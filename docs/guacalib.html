<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>guacalib API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#GuacamoleDB">GuacamoleDB</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GuacamoleDB.__init__">GuacamoleDB</a>
                        </li>
                        <li>
                                <a class="variable" href="#GuacamoleDB.CONNECTION_PARAMETERS">CONNECTION_PARAMETERS</a>
                        </li>
                        <li>
                                <a class="variable" href="#GuacamoleDB.USER_PARAMETERS">USER_PARAMETERS</a>
                        </li>
                        <li>
                                <a class="variable" href="#GuacamoleDB.debug">debug</a>
                        </li>
                        <li>
                                <a class="variable" href="#GuacamoleDB.logger">logger</a>
                        </li>
                        <li>
                                <a class="variable" href="#GuacamoleDB.db_config">db_config</a>
                        </li>
                        <li>
                                <a class="variable" href="#GuacamoleDB.conn">conn</a>
                        </li>
                        <li>
                                <a class="variable" href="#GuacamoleDB.cursor">cursor</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.debug_print">debug_print</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.read_config">read_config</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.connect_db">connect_db</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.list_users">list_users</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.list_usergroups">list_usergroups</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.usergroup_exists">usergroup_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_usergroup_id">get_usergroup_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.user_exists">user_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_connection_group_id_by_name">get_connection_group_id_by_name</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.modify_connection_parent_group">modify_connection_parent_group</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_connection_user_permissions">get_connection_user_permissions</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.modify_connection">modify_connection</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.change_user_password">change_user_password</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.modify_user">modify_user</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.delete_existing_user">delete_existing_user</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.delete_existing_usergroup">delete_existing_usergroup</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.delete_existing_usergroup_by_id">delete_existing_usergroup_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.delete_existing_connection">delete_existing_connection</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.delete_connection_group">delete_connection_group</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.create_user">create_user</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.create_usergroup">create_usergroup</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.add_user_to_usergroup">add_user_to_usergroup</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.remove_user_from_usergroup">remove_user_from_usergroup</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_connection_group_id">get_connection_group_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.connection_exists">connection_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.connection_group_exists">connection_group_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.create_connection">create_connection</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.grant_connection_permission">grant_connection_permission</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.list_users_with_usergroups">list_users_with_usergroups</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.list_connections_with_conngroups_and_parents">list_connections_with_conngroups_and_parents</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_connection_by_id">get_connection_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.list_usergroups_with_users_and_connections">list_usergroups_with_users_and_connections</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.create_connection_group">create_connection_group</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.grant_connection_permission_to_user">grant_connection_permission_to_user</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.revoke_connection_permission_from_user">revoke_connection_permission_from_user</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.modify_connection_group_parent">modify_connection_group_parent</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.list_connection_groups">list_connection_groups</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_connection_group_by_id">get_connection_group_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_connection_name_by_id">get_connection_name_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_connection_group_name_by_id">get_connection_group_name_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.validate_positive_id">validate_positive_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.resolve_connection_id">resolve_connection_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.resolve_conngroup_id">resolve_conngroup_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.resolve_usergroup_id">resolve_usergroup_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.usergroup_exists_by_id">usergroup_exists_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.get_usergroup_name_by_id">get_usergroup_name_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.list_groups_with_users">list_groups_with_users</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.debug_connection_permissions">debug_connection_permissions</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.grant_connection_group_permission_to_user">grant_connection_group_permission_to_user</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.revoke_connection_group_permission_from_user">revoke_connection_group_permission_from_user</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id">grant_connection_group_permission_to_user_by_id</a>
                        </li>
                        <li>
                                <a class="function" href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id">revoke_connection_group_permission_from_user_by_id</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#setup_logging">setup_logging</a>
            </li>
            <li>
                    <a class="function" href="#get_logger">get_logger</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
guacalib    </h1>

                        <div class="docstring"><p>Guacamole Database Management Library.</p>

<p>This library provides programmatic access to Apache Guacamole database operations,
enabling automated management of users, user groups, connections, and connection
groups through direct MySQL database access. It serves as both a Python library
and the foundation for the guacaman CLI tool.</p>

<p>The library focuses on security, reliability, and comprehensive functionality
for managing Guacamole deployments programmatically. It supports all major
Guacamole features including user management, permission control, connection
configuration, and hierarchical organization.</p>

<p>Key Features:</p>

<ul>
<li>Complete user and user group management</li>
<li>Connection and connection group operations</li>
<li>Fine-grained permission control</li>
<li>Hierarchical organization support</li>
<li>Transaction-based operations</li>
<li>Comprehensive error handling and validation</li>
<li>MySQL database connectivity with connection pooling</li>
</ul>

<p>Example:
    Basic usage for user management:</p>

<pre><code>&gt;&gt;&gt; from guacalib import GuacamoleDB
&gt;&gt;&gt;
&gt;&gt;&gt; # Initialize database connection
&gt;&gt;&gt; with GuacamoleDB() as db:
&gt;&gt;&gt;     # Create a new user
&gt;&gt;&gt;     db.create_user("testuser", "securepassword")
&gt;&gt;&gt;
&gt;&gt;&gt;     # Create a VNC connection
&gt;&gt;&gt;     conn_id = db.create_connection(
&gt;&gt;&gt;         "vnc", "desktop", "192.168.1.100", "5901", "vncpassword"
&gt;&gt;&gt;     )
&gt;&gt;&gt;
&gt;&gt;&gt;     # Grant user access to connection
&gt;&gt;&gt;     db.grant_connection_permission("testuser", "USER", conn_id)
</code></pre>

<p>Example:
    Connection group management:</p>

<pre><code>&gt;&gt;&gt; from guacalib import GuacamoleDB
&gt;&gt;&gt;
&gt;&gt;&gt; with GuacamoleDB() as db:
&gt;&gt;&gt;     # Create a connection group
&gt;&gt;&gt;     group_id = db.create_connection_group("Desktops", "ORGANIZATIONAL")
&gt;&gt;&gt;
&gt;&gt;&gt;     # Add connection to group
&gt;&gt;&gt;     db.create_connection(
&gt;&gt;&gt;         "vnc", "desktop-pc", "192.168.1.101", "5901", "password",
&gt;&gt;&gt;         parent_group_id=group_id
&gt;&gt;&gt;     )
&gt;&gt;&gt;
&gt;&gt;&gt;     # Grant group access to user group
&gt;&gt;&gt;     db.grant_connection_group_permission_to_user(
&gt;&gt;&gt;         "IT Staff", "USER_GROUP", group_id
&gt;&gt;&gt;     )
</code></pre>

<p>API Overview:
    The main entry point is the <code><a href="#GuacamoleDB">GuacamoleDB</a></code> class, which provides methods for:</p>

<pre><code>- **User Management**: create_user(), delete_existing_user(), modify_user()
- **User Groups**: create_usergroup(), add_user_to_usergroup()
- **Connections**: create_connection(), modify_connection(), delete_existing_connection()
- **Connection Groups**: create_connection_group(), modify_connection_group_parent()
- **Permissions**: grant_connection_permission(), revoke_connection_permission()
- **Data Listing**: list_users(), list_connections_with_conngroups_and_parents()

The GuacamoleDB class implements the context manager protocol for safe
database connection handling and supports MySQL connection parameters via
configuration files or direct parameter passing.
</code></pre>

<p>Security:
    - All SQL queries use parameterized statements to prevent injection
    - Database credentials stored in separate configuration files
    - Comprehensive input validation and error handling
    - Transaction support for atomic operations</p>

<p>Logging (Phase 4):
    The library provides comprehensive logging support for downstream applications:</p>

<pre><code>&gt;&gt;&gt; from guacalib import setup_logging, get_logger
&gt;&gt;&gt;
&gt;&gt;&gt; # Configure logging (optional - defaults to WARNING level)
&gt;&gt;&gt; setup_logging(debug=True)  # Enable debug logging
&gt;&gt;&gt;
&gt;&gt;&gt; # Get a module-specific logger
&gt;&gt;&gt; logger = get_logger('myapp')
&gt;&gt;&gt; logger.info("Application started")
&gt;&gt;&gt;
&gt;&gt;&gt; # Environment variables can override logging configuration:
&gt;&gt;&gt; # export GUACALIB_LOG_LEVEL=DEBUG
&gt;&gt;&gt; # export GUACALIB_LOG_FORMAT='%(asctime)s [%(levelname)s] %(name)s: %(message)s'
&gt;&gt;&gt; setup_logging()

Important: setup_logging() is never called automatically on import to respect
host application logging configuration. Applications must call it explicitly
if they want guacalib logging configured.

Logging Features:
- Environment variable support (GUACALIB_LOG_LEVEL, GUACALIB_LOG_FORMAT)
- Idempotent configuration - safe to call multiple times
- Uses stderr to preserve stdout for application data
- Module-specific loggers for clean log separation
- No interference with host application logging configuration
</code></pre>
</div>

                        <input id="mod-guacalib-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-guacalib-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Guacamole Database Management Library.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">This library provides programmatic access to Apache Guacamole database operations,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">enabling automated management of users, user groups, connections, and connection</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">groups through direct MySQL database access. It serves as both a Python library</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">and the foundation for the guacaman CLI tool.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">The library focuses on security, reliability, and comprehensive functionality</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">for managing Guacamole deployments programmatically. It supports all major</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">Guacamole features including user management, permission control, connection</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">configuration, and hierarchical organization.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">Key Features:</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">- Complete user and user group management</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">- Connection and connection group operations</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">- Fine-grained permission control</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">- Hierarchical organization support</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">- Transaction-based operations</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">- Comprehensive error handling and validation</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">- MySQL database connectivity with connection pooling</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">Example:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    Basic usage for user management:</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    &gt;&gt;&gt; from guacalib import GuacamoleDB</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    &gt;&gt;&gt; # Initialize database connection</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    &gt;&gt;&gt;     # Create a new user</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    &gt;&gt;&gt;     db.create_user(&quot;testuser&quot;, &quot;securepassword&quot;)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    &gt;&gt;&gt;     # Create a VNC connection</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    &gt;&gt;&gt;     conn_id = db.create_connection(</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    &gt;&gt;&gt;         &quot;vnc&quot;, &quot;desktop&quot;, &quot;192.168.1.100&quot;, &quot;5901&quot;, &quot;vncpassword&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    &gt;&gt;&gt;     )</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    &gt;&gt;&gt;     # Grant user access to connection</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    &gt;&gt;&gt;     db.grant_connection_permission(&quot;testuser&quot;, &quot;USER&quot;, conn_id)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">Example:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    Connection group management:</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    &gt;&gt;&gt; from guacalib import GuacamoleDB</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    &gt;&gt;&gt;     # Create a connection group</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    &gt;&gt;&gt;     group_id = db.create_connection_group(&quot;Desktops&quot;, &quot;ORGANIZATIONAL&quot;)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    &gt;&gt;&gt;     # Add connection to group</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    &gt;&gt;&gt;     db.create_connection(</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    &gt;&gt;&gt;         &quot;vnc&quot;, &quot;desktop-pc&quot;, &quot;192.168.1.101&quot;, &quot;5901&quot;, &quot;password&quot;,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    &gt;&gt;&gt;         parent_group_id=group_id</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    &gt;&gt;&gt;     )</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    &gt;&gt;&gt;     # Grant group access to user group</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    &gt;&gt;&gt;     db.grant_connection_group_permission_to_user(</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    &gt;&gt;&gt;         &quot;IT Staff&quot;, &quot;USER_GROUP&quot;, group_id</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    &gt;&gt;&gt;     )</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">API Overview:</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    The main entry point is the `GuacamoleDB` class, which provides methods for:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    - **User Management**: create_user(), delete_existing_user(), modify_user()</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    - **User Groups**: create_usergroup(), add_user_to_usergroup()</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    - **Connections**: create_connection(), modify_connection(), delete_existing_connection()</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    - **Connection Groups**: create_connection_group(), modify_connection_group_parent()</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">    - **Permissions**: grant_connection_permission(), revoke_connection_permission()</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    - **Data Listing**: list_users(), list_connections_with_conngroups_and_parents()</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    The GuacamoleDB class implements the context manager protocol for safe</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    database connection handling and supports MySQL connection parameters via</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    configuration files or direct parameter passing.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">Security:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    - All SQL queries use parameterized statements to prevent injection</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    - Database credentials stored in separate configuration files</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    - Comprehensive input validation and error handling</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    - Transaction support for atomic operations</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">Logging (Phase 4):</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">    The library provides comprehensive logging support for downstream applications:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    &gt;&gt;&gt; from guacalib import setup_logging, get_logger</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    &gt;&gt;&gt; # Configure logging (optional - defaults to WARNING level)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    &gt;&gt;&gt; setup_logging(debug=True)  # Enable debug logging</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    &gt;&gt;&gt; # Get a module-specific logger</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    &gt;&gt;&gt; logger = get_logger(&#39;myapp&#39;)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    &gt;&gt;&gt; logger.info(&quot;Application started&quot;)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    &gt;&gt;&gt;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    &gt;&gt;&gt; # Environment variables can override logging configuration:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    &gt;&gt;&gt; # export GUACALIB_LOG_LEVEL=DEBUG</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    &gt;&gt;&gt; # export GUACALIB_LOG_FORMAT=&#39;%(asctime)s [%(levelname)s] %(name)s: %(message)s&#39;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    &gt;&gt;&gt; setup_logging()</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    Important: setup_logging() is never called automatically on import to respect</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">    host application logging configuration. Applications must call it explicitly</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">    if they want guacalib logging configured.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">    Logging Features:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">    - Environment variable support (GUACALIB_LOG_LEVEL, GUACALIB_LOG_FORMAT)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    - Idempotent configuration - safe to call multiple times</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    - Uses stderr to preserve stdout for application data</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    - Module-specific loggers for clean log separation</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">    - No interference with host application logging configuration</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">GuacamoleDB</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">VERSION</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.logging_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_logging</span><span class="p">,</span> <span class="n">get_logger</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="n">VERSION</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GuacamoleDB&quot;</span><span class="p">,</span> <span class="s2">&quot;setup_logging&quot;</span><span class="p">,</span> <span class="s2">&quot;get_logger&quot;</span><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="GuacamoleDB">
                            <input id="GuacamoleDB-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GuacamoleDB</span>:

                <label class="view-source-button" for="GuacamoleDB-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB-29"><a href="#GuacamoleDB-29"><span class="linenos">  29</span></a><span class="k">class</span><span class="w"> </span><span class="nc">GuacamoleDB</span><span class="p">:</span>
</span><span id="GuacamoleDB-30"><a href="#GuacamoleDB-30"><span class="linenos">  30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Database interface for Apache Guacamole management.</span>
</span><span id="GuacamoleDB-31"><a href="#GuacamoleDB-31"><span class="linenos">  31</span></a>
</span><span id="GuacamoleDB-32"><a href="#GuacamoleDB-32"><span class="linenos">  32</span></a><span class="sd">    Provides a high-level interface for managing Apache Guacamole database entities</span>
</span><span id="GuacamoleDB-33"><a href="#GuacamoleDB-33"><span class="linenos">  33</span></a><span class="sd">    including users, user groups, connections, connection groups, and permissions.</span>
</span><span id="GuacamoleDB-34"><a href="#GuacamoleDB-34"><span class="linenos">  34</span></a><span class="sd">    This class handles MySQL database connections and provides methods for CRUD</span>
</span><span id="GuacamoleDB-35"><a href="#GuacamoleDB-35"><span class="linenos">  35</span></a><span class="sd">    operations on Guacamole entities.</span>
</span><span id="GuacamoleDB-36"><a href="#GuacamoleDB-36"><span class="linenos">  36</span></a>
</span><span id="GuacamoleDB-37"><a href="#GuacamoleDB-37"><span class="linenos">  37</span></a><span class="sd">    Attributes:</span>
</span><span id="GuacamoleDB-38"><a href="#GuacamoleDB-38"><span class="linenos">  38</span></a><span class="sd">        CONNECTION_PARAMETERS: Dictionary defining valid connection parameters by protocol.</span>
</span><span id="GuacamoleDB-39"><a href="#GuacamoleDB-39"><span class="linenos">  39</span></a><span class="sd">        USER_PARAMETERS: Dictionary defining valid user account parameters.</span>
</span><span id="GuacamoleDB-40"><a href="#GuacamoleDB-40"><span class="linenos">  40</span></a>
</span><span id="GuacamoleDB-41"><a href="#GuacamoleDB-41"><span class="linenos">  41</span></a><span class="sd">    Example:</span>
</span><span id="GuacamoleDB-42"><a href="#GuacamoleDB-42"><span class="linenos">  42</span></a><span class="sd">        &gt;&gt;&gt; # Using config file</span>
</span><span id="GuacamoleDB-43"><a href="#GuacamoleDB-43"><span class="linenos">  43</span></a><span class="sd">        &gt;&gt;&gt; with GuacamoleDB(&quot;~/.guacaman.ini&quot;) as db:</span>
</span><span id="GuacamoleDB-44"><a href="#GuacamoleDB-44"><span class="linenos">  44</span></a><span class="sd">        ...     users = db.list_users()</span>
</span><span id="GuacamoleDB-45"><a href="#GuacamoleDB-45"><span class="linenos">  45</span></a><span class="sd">        ...     print(f&quot;Found {len(users)} users&quot;)</span>
</span><span id="GuacamoleDB-46"><a href="#GuacamoleDB-46"><span class="linenos">  46</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="GuacamoleDB-47"><a href="#GuacamoleDB-47"><span class="linenos">  47</span></a><span class="sd">        &gt;&gt;&gt; # Using environment variables</span>
</span><span id="GuacamoleDB-48"><a href="#GuacamoleDB-48"><span class="linenos">  48</span></a><span class="sd">        &gt;&gt;&gt; import os</span>
</span><span id="GuacamoleDB-49"><a href="#GuacamoleDB-49"><span class="linenos">  49</span></a><span class="sd">        &gt;&gt;&gt; os.environ[&#39;GUACALIB_HOST&#39;] = &#39;localhost&#39;</span>
</span><span id="GuacamoleDB-50"><a href="#GuacamoleDB-50"><span class="linenos">  50</span></a><span class="sd">        &gt;&gt;&gt; os.environ[&#39;GUACALIB_USER&#39;] = &#39;guacamole_user&#39;</span>
</span><span id="GuacamoleDB-51"><a href="#GuacamoleDB-51"><span class="linenos">  51</span></a><span class="sd">        &gt;&gt;&gt; os.environ[&#39;GUACALIB_PASSWORD&#39;] = &#39;secret_password&#39;</span>
</span><span id="GuacamoleDB-52"><a href="#GuacamoleDB-52"><span class="linenos">  52</span></a><span class="sd">        &gt;&gt;&gt; os.environ[&#39;GUACALIB_DATABASE&#39;] = &#39;guacamole_db&#39;</span>
</span><span id="GuacamoleDB-53"><a href="#GuacamoleDB-53"><span class="linenos">  53</span></a><span class="sd">        &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-54"><a href="#GuacamoleDB-54"><span class="linenos">  54</span></a><span class="sd">        ...     users = db.list_users()</span>
</span><span id="GuacamoleDB-55"><a href="#GuacamoleDB-55"><span class="linenos">  55</span></a><span class="sd">        ...     print(f&quot;Found {len(users)} users&quot;)</span>
</span><span id="GuacamoleDB-56"><a href="#GuacamoleDB-56"><span class="linenos">  56</span></a>
</span><span id="GuacamoleDB-57"><a href="#GuacamoleDB-57"><span class="linenos">  57</span></a><span class="sd">    Note:</span>
</span><span id="GuacamoleDB-58"><a href="#GuacamoleDB-58"><span class="linenos">  58</span></a><span class="sd">        This class implements the context manager protocol for automatic</span>
</span><span id="GuacamoleDB-59"><a href="#GuacamoleDB-59"><span class="linenos">  59</span></a><span class="sd">        database connection handling and transaction management.</span>
</span><span id="GuacamoleDB-60"><a href="#GuacamoleDB-60"><span class="linenos">  60</span></a>
</span><span id="GuacamoleDB-61"><a href="#GuacamoleDB-61"><span class="linenos">  61</span></a><span class="sd">        Database connection can be configured using:</span>
</span><span id="GuacamoleDB-62"><a href="#GuacamoleDB-62"><span class="linenos">  62</span></a><span class="sd">        1. Environment variables (GUACALIB_HOST, GUACALIB_USER, GUACALIB_PASSWORD,</span>
</span><span id="GuacamoleDB-63"><a href="#GuacamoleDB-63"><span class="linenos">  63</span></a><span class="sd">           GUACALIB_DATABASE) - takes precedence</span>
</span><span id="GuacamoleDB-64"><a href="#GuacamoleDB-64"><span class="linenos">  64</span></a><span class="sd">        2. Configuration file with [mysql] section containing host, user, password,</span>
</span><span id="GuacamoleDB-65"><a href="#GuacamoleDB-65"><span class="linenos">  65</span></a><span class="sd">           and database keys</span>
</span><span id="GuacamoleDB-66"><a href="#GuacamoleDB-66"><span class="linenos">  66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-67"><a href="#GuacamoleDB-67"><span class="linenos">  67</span></a>
</span><span id="GuacamoleDB-68"><a href="#GuacamoleDB-68"><span class="linenos">  68</span></a>    <span class="n">CONNECTION_PARAMETERS</span> <span class="o">=</span> <span class="n">CONNECTION_PARAMETERS</span>
</span><span id="GuacamoleDB-69"><a href="#GuacamoleDB-69"><span class="linenos">  69</span></a>    <span class="n">USER_PARAMETERS</span> <span class="o">=</span> <span class="n">USER_PARAMETERS</span>
</span><span id="GuacamoleDB-70"><a href="#GuacamoleDB-70"><span class="linenos">  70</span></a>
</span><span id="GuacamoleDB-71"><a href="#GuacamoleDB-71"><span class="linenos">  71</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;db_config.ini&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-72"><a href="#GuacamoleDB-72"><span class="linenos">  72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize GuacamoleDB with configuration and database connection.</span>
</span><span id="GuacamoleDB-73"><a href="#GuacamoleDB-73"><span class="linenos">  73</span></a>
</span><span id="GuacamoleDB-74"><a href="#GuacamoleDB-74"><span class="linenos">  74</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-75"><a href="#GuacamoleDB-75"><span class="linenos">  75</span></a><span class="sd">            config_file: Path to MySQL configuration file. Defaults to &quot;db_config.ini&quot;.</span>
</span><span id="GuacamoleDB-76"><a href="#GuacamoleDB-76"><span class="linenos">  76</span></a><span class="sd">            debug: Enable debug output for database operations. Defaults to False.</span>
</span><span id="GuacamoleDB-77"><a href="#GuacamoleDB-77"><span class="linenos">  77</span></a>
</span><span id="GuacamoleDB-78"><a href="#GuacamoleDB-78"><span class="linenos">  78</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-79"><a href="#GuacamoleDB-79"><span class="linenos">  79</span></a><span class="sd">            SystemExit: If configuration file is not found or invalid and environment</span>
</span><span id="GuacamoleDB-80"><a href="#GuacamoleDB-80"><span class="linenos">  80</span></a><span class="sd">                       variables are not set.</span>
</span><span id="GuacamoleDB-81"><a href="#GuacamoleDB-81"><span class="linenos">  81</span></a><span class="sd">            mysql.connector.Error: If database connection fails.</span>
</span><span id="GuacamoleDB-82"><a href="#GuacamoleDB-82"><span class="linenos">  82</span></a>
</span><span id="GuacamoleDB-83"><a href="#GuacamoleDB-83"><span class="linenos">  83</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-84"><a href="#GuacamoleDB-84"><span class="linenos">  84</span></a><span class="sd">            Configuration is loaded in the following priority order:</span>
</span><span id="GuacamoleDB-85"><a href="#GuacamoleDB-85"><span class="linenos">  85</span></a><span class="sd">            1. Environment variables (GUACALIB_HOST, GUACALIB_USER, GUACALIB_PASSWORD,</span>
</span><span id="GuacamoleDB-86"><a href="#GuacamoleDB-86"><span class="linenos">  86</span></a><span class="sd">               GUACALIB_DATABASE)</span>
</span><span id="GuacamoleDB-87"><a href="#GuacamoleDB-87"><span class="linenos">  87</span></a><span class="sd">            2. Configuration file containing a [mysql] section with host, user,</span>
</span><span id="GuacamoleDB-88"><a href="#GuacamoleDB-88"><span class="linenos">  88</span></a><span class="sd">               password, and database keys.</span>
</span><span id="GuacamoleDB-89"><a href="#GuacamoleDB-89"><span class="linenos">  89</span></a>
</span><span id="GuacamoleDB-90"><a href="#GuacamoleDB-90"><span class="linenos">  90</span></a><span class="sd">            Environment variables take precedence over configuration file settings.</span>
</span><span id="GuacamoleDB-91"><a href="#GuacamoleDB-91"><span class="linenos">  91</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-92"><a href="#GuacamoleDB-92"><span class="linenos">  92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="GuacamoleDB-93"><a href="#GuacamoleDB-93"><span class="linenos">  93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB-94"><a href="#GuacamoleDB-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">db_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</span><span id="GuacamoleDB-95"><a href="#GuacamoleDB-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect_db</span><span class="p">()</span>
</span><span id="GuacamoleDB-96"><a href="#GuacamoleDB-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="GuacamoleDB-97"><a href="#GuacamoleDB-97"><span class="linenos">  97</span></a>
</span><span id="GuacamoleDB-98"><a href="#GuacamoleDB-98"><span class="linenos">  98</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_scrub_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="GuacamoleDB-99"><a href="#GuacamoleDB-99"><span class="linenos">  99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scrub sensitive credentials from log messages.</span>
</span><span id="GuacamoleDB-100"><a href="#GuacamoleDB-100"><span class="linenos"> 100</span></a>
</span><span id="GuacamoleDB-101"><a href="#GuacamoleDB-101"><span class="linenos"> 101</span></a><span class="sd">        This function removes sensitive information like passwords, tokens,</span>
</span><span id="GuacamoleDB-102"><a href="#GuacamoleDB-102"><span class="linenos"> 102</span></a><span class="sd">        and other credentials from log messages to prevent accidental exposure</span>
</span><span id="GuacamoleDB-103"><a href="#GuacamoleDB-103"><span class="linenos"> 103</span></a><span class="sd">        in logs. It replaces sensitive values with [REDACTED] placeholders.</span>
</span><span id="GuacamoleDB-104"><a href="#GuacamoleDB-104"><span class="linenos"> 104</span></a>
</span><span id="GuacamoleDB-105"><a href="#GuacamoleDB-105"><span class="linenos"> 105</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-106"><a href="#GuacamoleDB-106"><span class="linenos"> 106</span></a><span class="sd">            message: The original message that may contain sensitive credentials.</span>
</span><span id="GuacamoleDB-107"><a href="#GuacamoleDB-107"><span class="linenos"> 107</span></a>
</span><span id="GuacamoleDB-108"><a href="#GuacamoleDB-108"><span class="linenos"> 108</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-109"><a href="#GuacamoleDB-109"><span class="linenos"> 109</span></a><span class="sd">            The message with sensitive values replaced with [REDACTED].</span>
</span><span id="GuacamoleDB-110"><a href="#GuacamoleDB-110"><span class="linenos"> 110</span></a>
</span><span id="GuacamoleDB-111"><a href="#GuacamoleDB-111"><span class="linenos"> 111</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-112"><a href="#GuacamoleDB-112"><span class="linenos"> 112</span></a><span class="sd">            This function handles common credential patterns but may not catch</span>
</span><span id="GuacamoleDB-113"><a href="#GuacamoleDB-113"><span class="linenos"> 113</span></a><span class="sd">            all possible formats. Review log output to ensure no credentials</span>
</span><span id="GuacamoleDB-114"><a href="#GuacamoleDB-114"><span class="linenos"> 114</span></a><span class="sd">            are accidentally exposed.</span>
</span><span id="GuacamoleDB-115"><a href="#GuacamoleDB-115"><span class="linenos"> 115</span></a>
</span><span id="GuacamoleDB-116"><a href="#GuacamoleDB-116"><span class="linenos"> 116</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-117"><a href="#GuacamoleDB-117"><span class="linenos"> 117</span></a><span class="sd">            &gt;&gt;&gt; scrubbed = self._scrub_credentials(&quot;password=secret123&quot;)</span>
</span><span id="GuacamoleDB-118"><a href="#GuacamoleDB-118"><span class="linenos"> 118</span></a><span class="sd">            &gt;&gt;&gt; print(scrubbed)</span>
</span><span id="GuacamoleDB-119"><a href="#GuacamoleDB-119"><span class="linenos"> 119</span></a><span class="sd">            password=[REDACTED]</span>
</span><span id="GuacamoleDB-120"><a href="#GuacamoleDB-120"><span class="linenos"> 120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-121"><a href="#GuacamoleDB-121"><span class="linenos"> 121</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="GuacamoleDB-122"><a href="#GuacamoleDB-122"><span class="linenos"> 122</span></a>
</span><span id="GuacamoleDB-123"><a href="#GuacamoleDB-123"><span class="linenos"> 123</span></a>        <span class="c1"># Enhanced list of sensitive parameter names to scrub</span>
</span><span id="GuacamoleDB-124"><a href="#GuacamoleDB-124"><span class="linenos"> 124</span></a>        <span class="n">sensitive_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="GuacamoleDB-125"><a href="#GuacamoleDB-125"><span class="linenos"> 125</span></a>            <span class="c1"># Basic password patterns</span>
</span><span id="GuacamoleDB-126"><a href="#GuacamoleDB-126"><span class="linenos"> 126</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;password[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;password=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-127"><a href="#GuacamoleDB-127"><span class="linenos"> 127</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;passwd[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;passwd=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-128"><a href="#GuacamoleDB-128"><span class="linenos"> 128</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;pwd[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;pwd=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-129"><a href="#GuacamoleDB-129"><span class="linenos"> 129</span></a>
</span><span id="GuacamoleDB-130"><a href="#GuacamoleDB-130"><span class="linenos"> 130</span></a>            <span class="c1"># Authentication secrets</span>
</span><span id="GuacamoleDB-131"><a href="#GuacamoleDB-131"><span class="linenos"> 131</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;salt[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;salt=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-132"><a href="#GuacamoleDB-132"><span class="linenos"> 132</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;secret[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;secret=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-133"><a href="#GuacamoleDB-133"><span class="linenos"> 133</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;token[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;token=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-134"><a href="#GuacamoleDB-134"><span class="linenos"> 134</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;api_key[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;api_key=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-135"><a href="#GuacamoleDB-135"><span class="linenos"> 135</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;apikey[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;apikey=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-136"><a href="#GuacamoleDB-136"><span class="linenos"> 136</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;access_key[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;access_key=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-137"><a href="#GuacamoleDB-137"><span class="linenos"> 137</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;secret_key[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;secret_key=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-138"><a href="#GuacamoleDB-138"><span class="linenos"> 138</span></a>
</span><span id="GuacamoleDB-139"><a href="#GuacamoleDB-139"><span class="linenos"> 139</span></a>            <span class="c1"># Database connection patterns</span>
</span><span id="GuacamoleDB-140"><a href="#GuacamoleDB-140"><span class="linenos"> 140</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;database[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+@[^\s</span><span class="se">\&#39;</span><span class="s1">&quot;]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;database=user@[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-141"><a href="#GuacamoleDB-141"><span class="linenos"> 141</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mysql://[^@]+@&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql://[REDACTED]@&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-142"><a href="#GuacamoleDB-142"><span class="linenos"> 142</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;mysql\+://[^@]+@&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql+://[REDACTED]@&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-143"><a href="#GuacamoleDB-143"><span class="linenos"> 143</span></a>
</span><span id="GuacamoleDB-144"><a href="#GuacamoleDB-144"><span class="linenos"> 144</span></a>            <span class="c1"># Common authentication field names</span>
</span><span id="GuacamoleDB-145"><a href="#GuacamoleDB-145"><span class="linenos"> 145</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;auth[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;auth=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-146"><a href="#GuacamoleDB-146"><span class="linenos"> 146</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;private_key[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;private_key=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-147"><a href="#GuacamoleDB-147"><span class="linenos"> 147</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;credential[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;credential=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-148"><a href="#GuacamoleDB-148"><span class="linenos"> 148</span></a>            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;credentials[&quot;</span><span class="se">\&#39;</span><span class="s1">]?\s*[:=]\s*[&quot;</span><span class="se">\&#39;</span><span class="s1">]?([^&quot;</span><span class="se">\&#39;</span><span class="s1">\s,}]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;credentials=[REDACTED]&#39;</span><span class="p">),</span>
</span><span id="GuacamoleDB-149"><a href="#GuacamoleDB-149"><span class="linenos"> 149</span></a>        <span class="p">]</span>
</span><span id="GuacamoleDB-150"><a href="#GuacamoleDB-150"><span class="linenos"> 150</span></a>
</span><span id="GuacamoleDB-151"><a href="#GuacamoleDB-151"><span class="linenos"> 151</span></a>        <span class="n">scrubbed</span> <span class="o">=</span> <span class="n">message</span>
</span><span id="GuacamoleDB-152"><a href="#GuacamoleDB-152"><span class="linenos"> 152</span></a>        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="n">sensitive_patterns</span><span class="p">:</span>
</span><span id="GuacamoleDB-153"><a href="#GuacamoleDB-153"><span class="linenos"> 153</span></a>            <span class="n">scrubbed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">scrubbed</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="GuacamoleDB-154"><a href="#GuacamoleDB-154"><span class="linenos"> 154</span></a>
</span><span id="GuacamoleDB-155"><a href="#GuacamoleDB-155"><span class="linenos"> 155</span></a>        <span class="k">return</span> <span class="n">scrubbed</span>
</span><span id="GuacamoleDB-156"><a href="#GuacamoleDB-156"><span class="linenos"> 156</span></a>
</span><span id="GuacamoleDB-157"><a href="#GuacamoleDB-157"><span class="linenos"> 157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">debug_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-158"><a href="#GuacamoleDB-158"><span class="linenos"> 158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print debug messages if debug mode is enabled with credential scrubbing.</span>
</span><span id="GuacamoleDB-159"><a href="#GuacamoleDB-159"><span class="linenos"> 159</span></a>
</span><span id="GuacamoleDB-160"><a href="#GuacamoleDB-160"><span class="linenos"> 160</span></a><span class="sd">        This method provides backward compatibility by using logging when configured</span>
</span><span id="GuacamoleDB-161"><a href="#GuacamoleDB-161"><span class="linenos"> 161</span></a><span class="sd">        and falling back to print statements when logging is not available. All</span>
</span><span id="GuacamoleDB-162"><a href="#GuacamoleDB-162"><span class="linenos"> 162</span></a><span class="sd">        messages are scrubbed for sensitive credentials before output.</span>
</span><span id="GuacamoleDB-163"><a href="#GuacamoleDB-163"><span class="linenos"> 163</span></a>
</span><span id="GuacamoleDB-164"><a href="#GuacamoleDB-164"><span class="linenos"> 164</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-165"><a href="#GuacamoleDB-165"><span class="linenos"> 165</span></a><span class="sd">            *args: Arguments to pass to print function or logger. All arguments</span>
</span><span id="GuacamoleDB-166"><a href="#GuacamoleDB-166"><span class="linenos"> 166</span></a><span class="sd">                  will be converted to strings and scrubbed for credentials.</span>
</span><span id="GuacamoleDB-167"><a href="#GuacamoleDB-167"><span class="linenos"> 167</span></a><span class="sd">            **kwargs: Keyword arguments to pass to print function or logger.</span>
</span><span id="GuacamoleDB-168"><a href="#GuacamoleDB-168"><span class="linenos"> 168</span></a>
</span><span id="GuacamoleDB-169"><a href="#GuacamoleDB-169"><span class="linenos"> 169</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-170"><a href="#GuacamoleDB-170"><span class="linenos"> 170</span></a><span class="sd">            This method automatically scrubs all arguments for sensitive</span>
</span><span id="GuacamoleDB-171"><a href="#GuacamoleDB-171"><span class="linenos"> 171</span></a><span class="sd">            credentials before output to prevent accidental exposure in logs</span>
</span><span id="GuacamoleDB-172"><a href="#GuacamoleDB-172"><span class="linenos"> 172</span></a><span class="sd">            or debug output. It maintains the original debug functionality</span>
</span><span id="GuacamoleDB-173"><a href="#GuacamoleDB-173"><span class="linenos"> 173</span></a><span class="sd">            while enhancing security.</span>
</span><span id="GuacamoleDB-174"><a href="#GuacamoleDB-174"><span class="linenos"> 174</span></a>
</span><span id="GuacamoleDB-175"><a href="#GuacamoleDB-175"><span class="linenos"> 175</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-176"><a href="#GuacamoleDB-176"><span class="linenos"> 176</span></a><span class="sd">            &gt;&gt;&gt; self.debug_print(&quot;Connecting with password=secret123&quot;)</span>
</span><span id="GuacamoleDB-177"><a href="#GuacamoleDB-177"><span class="linenos"> 177</span></a><span class="sd">            [DEBUG] Connecting with password=[REDACTED]</span>
</span><span id="GuacamoleDB-178"><a href="#GuacamoleDB-178"><span class="linenos"> 178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-179"><a href="#GuacamoleDB-179"><span class="linenos"> 179</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="GuacamoleDB-180"><a href="#GuacamoleDB-180"><span class="linenos"> 180</span></a>            <span class="c1"># Convert all arguments to strings and scrub credentials</span>
</span><span id="GuacamoleDB-181"><a href="#GuacamoleDB-181"><span class="linenos"> 181</span></a>            <span class="n">scrubbed_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-182"><a href="#GuacamoleDB-182"><span class="linenos"> 182</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="GuacamoleDB-183"><a href="#GuacamoleDB-183"><span class="linenos"> 183</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB-184"><a href="#GuacamoleDB-184"><span class="linenos"> 184</span></a>                    <span class="n">scrubbed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
</span><span id="GuacamoleDB-185"><a href="#GuacamoleDB-185"><span class="linenos"> 185</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-186"><a href="#GuacamoleDB-186"><span class="linenos"> 186</span></a>                    <span class="c1"># For non-string arguments, convert to string then scrub</span>
</span><span id="GuacamoleDB-187"><a href="#GuacamoleDB-187"><span class="linenos"> 187</span></a>                    <span class="n">scrubbed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)))</span>
</span><span id="GuacamoleDB-188"><a href="#GuacamoleDB-188"><span class="linenos"> 188</span></a>
</span><span id="GuacamoleDB-189"><a href="#GuacamoleDB-189"><span class="linenos"> 189</span></a>            <span class="c1"># Try to use logging if it&#39;s configured, otherwise fall back to print</span>
</span><span id="GuacamoleDB-190"><a href="#GuacamoleDB-190"><span class="linenos"> 190</span></a>            <span class="c1"># Check if logging has been configured by checking if the logger has handlers</span>
</span><span id="GuacamoleDB-191"><a href="#GuacamoleDB-191"><span class="linenos"> 191</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s1">&#39;handlers&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
</span><span id="GuacamoleDB-192"><a href="#GuacamoleDB-192"><span class="linenos"> 192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scrubbed_args</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="GuacamoleDB-193"><a href="#GuacamoleDB-193"><span class="linenos"> 193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-194"><a href="#GuacamoleDB-194"><span class="linenos"> 194</span></a>                <span class="c1"># Fallback to original print behavior</span>
</span><span id="GuacamoleDB-195"><a href="#GuacamoleDB-195"><span class="linenos"> 195</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">scrubbed_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="GuacamoleDB-196"><a href="#GuacamoleDB-196"><span class="linenos"> 196</span></a>
</span><span id="GuacamoleDB-197"><a href="#GuacamoleDB-197"><span class="linenos"> 197</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GuacamoleDB&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-198"><a href="#GuacamoleDB-198"><span class="linenos"> 198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enter the runtime context for the database connection.</span>
</span><span id="GuacamoleDB-199"><a href="#GuacamoleDB-199"><span class="linenos"> 199</span></a>
</span><span id="GuacamoleDB-200"><a href="#GuacamoleDB-200"><span class="linenos"> 200</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-201"><a href="#GuacamoleDB-201"><span class="linenos"> 201</span></a><span class="sd">            The GuacamoleDB instance for use in the with statement.</span>
</span><span id="GuacamoleDB-202"><a href="#GuacamoleDB-202"><span class="linenos"> 202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-203"><a href="#GuacamoleDB-203"><span class="linenos"> 203</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="GuacamoleDB-204"><a href="#GuacamoleDB-204"><span class="linenos"> 204</span></a>
</span><span id="GuacamoleDB-205"><a href="#GuacamoleDB-205"><span class="linenos"> 205</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span>
</span><span id="GuacamoleDB-206"><a href="#GuacamoleDB-206"><span class="linenos"> 206</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB-207"><a href="#GuacamoleDB-207"><span class="linenos"> 207</span></a>        <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
</span><span id="GuacamoleDB-208"><a href="#GuacamoleDB-208"><span class="linenos"> 208</span></a>        <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
</span><span id="GuacamoleDB-209"><a href="#GuacamoleDB-209"><span class="linenos"> 209</span></a>        <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="GuacamoleDB-210"><a href="#GuacamoleDB-210"><span class="linenos"> 210</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-211"><a href="#GuacamoleDB-211"><span class="linenos"> 211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Exit the runtime context and handle database connection cleanup.</span>
</span><span id="GuacamoleDB-212"><a href="#GuacamoleDB-212"><span class="linenos"> 212</span></a>
</span><span id="GuacamoleDB-213"><a href="#GuacamoleDB-213"><span class="linenos"> 213</span></a><span class="sd">        Commits transactions if no exception occurred, rolls back if there was</span>
</span><span id="GuacamoleDB-214"><a href="#GuacamoleDB-214"><span class="linenos"> 214</span></a><span class="sd">        an exception, and closes database connections.</span>
</span><span id="GuacamoleDB-215"><a href="#GuacamoleDB-215"><span class="linenos"> 215</span></a>
</span><span id="GuacamoleDB-216"><a href="#GuacamoleDB-216"><span class="linenos"> 216</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-217"><a href="#GuacamoleDB-217"><span class="linenos"> 217</span></a><span class="sd">            exc_type: Exception type if an exception occurred, None otherwise.</span>
</span><span id="GuacamoleDB-218"><a href="#GuacamoleDB-218"><span class="linenos"> 218</span></a><span class="sd">            exc_value: Exception value if an exception occurred, None otherwise.</span>
</span><span id="GuacamoleDB-219"><a href="#GuacamoleDB-219"><span class="linenos"> 219</span></a><span class="sd">            traceback: Exception traceback if an exception occurred, None otherwise.</span>
</span><span id="GuacamoleDB-220"><a href="#GuacamoleDB-220"><span class="linenos"> 220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-221"><a href="#GuacamoleDB-221"><span class="linenos"> 221</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">:</span>
</span><span id="GuacamoleDB-222"><a href="#GuacamoleDB-222"><span class="linenos"> 222</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="GuacamoleDB-223"><a href="#GuacamoleDB-223"><span class="linenos"> 223</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">:</span>
</span><span id="GuacamoleDB-224"><a href="#GuacamoleDB-224"><span class="linenos"> 224</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-225"><a href="#GuacamoleDB-225"><span class="linenos"> 225</span></a>                <span class="c1"># Always commit unless there was an exception</span>
</span><span id="GuacamoleDB-226"><a href="#GuacamoleDB-226"><span class="linenos"> 226</span></a>                <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-227"><a href="#GuacamoleDB-227"><span class="linenos"> 227</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="GuacamoleDB-228"><a href="#GuacamoleDB-228"><span class="linenos"> 228</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Transaction committed successfully&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-229"><a href="#GuacamoleDB-229"><span class="linenos"> 229</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-230"><a href="#GuacamoleDB-230"><span class="linenos"> 230</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span><span id="GuacamoleDB-231"><a href="#GuacamoleDB-231"><span class="linenos"> 231</span></a>                    <span class="c1"># Only log rollback for non-SystemExit exceptions to avoid test noise</span>
</span><span id="GuacamoleDB-232"><a href="#GuacamoleDB-232"><span class="linenos"> 232</span></a>                    <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ne">SystemExit</span><span class="p">:</span>
</span><span id="GuacamoleDB-233"><a href="#GuacamoleDB-233"><span class="linenos"> 233</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transaction rolled back due to </span><span class="si">{</span><span class="n">exc_type</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-234"><a href="#GuacamoleDB-234"><span class="linenos"> 234</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="GuacamoleDB-235"><a href="#GuacamoleDB-235"><span class="linenos"> 235</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="GuacamoleDB-236"><a href="#GuacamoleDB-236"><span class="linenos"> 236</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Closing database connection&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-237"><a href="#GuacamoleDB-237"><span class="linenos"> 237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="GuacamoleDB-238"><a href="#GuacamoleDB-238"><span class="linenos"> 238</span></a>
</span><span id="GuacamoleDB-239"><a href="#GuacamoleDB-239"><span class="linenos"> 239</span></a>    <span class="nd">@staticmethod</span>
</span><span id="GuacamoleDB-240"><a href="#GuacamoleDB-240"><span class="linenos"> 240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConnectionConfig</span><span class="p">:</span>
</span><span id="GuacamoleDB-241"><a href="#GuacamoleDB-241"><span class="linenos"> 241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read and validate MySQL database configuration from environment variables or file.</span>
</span><span id="GuacamoleDB-242"><a href="#GuacamoleDB-242"><span class="linenos"> 242</span></a>
</span><span id="GuacamoleDB-243"><a href="#GuacamoleDB-243"><span class="linenos"> 243</span></a><span class="sd">        First checks for environment variables (GUACALIB_HOST, GUACALIB_USER,</span>
</span><span id="GuacamoleDB-244"><a href="#GuacamoleDB-244"><span class="linenos"> 244</span></a><span class="sd">        GUACALIB_PASSWORD, GUACALIB_DATABASE). If all required environment variables</span>
</span><span id="GuacamoleDB-245"><a href="#GuacamoleDB-245"><span class="linenos"> 245</span></a><span class="sd">        are present, they are used. Otherwise, falls back to reading from configuration</span>
</span><span id="GuacamoleDB-246"><a href="#GuacamoleDB-246"><span class="linenos"> 246</span></a><span class="sd">        file.</span>
</span><span id="GuacamoleDB-247"><a href="#GuacamoleDB-247"><span class="linenos"> 247</span></a>
</span><span id="GuacamoleDB-248"><a href="#GuacamoleDB-248"><span class="linenos"> 248</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-249"><a href="#GuacamoleDB-249"><span class="linenos"> 249</span></a><span class="sd">            config_file: Path to the configuration file.</span>
</span><span id="GuacamoleDB-250"><a href="#GuacamoleDB-250"><span class="linenos"> 250</span></a>
</span><span id="GuacamoleDB-251"><a href="#GuacamoleDB-251"><span class="linenos"> 251</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-252"><a href="#GuacamoleDB-252"><span class="linenos"> 252</span></a><span class="sd">            Dictionary containing MySQL connection parameters with keys:</span>
</span><span id="GuacamoleDB-253"><a href="#GuacamoleDB-253"><span class="linenos"> 253</span></a><span class="sd">            &#39;host&#39;, &#39;user&#39;, &#39;password&#39;, &#39;database&#39;.</span>
</span><span id="GuacamoleDB-254"><a href="#GuacamoleDB-254"><span class="linenos"> 254</span></a>
</span><span id="GuacamoleDB-255"><a href="#GuacamoleDB-255"><span class="linenos"> 255</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-256"><a href="#GuacamoleDB-256"><span class="linenos"> 256</span></a><span class="sd">            SystemExit: If config file is not found, missing required sections,</span>
</span><span id="GuacamoleDB-257"><a href="#GuacamoleDB-257"><span class="linenos"> 257</span></a><span class="sd">                       contains invalid configuration, or environment variables</span>
</span><span id="GuacamoleDB-258"><a href="#GuacamoleDB-258"><span class="linenos"> 258</span></a><span class="sd">                       are incomplete.</span>
</span><span id="GuacamoleDB-259"><a href="#GuacamoleDB-259"><span class="linenos"> 259</span></a>
</span><span id="GuacamoleDB-260"><a href="#GuacamoleDB-260"><span class="linenos"> 260</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-261"><a href="#GuacamoleDB-261"><span class="linenos"> 261</span></a><span class="sd">            &gt;&gt;&gt; # Using environment variables</span>
</span><span id="GuacamoleDB-262"><a href="#GuacamoleDB-262"><span class="linenos"> 262</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_HOST&#39;] = &#39;localhost&#39;</span>
</span><span id="GuacamoleDB-263"><a href="#GuacamoleDB-263"><span class="linenos"> 263</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_USER&#39;] = &#39;guacamole_user&#39;</span>
</span><span id="GuacamoleDB-264"><a href="#GuacamoleDB-264"><span class="linenos"> 264</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_PASSWORD&#39;] = &#39;secret_password&#39;</span>
</span><span id="GuacamoleDB-265"><a href="#GuacamoleDB-265"><span class="linenos"> 265</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_DATABASE&#39;] = &#39;guacamole_db&#39;</span>
</span><span id="GuacamoleDB-266"><a href="#GuacamoleDB-266"><span class="linenos"> 266</span></a><span class="sd">            &gt;&gt;&gt; config = GuacamoleDB.read_config(&quot;~/.guacaman.ini&quot;)</span>
</span><span id="GuacamoleDB-267"><a href="#GuacamoleDB-267"><span class="linenos"> 267</span></a><span class="sd">            &gt;&gt;&gt; print(config[&#39;host&#39;])</span>
</span><span id="GuacamoleDB-268"><a href="#GuacamoleDB-268"><span class="linenos"> 268</span></a><span class="sd">            &#39;localhost&#39;</span>
</span><span id="GuacamoleDB-269"><a href="#GuacamoleDB-269"><span class="linenos"> 269</span></a>
</span><span id="GuacamoleDB-270"><a href="#GuacamoleDB-270"><span class="linenos"> 270</span></a><span class="sd">            &gt;&gt;&gt; # Using config file</span>
</span><span id="GuacamoleDB-271"><a href="#GuacamoleDB-271"><span class="linenos"> 271</span></a><span class="sd">            &gt;&gt;&gt; config = GuacamoleDB.read_config(&quot;~/.guacaman.ini&quot;)</span>
</span><span id="GuacamoleDB-272"><a href="#GuacamoleDB-272"><span class="linenos"> 272</span></a><span class="sd">            &gt;&gt;&gt; print(config[&#39;host&#39;])</span>
</span><span id="GuacamoleDB-273"><a href="#GuacamoleDB-273"><span class="linenos"> 273</span></a><span class="sd">            &#39;localhost&#39;</span>
</span><span id="GuacamoleDB-274"><a href="#GuacamoleDB-274"><span class="linenos"> 274</span></a>
</span><span id="GuacamoleDB-275"><a href="#GuacamoleDB-275"><span class="linenos"> 275</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-276"><a href="#GuacamoleDB-276"><span class="linenos"> 276</span></a><span class="sd">            Environment variables take precedence over configuration file settings.</span>
</span><span id="GuacamoleDB-277"><a href="#GuacamoleDB-277"><span class="linenos"> 277</span></a>
</span><span id="GuacamoleDB-278"><a href="#GuacamoleDB-278"><span class="linenos"> 278</span></a><span class="sd">            Environment variables:</span>
</span><span id="GuacamoleDB-279"><a href="#GuacamoleDB-279"><span class="linenos"> 279</span></a><span class="sd">            - GUACALIB_HOST: MySQL server hostname</span>
</span><span id="GuacamoleDB-280"><a href="#GuacamoleDB-280"><span class="linenos"> 280</span></a><span class="sd">            - GUACALIB_USER: MySQL username</span>
</span><span id="GuacamoleDB-281"><a href="#GuacamoleDB-281"><span class="linenos"> 281</span></a><span class="sd">            - GUACALIB_PASSWORD: MySQL password</span>
</span><span id="GuacamoleDB-282"><a href="#GuacamoleDB-282"><span class="linenos"> 282</span></a><span class="sd">            - GUACALIB_DATABASE: MySQL database name</span>
</span><span id="GuacamoleDB-283"><a href="#GuacamoleDB-283"><span class="linenos"> 283</span></a>
</span><span id="GuacamoleDB-284"><a href="#GuacamoleDB-284"><span class="linenos"> 284</span></a><span class="sd">            Configuration file format:</span>
</span><span id="GuacamoleDB-285"><a href="#GuacamoleDB-285"><span class="linenos"> 285</span></a><span class="sd">            [mysql]</span>
</span><span id="GuacamoleDB-286"><a href="#GuacamoleDB-286"><span class="linenos"> 286</span></a><span class="sd">            host = localhost</span>
</span><span id="GuacamoleDB-287"><a href="#GuacamoleDB-287"><span class="linenos"> 287</span></a><span class="sd">            user = guacamole_user</span>
</span><span id="GuacamoleDB-288"><a href="#GuacamoleDB-288"><span class="linenos"> 288</span></a><span class="sd">            password = secret_password</span>
</span><span id="GuacamoleDB-289"><a href="#GuacamoleDB-289"><span class="linenos"> 289</span></a><span class="sd">            database = guacamole_db</span>
</span><span id="GuacamoleDB-290"><a href="#GuacamoleDB-290"><span class="linenos"> 290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-291"><a href="#GuacamoleDB-291"><span class="linenos"> 291</span></a>        <span class="c1"># First try to get configuration from environment variables</span>
</span><span id="GuacamoleDB-292"><a href="#GuacamoleDB-292"><span class="linenos"> 292</span></a>        <span class="n">env_vars</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB-293"><a href="#GuacamoleDB-293"><span class="linenos"> 293</span></a>            <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_HOST&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB-294"><a href="#GuacamoleDB-294"><span class="linenos"> 294</span></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_USER&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB-295"><a href="#GuacamoleDB-295"><span class="linenos"> 295</span></a>            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_PASSWORD&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB-296"><a href="#GuacamoleDB-296"><span class="linenos"> 296</span></a>            <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_DATABASE&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB-297"><a href="#GuacamoleDB-297"><span class="linenos"> 297</span></a>        <span class="p">}</span>
</span><span id="GuacamoleDB-298"><a href="#GuacamoleDB-298"><span class="linenos"> 298</span></a>
</span><span id="GuacamoleDB-299"><a href="#GuacamoleDB-299"><span class="linenos"> 299</span></a>        <span class="c1"># Check if all required environment variables are present</span>
</span><span id="GuacamoleDB-300"><a href="#GuacamoleDB-300"><span class="linenos"> 300</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">env_vars</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="GuacamoleDB-301"><a href="#GuacamoleDB-301"><span class="linenos"> 301</span></a>            <span class="k">return</span> <span class="n">env_vars</span>
</span><span id="GuacamoleDB-302"><a href="#GuacamoleDB-302"><span class="linenos"> 302</span></a>
</span><span id="GuacamoleDB-303"><a href="#GuacamoleDB-303"><span class="linenos"> 303</span></a>        <span class="c1"># If environment variables are not complete, fall back to config file</span>
</span><span id="GuacamoleDB-304"><a href="#GuacamoleDB-304"><span class="linenos"> 304</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</span><span id="GuacamoleDB-305"><a href="#GuacamoleDB-305"><span class="linenos"> 305</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
</span><span id="GuacamoleDB-306"><a href="#GuacamoleDB-306"><span class="linenos"> 306</span></a>            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB-307"><a href="#GuacamoleDB-307"><span class="linenos"> 307</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file not found: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-308"><a href="#GuacamoleDB-308"><span class="linenos"> 308</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Config file not found. Please set environment variables or create a config file at ~/.guacaman.ini&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-309"><a href="#GuacamoleDB-309"><span class="linenos"> 309</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option 1: Set environment variables:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-310"><a href="#GuacamoleDB-310"><span class="linenos"> 310</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_HOST=your_mysql_host&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-311"><a href="#GuacamoleDB-311"><span class="linenos"> 311</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_USER=your_mysql_user&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-312"><a href="#GuacamoleDB-312"><span class="linenos"> 312</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_PASSWORD=your_mysql_password&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-313"><a href="#GuacamoleDB-313"><span class="linenos"> 313</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_DATABASE=your_mysql_database&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-314"><a href="#GuacamoleDB-314"><span class="linenos"> 314</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option 2: Create a config file with the following format:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-315"><a href="#GuacamoleDB-315"><span class="linenos"> 315</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[mysql]&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-316"><a href="#GuacamoleDB-316"><span class="linenos"> 316</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;host = your_mysql_host&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-317"><a href="#GuacamoleDB-317"><span class="linenos"> 317</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;user = your_mysql_user&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-318"><a href="#GuacamoleDB-318"><span class="linenos"> 318</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;password = your_mysql_password&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-319"><a href="#GuacamoleDB-319"><span class="linenos"> 319</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;database = your_mysql_database&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-320"><a href="#GuacamoleDB-320"><span class="linenos"> 320</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB-321"><a href="#GuacamoleDB-321"><span class="linenos"> 321</span></a>
</span><span id="GuacamoleDB-322"><a href="#GuacamoleDB-322"><span class="linenos"> 322</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-323"><a href="#GuacamoleDB-323"><span class="linenos"> 323</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</span><span id="GuacamoleDB-324"><a href="#GuacamoleDB-324"><span class="linenos"> 324</span></a>            <span class="k">if</span> <span class="s2">&quot;mysql&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
</span><span id="GuacamoleDB-325"><a href="#GuacamoleDB-325"><span class="linenos"> 325</span></a>                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB-326"><a href="#GuacamoleDB-326"><span class="linenos"> 326</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing [mysql] section in config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-327"><a href="#GuacamoleDB-327"><span class="linenos"> 327</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Missing [mysql] section in config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-328"><a href="#GuacamoleDB-328"><span class="linenos"> 328</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB-329"><a href="#GuacamoleDB-329"><span class="linenos"> 329</span></a>
</span><span id="GuacamoleDB-330"><a href="#GuacamoleDB-330"><span class="linenos"> 330</span></a>            <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">]</span>
</span><span id="GuacamoleDB-331"><a href="#GuacamoleDB-331"><span class="linenos"> 331</span></a>            <span class="n">missing_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">]]</span>
</span><span id="GuacamoleDB-332"><a href="#GuacamoleDB-332"><span class="linenos"> 332</span></a>            <span class="k">if</span> <span class="n">missing_keys</span><span class="p">:</span>
</span><span id="GuacamoleDB-333"><a href="#GuacamoleDB-333"><span class="linenos"> 333</span></a>                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB-334"><a href="#GuacamoleDB-334"><span class="linenos"> 334</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required keys in [mysql] section: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_keys</span><span class="p">)</span><span class="si">}</span><span class="s2"> in config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-335"><a href="#GuacamoleDB-335"><span class="linenos"> 335</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="GuacamoleDB-336"><a href="#GuacamoleDB-336"><span class="linenos"> 336</span></a>                    <span class="sa">f</span><span class="s2">&quot;Error: Missing required keys in [mysql] section: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-337"><a href="#GuacamoleDB-337"><span class="linenos"> 337</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-338"><a href="#GuacamoleDB-338"><span class="linenos"> 338</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-339"><a href="#GuacamoleDB-339"><span class="linenos"> 339</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB-340"><a href="#GuacamoleDB-340"><span class="linenos"> 340</span></a>
</span><span id="GuacamoleDB-341"><a href="#GuacamoleDB-341"><span class="linenos"> 341</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="GuacamoleDB-342"><a href="#GuacamoleDB-342"><span class="linenos"> 342</span></a>                <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;host&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB-343"><a href="#GuacamoleDB-343"><span class="linenos"> 343</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB-344"><a href="#GuacamoleDB-344"><span class="linenos"> 344</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB-345"><a href="#GuacamoleDB-345"><span class="linenos"> 345</span></a>                <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;database&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB-346"><a href="#GuacamoleDB-346"><span class="linenos"> 346</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB-347"><a href="#GuacamoleDB-347"><span class="linenos"> 347</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-348"><a href="#GuacamoleDB-348"><span class="linenos"> 348</span></a>            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB-349"><a href="#GuacamoleDB-349"><span class="linenos"> 349</span></a>            <span class="c1"># Simple credential scrubbing for static method</span>
</span><span id="GuacamoleDB-350"><a href="#GuacamoleDB-350"><span class="linenos"> 350</span></a>            <span class="n">scrubbed_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;password=&#39;</span><span class="p">,</span> <span class="s1">&#39;password=[REDACTED]&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB-351"><a href="#GuacamoleDB-351"><span class="linenos"> 351</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading config file </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">scrubbed_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-352"><a href="#GuacamoleDB-352"><span class="linenos"> 352</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading config file </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-353"><a href="#GuacamoleDB-353"><span class="linenos"> 353</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB-354"><a href="#GuacamoleDB-354"><span class="linenos"> 354</span></a>
</span><span id="GuacamoleDB-355"><a href="#GuacamoleDB-355"><span class="linenos"> 355</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MySQLConnection</span><span class="p">:</span>
</span><span id="GuacamoleDB-356"><a href="#GuacamoleDB-356"><span class="linenos"> 356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Establish MySQL database connection using loaded configuration.</span>
</span><span id="GuacamoleDB-357"><a href="#GuacamoleDB-357"><span class="linenos"> 357</span></a>
</span><span id="GuacamoleDB-358"><a href="#GuacamoleDB-358"><span class="linenos"> 358</span></a><span class="sd">        Creates a MySQL connection using the configuration loaded by read_config().</span>
</span><span id="GuacamoleDB-359"><a href="#GuacamoleDB-359"><span class="linenos"> 359</span></a><span class="sd">        Sets UTF8MB4 charset and collation for proper Unicode support.</span>
</span><span id="GuacamoleDB-360"><a href="#GuacamoleDB-360"><span class="linenos"> 360</span></a>
</span><span id="GuacamoleDB-361"><a href="#GuacamoleDB-361"><span class="linenos"> 361</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-362"><a href="#GuacamoleDB-362"><span class="linenos"> 362</span></a><span class="sd">            MySQLConnection object for database operations.</span>
</span><span id="GuacamoleDB-363"><a href="#GuacamoleDB-363"><span class="linenos"> 363</span></a>
</span><span id="GuacamoleDB-364"><a href="#GuacamoleDB-364"><span class="linenos"> 364</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-365"><a href="#GuacamoleDB-365"><span class="linenos"> 365</span></a><span class="sd">            SystemExit: If database connection fails.</span>
</span><span id="GuacamoleDB-366"><a href="#GuacamoleDB-366"><span class="linenos"> 366</span></a><span class="sd">            mysql.connector.Error: For various MySQL connection errors.</span>
</span><span id="GuacamoleDB-367"><a href="#GuacamoleDB-367"><span class="linenos"> 367</span></a>
</span><span id="GuacamoleDB-368"><a href="#GuacamoleDB-368"><span class="linenos"> 368</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-369"><a href="#GuacamoleDB-369"><span class="linenos"> 369</span></a><span class="sd">            Uses UTF8MB4 charset to support full Unicode including emoji and</span>
</span><span id="GuacamoleDB-370"><a href="#GuacamoleDB-370"><span class="linenos"> 370</span></a><span class="sd">            special characters. Connection parameters are loaded from the</span>
</span><span id="GuacamoleDB-371"><a href="#GuacamoleDB-371"><span class="linenos"> 371</span></a><span class="sd">            configuration file during initialization.</span>
</span><span id="GuacamoleDB-372"><a href="#GuacamoleDB-372"><span class="linenos"> 372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-373"><a href="#GuacamoleDB-373"><span class="linenos"> 373</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-374"><a href="#GuacamoleDB-374"><span class="linenos"> 374</span></a>            <span class="n">conn</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="GuacamoleDB-375"><a href="#GuacamoleDB-375"><span class="linenos"> 375</span></a>                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">db_config</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf8mb4&quot;</span><span class="p">,</span> <span class="n">collation</span><span class="o">=</span><span class="s2">&quot;utf8mb4_general_ci&quot;</span>
</span><span id="GuacamoleDB-376"><a href="#GuacamoleDB-376"><span class="linenos"> 376</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-377"><a href="#GuacamoleDB-377"><span class="linenos"> 377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database connection established to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-378"><a href="#GuacamoleDB-378"><span class="linenos"> 378</span></a>            <span class="k">return</span> <span class="n">conn</span>
</span><span id="GuacamoleDB-379"><a href="#GuacamoleDB-379"><span class="linenos"> 379</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-380"><a href="#GuacamoleDB-380"><span class="linenos"> 380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database connection failed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-381"><a href="#GuacamoleDB-381"><span class="linenos"> 381</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB-382"><a href="#GuacamoleDB-382"><span class="linenos"> 382</span></a>
</span><span id="GuacamoleDB-383"><a href="#GuacamoleDB-383"><span class="linenos"> 383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_users</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB-384"><a href="#GuacamoleDB-384"><span class="linenos"> 384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all users from the Guacamole database.</span>
</span><span id="GuacamoleDB-385"><a href="#GuacamoleDB-385"><span class="linenos"> 385</span></a>
</span><span id="GuacamoleDB-386"><a href="#GuacamoleDB-386"><span class="linenos"> 386</span></a><span class="sd">        Queries the guacamole_entity table to find all entities of type &#39;USER&#39;</span>
</span><span id="GuacamoleDB-387"><a href="#GuacamoleDB-387"><span class="linenos"> 387</span></a><span class="sd">        and returns them as an alphabetically sorted list.</span>
</span><span id="GuacamoleDB-388"><a href="#GuacamoleDB-388"><span class="linenos"> 388</span></a>
</span><span id="GuacamoleDB-389"><a href="#GuacamoleDB-389"><span class="linenos"> 389</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-390"><a href="#GuacamoleDB-390"><span class="linenos"> 390</span></a><span class="sd">            List of usernames sorted alphabetically.</span>
</span><span id="GuacamoleDB-391"><a href="#GuacamoleDB-391"><span class="linenos"> 391</span></a>
</span><span id="GuacamoleDB-392"><a href="#GuacamoleDB-392"><span class="linenos"> 392</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-393"><a href="#GuacamoleDB-393"><span class="linenos"> 393</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-394"><a href="#GuacamoleDB-394"><span class="linenos"> 394</span></a>
</span><span id="GuacamoleDB-395"><a href="#GuacamoleDB-395"><span class="linenos"> 395</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-396"><a href="#GuacamoleDB-396"><span class="linenos"> 396</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-397"><a href="#GuacamoleDB-397"><span class="linenos"> 397</span></a><span class="sd">            ...     users = db.list_users()</span>
</span><span id="GuacamoleDB-398"><a href="#GuacamoleDB-398"><span class="linenos"> 398</span></a><span class="sd">            ...     print(f&quot;Found users: {&#39;, &#39;.join(users)}&quot;)</span>
</span><span id="GuacamoleDB-399"><a href="#GuacamoleDB-399"><span class="linenos"> 399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-400"><a href="#GuacamoleDB-400"><span class="linenos"> 400</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-401"><a href="#GuacamoleDB-401"><span class="linenos"> 401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-402"><a href="#GuacamoleDB-402"><span class="linenos"> 402</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-403"><a href="#GuacamoleDB-403"><span class="linenos"> 403</span></a><span class="sd">                SELECT name</span>
</span><span id="GuacamoleDB-404"><a href="#GuacamoleDB-404"><span class="linenos"> 404</span></a><span class="sd">                FROM guacamole_entity</span>
</span><span id="GuacamoleDB-405"><a href="#GuacamoleDB-405"><span class="linenos"> 405</span></a><span class="sd">                WHERE type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-406"><a href="#GuacamoleDB-406"><span class="linenos"> 406</span></a><span class="sd">                ORDER BY name</span>
</span><span id="GuacamoleDB-407"><a href="#GuacamoleDB-407"><span class="linenos"> 407</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-408"><a href="#GuacamoleDB-408"><span class="linenos"> 408</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-409"><a href="#GuacamoleDB-409"><span class="linenos"> 409</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB-410"><a href="#GuacamoleDB-410"><span class="linenos"> 410</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-411"><a href="#GuacamoleDB-411"><span class="linenos"> 411</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list users: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-412"><a href="#GuacamoleDB-412"><span class="linenos"> 412</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-413"><a href="#GuacamoleDB-413"><span class="linenos"> 413</span></a>
</span><span id="GuacamoleDB-414"><a href="#GuacamoleDB-414"><span class="linenos"> 414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_usergroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB-415"><a href="#GuacamoleDB-415"><span class="linenos"> 415</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all user groups from the Guacamole database.</span>
</span><span id="GuacamoleDB-416"><a href="#GuacamoleDB-416"><span class="linenos"> 416</span></a>
</span><span id="GuacamoleDB-417"><a href="#GuacamoleDB-417"><span class="linenos"> 417</span></a><span class="sd">        Queries the guacamole_entity table to find all entities of type &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-418"><a href="#GuacamoleDB-418"><span class="linenos"> 418</span></a><span class="sd">        and returns them as an alphabetically sorted list.</span>
</span><span id="GuacamoleDB-419"><a href="#GuacamoleDB-419"><span class="linenos"> 419</span></a>
</span><span id="GuacamoleDB-420"><a href="#GuacamoleDB-420"><span class="linenos"> 420</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-421"><a href="#GuacamoleDB-421"><span class="linenos"> 421</span></a><span class="sd">            List of user group names sorted alphabetically.</span>
</span><span id="GuacamoleDB-422"><a href="#GuacamoleDB-422"><span class="linenos"> 422</span></a>
</span><span id="GuacamoleDB-423"><a href="#GuacamoleDB-423"><span class="linenos"> 423</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-424"><a href="#GuacamoleDB-424"><span class="linenos"> 424</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-425"><a href="#GuacamoleDB-425"><span class="linenos"> 425</span></a>
</span><span id="GuacamoleDB-426"><a href="#GuacamoleDB-426"><span class="linenos"> 426</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-427"><a href="#GuacamoleDB-427"><span class="linenos"> 427</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-428"><a href="#GuacamoleDB-428"><span class="linenos"> 428</span></a><span class="sd">            ...     groups = db.list_usergroups()</span>
</span><span id="GuacamoleDB-429"><a href="#GuacamoleDB-429"><span class="linenos"> 429</span></a><span class="sd">            ...     print(f&quot;Found groups: {&#39;, &#39;.join(groups)}&quot;)</span>
</span><span id="GuacamoleDB-430"><a href="#GuacamoleDB-430"><span class="linenos"> 430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-431"><a href="#GuacamoleDB-431"><span class="linenos"> 431</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-432"><a href="#GuacamoleDB-432"><span class="linenos"> 432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-433"><a href="#GuacamoleDB-433"><span class="linenos"> 433</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-434"><a href="#GuacamoleDB-434"><span class="linenos"> 434</span></a><span class="sd">                SELECT name</span>
</span><span id="GuacamoleDB-435"><a href="#GuacamoleDB-435"><span class="linenos"> 435</span></a><span class="sd">                FROM guacamole_entity</span>
</span><span id="GuacamoleDB-436"><a href="#GuacamoleDB-436"><span class="linenos"> 436</span></a><span class="sd">                WHERE type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-437"><a href="#GuacamoleDB-437"><span class="linenos"> 437</span></a><span class="sd">                ORDER BY name</span>
</span><span id="GuacamoleDB-438"><a href="#GuacamoleDB-438"><span class="linenos"> 438</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-439"><a href="#GuacamoleDB-439"><span class="linenos"> 439</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-440"><a href="#GuacamoleDB-440"><span class="linenos"> 440</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB-441"><a href="#GuacamoleDB-441"><span class="linenos"> 441</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-442"><a href="#GuacamoleDB-442"><span class="linenos"> 442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list usergroups: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-443"><a href="#GuacamoleDB-443"><span class="linenos"> 443</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-444"><a href="#GuacamoleDB-444"><span class="linenos"> 444</span></a>
</span><span id="GuacamoleDB-445"><a href="#GuacamoleDB-445"><span class="linenos"> 445</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">usergroup_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-446"><a href="#GuacamoleDB-446"><span class="linenos"> 446</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a user group exists in the Guacamole database.</span>
</span><span id="GuacamoleDB-447"><a href="#GuacamoleDB-447"><span class="linenos"> 447</span></a>
</span><span id="GuacamoleDB-448"><a href="#GuacamoleDB-448"><span class="linenos"> 448</span></a><span class="sd">        Queries the guacamole_entity table to determine if a user group with the</span>
</span><span id="GuacamoleDB-449"><a href="#GuacamoleDB-449"><span class="linenos"> 449</span></a><span class="sd">        specified name exists.</span>
</span><span id="GuacamoleDB-450"><a href="#GuacamoleDB-450"><span class="linenos"> 450</span></a>
</span><span id="GuacamoleDB-451"><a href="#GuacamoleDB-451"><span class="linenos"> 451</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-452"><a href="#GuacamoleDB-452"><span class="linenos"> 452</span></a><span class="sd">            group_name: The user group name to check for existence.</span>
</span><span id="GuacamoleDB-453"><a href="#GuacamoleDB-453"><span class="linenos"> 453</span></a>
</span><span id="GuacamoleDB-454"><a href="#GuacamoleDB-454"><span class="linenos"> 454</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-455"><a href="#GuacamoleDB-455"><span class="linenos"> 455</span></a><span class="sd">            True if the user group exists, False otherwise.</span>
</span><span id="GuacamoleDB-456"><a href="#GuacamoleDB-456"><span class="linenos"> 456</span></a>
</span><span id="GuacamoleDB-457"><a href="#GuacamoleDB-457"><span class="linenos"> 457</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-458"><a href="#GuacamoleDB-458"><span class="linenos"> 458</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-459"><a href="#GuacamoleDB-459"><span class="linenos"> 459</span></a>
</span><span id="GuacamoleDB-460"><a href="#GuacamoleDB-460"><span class="linenos"> 460</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-461"><a href="#GuacamoleDB-461"><span class="linenos"> 461</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-462"><a href="#GuacamoleDB-462"><span class="linenos"> 462</span></a><span class="sd">            ...     if db.usergroup_exists(&#39;admins&#39;):</span>
</span><span id="GuacamoleDB-463"><a href="#GuacamoleDB-463"><span class="linenos"> 463</span></a><span class="sd">            ...         print(&quot;Admin group exists&quot;)</span>
</span><span id="GuacamoleDB-464"><a href="#GuacamoleDB-464"><span class="linenos"> 464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-465"><a href="#GuacamoleDB-465"><span class="linenos"> 465</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-466"><a href="#GuacamoleDB-466"><span class="linenos"> 466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-467"><a href="#GuacamoleDB-467"><span class="linenos"> 467</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-468"><a href="#GuacamoleDB-468"><span class="linenos"> 468</span></a><span class="sd">                SELECT COUNT(*) FROM guacamole_entity</span>
</span><span id="GuacamoleDB-469"><a href="#GuacamoleDB-469"><span class="linenos"> 469</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-470"><a href="#GuacamoleDB-470"><span class="linenos"> 470</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-471"><a href="#GuacamoleDB-471"><span class="linenos"> 471</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-472"><a href="#GuacamoleDB-472"><span class="linenos"> 472</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-473"><a href="#GuacamoleDB-473"><span class="linenos"> 473</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="GuacamoleDB-474"><a href="#GuacamoleDB-474"><span class="linenos"> 474</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-475"><a href="#GuacamoleDB-475"><span class="linenos"> 475</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking usergroup existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-476"><a href="#GuacamoleDB-476"><span class="linenos"> 476</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-477"><a href="#GuacamoleDB-477"><span class="linenos"> 477</span></a>
</span><span id="GuacamoleDB-478"><a href="#GuacamoleDB-478"><span class="linenos"> 478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_usergroup_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB-479"><a href="#GuacamoleDB-479"><span class="linenos"> 479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the database ID for a user group by name.</span>
</span><span id="GuacamoleDB-480"><a href="#GuacamoleDB-480"><span class="linenos"> 480</span></a>
</span><span id="GuacamoleDB-481"><a href="#GuacamoleDB-481"><span class="linenos"> 481</span></a><span class="sd">        Queries the guacamole_user_group and guacamole_entity tables to find</span>
</span><span id="GuacamoleDB-482"><a href="#GuacamoleDB-482"><span class="linenos"> 482</span></a><span class="sd">        the internal database ID for a user group.</span>
</span><span id="GuacamoleDB-483"><a href="#GuacamoleDB-483"><span class="linenos"> 483</span></a>
</span><span id="GuacamoleDB-484"><a href="#GuacamoleDB-484"><span class="linenos"> 484</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-485"><a href="#GuacamoleDB-485"><span class="linenos"> 485</span></a><span class="sd">            group_name: The name of the user group.</span>
</span><span id="GuacamoleDB-486"><a href="#GuacamoleDB-486"><span class="linenos"> 486</span></a>
</span><span id="GuacamoleDB-487"><a href="#GuacamoleDB-487"><span class="linenos"> 487</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-488"><a href="#GuacamoleDB-488"><span class="linenos"> 488</span></a><span class="sd">            The user group ID from the database.</span>
</span><span id="GuacamoleDB-489"><a href="#GuacamoleDB-489"><span class="linenos"> 489</span></a>
</span><span id="GuacamoleDB-490"><a href="#GuacamoleDB-490"><span class="linenos"> 490</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-491"><a href="#GuacamoleDB-491"><span class="linenos"> 491</span></a><span class="sd">            ValueError: If the user group is not found.</span>
</span><span id="GuacamoleDB-492"><a href="#GuacamoleDB-492"><span class="linenos"> 492</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-493"><a href="#GuacamoleDB-493"><span class="linenos"> 493</span></a>
</span><span id="GuacamoleDB-494"><a href="#GuacamoleDB-494"><span class="linenos"> 494</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-495"><a href="#GuacamoleDB-495"><span class="linenos"> 495</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-496"><a href="#GuacamoleDB-496"><span class="linenos"> 496</span></a><span class="sd">            ...     group_id = db.get_usergroup_id(&#39;admins&#39;)</span>
</span><span id="GuacamoleDB-497"><a href="#GuacamoleDB-497"><span class="linenos"> 497</span></a><span class="sd">            ...     print(f&quot;Admin group ID: {group_id}&quot;)</span>
</span><span id="GuacamoleDB-498"><a href="#GuacamoleDB-498"><span class="linenos"> 498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-499"><a href="#GuacamoleDB-499"><span class="linenos"> 499</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-500"><a href="#GuacamoleDB-500"><span class="linenos"> 500</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-501"><a href="#GuacamoleDB-501"><span class="linenos"> 501</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-502"><a href="#GuacamoleDB-502"><span class="linenos"> 502</span></a><span class="sd">                SELECT user_group_id</span>
</span><span id="GuacamoleDB-503"><a href="#GuacamoleDB-503"><span class="linenos"> 503</span></a><span class="sd">                FROM guacamole_user_group g</span>
</span><span id="GuacamoleDB-504"><a href="#GuacamoleDB-504"><span class="linenos"> 504</span></a><span class="sd">                JOIN guacamole_entity e ON g.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB-505"><a href="#GuacamoleDB-505"><span class="linenos"> 505</span></a><span class="sd">                WHERE e.name = %s AND e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-506"><a href="#GuacamoleDB-506"><span class="linenos"> 506</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-507"><a href="#GuacamoleDB-507"><span class="linenos"> 507</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-508"><a href="#GuacamoleDB-508"><span class="linenos"> 508</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-509"><a href="#GuacamoleDB-509"><span class="linenos"> 509</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-510"><a href="#GuacamoleDB-510"><span class="linenos"> 510</span></a>            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-511"><a href="#GuacamoleDB-511"><span class="linenos"> 511</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-512"><a href="#GuacamoleDB-512"><span class="linenos"> 512</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-513"><a href="#GuacamoleDB-513"><span class="linenos"> 513</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-514"><a href="#GuacamoleDB-514"><span class="linenos"> 514</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-515"><a href="#GuacamoleDB-515"><span class="linenos"> 515</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting usergroup ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-516"><a href="#GuacamoleDB-516"><span class="linenos"> 516</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-517"><a href="#GuacamoleDB-517"><span class="linenos"> 517</span></a>
</span><span id="GuacamoleDB-518"><a href="#GuacamoleDB-518"><span class="linenos"> 518</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">user_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-519"><a href="#GuacamoleDB-519"><span class="linenos"> 519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a user exists in the Guacamole database.</span>
</span><span id="GuacamoleDB-520"><a href="#GuacamoleDB-520"><span class="linenos"> 520</span></a>
</span><span id="GuacamoleDB-521"><a href="#GuacamoleDB-521"><span class="linenos"> 521</span></a><span class="sd">        Queries the guacamole_entity table to determine if a user with the</span>
</span><span id="GuacamoleDB-522"><a href="#GuacamoleDB-522"><span class="linenos"> 522</span></a><span class="sd">        specified username exists.</span>
</span><span id="GuacamoleDB-523"><a href="#GuacamoleDB-523"><span class="linenos"> 523</span></a>
</span><span id="GuacamoleDB-524"><a href="#GuacamoleDB-524"><span class="linenos"> 524</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-525"><a href="#GuacamoleDB-525"><span class="linenos"> 525</span></a><span class="sd">            username: The username to check for existence.</span>
</span><span id="GuacamoleDB-526"><a href="#GuacamoleDB-526"><span class="linenos"> 526</span></a>
</span><span id="GuacamoleDB-527"><a href="#GuacamoleDB-527"><span class="linenos"> 527</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-528"><a href="#GuacamoleDB-528"><span class="linenos"> 528</span></a><span class="sd">            True if the user exists, False otherwise.</span>
</span><span id="GuacamoleDB-529"><a href="#GuacamoleDB-529"><span class="linenos"> 529</span></a>
</span><span id="GuacamoleDB-530"><a href="#GuacamoleDB-530"><span class="linenos"> 530</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-531"><a href="#GuacamoleDB-531"><span class="linenos"> 531</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-532"><a href="#GuacamoleDB-532"><span class="linenos"> 532</span></a>
</span><span id="GuacamoleDB-533"><a href="#GuacamoleDB-533"><span class="linenos"> 533</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-534"><a href="#GuacamoleDB-534"><span class="linenos"> 534</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-535"><a href="#GuacamoleDB-535"><span class="linenos"> 535</span></a><span class="sd">            ...     if db.user_exists(&#39;admin&#39;):</span>
</span><span id="GuacamoleDB-536"><a href="#GuacamoleDB-536"><span class="linenos"> 536</span></a><span class="sd">            ...         print(&quot;Admin user exists&quot;)</span>
</span><span id="GuacamoleDB-537"><a href="#GuacamoleDB-537"><span class="linenos"> 537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-538"><a href="#GuacamoleDB-538"><span class="linenos"> 538</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-539"><a href="#GuacamoleDB-539"><span class="linenos"> 539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-540"><a href="#GuacamoleDB-540"><span class="linenos"> 540</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-541"><a href="#GuacamoleDB-541"><span class="linenos"> 541</span></a><span class="sd">                SELECT COUNT(*) FROM guacamole_entity</span>
</span><span id="GuacamoleDB-542"><a href="#GuacamoleDB-542"><span class="linenos"> 542</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-543"><a href="#GuacamoleDB-543"><span class="linenos"> 543</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-544"><a href="#GuacamoleDB-544"><span class="linenos"> 544</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-545"><a href="#GuacamoleDB-545"><span class="linenos"> 545</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-546"><a href="#GuacamoleDB-546"><span class="linenos"> 546</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="GuacamoleDB-547"><a href="#GuacamoleDB-547"><span class="linenos"> 547</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-548"><a href="#GuacamoleDB-548"><span class="linenos"> 548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking user existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-549"><a href="#GuacamoleDB-549"><span class="linenos"> 549</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-550"><a href="#GuacamoleDB-550"><span class="linenos"> 550</span></a>
</span><span id="GuacamoleDB-551"><a href="#GuacamoleDB-551"><span class="linenos"> 551</span></a>    <span class="c1"># Define allowed user parameters as a class attribute</span>
</span><span id="GuacamoleDB-552"><a href="#GuacamoleDB-552"><span class="linenos"> 552</span></a>    <span class="n">USER_PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB-553"><a href="#GuacamoleDB-553"><span class="linenos"> 553</span></a>        <span class="s2">&quot;disabled&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-554"><a href="#GuacamoleDB-554"><span class="linenos"> 554</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tinyint&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-555"><a href="#GuacamoleDB-555"><span class="linenos"> 555</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether the user is disabled (0=enabled, 1=disabled)&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-556"><a href="#GuacamoleDB-556"><span class="linenos"> 556</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-557"><a href="#GuacamoleDB-557"><span class="linenos"> 557</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-558"><a href="#GuacamoleDB-558"><span class="linenos"> 558</span></a>        <span class="s2">&quot;expired&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-559"><a href="#GuacamoleDB-559"><span class="linenos"> 559</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tinyint&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-560"><a href="#GuacamoleDB-560"><span class="linenos"> 560</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Whether the user account is expired (0=active, 1=expired)&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-561"><a href="#GuacamoleDB-561"><span class="linenos"> 561</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-562"><a href="#GuacamoleDB-562"><span class="linenos"> 562</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-563"><a href="#GuacamoleDB-563"><span class="linenos"> 563</span></a>        <span class="s2">&quot;access_window_start&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-564"><a href="#GuacamoleDB-564"><span class="linenos"> 564</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-565"><a href="#GuacamoleDB-565"><span class="linenos"> 565</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Start of allowed access time window (HH:MM:SS)&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-566"><a href="#GuacamoleDB-566"><span class="linenos"> 566</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-567"><a href="#GuacamoleDB-567"><span class="linenos"> 567</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-568"><a href="#GuacamoleDB-568"><span class="linenos"> 568</span></a>        <span class="s2">&quot;access_window_end&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-569"><a href="#GuacamoleDB-569"><span class="linenos"> 569</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-570"><a href="#GuacamoleDB-570"><span class="linenos"> 570</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;End of allowed access time window (HH:MM:SS)&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-571"><a href="#GuacamoleDB-571"><span class="linenos"> 571</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-572"><a href="#GuacamoleDB-572"><span class="linenos"> 572</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-573"><a href="#GuacamoleDB-573"><span class="linenos"> 573</span></a>        <span class="s2">&quot;valid_from&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-574"><a href="#GuacamoleDB-574"><span class="linenos"> 574</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-575"><a href="#GuacamoleDB-575"><span class="linenos"> 575</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Date when account becomes valid (YYYY-MM-DD)&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-576"><a href="#GuacamoleDB-576"><span class="linenos"> 576</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-577"><a href="#GuacamoleDB-577"><span class="linenos"> 577</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-578"><a href="#GuacamoleDB-578"><span class="linenos"> 578</span></a>        <span class="s2">&quot;valid_until&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-579"><a href="#GuacamoleDB-579"><span class="linenos"> 579</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-580"><a href="#GuacamoleDB-580"><span class="linenos"> 580</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Date when account expires (YYYY-MM-DD)&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-581"><a href="#GuacamoleDB-581"><span class="linenos"> 581</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-582"><a href="#GuacamoleDB-582"><span class="linenos"> 582</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-583"><a href="#GuacamoleDB-583"><span class="linenos"> 583</span></a>        <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-584"><a href="#GuacamoleDB-584"><span class="linenos"> 584</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-585"><a href="#GuacamoleDB-585"><span class="linenos"> 585</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s1">&#39;User</span><span class="se">\&#39;</span><span class="s1">s timezone (e.g., &quot;America/New_York&quot;)&#39;</span><span class="p">,</span>
</span><span id="GuacamoleDB-586"><a href="#GuacamoleDB-586"><span class="linenos"> 586</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-587"><a href="#GuacamoleDB-587"><span class="linenos"> 587</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-588"><a href="#GuacamoleDB-588"><span class="linenos"> 588</span></a>        <span class="s2">&quot;full_name&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-589"><a href="#GuacamoleDB-589"><span class="linenos"> 589</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-590"><a href="#GuacamoleDB-590"><span class="linenos"> 590</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;User&#39;s full name&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-591"><a href="#GuacamoleDB-591"><span class="linenos"> 591</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-592"><a href="#GuacamoleDB-592"><span class="linenos"> 592</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-593"><a href="#GuacamoleDB-593"><span class="linenos"> 593</span></a>        <span class="s2">&quot;email_address&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-594"><a href="#GuacamoleDB-594"><span class="linenos"> 594</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-595"><a href="#GuacamoleDB-595"><span class="linenos"> 595</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;User&#39;s email address&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-596"><a href="#GuacamoleDB-596"><span class="linenos"> 596</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-597"><a href="#GuacamoleDB-597"><span class="linenos"> 597</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-598"><a href="#GuacamoleDB-598"><span class="linenos"> 598</span></a>        <span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-599"><a href="#GuacamoleDB-599"><span class="linenos"> 599</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-600"><a href="#GuacamoleDB-600"><span class="linenos"> 600</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;User&#39;s organization&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-601"><a href="#GuacamoleDB-601"><span class="linenos"> 601</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-602"><a href="#GuacamoleDB-602"><span class="linenos"> 602</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-603"><a href="#GuacamoleDB-603"><span class="linenos"> 603</span></a>        <span class="s2">&quot;organizational_role&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-604"><a href="#GuacamoleDB-604"><span class="linenos"> 604</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-605"><a href="#GuacamoleDB-605"><span class="linenos"> 605</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;User&#39;s role within the organization&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-606"><a href="#GuacamoleDB-606"><span class="linenos"> 606</span></a>            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;NULL&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-607"><a href="#GuacamoleDB-607"><span class="linenos"> 607</span></a>        <span class="p">},</span>
</span><span id="GuacamoleDB-608"><a href="#GuacamoleDB-608"><span class="linenos"> 608</span></a>    <span class="p">}</span>
</span><span id="GuacamoleDB-609"><a href="#GuacamoleDB-609"><span class="linenos"> 609</span></a>
</span><span id="GuacamoleDB-610"><a href="#GuacamoleDB-610"><span class="linenos"> 610</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_id_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="GuacamoleDB-611"><a href="#GuacamoleDB-611"><span class="linenos"> 611</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get connection group ID by name from the database.</span>
</span><span id="GuacamoleDB-612"><a href="#GuacamoleDB-612"><span class="linenos"> 612</span></a>
</span><span id="GuacamoleDB-613"><a href="#GuacamoleDB-613"><span class="linenos"> 613</span></a><span class="sd">        Retrieves the database ID for a connection group given its name.</span>
</span><span id="GuacamoleDB-614"><a href="#GuacamoleDB-614"><span class="linenos"> 614</span></a><span class="sd">        Returns None for empty group names to handle root-level assignments.</span>
</span><span id="GuacamoleDB-615"><a href="#GuacamoleDB-615"><span class="linenos"> 615</span></a>
</span><span id="GuacamoleDB-616"><a href="#GuacamoleDB-616"><span class="linenos"> 616</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-617"><a href="#GuacamoleDB-617"><span class="linenos"> 617</span></a><span class="sd">            group_name: Name of the connection group to look up.</span>
</span><span id="GuacamoleDB-618"><a href="#GuacamoleDB-618"><span class="linenos"> 618</span></a>
</span><span id="GuacamoleDB-619"><a href="#GuacamoleDB-619"><span class="linenos"> 619</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-620"><a href="#GuacamoleDB-620"><span class="linenos"> 620</span></a><span class="sd">            The database ID of the connection group, or None if group_name is empty.</span>
</span><span id="GuacamoleDB-621"><a href="#GuacamoleDB-621"><span class="linenos"> 621</span></a>
</span><span id="GuacamoleDB-622"><a href="#GuacamoleDB-622"><span class="linenos"> 622</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-623"><a href="#GuacamoleDB-623"><span class="linenos"> 623</span></a><span class="sd">            ValueError: If the connection group with the specified name is not found.</span>
</span><span id="GuacamoleDB-624"><a href="#GuacamoleDB-624"><span class="linenos"> 624</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-625"><a href="#GuacamoleDB-625"><span class="linenos"> 625</span></a>
</span><span id="GuacamoleDB-626"><a href="#GuacamoleDB-626"><span class="linenos"> 626</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-627"><a href="#GuacamoleDB-627"><span class="linenos"> 627</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-628"><a href="#GuacamoleDB-628"><span class="linenos"> 628</span></a><span class="sd">            ...     group_id = db.get_connection_group_id_by_name(&quot;Production Servers&quot;)</span>
</span><span id="GuacamoleDB-629"><a href="#GuacamoleDB-629"><span class="linenos"> 629</span></a><span class="sd">            ...     print(f&quot;Group ID: {group_id}&quot;)</span>
</span><span id="GuacamoleDB-630"><a href="#GuacamoleDB-630"><span class="linenos"> 630</span></a><span class="sd">            Group ID: 42</span>
</span><span id="GuacamoleDB-631"><a href="#GuacamoleDB-631"><span class="linenos"> 631</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-632"><a href="#GuacamoleDB-632"><span class="linenos"> 632</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-633"><a href="#GuacamoleDB-633"><span class="linenos"> 633</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">group_name</span><span class="p">:</span>  <span class="c1"># Handle empty group name as explicit NULL</span>
</span><span id="GuacamoleDB-634"><a href="#GuacamoleDB-634"><span class="linenos"> 634</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-635"><a href="#GuacamoleDB-635"><span class="linenos"> 635</span></a>
</span><span id="GuacamoleDB-636"><a href="#GuacamoleDB-636"><span class="linenos"> 636</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-637"><a href="#GuacamoleDB-637"><span class="linenos"> 637</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-638"><a href="#GuacamoleDB-638"><span class="linenos"> 638</span></a><span class="sd">                SELECT connection_group_id </span>
</span><span id="GuacamoleDB-639"><a href="#GuacamoleDB-639"><span class="linenos"> 639</span></a><span class="sd">                FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-640"><a href="#GuacamoleDB-640"><span class="linenos"> 640</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB-641"><a href="#GuacamoleDB-641"><span class="linenos"> 641</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-642"><a href="#GuacamoleDB-642"><span class="linenos"> 642</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-643"><a href="#GuacamoleDB-643"><span class="linenos"> 643</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-644"><a href="#GuacamoleDB-644"><span class="linenos"> 644</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-645"><a href="#GuacamoleDB-645"><span class="linenos"> 645</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-646"><a href="#GuacamoleDB-646"><span class="linenos"> 646</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-647"><a href="#GuacamoleDB-647"><span class="linenos"> 647</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-648"><a href="#GuacamoleDB-648"><span class="linenos"> 648</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-649"><a href="#GuacamoleDB-649"><span class="linenos"> 649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection group ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-650"><a href="#GuacamoleDB-650"><span class="linenos"> 650</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-651"><a href="#GuacamoleDB-651"><span class="linenos"> 651</span></a>
</span><span id="GuacamoleDB-652"><a href="#GuacamoleDB-652"><span class="linenos"> 652</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_connection_parent_group</span><span class="p">(</span>
</span><span id="GuacamoleDB-653"><a href="#GuacamoleDB-653"><span class="linenos"> 653</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB-654"><a href="#GuacamoleDB-654"><span class="linenos"> 654</span></a>        <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-655"><a href="#GuacamoleDB-655"><span class="linenos"> 655</span></a>        <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-656"><a href="#GuacamoleDB-656"><span class="linenos"> 656</span></a>        <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-657"><a href="#GuacamoleDB-657"><span class="linenos"> 657</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-658"><a href="#GuacamoleDB-658"><span class="linenos"> 658</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set parent connection group for a connection&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-659"><a href="#GuacamoleDB-659"><span class="linenos"> 659</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-660"><a href="#GuacamoleDB-660"><span class="linenos"> 660</span></a>            <span class="c1"># Use resolver to get connection_id and validate inputs</span>
</span><span id="GuacamoleDB-661"><a href="#GuacamoleDB-661"><span class="linenos"> 661</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-662"><a href="#GuacamoleDB-662"><span class="linenos"> 662</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB-663"><a href="#GuacamoleDB-663"><span class="linenos"> 663</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-664"><a href="#GuacamoleDB-664"><span class="linenos"> 664</span></a>
</span><span id="GuacamoleDB-665"><a href="#GuacamoleDB-665"><span class="linenos"> 665</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GuacamoleDB-666"><a href="#GuacamoleDB-666"><span class="linenos"> 666</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_id_by_name</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">group_name</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-667"><a href="#GuacamoleDB-667"><span class="linenos"> 667</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-668"><a href="#GuacamoleDB-668"><span class="linenos"> 668</span></a>
</span><span id="GuacamoleDB-669"><a href="#GuacamoleDB-669"><span class="linenos"> 669</span></a>            <span class="c1"># Get current parent</span>
</span><span id="GuacamoleDB-670"><a href="#GuacamoleDB-670"><span class="linenos"> 670</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-671"><a href="#GuacamoleDB-671"><span class="linenos"> 671</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-672"><a href="#GuacamoleDB-672"><span class="linenos"> 672</span></a><span class="sd">                SELECT parent_id </span>
</span><span id="GuacamoleDB-673"><a href="#GuacamoleDB-673"><span class="linenos"> 673</span></a><span class="sd">                FROM guacamole_connection </span>
</span><span id="GuacamoleDB-674"><a href="#GuacamoleDB-674"><span class="linenos"> 674</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-675"><a href="#GuacamoleDB-675"><span class="linenos"> 675</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-676"><a href="#GuacamoleDB-676"><span class="linenos"> 676</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-677"><a href="#GuacamoleDB-677"><span class="linenos"> 677</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-678"><a href="#GuacamoleDB-678"><span class="linenos"> 678</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-679"><a href="#GuacamoleDB-679"><span class="linenos"> 679</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-680"><a href="#GuacamoleDB-680"><span class="linenos"> 680</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-681"><a href="#GuacamoleDB-681"><span class="linenos"> 681</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection with ID </span><span class="si">{</span><span class="n">resolved_connection_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
</span><span id="GuacamoleDB-682"><a href="#GuacamoleDB-682"><span class="linenos"> 682</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-683"><a href="#GuacamoleDB-683"><span class="linenos"> 683</span></a>            <span class="n">current_parent_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-684"><a href="#GuacamoleDB-684"><span class="linenos"> 684</span></a>
</span><span id="GuacamoleDB-685"><a href="#GuacamoleDB-685"><span class="linenos"> 685</span></a>            <span class="c1"># Get connection name for error messages if we only have ID</span>
</span><span id="GuacamoleDB-686"><a href="#GuacamoleDB-686"><span class="linenos"> 686</span></a>            <span class="k">if</span> <span class="n">connection_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-687"><a href="#GuacamoleDB-687"><span class="linenos"> 687</span></a>                <span class="n">connection_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_name_by_id</span><span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-688"><a href="#GuacamoleDB-688"><span class="linenos"> 688</span></a>
</span><span id="GuacamoleDB-689"><a href="#GuacamoleDB-689"><span class="linenos"> 689</span></a>            <span class="c1"># Check if we&#39;re trying to set to same group</span>
</span><span id="GuacamoleDB-690"><a href="#GuacamoleDB-690"><span class="linenos"> 690</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">==</span> <span class="n">current_parent_id</span><span class="p">:</span>
</span><span id="GuacamoleDB-691"><a href="#GuacamoleDB-691"><span class="linenos"> 691</span></a>                <span class="k">if</span> <span class="n">group_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-692"><a href="#GuacamoleDB-692"><span class="linenos"> 692</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-693"><a href="#GuacamoleDB-693"><span class="linenos"> 693</span></a>                        <span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; already has no parent group&quot;</span>
</span><span id="GuacamoleDB-694"><a href="#GuacamoleDB-694"><span class="linenos"> 694</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-695"><a href="#GuacamoleDB-695"><span class="linenos"> 695</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-696"><a href="#GuacamoleDB-696"><span class="linenos"> 696</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-697"><a href="#GuacamoleDB-697"><span class="linenos"> 697</span></a>                        <span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; is already in group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-698"><a href="#GuacamoleDB-698"><span class="linenos"> 698</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-699"><a href="#GuacamoleDB-699"><span class="linenos"> 699</span></a>
</span><span id="GuacamoleDB-700"><a href="#GuacamoleDB-700"><span class="linenos"> 700</span></a>            <span class="c1"># Update parent ID</span>
</span><span id="GuacamoleDB-701"><a href="#GuacamoleDB-701"><span class="linenos"> 701</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-702"><a href="#GuacamoleDB-702"><span class="linenos"> 702</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-703"><a href="#GuacamoleDB-703"><span class="linenos"> 703</span></a><span class="sd">                UPDATE guacamole_connection</span>
</span><span id="GuacamoleDB-704"><a href="#GuacamoleDB-704"><span class="linenos"> 704</span></a><span class="sd">                SET parent_id = %s</span>
</span><span id="GuacamoleDB-705"><a href="#GuacamoleDB-705"><span class="linenos"> 705</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-706"><a href="#GuacamoleDB-706"><span class="linenos"> 706</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-707"><a href="#GuacamoleDB-707"><span class="linenos"> 707</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">resolved_connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-708"><a href="#GuacamoleDB-708"><span class="linenos"> 708</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-709"><a href="#GuacamoleDB-709"><span class="linenos"> 709</span></a>
</span><span id="GuacamoleDB-710"><a href="#GuacamoleDB-710"><span class="linenos"> 710</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-711"><a href="#GuacamoleDB-711"><span class="linenos"> 711</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-712"><a href="#GuacamoleDB-712"><span class="linenos"> 712</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to update parent group for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-713"><a href="#GuacamoleDB-713"><span class="linenos"> 713</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-714"><a href="#GuacamoleDB-714"><span class="linenos"> 714</span></a>
</span><span id="GuacamoleDB-715"><a href="#GuacamoleDB-715"><span class="linenos"> 715</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-716"><a href="#GuacamoleDB-716"><span class="linenos"> 716</span></a>
</span><span id="GuacamoleDB-717"><a href="#GuacamoleDB-717"><span class="linenos"> 717</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-718"><a href="#GuacamoleDB-718"><span class="linenos"> 718</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying connection parent group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-719"><a href="#GuacamoleDB-719"><span class="linenos"> 719</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-720"><a href="#GuacamoleDB-720"><span class="linenos"> 720</span></a>
</span><span id="GuacamoleDB-721"><a href="#GuacamoleDB-721"><span class="linenos"> 721</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_user_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB-722"><a href="#GuacamoleDB-722"><span class="linenos"> 722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of users with direct permissions to a connection&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-723"><a href="#GuacamoleDB-723"><span class="linenos"> 723</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-724"><a href="#GuacamoleDB-724"><span class="linenos"> 724</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-725"><a href="#GuacamoleDB-725"><span class="linenos"> 725</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-726"><a href="#GuacamoleDB-726"><span class="linenos"> 726</span></a><span class="sd">                SELECT e.name</span>
</span><span id="GuacamoleDB-727"><a href="#GuacamoleDB-727"><span class="linenos"> 727</span></a><span class="sd">                FROM guacamole_connection c</span>
</span><span id="GuacamoleDB-728"><a href="#GuacamoleDB-728"><span class="linenos"> 728</span></a><span class="sd">                JOIN guacamole_connection_permission cp ON c.connection_id = cp.connection_id</span>
</span><span id="GuacamoleDB-729"><a href="#GuacamoleDB-729"><span class="linenos"> 729</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB-730"><a href="#GuacamoleDB-730"><span class="linenos"> 730</span></a><span class="sd">                WHERE c.connection_name = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-731"><a href="#GuacamoleDB-731"><span class="linenos"> 731</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-732"><a href="#GuacamoleDB-732"><span class="linenos"> 732</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-733"><a href="#GuacamoleDB-733"><span class="linenos"> 733</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-734"><a href="#GuacamoleDB-734"><span class="linenos"> 734</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB-735"><a href="#GuacamoleDB-735"><span class="linenos"> 735</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-736"><a href="#GuacamoleDB-736"><span class="linenos"> 736</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection user permissions: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-737"><a href="#GuacamoleDB-737"><span class="linenos"> 737</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-738"><a href="#GuacamoleDB-738"><span class="linenos"> 738</span></a>
</span><span id="GuacamoleDB-739"><a href="#GuacamoleDB-739"><span class="linenos"> 739</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_connection</span><span class="p">(</span>
</span><span id="GuacamoleDB-740"><a href="#GuacamoleDB-740"><span class="linenos"> 740</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB-741"><a href="#GuacamoleDB-741"><span class="linenos"> 741</span></a>        <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-742"><a href="#GuacamoleDB-742"><span class="linenos"> 742</span></a>        <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-743"><a href="#GuacamoleDB-743"><span class="linenos"> 743</span></a>        <span class="n">param_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-744"><a href="#GuacamoleDB-744"><span class="linenos"> 744</span></a>        <span class="n">param_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-745"><a href="#GuacamoleDB-745"><span class="linenos"> 745</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-746"><a href="#GuacamoleDB-746"><span class="linenos"> 746</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify a connection parameter in either guacamole_connection or guacamole_connection_parameter table&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-747"><a href="#GuacamoleDB-747"><span class="linenos"> 747</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-748"><a href="#GuacamoleDB-748"><span class="linenos"> 748</span></a>            <span class="c1"># Validate parameter name</span>
</span><span id="GuacamoleDB-749"><a href="#GuacamoleDB-749"><span class="linenos"> 749</span></a>            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONNECTION_PARAMETERS</span><span class="p">:</span>
</span><span id="GuacamoleDB-750"><a href="#GuacamoleDB-750"><span class="linenos"> 750</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-751"><a href="#GuacamoleDB-751"><span class="linenos"> 751</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">. Run &#39;guacaman conn modify&#39; without arguments to see allowed parameters.&quot;</span>
</span><span id="GuacamoleDB-752"><a href="#GuacamoleDB-752"><span class="linenos"> 752</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-753"><a href="#GuacamoleDB-753"><span class="linenos"> 753</span></a>
</span><span id="GuacamoleDB-754"><a href="#GuacamoleDB-754"><span class="linenos"> 754</span></a>            <span class="c1"># Use resolver to get connection_id and validate inputs</span>
</span><span id="GuacamoleDB-755"><a href="#GuacamoleDB-755"><span class="linenos"> 755</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-756"><a href="#GuacamoleDB-756"><span class="linenos"> 756</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB-757"><a href="#GuacamoleDB-757"><span class="linenos"> 757</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-758"><a href="#GuacamoleDB-758"><span class="linenos"> 758</span></a>
</span><span id="GuacamoleDB-759"><a href="#GuacamoleDB-759"><span class="linenos"> 759</span></a>            <span class="n">param_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONNECTION_PARAMETERS</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span>
</span><span id="GuacamoleDB-760"><a href="#GuacamoleDB-760"><span class="linenos"> 760</span></a>            <span class="n">param_table</span> <span class="o">=</span> <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span>
</span><span id="GuacamoleDB-761"><a href="#GuacamoleDB-761"><span class="linenos"> 761</span></a>
</span><span id="GuacamoleDB-762"><a href="#GuacamoleDB-762"><span class="linenos"> 762</span></a>            <span class="c1"># Update the parameter based on which table it belongs to</span>
</span><span id="GuacamoleDB-763"><a href="#GuacamoleDB-763"><span class="linenos"> 763</span></a>            <span class="k">if</span> <span class="n">param_table</span> <span class="o">==</span> <span class="s2">&quot;connection&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-764"><a href="#GuacamoleDB-764"><span class="linenos"> 764</span></a>                <span class="c1"># Validate parameter value based on type</span>
</span><span id="GuacamoleDB-765"><a href="#GuacamoleDB-765"><span class="linenos"> 765</span></a>                <span class="k">if</span> <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-766"><a href="#GuacamoleDB-766"><span class="linenos"> 766</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-767"><a href="#GuacamoleDB-767"><span class="linenos"> 767</span></a>                        <span class="n">param_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
</span><span id="GuacamoleDB-768"><a href="#GuacamoleDB-768"><span class="linenos"> 768</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="GuacamoleDB-769"><a href="#GuacamoleDB-769"><span class="linenos"> 769</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> must be an integer&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-770"><a href="#GuacamoleDB-770"><span class="linenos"> 770</span></a>
</span><span id="GuacamoleDB-771"><a href="#GuacamoleDB-771"><span class="linenos"> 771</span></a>                <span class="c1"># Update in guacamole_connection table</span>
</span><span id="GuacamoleDB-772"><a href="#GuacamoleDB-772"><span class="linenos"> 772</span></a>                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-773"><a href="#GuacamoleDB-773"><span class="linenos"> 773</span></a><span class="s2">                    UPDATE guacamole_connection </span>
</span><span id="GuacamoleDB-774"><a href="#GuacamoleDB-774"><span class="linenos"> 774</span></a><span class="s2">                    SET </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> = %s</span>
</span><span id="GuacamoleDB-775"><a href="#GuacamoleDB-775"><span class="linenos"> 775</span></a><span class="s2">                    WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-776"><a href="#GuacamoleDB-776"><span class="linenos"> 776</span></a><span class="s2">                &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-777"><a href="#GuacamoleDB-777"><span class="linenos"> 777</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="n">resolved_connection_id</span><span class="p">))</span>
</span><span id="GuacamoleDB-778"><a href="#GuacamoleDB-778"><span class="linenos"> 778</span></a>
</span><span id="GuacamoleDB-779"><a href="#GuacamoleDB-779"><span class="linenos"> 779</span></a>            <span class="k">elif</span> <span class="n">param_table</span> <span class="o">==</span> <span class="s2">&quot;parameter&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-780"><a href="#GuacamoleDB-780"><span class="linenos"> 780</span></a>                <span class="c1"># Special handling for read-only parameter</span>
</span><span id="GuacamoleDB-781"><a href="#GuacamoleDB-781"><span class="linenos"> 781</span></a>                <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;read-only&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-782"><a href="#GuacamoleDB-782"><span class="linenos"> 782</span></a>                    <span class="c1"># Validate boolean value</span>
</span><span id="GuacamoleDB-783"><a href="#GuacamoleDB-783"><span class="linenos"> 783</span></a>                    <span class="k">if</span> <span class="n">param_value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">):</span>
</span><span id="GuacamoleDB-784"><a href="#GuacamoleDB-784"><span class="linenos"> 784</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-785"><a href="#GuacamoleDB-785"><span class="linenos"> 785</span></a>                            <span class="s2">&quot;Parameter read-only must be &#39;true&#39; or &#39;false&#39;&quot;</span>
</span><span id="GuacamoleDB-786"><a href="#GuacamoleDB-786"><span class="linenos"> 786</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB-787"><a href="#GuacamoleDB-787"><span class="linenos"> 787</span></a>
</span><span id="GuacamoleDB-788"><a href="#GuacamoleDB-788"><span class="linenos"> 788</span></a>                    <span class="c1"># For read-only, we either add with &#39;true&#39; or remove the parameter</span>
</span><span id="GuacamoleDB-789"><a href="#GuacamoleDB-789"><span class="linenos"> 789</span></a>                    <span class="k">if</span> <span class="n">param_value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-790"><a href="#GuacamoleDB-790"><span class="linenos"> 790</span></a>                        <span class="c1"># Check if parameter already exists</span>
</span><span id="GuacamoleDB-791"><a href="#GuacamoleDB-791"><span class="linenos"> 791</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-792"><a href="#GuacamoleDB-792"><span class="linenos"> 792</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-793"><a href="#GuacamoleDB-793"><span class="linenos"> 793</span></a><span class="sd">                            SELECT parameter_value FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-794"><a href="#GuacamoleDB-794"><span class="linenos"> 794</span></a><span class="sd">                            WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB-795"><a href="#GuacamoleDB-795"><span class="linenos"> 795</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-796"><a href="#GuacamoleDB-796"><span class="linenos"> 796</span></a>                            <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB-797"><a href="#GuacamoleDB-797"><span class="linenos"> 797</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB-798"><a href="#GuacamoleDB-798"><span class="linenos"> 798</span></a>
</span><span id="GuacamoleDB-799"><a href="#GuacamoleDB-799"><span class="linenos"> 799</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB-800"><a href="#GuacamoleDB-800"><span class="linenos"> 800</span></a>                            <span class="c1"># Update existing parameter</span>
</span><span id="GuacamoleDB-801"><a href="#GuacamoleDB-801"><span class="linenos"> 801</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-802"><a href="#GuacamoleDB-802"><span class="linenos"> 802</span></a><span class="w">                                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-803"><a href="#GuacamoleDB-803"><span class="linenos"> 803</span></a><span class="sd">                                UPDATE guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-804"><a href="#GuacamoleDB-804"><span class="linenos"> 804</span></a><span class="sd">                                SET parameter_value = &#39;true&#39;</span>
</span><span id="GuacamoleDB-805"><a href="#GuacamoleDB-805"><span class="linenos"> 805</span></a><span class="sd">                                WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB-806"><a href="#GuacamoleDB-806"><span class="linenos"> 806</span></a><span class="sd">                            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-807"><a href="#GuacamoleDB-807"><span class="linenos"> 807</span></a>                                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB-808"><a href="#GuacamoleDB-808"><span class="linenos"> 808</span></a>                            <span class="p">)</span>
</span><span id="GuacamoleDB-809"><a href="#GuacamoleDB-809"><span class="linenos"> 809</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-810"><a href="#GuacamoleDB-810"><span class="linenos"> 810</span></a>                            <span class="c1"># Insert new parameter</span>
</span><span id="GuacamoleDB-811"><a href="#GuacamoleDB-811"><span class="linenos"> 811</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-812"><a href="#GuacamoleDB-812"><span class="linenos"> 812</span></a><span class="w">                                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-813"><a href="#GuacamoleDB-813"><span class="linenos"> 813</span></a><span class="sd">                                INSERT INTO guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-814"><a href="#GuacamoleDB-814"><span class="linenos"> 814</span></a><span class="sd">                                (connection_id, parameter_name, parameter_value)</span>
</span><span id="GuacamoleDB-815"><a href="#GuacamoleDB-815"><span class="linenos"> 815</span></a><span class="sd">                                VALUES (%s, %s, &#39;true&#39;)</span>
</span><span id="GuacamoleDB-816"><a href="#GuacamoleDB-816"><span class="linenos"> 816</span></a><span class="sd">                            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-817"><a href="#GuacamoleDB-817"><span class="linenos"> 817</span></a>                                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB-818"><a href="#GuacamoleDB-818"><span class="linenos"> 818</span></a>                            <span class="p">)</span>
</span><span id="GuacamoleDB-819"><a href="#GuacamoleDB-819"><span class="linenos"> 819</span></a>                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># param_value.lower() == &#39;false&#39;</span>
</span><span id="GuacamoleDB-820"><a href="#GuacamoleDB-820"><span class="linenos"> 820</span></a>                        <span class="c1"># Remove the parameter if it exists</span>
</span><span id="GuacamoleDB-821"><a href="#GuacamoleDB-821"><span class="linenos"> 821</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-822"><a href="#GuacamoleDB-822"><span class="linenos"> 822</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-823"><a href="#GuacamoleDB-823"><span class="linenos"> 823</span></a><span class="sd">                            DELETE FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-824"><a href="#GuacamoleDB-824"><span class="linenos"> 824</span></a><span class="sd">                            WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB-825"><a href="#GuacamoleDB-825"><span class="linenos"> 825</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-826"><a href="#GuacamoleDB-826"><span class="linenos"> 826</span></a>                            <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB-827"><a href="#GuacamoleDB-827"><span class="linenos"> 827</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB-828"><a href="#GuacamoleDB-828"><span class="linenos"> 828</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-829"><a href="#GuacamoleDB-829"><span class="linenos"> 829</span></a>                    <span class="c1"># Special handling for color-depth</span>
</span><span id="GuacamoleDB-830"><a href="#GuacamoleDB-830"><span class="linenos"> 830</span></a>                    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;color-depth&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-831"><a href="#GuacamoleDB-831"><span class="linenos"> 831</span></a>                        <span class="k">if</span> <span class="n">param_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="s2">&quot;24&quot;</span><span class="p">,</span> <span class="s2">&quot;32&quot;</span><span class="p">):</span>
</span><span id="GuacamoleDB-832"><a href="#GuacamoleDB-832"><span class="linenos"> 832</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-833"><a href="#GuacamoleDB-833"><span class="linenos"> 833</span></a>                                <span class="s2">&quot;color-depth must be one of: 8, 16, 24, 32&quot;</span>
</span><span id="GuacamoleDB-834"><a href="#GuacamoleDB-834"><span class="linenos"> 834</span></a>                            <span class="p">)</span>
</span><span id="GuacamoleDB-835"><a href="#GuacamoleDB-835"><span class="linenos"> 835</span></a>
</span><span id="GuacamoleDB-836"><a href="#GuacamoleDB-836"><span class="linenos"> 836</span></a>                    <span class="c1"># Regular parameter handling</span>
</span><span id="GuacamoleDB-837"><a href="#GuacamoleDB-837"><span class="linenos"> 837</span></a>                    <span class="c1"># Check if parameter already exists</span>
</span><span id="GuacamoleDB-838"><a href="#GuacamoleDB-838"><span class="linenos"> 838</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-839"><a href="#GuacamoleDB-839"><span class="linenos"> 839</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-840"><a href="#GuacamoleDB-840"><span class="linenos"> 840</span></a><span class="sd">                        SELECT parameter_value FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-841"><a href="#GuacamoleDB-841"><span class="linenos"> 841</span></a><span class="sd">                        WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB-842"><a href="#GuacamoleDB-842"><span class="linenos"> 842</span></a><span class="sd">                    &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-843"><a href="#GuacamoleDB-843"><span class="linenos"> 843</span></a>                        <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB-844"><a href="#GuacamoleDB-844"><span class="linenos"> 844</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-845"><a href="#GuacamoleDB-845"><span class="linenos"> 845</span></a>
</span><span id="GuacamoleDB-846"><a href="#GuacamoleDB-846"><span class="linenos"> 846</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB-847"><a href="#GuacamoleDB-847"><span class="linenos"> 847</span></a>                        <span class="c1"># Update existing parameter</span>
</span><span id="GuacamoleDB-848"><a href="#GuacamoleDB-848"><span class="linenos"> 848</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-849"><a href="#GuacamoleDB-849"><span class="linenos"> 849</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-850"><a href="#GuacamoleDB-850"><span class="linenos"> 850</span></a><span class="sd">                            UPDATE guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-851"><a href="#GuacamoleDB-851"><span class="linenos"> 851</span></a><span class="sd">                            SET parameter_value = %s</span>
</span><span id="GuacamoleDB-852"><a href="#GuacamoleDB-852"><span class="linenos"> 852</span></a><span class="sd">                            WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB-853"><a href="#GuacamoleDB-853"><span class="linenos"> 853</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-854"><a href="#GuacamoleDB-854"><span class="linenos"> 854</span></a>                            <span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB-855"><a href="#GuacamoleDB-855"><span class="linenos"> 855</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB-856"><a href="#GuacamoleDB-856"><span class="linenos"> 856</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-857"><a href="#GuacamoleDB-857"><span class="linenos"> 857</span></a>                        <span class="c1"># Insert new parameter</span>
</span><span id="GuacamoleDB-858"><a href="#GuacamoleDB-858"><span class="linenos"> 858</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-859"><a href="#GuacamoleDB-859"><span class="linenos"> 859</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-860"><a href="#GuacamoleDB-860"><span class="linenos"> 860</span></a><span class="sd">                            INSERT INTO guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-861"><a href="#GuacamoleDB-861"><span class="linenos"> 861</span></a><span class="sd">                            (connection_id, parameter_name, parameter_value)</span>
</span><span id="GuacamoleDB-862"><a href="#GuacamoleDB-862"><span class="linenos"> 862</span></a><span class="sd">                            VALUES (%s, %s, %s)</span>
</span><span id="GuacamoleDB-863"><a href="#GuacamoleDB-863"><span class="linenos"> 863</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-864"><a href="#GuacamoleDB-864"><span class="linenos"> 864</span></a>                            <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span><span class="p">),</span>
</span><span id="GuacamoleDB-865"><a href="#GuacamoleDB-865"><span class="linenos"> 865</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB-866"><a href="#GuacamoleDB-866"><span class="linenos"> 866</span></a>
</span><span id="GuacamoleDB-867"><a href="#GuacamoleDB-867"><span class="linenos"> 867</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-868"><a href="#GuacamoleDB-868"><span class="linenos"> 868</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update connection parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-869"><a href="#GuacamoleDB-869"><span class="linenos"> 869</span></a>
</span><span id="GuacamoleDB-870"><a href="#GuacamoleDB-870"><span class="linenos"> 870</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-871"><a href="#GuacamoleDB-871"><span class="linenos"> 871</span></a>
</span><span id="GuacamoleDB-872"><a href="#GuacamoleDB-872"><span class="linenos"> 872</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-873"><a href="#GuacamoleDB-873"><span class="linenos"> 873</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying connection parameter: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-874"><a href="#GuacamoleDB-874"><span class="linenos"> 874</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-875"><a href="#GuacamoleDB-875"><span class="linenos"> 875</span></a>
</span><span id="GuacamoleDB-876"><a href="#GuacamoleDB-876"><span class="linenos"> 876</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_user_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-877"><a href="#GuacamoleDB-877"><span class="linenos"> 877</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the password for an existing user.</span>
</span><span id="GuacamoleDB-878"><a href="#GuacamoleDB-878"><span class="linenos"> 878</span></a>
</span><span id="GuacamoleDB-879"><a href="#GuacamoleDB-879"><span class="linenos"> 879</span></a><span class="sd">        Updates a user&#39;s password with secure hashing using a new random salt.</span>
</span><span id="GuacamoleDB-880"><a href="#GuacamoleDB-880"><span class="linenos"> 880</span></a><span class="sd">        Uses the same hashing method as create_user() for consistency.</span>
</span><span id="GuacamoleDB-881"><a href="#GuacamoleDB-881"><span class="linenos"> 881</span></a>
</span><span id="GuacamoleDB-882"><a href="#GuacamoleDB-882"><span class="linenos"> 882</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-883"><a href="#GuacamoleDB-883"><span class="linenos"> 883</span></a><span class="sd">            username: The username whose password should be changed.</span>
</span><span id="GuacamoleDB-884"><a href="#GuacamoleDB-884"><span class="linenos"> 884</span></a><span class="sd">            new_password: The new password to set.</span>
</span><span id="GuacamoleDB-885"><a href="#GuacamoleDB-885"><span class="linenos"> 885</span></a>
</span><span id="GuacamoleDB-886"><a href="#GuacamoleDB-886"><span class="linenos"> 886</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-887"><a href="#GuacamoleDB-887"><span class="linenos"> 887</span></a><span class="sd">            True if password was successfully changed.</span>
</span><span id="GuacamoleDB-888"><a href="#GuacamoleDB-888"><span class="linenos"> 888</span></a>
</span><span id="GuacamoleDB-889"><a href="#GuacamoleDB-889"><span class="linenos"> 889</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-890"><a href="#GuacamoleDB-890"><span class="linenos"> 890</span></a><span class="sd">            ValueError: If user is not found or password update fails.</span>
</span><span id="GuacamoleDB-891"><a href="#GuacamoleDB-891"><span class="linenos"> 891</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB-892"><a href="#GuacamoleDB-892"><span class="linenos"> 892</span></a>
</span><span id="GuacamoleDB-893"><a href="#GuacamoleDB-893"><span class="linenos"> 893</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-894"><a href="#GuacamoleDB-894"><span class="linenos"> 894</span></a><span class="sd">            Generates a new random salt for security. The password date is</span>
</span><span id="GuacamoleDB-895"><a href="#GuacamoleDB-895"><span class="linenos"> 895</span></a><span class="sd">            updated to track when the password was last changed.</span>
</span><span id="GuacamoleDB-896"><a href="#GuacamoleDB-896"><span class="linenos"> 896</span></a>
</span><span id="GuacamoleDB-897"><a href="#GuacamoleDB-897"><span class="linenos"> 897</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-898"><a href="#GuacamoleDB-898"><span class="linenos"> 898</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-899"><a href="#GuacamoleDB-899"><span class="linenos"> 899</span></a><span class="sd">            ...     db.change_user_password(&#39;user1&#39;, &#39;newsecurepassword&#39;)</span>
</span><span id="GuacamoleDB-900"><a href="#GuacamoleDB-900"><span class="linenos"> 900</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-901"><a href="#GuacamoleDB-901"><span class="linenos"> 901</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-902"><a href="#GuacamoleDB-902"><span class="linenos"> 902</span></a>            <span class="c1"># Generate random 32-byte salt</span>
</span><span id="GuacamoleDB-903"><a href="#GuacamoleDB-903"><span class="linenos"> 903</span></a>            <span class="n">salt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="GuacamoleDB-904"><a href="#GuacamoleDB-904"><span class="linenos"> 904</span></a>
</span><span id="GuacamoleDB-905"><a href="#GuacamoleDB-905"><span class="linenos"> 905</span></a>            <span class="c1"># Convert salt to uppercase hex string as Guacamole expects</span>
</span><span id="GuacamoleDB-906"><a href="#GuacamoleDB-906"><span class="linenos"> 906</span></a>            <span class="n">salt_hex</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">salt</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="GuacamoleDB-907"><a href="#GuacamoleDB-907"><span class="linenos"> 907</span></a>
</span><span id="GuacamoleDB-908"><a href="#GuacamoleDB-908"><span class="linenos"> 908</span></a>            <span class="c1"># Create password hash using Guacamole&#39;s method: SHA256(password + hex(salt))</span>
</span><span id="GuacamoleDB-909"><a href="#GuacamoleDB-909"><span class="linenos"> 909</span></a>            <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">new_password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">salt_hex</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span><span id="GuacamoleDB-910"><a href="#GuacamoleDB-910"><span class="linenos"> 910</span></a>
</span><span id="GuacamoleDB-911"><a href="#GuacamoleDB-911"><span class="linenos"> 911</span></a>            <span class="c1"># Get user entity_id</span>
</span><span id="GuacamoleDB-912"><a href="#GuacamoleDB-912"><span class="linenos"> 912</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-913"><a href="#GuacamoleDB-913"><span class="linenos"> 913</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-914"><a href="#GuacamoleDB-914"><span class="linenos"> 914</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-915"><a href="#GuacamoleDB-915"><span class="linenos"> 915</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-916"><a href="#GuacamoleDB-916"><span class="linenos"> 916</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-917"><a href="#GuacamoleDB-917"><span class="linenos"> 917</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-918"><a href="#GuacamoleDB-918"><span class="linenos"> 918</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-919"><a href="#GuacamoleDB-919"><span class="linenos"> 919</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-920"><a href="#GuacamoleDB-920"><span class="linenos"> 920</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-921"><a href="#GuacamoleDB-921"><span class="linenos"> 921</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-922"><a href="#GuacamoleDB-922"><span class="linenos"> 922</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-923"><a href="#GuacamoleDB-923"><span class="linenos"> 923</span></a>
</span><span id="GuacamoleDB-924"><a href="#GuacamoleDB-924"><span class="linenos"> 924</span></a>            <span class="c1"># Update the password</span>
</span><span id="GuacamoleDB-925"><a href="#GuacamoleDB-925"><span class="linenos"> 925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-926"><a href="#GuacamoleDB-926"><span class="linenos"> 926</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-927"><a href="#GuacamoleDB-927"><span class="linenos"> 927</span></a><span class="sd">                UPDATE guacamole_user</span>
</span><span id="GuacamoleDB-928"><a href="#GuacamoleDB-928"><span class="linenos"> 928</span></a><span class="sd">                SET password_hash = %s,</span>
</span><span id="GuacamoleDB-929"><a href="#GuacamoleDB-929"><span class="linenos"> 929</span></a><span class="sd">                    password_salt = %s,</span>
</span><span id="GuacamoleDB-930"><a href="#GuacamoleDB-930"><span class="linenos"> 930</span></a><span class="sd">                    password_date = NOW()</span>
</span><span id="GuacamoleDB-931"><a href="#GuacamoleDB-931"><span class="linenos"> 931</span></a><span class="sd">                WHERE entity_id = %s</span>
</span><span id="GuacamoleDB-932"><a href="#GuacamoleDB-932"><span class="linenos"> 932</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-933"><a href="#GuacamoleDB-933"><span class="linenos"> 933</span></a>                <span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-934"><a href="#GuacamoleDB-934"><span class="linenos"> 934</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-935"><a href="#GuacamoleDB-935"><span class="linenos"> 935</span></a>
</span><span id="GuacamoleDB-936"><a href="#GuacamoleDB-936"><span class="linenos"> 936</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-937"><a href="#GuacamoleDB-937"><span class="linenos"> 937</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update password for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-938"><a href="#GuacamoleDB-938"><span class="linenos"> 938</span></a>
</span><span id="GuacamoleDB-939"><a href="#GuacamoleDB-939"><span class="linenos"> 939</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-940"><a href="#GuacamoleDB-940"><span class="linenos"> 940</span></a>
</span><span id="GuacamoleDB-941"><a href="#GuacamoleDB-941"><span class="linenos"> 941</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-942"><a href="#GuacamoleDB-942"><span class="linenos"> 942</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error changing password: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-943"><a href="#GuacamoleDB-943"><span class="linenos"> 943</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-944"><a href="#GuacamoleDB-944"><span class="linenos"> 944</span></a>
</span><span id="GuacamoleDB-945"><a href="#GuacamoleDB-945"><span class="linenos"> 945</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_user</span><span class="p">(</span>
</span><span id="GuacamoleDB-946"><a href="#GuacamoleDB-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="GuacamoleDB-947"><a href="#GuacamoleDB-947"><span class="linenos"> 947</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-948"><a href="#GuacamoleDB-948"><span class="linenos"> 948</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify a user parameter in the Guacamole database.</span>
</span><span id="GuacamoleDB-949"><a href="#GuacamoleDB-949"><span class="linenos"> 949</span></a>
</span><span id="GuacamoleDB-950"><a href="#GuacamoleDB-950"><span class="linenos"> 950</span></a><span class="sd">        Updates user account parameters such as disabled status, expiration dates,</span>
</span><span id="GuacamoleDB-951"><a href="#GuacamoleDB-951"><span class="linenos"> 951</span></a><span class="sd">        time windows, timezone, and contact information.</span>
</span><span id="GuacamoleDB-952"><a href="#GuacamoleDB-952"><span class="linenos"> 952</span></a>
</span><span id="GuacamoleDB-953"><a href="#GuacamoleDB-953"><span class="linenos"> 953</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-954"><a href="#GuacamoleDB-954"><span class="linenos"> 954</span></a><span class="sd">            username: The username to modify.</span>
</span><span id="GuacamoleDB-955"><a href="#GuacamoleDB-955"><span class="linenos"> 955</span></a><span class="sd">            param_name: The parameter name to modify.</span>
</span><span id="GuacamoleDB-956"><a href="#GuacamoleDB-956"><span class="linenos"> 956</span></a><span class="sd">            param_value: The new value for the parameter.</span>
</span><span id="GuacamoleDB-957"><a href="#GuacamoleDB-957"><span class="linenos"> 957</span></a>
</span><span id="GuacamoleDB-958"><a href="#GuacamoleDB-958"><span class="linenos"> 958</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-959"><a href="#GuacamoleDB-959"><span class="linenos"> 959</span></a><span class="sd">            True if the parameter was successfully updated.</span>
</span><span id="GuacamoleDB-960"><a href="#GuacamoleDB-960"><span class="linenos"> 960</span></a>
</span><span id="GuacamoleDB-961"><a href="#GuacamoleDB-961"><span class="linenos"> 961</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-962"><a href="#GuacamoleDB-962"><span class="linenos"> 962</span></a><span class="sd">            ValueError: If parameter name is invalid, user doesn&#39;t exist,</span>
</span><span id="GuacamoleDB-963"><a href="#GuacamoleDB-963"><span class="linenos"> 963</span></a><span class="sd">                       or parameter update fails.</span>
</span><span id="GuacamoleDB-964"><a href="#GuacamoleDB-964"><span class="linenos"> 964</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB-965"><a href="#GuacamoleDB-965"><span class="linenos"> 965</span></a>
</span><span id="GuacamoleDB-966"><a href="#GuacamoleDB-966"><span class="linenos"> 966</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-967"><a href="#GuacamoleDB-967"><span class="linenos"> 967</span></a><span class="sd">            Valid parameters are defined in USER_PARAMETERS. Boolean values</span>
</span><span id="GuacamoleDB-968"><a href="#GuacamoleDB-968"><span class="linenos"> 968</span></a><span class="sd">            should be passed as &#39;0&#39; (false) or &#39;1&#39; (true) for tinyint fields.</span>
</span><span id="GuacamoleDB-969"><a href="#GuacamoleDB-969"><span class="linenos"> 969</span></a>
</span><span id="GuacamoleDB-970"><a href="#GuacamoleDB-970"><span class="linenos"> 970</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-971"><a href="#GuacamoleDB-971"><span class="linenos"> 971</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-972"><a href="#GuacamoleDB-972"><span class="linenos"> 972</span></a><span class="sd">            ...     db.modify_user(&#39;user1&#39;, &#39;disabled&#39;, &#39;1&#39;)</span>
</span><span id="GuacamoleDB-973"><a href="#GuacamoleDB-973"><span class="linenos"> 973</span></a><span class="sd">            ...     db.modify_user(&#39;user1&#39;, &#39;full_name&#39;, &#39;John Doe&#39;)</span>
</span><span id="GuacamoleDB-974"><a href="#GuacamoleDB-974"><span class="linenos"> 974</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-975"><a href="#GuacamoleDB-975"><span class="linenos"> 975</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-976"><a href="#GuacamoleDB-976"><span class="linenos"> 976</span></a>            <span class="c1"># Validate parameter name</span>
</span><span id="GuacamoleDB-977"><a href="#GuacamoleDB-977"><span class="linenos"> 977</span></a>            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">USER_PARAMETERS</span><span class="p">:</span>
</span><span id="GuacamoleDB-978"><a href="#GuacamoleDB-978"><span class="linenos"> 978</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-979"><a href="#GuacamoleDB-979"><span class="linenos"> 979</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">. Run &#39;guacaman user modify&#39; without arguments to see allowed parameters.&quot;</span>
</span><span id="GuacamoleDB-980"><a href="#GuacamoleDB-980"><span class="linenos"> 980</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-981"><a href="#GuacamoleDB-981"><span class="linenos"> 981</span></a>
</span><span id="GuacamoleDB-982"><a href="#GuacamoleDB-982"><span class="linenos"> 982</span></a>            <span class="c1"># Validate parameter value based on type</span>
</span><span id="GuacamoleDB-983"><a href="#GuacamoleDB-983"><span class="linenos"> 983</span></a>            <span class="n">param_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">USER_PARAMETERS</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="GuacamoleDB-984"><a href="#GuacamoleDB-984"><span class="linenos"> 984</span></a>            <span class="k">if</span> <span class="n">param_type</span> <span class="o">==</span> <span class="s2">&quot;tinyint&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-985"><a href="#GuacamoleDB-985"><span class="linenos"> 985</span></a>                <span class="k">if</span> <span class="n">param_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">):</span>
</span><span id="GuacamoleDB-986"><a href="#GuacamoleDB-986"><span class="linenos"> 986</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> must be 0 or 1&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-987"><a href="#GuacamoleDB-987"><span class="linenos"> 987</span></a>                <span class="n">param_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
</span><span id="GuacamoleDB-988"><a href="#GuacamoleDB-988"><span class="linenos"> 988</span></a>
</span><span id="GuacamoleDB-989"><a href="#GuacamoleDB-989"><span class="linenos"> 989</span></a>            <span class="c1"># Get user entity_id</span>
</span><span id="GuacamoleDB-990"><a href="#GuacamoleDB-990"><span class="linenos"> 990</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-991"><a href="#GuacamoleDB-991"><span class="linenos"> 991</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-992"><a href="#GuacamoleDB-992"><span class="linenos"> 992</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-993"><a href="#GuacamoleDB-993"><span class="linenos"> 993</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-994"><a href="#GuacamoleDB-994"><span class="linenos"> 994</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-995"><a href="#GuacamoleDB-995"><span class="linenos"> 995</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-996"><a href="#GuacamoleDB-996"><span class="linenos"> 996</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-997"><a href="#GuacamoleDB-997"><span class="linenos"> 997</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-998"><a href="#GuacamoleDB-998"><span class="linenos"> 998</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-999"><a href="#GuacamoleDB-999"><span class="linenos"> 999</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1000"><a href="#GuacamoleDB-1000"><span class="linenos">1000</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-1001"><a href="#GuacamoleDB-1001"><span class="linenos">1001</span></a>
</span><span id="GuacamoleDB-1002"><a href="#GuacamoleDB-1002"><span class="linenos">1002</span></a>            <span class="c1"># Update the parameter</span>
</span><span id="GuacamoleDB-1003"><a href="#GuacamoleDB-1003"><span class="linenos">1003</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1004"><a href="#GuacamoleDB-1004"><span class="linenos">1004</span></a><span class="s2">                UPDATE guacamole_user</span>
</span><span id="GuacamoleDB-1005"><a href="#GuacamoleDB-1005"><span class="linenos">1005</span></a><span class="s2">                SET </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> = %s</span>
</span><span id="GuacamoleDB-1006"><a href="#GuacamoleDB-1006"><span class="linenos">1006</span></a><span class="s2">                WHERE entity_id = %s</span>
</span><span id="GuacamoleDB-1007"><a href="#GuacamoleDB-1007"><span class="linenos">1007</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1008"><a href="#GuacamoleDB-1008"><span class="linenos">1008</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">))</span>
</span><span id="GuacamoleDB-1009"><a href="#GuacamoleDB-1009"><span class="linenos">1009</span></a>
</span><span id="GuacamoleDB-1010"><a href="#GuacamoleDB-1010"><span class="linenos">1010</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-1011"><a href="#GuacamoleDB-1011"><span class="linenos">1011</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update user parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1012"><a href="#GuacamoleDB-1012"><span class="linenos">1012</span></a>
</span><span id="GuacamoleDB-1013"><a href="#GuacamoleDB-1013"><span class="linenos">1013</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-1014"><a href="#GuacamoleDB-1014"><span class="linenos">1014</span></a>
</span><span id="GuacamoleDB-1015"><a href="#GuacamoleDB-1015"><span class="linenos">1015</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1016"><a href="#GuacamoleDB-1016"><span class="linenos">1016</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying user parameter: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1017"><a href="#GuacamoleDB-1017"><span class="linenos">1017</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1018"><a href="#GuacamoleDB-1018"><span class="linenos">1018</span></a>
</span><span id="GuacamoleDB-1019"><a href="#GuacamoleDB-1019"><span class="linenos">1019</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1020"><a href="#GuacamoleDB-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a user and all associated data from the Guacamole database.</span>
</span><span id="GuacamoleDB-1021"><a href="#GuacamoleDB-1021"><span class="linenos">1021</span></a>
</span><span id="GuacamoleDB-1022"><a href="#GuacamoleDB-1022"><span class="linenos">1022</span></a><span class="sd">        Removes a user completely from the system, including their entity record,</span>
</span><span id="GuacamoleDB-1023"><a href="#GuacamoleDB-1023"><span class="linenos">1023</span></a><span class="sd">        user account, group memberships, and all permissions. This operation</span>
</span><span id="GuacamoleDB-1024"><a href="#GuacamoleDB-1024"><span class="linenos">1024</span></a><span class="sd">        cascades through all related tables to maintain database integrity.</span>
</span><span id="GuacamoleDB-1025"><a href="#GuacamoleDB-1025"><span class="linenos">1025</span></a>
</span><span id="GuacamoleDB-1026"><a href="#GuacamoleDB-1026"><span class="linenos">1026</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-1027"><a href="#GuacamoleDB-1027"><span class="linenos">1027</span></a><span class="sd">            username: The username to delete.</span>
</span><span id="GuacamoleDB-1028"><a href="#GuacamoleDB-1028"><span class="linenos">1028</span></a>
</span><span id="GuacamoleDB-1029"><a href="#GuacamoleDB-1029"><span class="linenos">1029</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-1030"><a href="#GuacamoleDB-1030"><span class="linenos">1030</span></a><span class="sd">            ValueError: If the user doesn&#39;t exist.</span>
</span><span id="GuacamoleDB-1031"><a href="#GuacamoleDB-1031"><span class="linenos">1031</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB-1032"><a href="#GuacamoleDB-1032"><span class="linenos">1032</span></a>
</span><span id="GuacamoleDB-1033"><a href="#GuacamoleDB-1033"><span class="linenos">1033</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-1034"><a href="#GuacamoleDB-1034"><span class="linenos">1034</span></a><span class="sd">            This is a destructive operation that cannot be undone. The user and</span>
</span><span id="GuacamoleDB-1035"><a href="#GuacamoleDB-1035"><span class="linenos">1035</span></a><span class="sd">            all their associated permissions and memberships are permanently</span>
</span><span id="GuacamoleDB-1036"><a href="#GuacamoleDB-1036"><span class="linenos">1036</span></a><span class="sd">            removed. Deletions are performed in the correct order to respect</span>
</span><span id="GuacamoleDB-1037"><a href="#GuacamoleDB-1037"><span class="linenos">1037</span></a><span class="sd">            foreign key constraints.</span>
</span><span id="GuacamoleDB-1038"><a href="#GuacamoleDB-1038"><span class="linenos">1038</span></a>
</span><span id="GuacamoleDB-1039"><a href="#GuacamoleDB-1039"><span class="linenos">1039</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-1040"><a href="#GuacamoleDB-1040"><span class="linenos">1040</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-1041"><a href="#GuacamoleDB-1041"><span class="linenos">1041</span></a><span class="sd">            ...     db.delete_existing_user(&#39;olduser&#39;)</span>
</span><span id="GuacamoleDB-1042"><a href="#GuacamoleDB-1042"><span class="linenos">1042</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1043"><a href="#GuacamoleDB-1043"><span class="linenos">1043</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1044"><a href="#GuacamoleDB-1044"><span class="linenos">1044</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_exists</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
</span><span id="GuacamoleDB-1045"><a href="#GuacamoleDB-1045"><span class="linenos">1045</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1046"><a href="#GuacamoleDB-1046"><span class="linenos">1046</span></a>
</span><span id="GuacamoleDB-1047"><a href="#GuacamoleDB-1047"><span class="linenos">1047</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting user: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1048"><a href="#GuacamoleDB-1048"><span class="linenos">1048</span></a>            <span class="c1"># Delete user group permissions first</span>
</span><span id="GuacamoleDB-1049"><a href="#GuacamoleDB-1049"><span class="linenos">1049</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1050"><a href="#GuacamoleDB-1050"><span class="linenos">1050</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1051"><a href="#GuacamoleDB-1051"><span class="linenos">1051</span></a><span class="sd">                DELETE FROM guacamole_user_group_permission</span>
</span><span id="GuacamoleDB-1052"><a href="#GuacamoleDB-1052"><span class="linenos">1052</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1053"><a href="#GuacamoleDB-1053"><span class="linenos">1053</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-1054"><a href="#GuacamoleDB-1054"><span class="linenos">1054</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1055"><a href="#GuacamoleDB-1055"><span class="linenos">1055</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1056"><a href="#GuacamoleDB-1056"><span class="linenos">1056</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1057"><a href="#GuacamoleDB-1057"><span class="linenos">1057</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1058"><a href="#GuacamoleDB-1058"><span class="linenos">1058</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1059"><a href="#GuacamoleDB-1059"><span class="linenos">1059</span></a>
</span><span id="GuacamoleDB-1060"><a href="#GuacamoleDB-1060"><span class="linenos">1060</span></a>            <span class="c1"># Delete user group memberships</span>
</span><span id="GuacamoleDB-1061"><a href="#GuacamoleDB-1061"><span class="linenos">1061</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1062"><a href="#GuacamoleDB-1062"><span class="linenos">1062</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1063"><a href="#GuacamoleDB-1063"><span class="linenos">1063</span></a><span class="sd">                DELETE FROM guacamole_user_group_member</span>
</span><span id="GuacamoleDB-1064"><a href="#GuacamoleDB-1064"><span class="linenos">1064</span></a><span class="sd">                WHERE member_entity_id IN (</span>
</span><span id="GuacamoleDB-1065"><a href="#GuacamoleDB-1065"><span class="linenos">1065</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-1066"><a href="#GuacamoleDB-1066"><span class="linenos">1066</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1067"><a href="#GuacamoleDB-1067"><span class="linenos">1067</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1068"><a href="#GuacamoleDB-1068"><span class="linenos">1068</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1069"><a href="#GuacamoleDB-1069"><span class="linenos">1069</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1070"><a href="#GuacamoleDB-1070"><span class="linenos">1070</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1071"><a href="#GuacamoleDB-1071"><span class="linenos">1071</span></a>
</span><span id="GuacamoleDB-1072"><a href="#GuacamoleDB-1072"><span class="linenos">1072</span></a>            <span class="c1"># Delete user permissions</span>
</span><span id="GuacamoleDB-1073"><a href="#GuacamoleDB-1073"><span class="linenos">1073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1074"><a href="#GuacamoleDB-1074"><span class="linenos">1074</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1075"><a href="#GuacamoleDB-1075"><span class="linenos">1075</span></a><span class="sd">                DELETE FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB-1076"><a href="#GuacamoleDB-1076"><span class="linenos">1076</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1077"><a href="#GuacamoleDB-1077"><span class="linenos">1077</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-1078"><a href="#GuacamoleDB-1078"><span class="linenos">1078</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1079"><a href="#GuacamoleDB-1079"><span class="linenos">1079</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1080"><a href="#GuacamoleDB-1080"><span class="linenos">1080</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1081"><a href="#GuacamoleDB-1081"><span class="linenos">1081</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1082"><a href="#GuacamoleDB-1082"><span class="linenos">1082</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1083"><a href="#GuacamoleDB-1083"><span class="linenos">1083</span></a>
</span><span id="GuacamoleDB-1084"><a href="#GuacamoleDB-1084"><span class="linenos">1084</span></a>            <span class="c1"># Delete user</span>
</span><span id="GuacamoleDB-1085"><a href="#GuacamoleDB-1085"><span class="linenos">1085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1086"><a href="#GuacamoleDB-1086"><span class="linenos">1086</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1087"><a href="#GuacamoleDB-1087"><span class="linenos">1087</span></a><span class="sd">                DELETE FROM guacamole_user</span>
</span><span id="GuacamoleDB-1088"><a href="#GuacamoleDB-1088"><span class="linenos">1088</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1089"><a href="#GuacamoleDB-1089"><span class="linenos">1089</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-1090"><a href="#GuacamoleDB-1090"><span class="linenos">1090</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1091"><a href="#GuacamoleDB-1091"><span class="linenos">1091</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1092"><a href="#GuacamoleDB-1092"><span class="linenos">1092</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1093"><a href="#GuacamoleDB-1093"><span class="linenos">1093</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1094"><a href="#GuacamoleDB-1094"><span class="linenos">1094</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1095"><a href="#GuacamoleDB-1095"><span class="linenos">1095</span></a>
</span><span id="GuacamoleDB-1096"><a href="#GuacamoleDB-1096"><span class="linenos">1096</span></a>            <span class="c1"># Delete entity</span>
</span><span id="GuacamoleDB-1097"><a href="#GuacamoleDB-1097"><span class="linenos">1097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1098"><a href="#GuacamoleDB-1098"><span class="linenos">1098</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1099"><a href="#GuacamoleDB-1099"><span class="linenos">1099</span></a><span class="sd">                DELETE FROM guacamole_entity</span>
</span><span id="GuacamoleDB-1100"><a href="#GuacamoleDB-1100"><span class="linenos">1100</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1101"><a href="#GuacamoleDB-1101"><span class="linenos">1101</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1102"><a href="#GuacamoleDB-1102"><span class="linenos">1102</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1103"><a href="#GuacamoleDB-1103"><span class="linenos">1103</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1104"><a href="#GuacamoleDB-1104"><span class="linenos">1104</span></a>
</span><span id="GuacamoleDB-1105"><a href="#GuacamoleDB-1105"><span class="linenos">1105</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1106"><a href="#GuacamoleDB-1106"><span class="linenos">1106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1107"><a href="#GuacamoleDB-1107"><span class="linenos">1107</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1108"><a href="#GuacamoleDB-1108"><span class="linenos">1108</span></a>
</span><span id="GuacamoleDB-1109"><a href="#GuacamoleDB-1109"><span class="linenos">1109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1110"><a href="#GuacamoleDB-1110"><span class="linenos">1110</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1111"><a href="#GuacamoleDB-1111"><span class="linenos">1111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting usergroup: </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1112"><a href="#GuacamoleDB-1112"><span class="linenos">1112</span></a>            <span class="c1"># Delete group memberships</span>
</span><span id="GuacamoleDB-1113"><a href="#GuacamoleDB-1113"><span class="linenos">1113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1114"><a href="#GuacamoleDB-1114"><span class="linenos">1114</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1115"><a href="#GuacamoleDB-1115"><span class="linenos">1115</span></a><span class="sd">                DELETE FROM guacamole_user_group_member </span>
</span><span id="GuacamoleDB-1116"><a href="#GuacamoleDB-1116"><span class="linenos">1116</span></a><span class="sd">                WHERE user_group_id IN (</span>
</span><span id="GuacamoleDB-1117"><a href="#GuacamoleDB-1117"><span class="linenos">1117</span></a><span class="sd">                    SELECT user_group_id FROM guacamole_user_group </span>
</span><span id="GuacamoleDB-1118"><a href="#GuacamoleDB-1118"><span class="linenos">1118</span></a><span class="sd">                    WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1119"><a href="#GuacamoleDB-1119"><span class="linenos">1119</span></a><span class="sd">                        SELECT entity_id FROM guacamole_entity </span>
</span><span id="GuacamoleDB-1120"><a href="#GuacamoleDB-1120"><span class="linenos">1120</span></a><span class="sd">                        WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-1121"><a href="#GuacamoleDB-1121"><span class="linenos">1121</span></a><span class="sd">                    )</span>
</span><span id="GuacamoleDB-1122"><a href="#GuacamoleDB-1122"><span class="linenos">1122</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1123"><a href="#GuacamoleDB-1123"><span class="linenos">1123</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1124"><a href="#GuacamoleDB-1124"><span class="linenos">1124</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1125"><a href="#GuacamoleDB-1125"><span class="linenos">1125</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1126"><a href="#GuacamoleDB-1126"><span class="linenos">1126</span></a>
</span><span id="GuacamoleDB-1127"><a href="#GuacamoleDB-1127"><span class="linenos">1127</span></a>            <span class="c1"># Delete group permissions</span>
</span><span id="GuacamoleDB-1128"><a href="#GuacamoleDB-1128"><span class="linenos">1128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1129"><a href="#GuacamoleDB-1129"><span class="linenos">1129</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1130"><a href="#GuacamoleDB-1130"><span class="linenos">1130</span></a><span class="sd">                DELETE FROM guacamole_connection_permission </span>
</span><span id="GuacamoleDB-1131"><a href="#GuacamoleDB-1131"><span class="linenos">1131</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1132"><a href="#GuacamoleDB-1132"><span class="linenos">1132</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity </span>
</span><span id="GuacamoleDB-1133"><a href="#GuacamoleDB-1133"><span class="linenos">1133</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-1134"><a href="#GuacamoleDB-1134"><span class="linenos">1134</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1135"><a href="#GuacamoleDB-1135"><span class="linenos">1135</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1136"><a href="#GuacamoleDB-1136"><span class="linenos">1136</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1137"><a href="#GuacamoleDB-1137"><span class="linenos">1137</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1138"><a href="#GuacamoleDB-1138"><span class="linenos">1138</span></a>
</span><span id="GuacamoleDB-1139"><a href="#GuacamoleDB-1139"><span class="linenos">1139</span></a>            <span class="c1"># Delete user group</span>
</span><span id="GuacamoleDB-1140"><a href="#GuacamoleDB-1140"><span class="linenos">1140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1141"><a href="#GuacamoleDB-1141"><span class="linenos">1141</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1142"><a href="#GuacamoleDB-1142"><span class="linenos">1142</span></a><span class="sd">                DELETE FROM guacamole_user_group </span>
</span><span id="GuacamoleDB-1143"><a href="#GuacamoleDB-1143"><span class="linenos">1143</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1144"><a href="#GuacamoleDB-1144"><span class="linenos">1144</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity </span>
</span><span id="GuacamoleDB-1145"><a href="#GuacamoleDB-1145"><span class="linenos">1145</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-1146"><a href="#GuacamoleDB-1146"><span class="linenos">1146</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1147"><a href="#GuacamoleDB-1147"><span class="linenos">1147</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1148"><a href="#GuacamoleDB-1148"><span class="linenos">1148</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1149"><a href="#GuacamoleDB-1149"><span class="linenos">1149</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1150"><a href="#GuacamoleDB-1150"><span class="linenos">1150</span></a>
</span><span id="GuacamoleDB-1151"><a href="#GuacamoleDB-1151"><span class="linenos">1151</span></a>            <span class="c1"># Delete entity</span>
</span><span id="GuacamoleDB-1152"><a href="#GuacamoleDB-1152"><span class="linenos">1152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1153"><a href="#GuacamoleDB-1153"><span class="linenos">1153</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1154"><a href="#GuacamoleDB-1154"><span class="linenos">1154</span></a><span class="sd">                DELETE FROM guacamole_entity </span>
</span><span id="GuacamoleDB-1155"><a href="#GuacamoleDB-1155"><span class="linenos">1155</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-1156"><a href="#GuacamoleDB-1156"><span class="linenos">1156</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1157"><a href="#GuacamoleDB-1157"><span class="linenos">1157</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1158"><a href="#GuacamoleDB-1158"><span class="linenos">1158</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1159"><a href="#GuacamoleDB-1159"><span class="linenos">1159</span></a>
</span><span id="GuacamoleDB-1160"><a href="#GuacamoleDB-1160"><span class="linenos">1160</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1161"><a href="#GuacamoleDB-1161"><span class="linenos">1161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1162"><a href="#GuacamoleDB-1162"><span class="linenos">1162</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1163"><a href="#GuacamoleDB-1163"><span class="linenos">1163</span></a>
</span><span id="GuacamoleDB-1164"><a href="#GuacamoleDB-1164"><span class="linenos">1164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_usergroup_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1165"><a href="#GuacamoleDB-1165"><span class="linenos">1165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a usergroup by ID and all its associated data&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1166"><a href="#GuacamoleDB-1166"><span class="linenos">1166</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1167"><a href="#GuacamoleDB-1167"><span class="linenos">1167</span></a>            <span class="c1"># Validate and resolve the group ID</span>
</span><span id="GuacamoleDB-1168"><a href="#GuacamoleDB-1168"><span class="linenos">1168</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_usergroup_id</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-1169"><a href="#GuacamoleDB-1169"><span class="linenos">1169</span></a>            <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_usergroup_name_by_id</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-1170"><a href="#GuacamoleDB-1170"><span class="linenos">1170</span></a>
</span><span id="GuacamoleDB-1171"><a href="#GuacamoleDB-1171"><span class="linenos">1171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-1172"><a href="#GuacamoleDB-1172"><span class="linenos">1172</span></a>                <span class="sa">f</span><span class="s2">&quot;Attempting to delete usergroup: </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">resolved_group_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GuacamoleDB-1173"><a href="#GuacamoleDB-1173"><span class="linenos">1173</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1174"><a href="#GuacamoleDB-1174"><span class="linenos">1174</span></a>
</span><span id="GuacamoleDB-1175"><a href="#GuacamoleDB-1175"><span class="linenos">1175</span></a>            <span class="c1"># Delete group memberships</span>
</span><span id="GuacamoleDB-1176"><a href="#GuacamoleDB-1176"><span class="linenos">1176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1177"><a href="#GuacamoleDB-1177"><span class="linenos">1177</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1178"><a href="#GuacamoleDB-1178"><span class="linenos">1178</span></a><span class="sd">                DELETE FROM guacamole_user_group_member </span>
</span><span id="GuacamoleDB-1179"><a href="#GuacamoleDB-1179"><span class="linenos">1179</span></a><span class="sd">                WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB-1180"><a href="#GuacamoleDB-1180"><span class="linenos">1180</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1181"><a href="#GuacamoleDB-1181"><span class="linenos">1181</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1182"><a href="#GuacamoleDB-1182"><span class="linenos">1182</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1183"><a href="#GuacamoleDB-1183"><span class="linenos">1183</span></a>
</span><span id="GuacamoleDB-1184"><a href="#GuacamoleDB-1184"><span class="linenos">1184</span></a>            <span class="c1"># Delete group permissions</span>
</span><span id="GuacamoleDB-1185"><a href="#GuacamoleDB-1185"><span class="linenos">1185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1186"><a href="#GuacamoleDB-1186"><span class="linenos">1186</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1187"><a href="#GuacamoleDB-1187"><span class="linenos">1187</span></a><span class="sd">                DELETE FROM guacamole_connection_permission </span>
</span><span id="GuacamoleDB-1188"><a href="#GuacamoleDB-1188"><span class="linenos">1188</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1189"><a href="#GuacamoleDB-1189"><span class="linenos">1189</span></a><span class="sd">                    SELECT entity_id FROM guacamole_user_group </span>
</span><span id="GuacamoleDB-1190"><a href="#GuacamoleDB-1190"><span class="linenos">1190</span></a><span class="sd">                    WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB-1191"><a href="#GuacamoleDB-1191"><span class="linenos">1191</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1192"><a href="#GuacamoleDB-1192"><span class="linenos">1192</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1193"><a href="#GuacamoleDB-1193"><span class="linenos">1193</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1194"><a href="#GuacamoleDB-1194"><span class="linenos">1194</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1195"><a href="#GuacamoleDB-1195"><span class="linenos">1195</span></a>
</span><span id="GuacamoleDB-1196"><a href="#GuacamoleDB-1196"><span class="linenos">1196</span></a>            <span class="c1"># Delete user group</span>
</span><span id="GuacamoleDB-1197"><a href="#GuacamoleDB-1197"><span class="linenos">1197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1198"><a href="#GuacamoleDB-1198"><span class="linenos">1198</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1199"><a href="#GuacamoleDB-1199"><span class="linenos">1199</span></a><span class="sd">                DELETE FROM guacamole_user_group </span>
</span><span id="GuacamoleDB-1200"><a href="#GuacamoleDB-1200"><span class="linenos">1200</span></a><span class="sd">                WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB-1201"><a href="#GuacamoleDB-1201"><span class="linenos">1201</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1202"><a href="#GuacamoleDB-1202"><span class="linenos">1202</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1203"><a href="#GuacamoleDB-1203"><span class="linenos">1203</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1204"><a href="#GuacamoleDB-1204"><span class="linenos">1204</span></a>
</span><span id="GuacamoleDB-1205"><a href="#GuacamoleDB-1205"><span class="linenos">1205</span></a>            <span class="c1"># Delete entity</span>
</span><span id="GuacamoleDB-1206"><a href="#GuacamoleDB-1206"><span class="linenos">1206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1207"><a href="#GuacamoleDB-1207"><span class="linenos">1207</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1208"><a href="#GuacamoleDB-1208"><span class="linenos">1208</span></a><span class="sd">                DELETE FROM guacamole_entity </span>
</span><span id="GuacamoleDB-1209"><a href="#GuacamoleDB-1209"><span class="linenos">1209</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB-1210"><a href="#GuacamoleDB-1210"><span class="linenos">1210</span></a><span class="sd">                    SELECT entity_id FROM guacamole_user_group </span>
</span><span id="GuacamoleDB-1211"><a href="#GuacamoleDB-1211"><span class="linenos">1211</span></a><span class="sd">                    WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB-1212"><a href="#GuacamoleDB-1212"><span class="linenos">1212</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1213"><a href="#GuacamoleDB-1213"><span class="linenos">1213</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1214"><a href="#GuacamoleDB-1214"><span class="linenos">1214</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1215"><a href="#GuacamoleDB-1215"><span class="linenos">1215</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1216"><a href="#GuacamoleDB-1216"><span class="linenos">1216</span></a>
</span><span id="GuacamoleDB-1217"><a href="#GuacamoleDB-1217"><span class="linenos">1217</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1218"><a href="#GuacamoleDB-1218"><span class="linenos">1218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1219"><a href="#GuacamoleDB-1219"><span class="linenos">1219</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1220"><a href="#GuacamoleDB-1220"><span class="linenos">1220</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1221"><a href="#GuacamoleDB-1221"><span class="linenos">1221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1222"><a href="#GuacamoleDB-1222"><span class="linenos">1222</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1223"><a href="#GuacamoleDB-1223"><span class="linenos">1223</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1224"><a href="#GuacamoleDB-1224"><span class="linenos">1224</span></a>
</span><span id="GuacamoleDB-1225"><a href="#GuacamoleDB-1225"><span class="linenos">1225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_connection</span><span class="p">(</span>
</span><span id="GuacamoleDB-1226"><a href="#GuacamoleDB-1226"><span class="linenos">1226</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-1227"><a href="#GuacamoleDB-1227"><span class="linenos">1227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1228"><a href="#GuacamoleDB-1228"><span class="linenos">1228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a connection and all its associated data&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1229"><a href="#GuacamoleDB-1229"><span class="linenos">1229</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1230"><a href="#GuacamoleDB-1230"><span class="linenos">1230</span></a>            <span class="c1"># Use resolver to get connection_id and validate inputs</span>
</span><span id="GuacamoleDB-1231"><a href="#GuacamoleDB-1231"><span class="linenos">1231</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-1232"><a href="#GuacamoleDB-1232"><span class="linenos">1232</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB-1233"><a href="#GuacamoleDB-1233"><span class="linenos">1233</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1234"><a href="#GuacamoleDB-1234"><span class="linenos">1234</span></a>
</span><span id="GuacamoleDB-1235"><a href="#GuacamoleDB-1235"><span class="linenos">1235</span></a>            <span class="c1"># Get connection name for logging if we only have ID</span>
</span><span id="GuacamoleDB-1236"><a href="#GuacamoleDB-1236"><span class="linenos">1236</span></a>            <span class="k">if</span> <span class="n">connection_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1237"><a href="#GuacamoleDB-1237"><span class="linenos">1237</span></a>                <span class="n">connection_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_name_by_id</span><span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-1238"><a href="#GuacamoleDB-1238"><span class="linenos">1238</span></a>
</span><span id="GuacamoleDB-1239"><a href="#GuacamoleDB-1239"><span class="linenos">1239</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-1240"><a href="#GuacamoleDB-1240"><span class="linenos">1240</span></a>                <span class="sa">f</span><span class="s2">&quot;Attempting to delete connection: </span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">resolved_connection_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GuacamoleDB-1241"><a href="#GuacamoleDB-1241"><span class="linenos">1241</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1242"><a href="#GuacamoleDB-1242"><span class="linenos">1242</span></a>
</span><span id="GuacamoleDB-1243"><a href="#GuacamoleDB-1243"><span class="linenos">1243</span></a>            <span class="c1"># Delete connection history</span>
</span><span id="GuacamoleDB-1244"><a href="#GuacamoleDB-1244"><span class="linenos">1244</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection history...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1245"><a href="#GuacamoleDB-1245"><span class="linenos">1245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1246"><a href="#GuacamoleDB-1246"><span class="linenos">1246</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1247"><a href="#GuacamoleDB-1247"><span class="linenos">1247</span></a><span class="sd">                DELETE FROM guacamole_connection_history</span>
</span><span id="GuacamoleDB-1248"><a href="#GuacamoleDB-1248"><span class="linenos">1248</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-1249"><a href="#GuacamoleDB-1249"><span class="linenos">1249</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1250"><a href="#GuacamoleDB-1250"><span class="linenos">1250</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1251"><a href="#GuacamoleDB-1251"><span class="linenos">1251</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1252"><a href="#GuacamoleDB-1252"><span class="linenos">1252</span></a>
</span><span id="GuacamoleDB-1253"><a href="#GuacamoleDB-1253"><span class="linenos">1253</span></a>            <span class="c1"># Delete connection parameters</span>
</span><span id="GuacamoleDB-1254"><a href="#GuacamoleDB-1254"><span class="linenos">1254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection parameters...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1255"><a href="#GuacamoleDB-1255"><span class="linenos">1255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1256"><a href="#GuacamoleDB-1256"><span class="linenos">1256</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1257"><a href="#GuacamoleDB-1257"><span class="linenos">1257</span></a><span class="sd">                DELETE FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-1258"><a href="#GuacamoleDB-1258"><span class="linenos">1258</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-1259"><a href="#GuacamoleDB-1259"><span class="linenos">1259</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1260"><a href="#GuacamoleDB-1260"><span class="linenos">1260</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1261"><a href="#GuacamoleDB-1261"><span class="linenos">1261</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1262"><a href="#GuacamoleDB-1262"><span class="linenos">1262</span></a>
</span><span id="GuacamoleDB-1263"><a href="#GuacamoleDB-1263"><span class="linenos">1263</span></a>            <span class="c1"># Delete connection permissions</span>
</span><span id="GuacamoleDB-1264"><a href="#GuacamoleDB-1264"><span class="linenos">1264</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection permissions...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1265"><a href="#GuacamoleDB-1265"><span class="linenos">1265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1266"><a href="#GuacamoleDB-1266"><span class="linenos">1266</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1267"><a href="#GuacamoleDB-1267"><span class="linenos">1267</span></a><span class="sd">                DELETE FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB-1268"><a href="#GuacamoleDB-1268"><span class="linenos">1268</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-1269"><a href="#GuacamoleDB-1269"><span class="linenos">1269</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1270"><a href="#GuacamoleDB-1270"><span class="linenos">1270</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1271"><a href="#GuacamoleDB-1271"><span class="linenos">1271</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1272"><a href="#GuacamoleDB-1272"><span class="linenos">1272</span></a>
</span><span id="GuacamoleDB-1273"><a href="#GuacamoleDB-1273"><span class="linenos">1273</span></a>            <span class="c1"># Finally delete the connection</span>
</span><span id="GuacamoleDB-1274"><a href="#GuacamoleDB-1274"><span class="linenos">1274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1275"><a href="#GuacamoleDB-1275"><span class="linenos">1275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1276"><a href="#GuacamoleDB-1276"><span class="linenos">1276</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1277"><a href="#GuacamoleDB-1277"><span class="linenos">1277</span></a><span class="sd">                DELETE FROM guacamole_connection</span>
</span><span id="GuacamoleDB-1278"><a href="#GuacamoleDB-1278"><span class="linenos">1278</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-1279"><a href="#GuacamoleDB-1279"><span class="linenos">1279</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1280"><a href="#GuacamoleDB-1280"><span class="linenos">1280</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1281"><a href="#GuacamoleDB-1281"><span class="linenos">1281</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1282"><a href="#GuacamoleDB-1282"><span class="linenos">1282</span></a>
</span><span id="GuacamoleDB-1283"><a href="#GuacamoleDB-1283"><span class="linenos">1283</span></a>            <span class="c1"># Commit the transaction</span>
</span><span id="GuacamoleDB-1284"><a href="#GuacamoleDB-1284"><span class="linenos">1284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Committing transaction...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1285"><a href="#GuacamoleDB-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="GuacamoleDB-1286"><a href="#GuacamoleDB-1286"><span class="linenos">1286</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1287"><a href="#GuacamoleDB-1287"><span class="linenos">1287</span></a>
</span><span id="GuacamoleDB-1288"><a href="#GuacamoleDB-1288"><span class="linenos">1288</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1289"><a href="#GuacamoleDB-1289"><span class="linenos">1289</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing connection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1290"><a href="#GuacamoleDB-1290"><span class="linenos">1290</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1291"><a href="#GuacamoleDB-1291"><span class="linenos">1291</span></a>
</span><span id="GuacamoleDB-1292"><a href="#GuacamoleDB-1292"><span class="linenos">1292</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_connection_group</span><span class="p">(</span>
</span><span id="GuacamoleDB-1293"><a href="#GuacamoleDB-1293"><span class="linenos">1293</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-1294"><a href="#GuacamoleDB-1294"><span class="linenos">1294</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-1295"><a href="#GuacamoleDB-1295"><span class="linenos">1295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a connection group and update references to it&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1296"><a href="#GuacamoleDB-1296"><span class="linenos">1296</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1297"><a href="#GuacamoleDB-1297"><span class="linenos">1297</span></a>            <span class="c1"># Use resolver to get group_id and validate inputs</span>
</span><span id="GuacamoleDB-1298"><a href="#GuacamoleDB-1298"><span class="linenos">1298</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_conngroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-1299"><a href="#GuacamoleDB-1299"><span class="linenos">1299</span></a>
</span><span id="GuacamoleDB-1300"><a href="#GuacamoleDB-1300"><span class="linenos">1300</span></a>            <span class="c1"># Get group name for logging if we only have ID</span>
</span><span id="GuacamoleDB-1301"><a href="#GuacamoleDB-1301"><span class="linenos">1301</span></a>            <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1302"><a href="#GuacamoleDB-1302"><span class="linenos">1302</span></a>                <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_name_by_id</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-1303"><a href="#GuacamoleDB-1303"><span class="linenos">1303</span></a>
</span><span id="GuacamoleDB-1304"><a href="#GuacamoleDB-1304"><span class="linenos">1304</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-1305"><a href="#GuacamoleDB-1305"><span class="linenos">1305</span></a>                <span class="sa">f</span><span class="s2">&quot;Attempting to delete connection group: </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">resolved_group_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GuacamoleDB-1306"><a href="#GuacamoleDB-1306"><span class="linenos">1306</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1307"><a href="#GuacamoleDB-1307"><span class="linenos">1307</span></a>
</span><span id="GuacamoleDB-1308"><a href="#GuacamoleDB-1308"><span class="linenos">1308</span></a>            <span class="c1"># Update any child groups to have NULL parent</span>
</span><span id="GuacamoleDB-1309"><a href="#GuacamoleDB-1309"><span class="linenos">1309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Updating child groups to have NULL parent...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1310"><a href="#GuacamoleDB-1310"><span class="linenos">1310</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1311"><a href="#GuacamoleDB-1311"><span class="linenos">1311</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1312"><a href="#GuacamoleDB-1312"><span class="linenos">1312</span></a><span class="sd">                UPDATE guacamole_connection_group</span>
</span><span id="GuacamoleDB-1313"><a href="#GuacamoleDB-1313"><span class="linenos">1313</span></a><span class="sd">                SET parent_id = NULL</span>
</span><span id="GuacamoleDB-1314"><a href="#GuacamoleDB-1314"><span class="linenos">1314</span></a><span class="sd">                WHERE parent_id = %s</span>
</span><span id="GuacamoleDB-1315"><a href="#GuacamoleDB-1315"><span class="linenos">1315</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1316"><a href="#GuacamoleDB-1316"><span class="linenos">1316</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1317"><a href="#GuacamoleDB-1317"><span class="linenos">1317</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1318"><a href="#GuacamoleDB-1318"><span class="linenos">1318</span></a>
</span><span id="GuacamoleDB-1319"><a href="#GuacamoleDB-1319"><span class="linenos">1319</span></a>            <span class="c1"># Update any connections to have NULL parent</span>
</span><span id="GuacamoleDB-1320"><a href="#GuacamoleDB-1320"><span class="linenos">1320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Updating connections to have NULL parent...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1321"><a href="#GuacamoleDB-1321"><span class="linenos">1321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1322"><a href="#GuacamoleDB-1322"><span class="linenos">1322</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1323"><a href="#GuacamoleDB-1323"><span class="linenos">1323</span></a><span class="sd">                UPDATE guacamole_connection</span>
</span><span id="GuacamoleDB-1324"><a href="#GuacamoleDB-1324"><span class="linenos">1324</span></a><span class="sd">                SET parent_id = NULL</span>
</span><span id="GuacamoleDB-1325"><a href="#GuacamoleDB-1325"><span class="linenos">1325</span></a><span class="sd">                WHERE parent_id = %s</span>
</span><span id="GuacamoleDB-1326"><a href="#GuacamoleDB-1326"><span class="linenos">1326</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1327"><a href="#GuacamoleDB-1327"><span class="linenos">1327</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1328"><a href="#GuacamoleDB-1328"><span class="linenos">1328</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1329"><a href="#GuacamoleDB-1329"><span class="linenos">1329</span></a>
</span><span id="GuacamoleDB-1330"><a href="#GuacamoleDB-1330"><span class="linenos">1330</span></a>            <span class="c1"># Delete the group</span>
</span><span id="GuacamoleDB-1331"><a href="#GuacamoleDB-1331"><span class="linenos">1331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection group...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1332"><a href="#GuacamoleDB-1332"><span class="linenos">1332</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1333"><a href="#GuacamoleDB-1333"><span class="linenos">1333</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1334"><a href="#GuacamoleDB-1334"><span class="linenos">1334</span></a><span class="sd">                DELETE FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-1335"><a href="#GuacamoleDB-1335"><span class="linenos">1335</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB-1336"><a href="#GuacamoleDB-1336"><span class="linenos">1336</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1337"><a href="#GuacamoleDB-1337"><span class="linenos">1337</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1338"><a href="#GuacamoleDB-1338"><span class="linenos">1338</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1339"><a href="#GuacamoleDB-1339"><span class="linenos">1339</span></a>
</span><span id="GuacamoleDB-1340"><a href="#GuacamoleDB-1340"><span class="linenos">1340</span></a>            <span class="c1"># Commit the transaction</span>
</span><span id="GuacamoleDB-1341"><a href="#GuacamoleDB-1341"><span class="linenos">1341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Committing transaction...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1342"><a href="#GuacamoleDB-1342"><span class="linenos">1342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="GuacamoleDB-1343"><a href="#GuacamoleDB-1343"><span class="linenos">1343</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted connection group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1344"><a href="#GuacamoleDB-1344"><span class="linenos">1344</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-1345"><a href="#GuacamoleDB-1345"><span class="linenos">1345</span></a>
</span><span id="GuacamoleDB-1346"><a href="#GuacamoleDB-1346"><span class="linenos">1346</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1347"><a href="#GuacamoleDB-1347"><span class="linenos">1347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting connection group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1348"><a href="#GuacamoleDB-1348"><span class="linenos">1348</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1349"><a href="#GuacamoleDB-1349"><span class="linenos">1349</span></a>
</span><span id="GuacamoleDB-1350"><a href="#GuacamoleDB-1350"><span class="linenos">1350</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1351"><a href="#GuacamoleDB-1351"><span class="linenos">1351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing connection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1352"><a href="#GuacamoleDB-1352"><span class="linenos">1352</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1353"><a href="#GuacamoleDB-1353"><span class="linenos">1353</span></a>
</span><span id="GuacamoleDB-1354"><a href="#GuacamoleDB-1354"><span class="linenos">1354</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1355"><a href="#GuacamoleDB-1355"><span class="linenos">1355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new user in the Guacamole database.</span>
</span><span id="GuacamoleDB-1356"><a href="#GuacamoleDB-1356"><span class="linenos">1356</span></a>
</span><span id="GuacamoleDB-1357"><a href="#GuacamoleDB-1357"><span class="linenos">1357</span></a><span class="sd">        Creates a new user with secure password hashing using Guacamole&#39;s</span>
</span><span id="GuacamoleDB-1358"><a href="#GuacamoleDB-1358"><span class="linenos">1358</span></a><span class="sd">        authentication method. Generates a random salt and hashes the password</span>
</span><span id="GuacamoleDB-1359"><a href="#GuacamoleDB-1359"><span class="linenos">1359</span></a><span class="sd">        using SHA256.</span>
</span><span id="GuacamoleDB-1360"><a href="#GuacamoleDB-1360"><span class="linenos">1360</span></a>
</span><span id="GuacamoleDB-1361"><a href="#GuacamoleDB-1361"><span class="linenos">1361</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-1362"><a href="#GuacamoleDB-1362"><span class="linenos">1362</span></a><span class="sd">            username: The username for the new user.</span>
</span><span id="GuacamoleDB-1363"><a href="#GuacamoleDB-1363"><span class="linenos">1363</span></a><span class="sd">            password: The password for the new user.</span>
</span><span id="GuacamoleDB-1364"><a href="#GuacamoleDB-1364"><span class="linenos">1364</span></a>
</span><span id="GuacamoleDB-1365"><a href="#GuacamoleDB-1365"><span class="linenos">1365</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-1366"><a href="#GuacamoleDB-1366"><span class="linenos">1366</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB-1367"><a href="#GuacamoleDB-1367"><span class="linenos">1367</span></a>
</span><span id="GuacamoleDB-1368"><a href="#GuacamoleDB-1368"><span class="linenos">1368</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-1369"><a href="#GuacamoleDB-1369"><span class="linenos">1369</span></a><span class="sd">            Uses Guacamole&#39;s password hashing method: SHA256(password + hex(salt)).</span>
</span><span id="GuacamoleDB-1370"><a href="#GuacamoleDB-1370"><span class="linenos">1370</span></a><span class="sd">            The salt is a random 32-byte value for security. This method creates</span>
</span><span id="GuacamoleDB-1371"><a href="#GuacamoleDB-1371"><span class="linenos">1371</span></a><span class="sd">            both the entity record and the user record with password credentials.</span>
</span><span id="GuacamoleDB-1372"><a href="#GuacamoleDB-1372"><span class="linenos">1372</span></a>
</span><span id="GuacamoleDB-1373"><a href="#GuacamoleDB-1373"><span class="linenos">1373</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-1374"><a href="#GuacamoleDB-1374"><span class="linenos">1374</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-1375"><a href="#GuacamoleDB-1375"><span class="linenos">1375</span></a><span class="sd">            ...     db.create_user(&#39;newuser&#39;, &#39;securepassword&#39;)</span>
</span><span id="GuacamoleDB-1376"><a href="#GuacamoleDB-1376"><span class="linenos">1376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1377"><a href="#GuacamoleDB-1377"><span class="linenos">1377</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1378"><a href="#GuacamoleDB-1378"><span class="linenos">1378</span></a>            <span class="c1"># Generate random 32-byte salt</span>
</span><span id="GuacamoleDB-1379"><a href="#GuacamoleDB-1379"><span class="linenos">1379</span></a>            <span class="n">salt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="GuacamoleDB-1380"><a href="#GuacamoleDB-1380"><span class="linenos">1380</span></a>
</span><span id="GuacamoleDB-1381"><a href="#GuacamoleDB-1381"><span class="linenos">1381</span></a>            <span class="c1"># Convert salt to uppercase hex string as Guacamole expects</span>
</span><span id="GuacamoleDB-1382"><a href="#GuacamoleDB-1382"><span class="linenos">1382</span></a>            <span class="n">salt_hex</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">salt</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="GuacamoleDB-1383"><a href="#GuacamoleDB-1383"><span class="linenos">1383</span></a>
</span><span id="GuacamoleDB-1384"><a href="#GuacamoleDB-1384"><span class="linenos">1384</span></a>            <span class="c1"># Create password hash using Guacamole&#39;s method: SHA256(password + hex(salt))</span>
</span><span id="GuacamoleDB-1385"><a href="#GuacamoleDB-1385"><span class="linenos">1385</span></a>            <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">salt_hex</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span><span id="GuacamoleDB-1386"><a href="#GuacamoleDB-1386"><span class="linenos">1386</span></a>
</span><span id="GuacamoleDB-1387"><a href="#GuacamoleDB-1387"><span class="linenos">1387</span></a>            <span class="c1"># Get binary representations</span>
</span><span id="GuacamoleDB-1388"><a href="#GuacamoleDB-1388"><span class="linenos">1388</span></a>            <span class="n">password_hash</span> <span class="o">=</span> <span class="n">digest</span>  <span class="c1"># SHA256 hash of (password + hex(salt))</span>
</span><span id="GuacamoleDB-1389"><a href="#GuacamoleDB-1389"><span class="linenos">1389</span></a>            <span class="n">password_salt</span> <span class="o">=</span> <span class="n">salt</span>  <span class="c1"># Original raw bytes salt</span>
</span><span id="GuacamoleDB-1390"><a href="#GuacamoleDB-1390"><span class="linenos">1390</span></a>
</span><span id="GuacamoleDB-1391"><a href="#GuacamoleDB-1391"><span class="linenos">1391</span></a>            <span class="c1"># Create entity</span>
</span><span id="GuacamoleDB-1392"><a href="#GuacamoleDB-1392"><span class="linenos">1392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1393"><a href="#GuacamoleDB-1393"><span class="linenos">1393</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1394"><a href="#GuacamoleDB-1394"><span class="linenos">1394</span></a><span class="sd">                INSERT INTO guacamole_entity (name, type)</span>
</span><span id="GuacamoleDB-1395"><a href="#GuacamoleDB-1395"><span class="linenos">1395</span></a><span class="sd">                VALUES (%s, &#39;USER&#39;)</span>
</span><span id="GuacamoleDB-1396"><a href="#GuacamoleDB-1396"><span class="linenos">1396</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1397"><a href="#GuacamoleDB-1397"><span class="linenos">1397</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1398"><a href="#GuacamoleDB-1398"><span class="linenos">1398</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1399"><a href="#GuacamoleDB-1399"><span class="linenos">1399</span></a>
</span><span id="GuacamoleDB-1400"><a href="#GuacamoleDB-1400"><span class="linenos">1400</span></a>            <span class="c1"># Create user with proper binary data</span>
</span><span id="GuacamoleDB-1401"><a href="#GuacamoleDB-1401"><span class="linenos">1401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1402"><a href="#GuacamoleDB-1402"><span class="linenos">1402</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1403"><a href="#GuacamoleDB-1403"><span class="linenos">1403</span></a><span class="sd">                INSERT INTO guacamole_user</span>
</span><span id="GuacamoleDB-1404"><a href="#GuacamoleDB-1404"><span class="linenos">1404</span></a><span class="sd">                    (entity_id, password_hash, password_salt, password_date)</span>
</span><span id="GuacamoleDB-1405"><a href="#GuacamoleDB-1405"><span class="linenos">1405</span></a><span class="sd">                SELECT</span>
</span><span id="GuacamoleDB-1406"><a href="#GuacamoleDB-1406"><span class="linenos">1406</span></a><span class="sd">                    entity_id,</span>
</span><span id="GuacamoleDB-1407"><a href="#GuacamoleDB-1407"><span class="linenos">1407</span></a><span class="sd">                    %s,</span>
</span><span id="GuacamoleDB-1408"><a href="#GuacamoleDB-1408"><span class="linenos">1408</span></a><span class="sd">                    %s,</span>
</span><span id="GuacamoleDB-1409"><a href="#GuacamoleDB-1409"><span class="linenos">1409</span></a><span class="sd">                    NOW()</span>
</span><span id="GuacamoleDB-1410"><a href="#GuacamoleDB-1410"><span class="linenos">1410</span></a><span class="sd">            FROM guacamole_entity</span>
</span><span id="GuacamoleDB-1411"><a href="#GuacamoleDB-1411"><span class="linenos">1411</span></a><span class="sd">            WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1412"><a href="#GuacamoleDB-1412"><span class="linenos">1412</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1413"><a href="#GuacamoleDB-1413"><span class="linenos">1413</span></a>                <span class="p">(</span><span class="n">password_hash</span><span class="p">,</span> <span class="n">password_salt</span><span class="p">,</span> <span class="n">username</span><span class="p">),</span>
</span><span id="GuacamoleDB-1414"><a href="#GuacamoleDB-1414"><span class="linenos">1414</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1415"><a href="#GuacamoleDB-1415"><span class="linenos">1415</span></a>
</span><span id="GuacamoleDB-1416"><a href="#GuacamoleDB-1416"><span class="linenos">1416</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; created successfully&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1417"><a href="#GuacamoleDB-1417"><span class="linenos">1417</span></a>
</span><span id="GuacamoleDB-1418"><a href="#GuacamoleDB-1418"><span class="linenos">1418</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1419"><a href="#GuacamoleDB-1419"><span class="linenos">1419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1420"><a href="#GuacamoleDB-1420"><span class="linenos">1420</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1421"><a href="#GuacamoleDB-1421"><span class="linenos">1421</span></a>
</span><span id="GuacamoleDB-1422"><a href="#GuacamoleDB-1422"><span class="linenos">1422</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1423"><a href="#GuacamoleDB-1423"><span class="linenos">1423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new user group in the Guacamole database.</span>
</span><span id="GuacamoleDB-1424"><a href="#GuacamoleDB-1424"><span class="linenos">1424</span></a>
</span><span id="GuacamoleDB-1425"><a href="#GuacamoleDB-1425"><span class="linenos">1425</span></a><span class="sd">        Creates both the entity record and the user group record for a new</span>
</span><span id="GuacamoleDB-1426"><a href="#GuacamoleDB-1426"><span class="linenos">1426</span></a><span class="sd">        user group with disabled status set to FALSE (enabled).</span>
</span><span id="GuacamoleDB-1427"><a href="#GuacamoleDB-1427"><span class="linenos">1427</span></a>
</span><span id="GuacamoleDB-1428"><a href="#GuacamoleDB-1428"><span class="linenos">1428</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-1429"><a href="#GuacamoleDB-1429"><span class="linenos">1429</span></a><span class="sd">            group_name: The name for the new user group.</span>
</span><span id="GuacamoleDB-1430"><a href="#GuacamoleDB-1430"><span class="linenos">1430</span></a>
</span><span id="GuacamoleDB-1431"><a href="#GuacamoleDB-1431"><span class="linenos">1431</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-1432"><a href="#GuacamoleDB-1432"><span class="linenos">1432</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB-1433"><a href="#GuacamoleDB-1433"><span class="linenos">1433</span></a>
</span><span id="GuacamoleDB-1434"><a href="#GuacamoleDB-1434"><span class="linenos">1434</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-1435"><a href="#GuacamoleDB-1435"><span class="linenos">1435</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-1436"><a href="#GuacamoleDB-1436"><span class="linenos">1436</span></a><span class="sd">            ...     db.create_usergroup(&#39;developers&#39;)</span>
</span><span id="GuacamoleDB-1437"><a href="#GuacamoleDB-1437"><span class="linenos">1437</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1438"><a href="#GuacamoleDB-1438"><span class="linenos">1438</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1439"><a href="#GuacamoleDB-1439"><span class="linenos">1439</span></a>            <span class="c1"># Create entity</span>
</span><span id="GuacamoleDB-1440"><a href="#GuacamoleDB-1440"><span class="linenos">1440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1441"><a href="#GuacamoleDB-1441"><span class="linenos">1441</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1442"><a href="#GuacamoleDB-1442"><span class="linenos">1442</span></a><span class="sd">                INSERT INTO guacamole_entity (name, type)</span>
</span><span id="GuacamoleDB-1443"><a href="#GuacamoleDB-1443"><span class="linenos">1443</span></a><span class="sd">                VALUES (%s, &#39;USER_GROUP&#39;)</span>
</span><span id="GuacamoleDB-1444"><a href="#GuacamoleDB-1444"><span class="linenos">1444</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1445"><a href="#GuacamoleDB-1445"><span class="linenos">1445</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1446"><a href="#GuacamoleDB-1446"><span class="linenos">1446</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1447"><a href="#GuacamoleDB-1447"><span class="linenos">1447</span></a>
</span><span id="GuacamoleDB-1448"><a href="#GuacamoleDB-1448"><span class="linenos">1448</span></a>            <span class="c1"># Create group</span>
</span><span id="GuacamoleDB-1449"><a href="#GuacamoleDB-1449"><span class="linenos">1449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1450"><a href="#GuacamoleDB-1450"><span class="linenos">1450</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1451"><a href="#GuacamoleDB-1451"><span class="linenos">1451</span></a><span class="sd">                INSERT INTO guacamole_user_group (entity_id, disabled)</span>
</span><span id="GuacamoleDB-1452"><a href="#GuacamoleDB-1452"><span class="linenos">1452</span></a><span class="sd">                SELECT entity_id, FALSE</span>
</span><span id="GuacamoleDB-1453"><a href="#GuacamoleDB-1453"><span class="linenos">1453</span></a><span class="sd">                FROM guacamole_entity</span>
</span><span id="GuacamoleDB-1454"><a href="#GuacamoleDB-1454"><span class="linenos">1454</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-1455"><a href="#GuacamoleDB-1455"><span class="linenos">1455</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1456"><a href="#GuacamoleDB-1456"><span class="linenos">1456</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1457"><a href="#GuacamoleDB-1457"><span class="linenos">1457</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1458"><a href="#GuacamoleDB-1458"><span class="linenos">1458</span></a>
</span><span id="GuacamoleDB-1459"><a href="#GuacamoleDB-1459"><span class="linenos">1459</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1460"><a href="#GuacamoleDB-1460"><span class="linenos">1460</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1461"><a href="#GuacamoleDB-1461"><span class="linenos">1461</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1462"><a href="#GuacamoleDB-1462"><span class="linenos">1462</span></a>
</span><span id="GuacamoleDB-1463"><a href="#GuacamoleDB-1463"><span class="linenos">1463</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_user_to_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1464"><a href="#GuacamoleDB-1464"><span class="linenos">1464</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1465"><a href="#GuacamoleDB-1465"><span class="linenos">1465</span></a>            <span class="c1"># Get the group ID</span>
</span><span id="GuacamoleDB-1466"><a href="#GuacamoleDB-1466"><span class="linenos">1466</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_usergroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
</span><span id="GuacamoleDB-1467"><a href="#GuacamoleDB-1467"><span class="linenos">1467</span></a>
</span><span id="GuacamoleDB-1468"><a href="#GuacamoleDB-1468"><span class="linenos">1468</span></a>            <span class="c1"># Get the user&#39;s entity ID</span>
</span><span id="GuacamoleDB-1469"><a href="#GuacamoleDB-1469"><span class="linenos">1469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1470"><a href="#GuacamoleDB-1470"><span class="linenos">1470</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1471"><a href="#GuacamoleDB-1471"><span class="linenos">1471</span></a><span class="sd">                SELECT entity_id </span>
</span><span id="GuacamoleDB-1472"><a href="#GuacamoleDB-1472"><span class="linenos">1472</span></a><span class="sd">                FROM guacamole_entity </span>
</span><span id="GuacamoleDB-1473"><a href="#GuacamoleDB-1473"><span class="linenos">1473</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1474"><a href="#GuacamoleDB-1474"><span class="linenos">1474</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1475"><a href="#GuacamoleDB-1475"><span class="linenos">1475</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1476"><a href="#GuacamoleDB-1476"><span class="linenos">1476</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1477"><a href="#GuacamoleDB-1477"><span class="linenos">1477</span></a>            <span class="n">user_entity_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-1478"><a href="#GuacamoleDB-1478"><span class="linenos">1478</span></a>
</span><span id="GuacamoleDB-1479"><a href="#GuacamoleDB-1479"><span class="linenos">1479</span></a>            <span class="c1"># Add user to group</span>
</span><span id="GuacamoleDB-1480"><a href="#GuacamoleDB-1480"><span class="linenos">1480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1481"><a href="#GuacamoleDB-1481"><span class="linenos">1481</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1482"><a href="#GuacamoleDB-1482"><span class="linenos">1482</span></a><span class="sd">                INSERT INTO guacamole_user_group_member </span>
</span><span id="GuacamoleDB-1483"><a href="#GuacamoleDB-1483"><span class="linenos">1483</span></a><span class="sd">                (user_group_id, member_entity_id)</span>
</span><span id="GuacamoleDB-1484"><a href="#GuacamoleDB-1484"><span class="linenos">1484</span></a><span class="sd">                VALUES (%s, %s)</span>
</span><span id="GuacamoleDB-1485"><a href="#GuacamoleDB-1485"><span class="linenos">1485</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1486"><a href="#GuacamoleDB-1486"><span class="linenos">1486</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-1487"><a href="#GuacamoleDB-1487"><span class="linenos">1487</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1488"><a href="#GuacamoleDB-1488"><span class="linenos">1488</span></a>
</span><span id="GuacamoleDB-1489"><a href="#GuacamoleDB-1489"><span class="linenos">1489</span></a>            <span class="c1"># Grant group permissions to user</span>
</span><span id="GuacamoleDB-1490"><a href="#GuacamoleDB-1490"><span class="linenos">1490</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1491"><a href="#GuacamoleDB-1491"><span class="linenos">1491</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1492"><a href="#GuacamoleDB-1492"><span class="linenos">1492</span></a><span class="sd">                INSERT INTO guacamole_user_group_permission</span>
</span><span id="GuacamoleDB-1493"><a href="#GuacamoleDB-1493"><span class="linenos">1493</span></a><span class="sd">                (entity_id, affected_user_group_id, permission)</span>
</span><span id="GuacamoleDB-1494"><a href="#GuacamoleDB-1494"><span class="linenos">1494</span></a><span class="sd">                SELECT %s, %s, &#39;READ&#39;</span>
</span><span id="GuacamoleDB-1495"><a href="#GuacamoleDB-1495"><span class="linenos">1495</span></a><span class="sd">                FROM dual</span>
</span><span id="GuacamoleDB-1496"><a href="#GuacamoleDB-1496"><span class="linenos">1496</span></a><span class="sd">                WHERE NOT EXISTS (</span>
</span><span id="GuacamoleDB-1497"><a href="#GuacamoleDB-1497"><span class="linenos">1497</span></a><span class="sd">                    SELECT 1 FROM guacamole_user_group_permission</span>
</span><span id="GuacamoleDB-1498"><a href="#GuacamoleDB-1498"><span class="linenos">1498</span></a><span class="sd">                    WHERE entity_id = %s </span>
</span><span id="GuacamoleDB-1499"><a href="#GuacamoleDB-1499"><span class="linenos">1499</span></a><span class="sd">                    AND affected_user_group_id = %s </span>
</span><span id="GuacamoleDB-1500"><a href="#GuacamoleDB-1500"><span class="linenos">1500</span></a><span class="sd">                    AND permission = &#39;READ&#39;</span>
</span><span id="GuacamoleDB-1501"><a href="#GuacamoleDB-1501"><span class="linenos">1501</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB-1502"><a href="#GuacamoleDB-1502"><span class="linenos">1502</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1503"><a href="#GuacamoleDB-1503"><span class="linenos">1503</span></a>                <span class="p">(</span><span class="n">user_entity_id</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">,</span> <span class="n">group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-1504"><a href="#GuacamoleDB-1504"><span class="linenos">1504</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1505"><a href="#GuacamoleDB-1505"><span class="linenos">1505</span></a>
</span><span id="GuacamoleDB-1506"><a href="#GuacamoleDB-1506"><span class="linenos">1506</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-1507"><a href="#GuacamoleDB-1507"><span class="linenos">1507</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully added user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; to usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-1508"><a href="#GuacamoleDB-1508"><span class="linenos">1508</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1509"><a href="#GuacamoleDB-1509"><span class="linenos">1509</span></a>
</span><span id="GuacamoleDB-1510"><a href="#GuacamoleDB-1510"><span class="linenos">1510</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1511"><a href="#GuacamoleDB-1511"><span class="linenos">1511</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding user to usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1512"><a href="#GuacamoleDB-1512"><span class="linenos">1512</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1513"><a href="#GuacamoleDB-1513"><span class="linenos">1513</span></a>
</span><span id="GuacamoleDB-1514"><a href="#GuacamoleDB-1514"><span class="linenos">1514</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_user_from_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1515"><a href="#GuacamoleDB-1515"><span class="linenos">1515</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1516"><a href="#GuacamoleDB-1516"><span class="linenos">1516</span></a>            <span class="c1"># Get the group ID</span>
</span><span id="GuacamoleDB-1517"><a href="#GuacamoleDB-1517"><span class="linenos">1517</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_usergroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
</span><span id="GuacamoleDB-1518"><a href="#GuacamoleDB-1518"><span class="linenos">1518</span></a>
</span><span id="GuacamoleDB-1519"><a href="#GuacamoleDB-1519"><span class="linenos">1519</span></a>            <span class="c1"># Get the user&#39;s entity ID</span>
</span><span id="GuacamoleDB-1520"><a href="#GuacamoleDB-1520"><span class="linenos">1520</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1521"><a href="#GuacamoleDB-1521"><span class="linenos">1521</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1522"><a href="#GuacamoleDB-1522"><span class="linenos">1522</span></a><span class="sd">                SELECT entity_id </span>
</span><span id="GuacamoleDB-1523"><a href="#GuacamoleDB-1523"><span class="linenos">1523</span></a><span class="sd">                FROM guacamole_entity </span>
</span><span id="GuacamoleDB-1524"><a href="#GuacamoleDB-1524"><span class="linenos">1524</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1525"><a href="#GuacamoleDB-1525"><span class="linenos">1525</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1526"><a href="#GuacamoleDB-1526"><span class="linenos">1526</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1527"><a href="#GuacamoleDB-1527"><span class="linenos">1527</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1528"><a href="#GuacamoleDB-1528"><span class="linenos">1528</span></a>            <span class="n">user_entity_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-1529"><a href="#GuacamoleDB-1529"><span class="linenos">1529</span></a>
</span><span id="GuacamoleDB-1530"><a href="#GuacamoleDB-1530"><span class="linenos">1530</span></a>            <span class="c1"># Check if user is actually in the group</span>
</span><span id="GuacamoleDB-1531"><a href="#GuacamoleDB-1531"><span class="linenos">1531</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1532"><a href="#GuacamoleDB-1532"><span class="linenos">1532</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1533"><a href="#GuacamoleDB-1533"><span class="linenos">1533</span></a><span class="sd">                SELECT COUNT(*) </span>
</span><span id="GuacamoleDB-1534"><a href="#GuacamoleDB-1534"><span class="linenos">1534</span></a><span class="sd">                FROM guacamole_user_group_member</span>
</span><span id="GuacamoleDB-1535"><a href="#GuacamoleDB-1535"><span class="linenos">1535</span></a><span class="sd">                WHERE user_group_id = %s AND member_entity_id = %s</span>
</span><span id="GuacamoleDB-1536"><a href="#GuacamoleDB-1536"><span class="linenos">1536</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1537"><a href="#GuacamoleDB-1537"><span class="linenos">1537</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-1538"><a href="#GuacamoleDB-1538"><span class="linenos">1538</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1539"><a href="#GuacamoleDB-1539"><span class="linenos">1539</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-1540"><a href="#GuacamoleDB-1540"><span class="linenos">1540</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; is not in group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1541"><a href="#GuacamoleDB-1541"><span class="linenos">1541</span></a>
</span><span id="GuacamoleDB-1542"><a href="#GuacamoleDB-1542"><span class="linenos">1542</span></a>            <span class="c1"># Remove user from group</span>
</span><span id="GuacamoleDB-1543"><a href="#GuacamoleDB-1543"><span class="linenos">1543</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1544"><a href="#GuacamoleDB-1544"><span class="linenos">1544</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1545"><a href="#GuacamoleDB-1545"><span class="linenos">1545</span></a><span class="sd">                DELETE FROM guacamole_user_group_member</span>
</span><span id="GuacamoleDB-1546"><a href="#GuacamoleDB-1546"><span class="linenos">1546</span></a><span class="sd">                WHERE user_group_id = %s AND member_entity_id = %s</span>
</span><span id="GuacamoleDB-1547"><a href="#GuacamoleDB-1547"><span class="linenos">1547</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1548"><a href="#GuacamoleDB-1548"><span class="linenos">1548</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-1549"><a href="#GuacamoleDB-1549"><span class="linenos">1549</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1550"><a href="#GuacamoleDB-1550"><span class="linenos">1550</span></a>
</span><span id="GuacamoleDB-1551"><a href="#GuacamoleDB-1551"><span class="linenos">1551</span></a>            <span class="c1"># Revoke group permissions from user</span>
</span><span id="GuacamoleDB-1552"><a href="#GuacamoleDB-1552"><span class="linenos">1552</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1553"><a href="#GuacamoleDB-1553"><span class="linenos">1553</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1554"><a href="#GuacamoleDB-1554"><span class="linenos">1554</span></a><span class="sd">                DELETE FROM guacamole_user_group_permission</span>
</span><span id="GuacamoleDB-1555"><a href="#GuacamoleDB-1555"><span class="linenos">1555</span></a><span class="sd">                WHERE entity_id = %s AND affected_user_group_id = %s</span>
</span><span id="GuacamoleDB-1556"><a href="#GuacamoleDB-1556"><span class="linenos">1556</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1557"><a href="#GuacamoleDB-1557"><span class="linenos">1557</span></a>                <span class="p">(</span><span class="n">user_entity_id</span><span class="p">,</span> <span class="n">group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-1558"><a href="#GuacamoleDB-1558"><span class="linenos">1558</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1559"><a href="#GuacamoleDB-1559"><span class="linenos">1559</span></a>
</span><span id="GuacamoleDB-1560"><a href="#GuacamoleDB-1560"><span class="linenos">1560</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-1561"><a href="#GuacamoleDB-1561"><span class="linenos">1561</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully removed user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; from usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-1562"><a href="#GuacamoleDB-1562"><span class="linenos">1562</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1563"><a href="#GuacamoleDB-1563"><span class="linenos">1563</span></a>
</span><span id="GuacamoleDB-1564"><a href="#GuacamoleDB-1564"><span class="linenos">1564</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1565"><a href="#GuacamoleDB-1565"><span class="linenos">1565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error removing user from group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1566"><a href="#GuacamoleDB-1566"><span class="linenos">1566</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1567"><a href="#GuacamoleDB-1567"><span class="linenos">1567</span></a>
</span><span id="GuacamoleDB-1568"><a href="#GuacamoleDB-1568"><span class="linenos">1568</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB-1569"><a href="#GuacamoleDB-1569"><span class="linenos">1569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve nested connection group path to connection group ID.</span>
</span><span id="GuacamoleDB-1570"><a href="#GuacamoleDB-1570"><span class="linenos">1570</span></a>
</span><span id="GuacamoleDB-1571"><a href="#GuacamoleDB-1571"><span class="linenos">1571</span></a><span class="sd">        Resolves a hierarchical path (e.g., &quot;parent/child/grandchild&quot;) to the</span>
</span><span id="GuacamoleDB-1572"><a href="#GuacamoleDB-1572"><span class="linenos">1572</span></a><span class="sd">        database ID of the final group in the path. This method traverses the</span>
</span><span id="GuacamoleDB-1573"><a href="#GuacamoleDB-1573"><span class="linenos">1573</span></a><span class="sd">        hierarchy to find the exact group at the specified path.</span>
</span><span id="GuacamoleDB-1574"><a href="#GuacamoleDB-1574"><span class="linenos">1574</span></a>
</span><span id="GuacamoleDB-1575"><a href="#GuacamoleDB-1575"><span class="linenos">1575</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-1576"><a href="#GuacamoleDB-1576"><span class="linenos">1576</span></a><span class="sd">            group_path: Slash-separated path to the connection group.</span>
</span><span id="GuacamoleDB-1577"><a href="#GuacamoleDB-1577"><span class="linenos">1577</span></a><span class="sd">                       Examples: &quot;Production&quot;, &quot;Production/Web&quot;, &quot;Servers/Linux&quot;</span>
</span><span id="GuacamoleDB-1578"><a href="#GuacamoleDB-1578"><span class="linenos">1578</span></a>
</span><span id="GuacamoleDB-1579"><a href="#GuacamoleDB-1579"><span class="linenos">1579</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-1580"><a href="#GuacamoleDB-1580"><span class="linenos">1580</span></a><span class="sd">            The database ID of the connection group at the specified path.</span>
</span><span id="GuacamoleDB-1581"><a href="#GuacamoleDB-1581"><span class="linenos">1581</span></a>
</span><span id="GuacamoleDB-1582"><a href="#GuacamoleDB-1582"><span class="linenos">1582</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-1583"><a href="#GuacamoleDB-1583"><span class="linenos">1583</span></a><span class="sd">            ValueError: If the group path cannot be resolved or any group in the</span>
</span><span id="GuacamoleDB-1584"><a href="#GuacamoleDB-1584"><span class="linenos">1584</span></a><span class="sd">                       path doesn&#39;t exist.</span>
</span><span id="GuacamoleDB-1585"><a href="#GuacamoleDB-1585"><span class="linenos">1585</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-1586"><a href="#GuacamoleDB-1586"><span class="linenos">1586</span></a>
</span><span id="GuacamoleDB-1587"><a href="#GuacamoleDB-1587"><span class="linenos">1587</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-1588"><a href="#GuacamoleDB-1588"><span class="linenos">1588</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-1589"><a href="#GuacamoleDB-1589"><span class="linenos">1589</span></a><span class="sd">            ...     group_id = db.get_connection_group_id(&quot;Production/Web Servers&quot;)</span>
</span><span id="GuacamoleDB-1590"><a href="#GuacamoleDB-1590"><span class="linenos">1590</span></a><span class="sd">            ...     print(f&quot;Group ID: {group_id}&quot;)</span>
</span><span id="GuacamoleDB-1591"><a href="#GuacamoleDB-1591"><span class="linenos">1591</span></a><span class="sd">            Group ID: 42</span>
</span><span id="GuacamoleDB-1592"><a href="#GuacamoleDB-1592"><span class="linenos">1592</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1593"><a href="#GuacamoleDB-1593"><span class="linenos">1593</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1594"><a href="#GuacamoleDB-1594"><span class="linenos">1594</span></a>            <span class="n">groups</span> <span class="o">=</span> <span class="n">group_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1595"><a href="#GuacamoleDB-1595"><span class="linenos">1595</span></a>            <span class="n">parent_group_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-1596"><a href="#GuacamoleDB-1596"><span class="linenos">1596</span></a>
</span><span id="GuacamoleDB-1597"><a href="#GuacamoleDB-1597"><span class="linenos">1597</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resolving group path: </span><span class="si">{</span><span class="n">group_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1598"><a href="#GuacamoleDB-1598"><span class="linenos">1598</span></a>
</span><span id="GuacamoleDB-1599"><a href="#GuacamoleDB-1599"><span class="linenos">1599</span></a>            <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span><span id="GuacamoleDB-1600"><a href="#GuacamoleDB-1600"><span class="linenos">1600</span></a>                <span class="c1"># CORRECTED SQL - use connection_group_name directly</span>
</span><span id="GuacamoleDB-1601"><a href="#GuacamoleDB-1601"><span class="linenos">1601</span></a>                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1602"><a href="#GuacamoleDB-1602"><span class="linenos">1602</span></a><span class="s2">                    SELECT connection_group_id </span>
</span><span id="GuacamoleDB-1603"><a href="#GuacamoleDB-1603"><span class="linenos">1603</span></a><span class="s2">                    FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-1604"><a href="#GuacamoleDB-1604"><span class="linenos">1604</span></a><span class="s2">                    WHERE connection_group_name = </span><span class="si">%s</span>
</span><span id="GuacamoleDB-1605"><a href="#GuacamoleDB-1605"><span class="linenos">1605</span></a><span class="s2">                &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1606"><a href="#GuacamoleDB-1606"><span class="linenos">1606</span></a>                <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
</span><span id="GuacamoleDB-1607"><a href="#GuacamoleDB-1607"><span class="linenos">1607</span></a>
</span><span id="GuacamoleDB-1608"><a href="#GuacamoleDB-1608"><span class="linenos">1608</span></a>                <span class="k">if</span> <span class="n">parent_group_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-1609"><a href="#GuacamoleDB-1609"><span class="linenos">1609</span></a>                    <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; AND parent_id = </span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-1610"><a href="#GuacamoleDB-1610"><span class="linenos">1610</span></a>                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-1611"><a href="#GuacamoleDB-1611"><span class="linenos">1611</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-1612"><a href="#GuacamoleDB-1612"><span class="linenos">1612</span></a>                    <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; AND parent_id IS NULL&quot;</span>
</span><span id="GuacamoleDB-1613"><a href="#GuacamoleDB-1613"><span class="linenos">1613</span></a>
</span><span id="GuacamoleDB-1614"><a href="#GuacamoleDB-1614"><span class="linenos">1614</span></a>                <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY connection_group_id LIMIT 1&quot;</span>
</span><span id="GuacamoleDB-1615"><a href="#GuacamoleDB-1615"><span class="linenos">1615</span></a>
</span><span id="GuacamoleDB-1616"><a href="#GuacamoleDB-1616"><span class="linenos">1616</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing SQL:</span><span class="se">\n</span><span class="si">{</span><span class="n">sql</span><span class="si">}</span><span class="se">\n</span><span class="s2">With params: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1617"><a href="#GuacamoleDB-1617"><span class="linenos">1617</span></a>
</span><span id="GuacamoleDB-1618"><a href="#GuacamoleDB-1618"><span class="linenos">1618</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
</span><span id="GuacamoleDB-1619"><a href="#GuacamoleDB-1619"><span class="linenos">1619</span></a>
</span><span id="GuacamoleDB-1620"><a href="#GuacamoleDB-1620"><span class="linenos">1620</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-1621"><a href="#GuacamoleDB-1621"><span class="linenos">1621</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-1622"><a href="#GuacamoleDB-1622"><span class="linenos">1622</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-1623"><a href="#GuacamoleDB-1623"><span class="linenos">1623</span></a>                        <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found in path &#39;</span><span class="si">{</span><span class="n">group_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-1624"><a href="#GuacamoleDB-1624"><span class="linenos">1624</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-1625"><a href="#GuacamoleDB-1625"><span class="linenos">1625</span></a>
</span><span id="GuacamoleDB-1626"><a href="#GuacamoleDB-1626"><span class="linenos">1626</span></a>                <span class="n">parent_group_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-1627"><a href="#GuacamoleDB-1627"><span class="linenos">1627</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found group ID </span><span class="si">{</span><span class="n">parent_group_id</span><span class="si">}</span><span class="s2"> for &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1628"><a href="#GuacamoleDB-1628"><span class="linenos">1628</span></a>
</span><span id="GuacamoleDB-1629"><a href="#GuacamoleDB-1629"><span class="linenos">1629</span></a>            <span class="k">return</span> <span class="n">parent_group_id</span>
</span><span id="GuacamoleDB-1630"><a href="#GuacamoleDB-1630"><span class="linenos">1630</span></a>
</span><span id="GuacamoleDB-1631"><a href="#GuacamoleDB-1631"><span class="linenos">1631</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1632"><a href="#GuacamoleDB-1632"><span class="linenos">1632</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error resolving group path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1633"><a href="#GuacamoleDB-1633"><span class="linenos">1633</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1634"><a href="#GuacamoleDB-1634"><span class="linenos">1634</span></a>
</span><span id="GuacamoleDB-1635"><a href="#GuacamoleDB-1635"><span class="linenos">1635</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connection_exists</span><span class="p">(</span>
</span><span id="GuacamoleDB-1636"><a href="#GuacamoleDB-1636"><span class="linenos">1636</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-1637"><a href="#GuacamoleDB-1637"><span class="linenos">1637</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-1638"><a href="#GuacamoleDB-1638"><span class="linenos">1638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a connection exists in the Guacamole database.</span>
</span><span id="GuacamoleDB-1639"><a href="#GuacamoleDB-1639"><span class="linenos">1639</span></a>
</span><span id="GuacamoleDB-1640"><a href="#GuacamoleDB-1640"><span class="linenos">1640</span></a><span class="sd">        Uses the resolve_connection_id method to validate inputs and determine</span>
</span><span id="GuacamoleDB-1641"><a href="#GuacamoleDB-1641"><span class="linenos">1641</span></a><span class="sd">        if a connection with the specified name or ID exists.</span>
</span><span id="GuacamoleDB-1642"><a href="#GuacamoleDB-1642"><span class="linenos">1642</span></a>
</span><span id="GuacamoleDB-1643"><a href="#GuacamoleDB-1643"><span class="linenos">1643</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-1644"><a href="#GuacamoleDB-1644"><span class="linenos">1644</span></a><span class="sd">            connection_name: The connection name to check. Optional.</span>
</span><span id="GuacamoleDB-1645"><a href="#GuacamoleDB-1645"><span class="linenos">1645</span></a><span class="sd">            connection_id: The connection ID to check. Optional.</span>
</span><span id="GuacamoleDB-1646"><a href="#GuacamoleDB-1646"><span class="linenos">1646</span></a>
</span><span id="GuacamoleDB-1647"><a href="#GuacamoleDB-1647"><span class="linenos">1647</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-1648"><a href="#GuacamoleDB-1648"><span class="linenos">1648</span></a><span class="sd">            True if the connection exists, False otherwise.</span>
</span><span id="GuacamoleDB-1649"><a href="#GuacamoleDB-1649"><span class="linenos">1649</span></a>
</span><span id="GuacamoleDB-1650"><a href="#GuacamoleDB-1650"><span class="linenos">1650</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-1651"><a href="#GuacamoleDB-1651"><span class="linenos">1651</span></a><span class="sd">            ValueError: If neither or both parameters are provided.</span>
</span><span id="GuacamoleDB-1652"><a href="#GuacamoleDB-1652"><span class="linenos">1652</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-1653"><a href="#GuacamoleDB-1653"><span class="linenos">1653</span></a>
</span><span id="GuacamoleDB-1654"><a href="#GuacamoleDB-1654"><span class="linenos">1654</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-1655"><a href="#GuacamoleDB-1655"><span class="linenos">1655</span></a><span class="sd">            Exactly one of connection_name or connection_id must be provided.</span>
</span><span id="GuacamoleDB-1656"><a href="#GuacamoleDB-1656"><span class="linenos">1656</span></a>
</span><span id="GuacamoleDB-1657"><a href="#GuacamoleDB-1657"><span class="linenos">1657</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-1658"><a href="#GuacamoleDB-1658"><span class="linenos">1658</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-1659"><a href="#GuacamoleDB-1659"><span class="linenos">1659</span></a><span class="sd">            ...     if db.connection_exists(connection_name=&#39;my-server&#39;):</span>
</span><span id="GuacamoleDB-1660"><a href="#GuacamoleDB-1660"><span class="linenos">1660</span></a><span class="sd">            ...         print(&quot;Connection exists&quot;)</span>
</span><span id="GuacamoleDB-1661"><a href="#GuacamoleDB-1661"><span class="linenos">1661</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1662"><a href="#GuacamoleDB-1662"><span class="linenos">1662</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1663"><a href="#GuacamoleDB-1663"><span class="linenos">1663</span></a>            <span class="c1"># Use resolver to validate inputs and get connection_id</span>
</span><span id="GuacamoleDB-1664"><a href="#GuacamoleDB-1664"><span class="linenos">1664</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-1665"><a href="#GuacamoleDB-1665"><span class="linenos">1665</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB-1666"><a href="#GuacamoleDB-1666"><span class="linenos">1666</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1667"><a href="#GuacamoleDB-1667"><span class="linenos">1667</span></a>            <span class="c1"># If resolver succeeds, connection exists</span>
</span><span id="GuacamoleDB-1668"><a href="#GuacamoleDB-1668"><span class="linenos">1668</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-1669"><a href="#GuacamoleDB-1669"><span class="linenos">1669</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="GuacamoleDB-1670"><a href="#GuacamoleDB-1670"><span class="linenos">1670</span></a>            <span class="c1"># If resolver fails with &quot;not found&quot;, connection doesn&#39;t exist</span>
</span><span id="GuacamoleDB-1671"><a href="#GuacamoleDB-1671"><span class="linenos">1671</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GuacamoleDB-1672"><a href="#GuacamoleDB-1672"><span class="linenos">1672</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1673"><a href="#GuacamoleDB-1673"><span class="linenos">1673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking connection existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1674"><a href="#GuacamoleDB-1674"><span class="linenos">1674</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1675"><a href="#GuacamoleDB-1675"><span class="linenos">1675</span></a>
</span><span id="GuacamoleDB-1676"><a href="#GuacamoleDB-1676"><span class="linenos">1676</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connection_group_exists</span><span class="p">(</span>
</span><span id="GuacamoleDB-1677"><a href="#GuacamoleDB-1677"><span class="linenos">1677</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-1678"><a href="#GuacamoleDB-1678"><span class="linenos">1678</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-1679"><a href="#GuacamoleDB-1679"><span class="linenos">1679</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a connection group with the given name or ID exists&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1680"><a href="#GuacamoleDB-1680"><span class="linenos">1680</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1681"><a href="#GuacamoleDB-1681"><span class="linenos">1681</span></a>            <span class="c1"># Use resolver to validate inputs and get group_id</span>
</span><span id="GuacamoleDB-1682"><a href="#GuacamoleDB-1682"><span class="linenos">1682</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_conngroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-1683"><a href="#GuacamoleDB-1683"><span class="linenos">1683</span></a>            <span class="c1"># If resolver succeeds, connection group exists</span>
</span><span id="GuacamoleDB-1684"><a href="#GuacamoleDB-1684"><span class="linenos">1684</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-1685"><a href="#GuacamoleDB-1685"><span class="linenos">1685</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="GuacamoleDB-1686"><a href="#GuacamoleDB-1686"><span class="linenos">1686</span></a>            <span class="c1"># If resolver fails with &quot;not found&quot;, connection group doesn&#39;t exist</span>
</span><span id="GuacamoleDB-1687"><a href="#GuacamoleDB-1687"><span class="linenos">1687</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GuacamoleDB-1688"><a href="#GuacamoleDB-1688"><span class="linenos">1688</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1689"><a href="#GuacamoleDB-1689"><span class="linenos">1689</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking connection group existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1690"><a href="#GuacamoleDB-1690"><span class="linenos">1690</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1691"><a href="#GuacamoleDB-1691"><span class="linenos">1691</span></a>
</span><span id="GuacamoleDB-1692"><a href="#GuacamoleDB-1692"><span class="linenos">1692</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_connection</span><span class="p">(</span>
</span><span id="GuacamoleDB-1693"><a href="#GuacamoleDB-1693"><span class="linenos">1693</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB-1694"><a href="#GuacamoleDB-1694"><span class="linenos">1694</span></a>        <span class="n">connection_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB-1695"><a href="#GuacamoleDB-1695"><span class="linenos">1695</span></a>        <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB-1696"><a href="#GuacamoleDB-1696"><span class="linenos">1696</span></a>        <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB-1697"><a href="#GuacamoleDB-1697"><span class="linenos">1697</span></a>        <span class="n">port</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="GuacamoleDB-1698"><a href="#GuacamoleDB-1698"><span class="linenos">1698</span></a>        <span class="n">vnc_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB-1699"><a href="#GuacamoleDB-1699"><span class="linenos">1699</span></a>        <span class="n">parent_group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-1700"><a href="#GuacamoleDB-1700"><span class="linenos">1700</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB-1701"><a href="#GuacamoleDB-1701"><span class="linenos">1701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new connection in the Guacamole database.</span>
</span><span id="GuacamoleDB-1702"><a href="#GuacamoleDB-1702"><span class="linenos">1702</span></a>
</span><span id="GuacamoleDB-1703"><a href="#GuacamoleDB-1703"><span class="linenos">1703</span></a><span class="sd">        Creates a new connection with basic parameters. Currently designed</span>
</span><span id="GuacamoleDB-1704"><a href="#GuacamoleDB-1704"><span class="linenos">1704</span></a><span class="sd">        for VNC connections but can be extended for other protocols.</span>
</span><span id="GuacamoleDB-1705"><a href="#GuacamoleDB-1705"><span class="linenos">1705</span></a>
</span><span id="GuacamoleDB-1706"><a href="#GuacamoleDB-1706"><span class="linenos">1706</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-1707"><a href="#GuacamoleDB-1707"><span class="linenos">1707</span></a><span class="sd">            connection_type: The connection protocol (e.g., &#39;vnc&#39;, &#39;rdp&#39;, &#39;ssh&#39;).</span>
</span><span id="GuacamoleDB-1708"><a href="#GuacamoleDB-1708"><span class="linenos">1708</span></a><span class="sd">            connection_name: The name for the new connection.</span>
</span><span id="GuacamoleDB-1709"><a href="#GuacamoleDB-1709"><span class="linenos">1709</span></a><span class="sd">            hostname: The hostname or IP address of the target server.</span>
</span><span id="GuacamoleDB-1710"><a href="#GuacamoleDB-1710"><span class="linenos">1710</span></a><span class="sd">            port: The port number for the connection.</span>
</span><span id="GuacamoleDB-1711"><a href="#GuacamoleDB-1711"><span class="linenos">1711</span></a><span class="sd">            vnc_password: The password for VNC authentication.</span>
</span><span id="GuacamoleDB-1712"><a href="#GuacamoleDB-1712"><span class="linenos">1712</span></a><span class="sd">            parent_group_id: Optional parent connection group ID.</span>
</span><span id="GuacamoleDB-1713"><a href="#GuacamoleDB-1713"><span class="linenos">1713</span></a>
</span><span id="GuacamoleDB-1714"><a href="#GuacamoleDB-1714"><span class="linenos">1714</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-1715"><a href="#GuacamoleDB-1715"><span class="linenos">1715</span></a><span class="sd">            The ID of the newly created connection.</span>
</span><span id="GuacamoleDB-1716"><a href="#GuacamoleDB-1716"><span class="linenos">1716</span></a>
</span><span id="GuacamoleDB-1717"><a href="#GuacamoleDB-1717"><span class="linenos">1717</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-1718"><a href="#GuacamoleDB-1718"><span class="linenos">1718</span></a><span class="sd">            ValueError: If required parameters are missing or connection already exists.</span>
</span><span id="GuacamoleDB-1719"><a href="#GuacamoleDB-1719"><span class="linenos">1719</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB-1720"><a href="#GuacamoleDB-1720"><span class="linenos">1720</span></a>
</span><span id="GuacamoleDB-1721"><a href="#GuacamoleDB-1721"><span class="linenos">1721</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-1722"><a href="#GuacamoleDB-1722"><span class="linenos">1722</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-1723"><a href="#GuacamoleDB-1723"><span class="linenos">1723</span></a><span class="sd">            ...     conn_id = db.create_connection(</span>
</span><span id="GuacamoleDB-1724"><a href="#GuacamoleDB-1724"><span class="linenos">1724</span></a><span class="sd">            ...         &#39;vnc&#39;, &#39;server1&#39;, &#39;192.168.1.100&#39;, 5901, &#39;password&#39;</span>
</span><span id="GuacamoleDB-1725"><a href="#GuacamoleDB-1725"><span class="linenos">1725</span></a><span class="sd">            ...     )</span>
</span><span id="GuacamoleDB-1726"><a href="#GuacamoleDB-1726"><span class="linenos">1726</span></a><span class="sd">            ...     print(f&quot;Created connection with ID: {conn_id}&quot;)</span>
</span><span id="GuacamoleDB-1727"><a href="#GuacamoleDB-1727"><span class="linenos">1727</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1728"><a href="#GuacamoleDB-1728"><span class="linenos">1728</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">connection_name</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">port</span><span class="p">]):</span>
</span><span id="GuacamoleDB-1729"><a href="#GuacamoleDB-1729"><span class="linenos">1729</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing required connection parameters&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1730"><a href="#GuacamoleDB-1730"><span class="linenos">1730</span></a>
</span><span id="GuacamoleDB-1731"><a href="#GuacamoleDB-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_exists</span><span class="p">(</span><span class="n">connection_name</span><span class="p">):</span>
</span><span id="GuacamoleDB-1732"><a href="#GuacamoleDB-1732"><span class="linenos">1732</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1733"><a href="#GuacamoleDB-1733"><span class="linenos">1733</span></a>
</span><span id="GuacamoleDB-1734"><a href="#GuacamoleDB-1734"><span class="linenos">1734</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1735"><a href="#GuacamoleDB-1735"><span class="linenos">1735</span></a>            <span class="c1"># Create connection</span>
</span><span id="GuacamoleDB-1736"><a href="#GuacamoleDB-1736"><span class="linenos">1736</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1737"><a href="#GuacamoleDB-1737"><span class="linenos">1737</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1738"><a href="#GuacamoleDB-1738"><span class="linenos">1738</span></a><span class="sd">                INSERT INTO guacamole_connection</span>
</span><span id="GuacamoleDB-1739"><a href="#GuacamoleDB-1739"><span class="linenos">1739</span></a><span class="sd">                (connection_name, protocol, parent_id)</span>
</span><span id="GuacamoleDB-1740"><a href="#GuacamoleDB-1740"><span class="linenos">1740</span></a><span class="sd">                VALUES (%s, %s, %s)</span>
</span><span id="GuacamoleDB-1741"><a href="#GuacamoleDB-1741"><span class="linenos">1741</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1742"><a href="#GuacamoleDB-1742"><span class="linenos">1742</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_type</span><span class="p">,</span> <span class="n">parent_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-1743"><a href="#GuacamoleDB-1743"><span class="linenos">1743</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1744"><a href="#GuacamoleDB-1744"><span class="linenos">1744</span></a>
</span><span id="GuacamoleDB-1745"><a href="#GuacamoleDB-1745"><span class="linenos">1745</span></a>            <span class="c1"># Get connection_id</span>
</span><span id="GuacamoleDB-1746"><a href="#GuacamoleDB-1746"><span class="linenos">1746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1747"><a href="#GuacamoleDB-1747"><span class="linenos">1747</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1748"><a href="#GuacamoleDB-1748"><span class="linenos">1748</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB-1749"><a href="#GuacamoleDB-1749"><span class="linenos">1749</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB-1750"><a href="#GuacamoleDB-1750"><span class="linenos">1750</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1751"><a href="#GuacamoleDB-1751"><span class="linenos">1751</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1752"><a href="#GuacamoleDB-1752"><span class="linenos">1752</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1753"><a href="#GuacamoleDB-1753"><span class="linenos">1753</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-1754"><a href="#GuacamoleDB-1754"><span class="linenos">1754</span></a>
</span><span id="GuacamoleDB-1755"><a href="#GuacamoleDB-1755"><span class="linenos">1755</span></a>            <span class="c1"># Create connection parameters</span>
</span><span id="GuacamoleDB-1756"><a href="#GuacamoleDB-1756"><span class="linenos">1756</span></a>            <span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="GuacamoleDB-1757"><a href="#GuacamoleDB-1757"><span class="linenos">1757</span></a>                <span class="p">(</span><span class="s2">&quot;hostname&quot;</span><span class="p">,</span> <span class="n">hostname</span><span class="p">),</span>
</span><span id="GuacamoleDB-1758"><a href="#GuacamoleDB-1758"><span class="linenos">1758</span></a>                <span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span>
</span><span id="GuacamoleDB-1759"><a href="#GuacamoleDB-1759"><span class="linenos">1759</span></a>                <span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="n">vnc_password</span><span class="p">),</span>
</span><span id="GuacamoleDB-1760"><a href="#GuacamoleDB-1760"><span class="linenos">1760</span></a>            <span class="p">]</span>
</span><span id="GuacamoleDB-1761"><a href="#GuacamoleDB-1761"><span class="linenos">1761</span></a>
</span><span id="GuacamoleDB-1762"><a href="#GuacamoleDB-1762"><span class="linenos">1762</span></a>            <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="GuacamoleDB-1763"><a href="#GuacamoleDB-1763"><span class="linenos">1763</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1764"><a href="#GuacamoleDB-1764"><span class="linenos">1764</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1765"><a href="#GuacamoleDB-1765"><span class="linenos">1765</span></a><span class="sd">                    INSERT INTO guacamole_connection_parameter</span>
</span><span id="GuacamoleDB-1766"><a href="#GuacamoleDB-1766"><span class="linenos">1766</span></a><span class="sd">                    (connection_id, parameter_name, parameter_value)</span>
</span><span id="GuacamoleDB-1767"><a href="#GuacamoleDB-1767"><span class="linenos">1767</span></a><span class="sd">                    VALUES (%s, %s, %s)</span>
</span><span id="GuacamoleDB-1768"><a href="#GuacamoleDB-1768"><span class="linenos">1768</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1769"><a href="#GuacamoleDB-1769"><span class="linenos">1769</span></a>                    <span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span><span class="p">),</span>
</span><span id="GuacamoleDB-1770"><a href="#GuacamoleDB-1770"><span class="linenos">1770</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-1771"><a href="#GuacamoleDB-1771"><span class="linenos">1771</span></a>
</span><span id="GuacamoleDB-1772"><a href="#GuacamoleDB-1772"><span class="linenos">1772</span></a>            <span class="k">return</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB-1773"><a href="#GuacamoleDB-1773"><span class="linenos">1773</span></a>
</span><span id="GuacamoleDB-1774"><a href="#GuacamoleDB-1774"><span class="linenos">1774</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1775"><a href="#GuacamoleDB-1775"><span class="linenos">1775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating VNC connection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1776"><a href="#GuacamoleDB-1776"><span class="linenos">1776</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1777"><a href="#GuacamoleDB-1777"><span class="linenos">1777</span></a>
</span><span id="GuacamoleDB-1778"><a href="#GuacamoleDB-1778"><span class="linenos">1778</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_permission</span><span class="p">(</span>
</span><span id="GuacamoleDB-1779"><a href="#GuacamoleDB-1779"><span class="linenos">1779</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">,</span> <span class="n">group_path</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GuacamoleDB-1780"><a href="#GuacamoleDB-1780"><span class="linenos">1780</span></a>    <span class="p">):</span>
</span><span id="GuacamoleDB-1781"><a href="#GuacamoleDB-1781"><span class="linenos">1781</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1782"><a href="#GuacamoleDB-1782"><span class="linenos">1782</span></a>            <span class="k">if</span> <span class="n">group_path</span><span class="p">:</span>
</span><span id="GuacamoleDB-1783"><a href="#GuacamoleDB-1783"><span class="linenos">1783</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing group path: </span><span class="si">{</span><span class="n">group_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1784"><a href="#GuacamoleDB-1784"><span class="linenos">1784</span></a>                <span class="n">parent_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_id</span><span class="p">(</span><span class="n">group_path</span><span class="p">)</span>
</span><span id="GuacamoleDB-1785"><a href="#GuacamoleDB-1785"><span class="linenos">1785</span></a>
</span><span id="GuacamoleDB-1786"><a href="#GuacamoleDB-1786"><span class="linenos">1786</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-1787"><a href="#GuacamoleDB-1787"><span class="linenos">1787</span></a>                    <span class="sa">f</span><span class="s2">&quot;Assigning connection </span><span class="si">{</span><span class="n">connection_id</span><span class="si">}</span><span class="s2"> to parent group </span><span class="si">{</span><span class="n">parent_group_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-1788"><a href="#GuacamoleDB-1788"><span class="linenos">1788</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-1789"><a href="#GuacamoleDB-1789"><span class="linenos">1789</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1790"><a href="#GuacamoleDB-1790"><span class="linenos">1790</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1791"><a href="#GuacamoleDB-1791"><span class="linenos">1791</span></a><span class="sd">                    UPDATE guacamole_connection</span>
</span><span id="GuacamoleDB-1792"><a href="#GuacamoleDB-1792"><span class="linenos">1792</span></a><span class="sd">                    SET parent_id = %s</span>
</span><span id="GuacamoleDB-1793"><a href="#GuacamoleDB-1793"><span class="linenos">1793</span></a><span class="sd">                    WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-1794"><a href="#GuacamoleDB-1794"><span class="linenos">1794</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1795"><a href="#GuacamoleDB-1795"><span class="linenos">1795</span></a>                    <span class="p">(</span><span class="n">parent_group_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-1796"><a href="#GuacamoleDB-1796"><span class="linenos">1796</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-1797"><a href="#GuacamoleDB-1797"><span class="linenos">1797</span></a>
</span><span id="GuacamoleDB-1798"><a href="#GuacamoleDB-1798"><span class="linenos">1798</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Granting permission to </span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1799"><a href="#GuacamoleDB-1799"><span class="linenos">1799</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1800"><a href="#GuacamoleDB-1800"><span class="linenos">1800</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1801"><a href="#GuacamoleDB-1801"><span class="linenos">1801</span></a><span class="sd">                INSERT INTO guacamole_connection_permission (entity_id, connection_id, permission)</span>
</span><span id="GuacamoleDB-1802"><a href="#GuacamoleDB-1802"><span class="linenos">1802</span></a><span class="sd">                SELECT entity.entity_id, %s, &#39;READ&#39;</span>
</span><span id="GuacamoleDB-1803"><a href="#GuacamoleDB-1803"><span class="linenos">1803</span></a><span class="sd">                FROM guacamole_entity entity</span>
</span><span id="GuacamoleDB-1804"><a href="#GuacamoleDB-1804"><span class="linenos">1804</span></a><span class="sd">                WHERE entity.name = %s AND entity.type = %s</span>
</span><span id="GuacamoleDB-1805"><a href="#GuacamoleDB-1805"><span class="linenos">1805</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1806"><a href="#GuacamoleDB-1806"><span class="linenos">1806</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">),</span>
</span><span id="GuacamoleDB-1807"><a href="#GuacamoleDB-1807"><span class="linenos">1807</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1808"><a href="#GuacamoleDB-1808"><span class="linenos">1808</span></a>
</span><span id="GuacamoleDB-1809"><a href="#GuacamoleDB-1809"><span class="linenos">1809</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1810"><a href="#GuacamoleDB-1810"><span class="linenos">1810</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error granting connection permission: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1811"><a href="#GuacamoleDB-1811"><span class="linenos">1811</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1812"><a href="#GuacamoleDB-1812"><span class="linenos">1812</span></a>
</span><span id="GuacamoleDB-1813"><a href="#GuacamoleDB-1813"><span class="linenos">1813</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_users_with_usergroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="GuacamoleDB-1814"><a href="#GuacamoleDB-1814"><span class="linenos">1814</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all users with their associated user group memberships.</span>
</span><span id="GuacamoleDB-1815"><a href="#GuacamoleDB-1815"><span class="linenos">1815</span></a>
</span><span id="GuacamoleDB-1816"><a href="#GuacamoleDB-1816"><span class="linenos">1816</span></a><span class="sd">        Retrieves a comprehensive mapping of all users in the system and the</span>
</span><span id="GuacamoleDB-1817"><a href="#GuacamoleDB-1817"><span class="linenos">1817</span></a><span class="sd">        user groups they belong to. This provides a complete view of user</span>
</span><span id="GuacamoleDB-1818"><a href="#GuacamoleDB-1818"><span class="linenos">1818</span></a><span class="sd">        group memberships for reporting and analysis.</span>
</span><span id="GuacamoleDB-1819"><a href="#GuacamoleDB-1819"><span class="linenos">1819</span></a>
</span><span id="GuacamoleDB-1820"><a href="#GuacamoleDB-1820"><span class="linenos">1820</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-1821"><a href="#GuacamoleDB-1821"><span class="linenos">1821</span></a><span class="sd">            Dict[str, List[str]]: Mapping of usernames to lists of user group names.</span>
</span><span id="GuacamoleDB-1822"><a href="#GuacamoleDB-1822"><span class="linenos">1822</span></a><span class="sd">                Users with no group memberships will have an empty list.</span>
</span><span id="GuacamoleDB-1823"><a href="#GuacamoleDB-1823"><span class="linenos">1823</span></a>
</span><span id="GuacamoleDB-1824"><a href="#GuacamoleDB-1824"><span class="linenos">1824</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-1825"><a href="#GuacamoleDB-1825"><span class="linenos">1825</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-1826"><a href="#GuacamoleDB-1826"><span class="linenos">1826</span></a>
</span><span id="GuacamoleDB-1827"><a href="#GuacamoleDB-1827"><span class="linenos">1827</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-1828"><a href="#GuacamoleDB-1828"><span class="linenos">1828</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-1829"><a href="#GuacamoleDB-1829"><span class="linenos">1829</span></a><span class="sd">            ...     users = db.list_users_with_usergroups()</span>
</span><span id="GuacamoleDB-1830"><a href="#GuacamoleDB-1830"><span class="linenos">1830</span></a><span class="sd">            ...     for username, groups in users.items():</span>
</span><span id="GuacamoleDB-1831"><a href="#GuacamoleDB-1831"><span class="linenos">1831</span></a><span class="sd">            ...         print(f&quot;{username}: {groups}&quot;)</span>
</span><span id="GuacamoleDB-1832"><a href="#GuacamoleDB-1832"><span class="linenos">1832</span></a><span class="sd">            john.doe: [&#39;admin&#39;, &#39;developers&#39;]</span>
</span><span id="GuacamoleDB-1833"><a href="#GuacamoleDB-1833"><span class="linenos">1833</span></a><span class="sd">            jane.smith: [&#39;users&#39;]</span>
</span><span id="GuacamoleDB-1834"><a href="#GuacamoleDB-1834"><span class="linenos">1834</span></a><span class="sd">            guest: []</span>
</span><span id="GuacamoleDB-1835"><a href="#GuacamoleDB-1835"><span class="linenos">1835</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1836"><a href="#GuacamoleDB-1836"><span class="linenos">1836</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1837"><a href="#GuacamoleDB-1837"><span class="linenos">1837</span></a><span class="s2">            SELECT DISTINCT </span>
</span><span id="GuacamoleDB-1838"><a href="#GuacamoleDB-1838"><span class="linenos">1838</span></a><span class="s2">                e1.name as username,</span>
</span><span id="GuacamoleDB-1839"><a href="#GuacamoleDB-1839"><span class="linenos">1839</span></a><span class="s2">                GROUP_CONCAT(e2.name) as groupnames</span>
</span><span id="GuacamoleDB-1840"><a href="#GuacamoleDB-1840"><span class="linenos">1840</span></a><span class="s2">            FROM guacamole_entity e1</span>
</span><span id="GuacamoleDB-1841"><a href="#GuacamoleDB-1841"><span class="linenos">1841</span></a><span class="s2">            JOIN guacamole_user u ON e1.entity_id = u.entity_id</span>
</span><span id="GuacamoleDB-1842"><a href="#GuacamoleDB-1842"><span class="linenos">1842</span></a><span class="s2">            LEFT JOIN guacamole_user_group_member ugm </span>
</span><span id="GuacamoleDB-1843"><a href="#GuacamoleDB-1843"><span class="linenos">1843</span></a><span class="s2">                ON e1.entity_id = ugm.member_entity_id</span>
</span><span id="GuacamoleDB-1844"><a href="#GuacamoleDB-1844"><span class="linenos">1844</span></a><span class="s2">            LEFT JOIN guacamole_user_group ug</span>
</span><span id="GuacamoleDB-1845"><a href="#GuacamoleDB-1845"><span class="linenos">1845</span></a><span class="s2">                ON ugm.user_group_id = ug.user_group_id</span>
</span><span id="GuacamoleDB-1846"><a href="#GuacamoleDB-1846"><span class="linenos">1846</span></a><span class="s2">            LEFT JOIN guacamole_entity e2</span>
</span><span id="GuacamoleDB-1847"><a href="#GuacamoleDB-1847"><span class="linenos">1847</span></a><span class="s2">                ON ug.entity_id = e2.entity_id</span>
</span><span id="GuacamoleDB-1848"><a href="#GuacamoleDB-1848"><span class="linenos">1848</span></a><span class="s2">            WHERE e1.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1849"><a href="#GuacamoleDB-1849"><span class="linenos">1849</span></a><span class="s2">            GROUP BY e1.name</span>
</span><span id="GuacamoleDB-1850"><a href="#GuacamoleDB-1850"><span class="linenos">1850</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1851"><a href="#GuacamoleDB-1851"><span class="linenos">1851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="GuacamoleDB-1852"><a href="#GuacamoleDB-1852"><span class="linenos">1852</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB-1853"><a href="#GuacamoleDB-1853"><span class="linenos">1853</span></a>
</span><span id="GuacamoleDB-1854"><a href="#GuacamoleDB-1854"><span class="linenos">1854</span></a>        <span class="n">users_groups</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB-1855"><a href="#GuacamoleDB-1855"><span class="linenos">1855</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="GuacamoleDB-1856"><a href="#GuacamoleDB-1856"><span class="linenos">1856</span></a>            <span class="n">username</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-1857"><a href="#GuacamoleDB-1857"><span class="linenos">1857</span></a>            <span class="n">groupnames</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-1858"><a href="#GuacamoleDB-1858"><span class="linenos">1858</span></a>            <span class="n">users_groups</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">groupnames</span>
</span><span id="GuacamoleDB-1859"><a href="#GuacamoleDB-1859"><span class="linenos">1859</span></a>
</span><span id="GuacamoleDB-1860"><a href="#GuacamoleDB-1860"><span class="linenos">1860</span></a>        <span class="k">return</span> <span class="n">users_groups</span>
</span><span id="GuacamoleDB-1861"><a href="#GuacamoleDB-1861"><span class="linenos">1861</span></a>
</span><span id="GuacamoleDB-1862"><a href="#GuacamoleDB-1862"><span class="linenos">1862</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_connections_with_conngroups_and_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConnectionInfo</span><span class="p">]:</span>
</span><span id="GuacamoleDB-1863"><a href="#GuacamoleDB-1863"><span class="linenos">1863</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all connections with their groups, parent group, and user permissions&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1864"><a href="#GuacamoleDB-1864"><span class="linenos">1864</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1865"><a href="#GuacamoleDB-1865"><span class="linenos">1865</span></a>            <span class="c1"># Get basic connection info with groups</span>
</span><span id="GuacamoleDB-1866"><a href="#GuacamoleDB-1866"><span class="linenos">1866</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1867"><a href="#GuacamoleDB-1867"><span class="linenos">1867</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1868"><a href="#GuacamoleDB-1868"><span class="linenos">1868</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB-1869"><a href="#GuacamoleDB-1869"><span class="linenos">1869</span></a><span class="sd">                    c.connection_id,</span>
</span><span id="GuacamoleDB-1870"><a href="#GuacamoleDB-1870"><span class="linenos">1870</span></a><span class="sd">                    c.connection_name,</span>
</span><span id="GuacamoleDB-1871"><a href="#GuacamoleDB-1871"><span class="linenos">1871</span></a><span class="sd">                    c.protocol,</span>
</span><span id="GuacamoleDB-1872"><a href="#GuacamoleDB-1872"><span class="linenos">1872</span></a><span class="sd">                    MAX(CASE WHEN p1.parameter_name = &#39;hostname&#39; THEN p1.parameter_value END) AS hostname,</span>
</span><span id="GuacamoleDB-1873"><a href="#GuacamoleDB-1873"><span class="linenos">1873</span></a><span class="sd">                    MAX(CASE WHEN p2.parameter_name = &#39;port&#39; THEN p2.parameter_value END) AS port,</span>
</span><span id="GuacamoleDB-1874"><a href="#GuacamoleDB-1874"><span class="linenos">1874</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT CASE WHEN e.type = &#39;USER_GROUP&#39; THEN e.name END) AS groups,</span>
</span><span id="GuacamoleDB-1875"><a href="#GuacamoleDB-1875"><span class="linenos">1875</span></a><span class="sd">                    cg.connection_group_name AS parent</span>
</span><span id="GuacamoleDB-1876"><a href="#GuacamoleDB-1876"><span class="linenos">1876</span></a><span class="sd">                FROM guacamole_connection c</span>
</span><span id="GuacamoleDB-1877"><a href="#GuacamoleDB-1877"><span class="linenos">1877</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p1 </span>
</span><span id="GuacamoleDB-1878"><a href="#GuacamoleDB-1878"><span class="linenos">1878</span></a><span class="sd">                    ON c.connection_id = p1.connection_id AND p1.parameter_name = &#39;hostname&#39;</span>
</span><span id="GuacamoleDB-1879"><a href="#GuacamoleDB-1879"><span class="linenos">1879</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p2 </span>
</span><span id="GuacamoleDB-1880"><a href="#GuacamoleDB-1880"><span class="linenos">1880</span></a><span class="sd">                    ON c.connection_id = p2.connection_id AND p2.parameter_name = &#39;port&#39;</span>
</span><span id="GuacamoleDB-1881"><a href="#GuacamoleDB-1881"><span class="linenos">1881</span></a><span class="sd">                LEFT JOIN guacamole_connection_permission cp </span>
</span><span id="GuacamoleDB-1882"><a href="#GuacamoleDB-1882"><span class="linenos">1882</span></a><span class="sd">                    ON c.connection_id = cp.connection_id</span>
</span><span id="GuacamoleDB-1883"><a href="#GuacamoleDB-1883"><span class="linenos">1883</span></a><span class="sd">                LEFT JOIN guacamole_entity e </span>
</span><span id="GuacamoleDB-1884"><a href="#GuacamoleDB-1884"><span class="linenos">1884</span></a><span class="sd">                    ON cp.entity_id = e.entity_id AND e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-1885"><a href="#GuacamoleDB-1885"><span class="linenos">1885</span></a><span class="sd">                LEFT JOIN guacamole_connection_group cg</span>
</span><span id="GuacamoleDB-1886"><a href="#GuacamoleDB-1886"><span class="linenos">1886</span></a><span class="sd">                    ON c.parent_id = cg.connection_group_id</span>
</span><span id="GuacamoleDB-1887"><a href="#GuacamoleDB-1887"><span class="linenos">1887</span></a><span class="sd">                GROUP BY c.connection_id</span>
</span><span id="GuacamoleDB-1888"><a href="#GuacamoleDB-1888"><span class="linenos">1888</span></a><span class="sd">                ORDER BY c.connection_name</span>
</span><span id="GuacamoleDB-1889"><a href="#GuacamoleDB-1889"><span class="linenos">1889</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1890"><a href="#GuacamoleDB-1890"><span class="linenos">1890</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1891"><a href="#GuacamoleDB-1891"><span class="linenos">1891</span></a>
</span><span id="GuacamoleDB-1892"><a href="#GuacamoleDB-1892"><span class="linenos">1892</span></a>            <span class="n">connections_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB-1893"><a href="#GuacamoleDB-1893"><span class="linenos">1893</span></a>
</span><span id="GuacamoleDB-1894"><a href="#GuacamoleDB-1894"><span class="linenos">1894</span></a>            <span class="c1"># Create a mapping of connection names to connection IDs</span>
</span><span id="GuacamoleDB-1895"><a href="#GuacamoleDB-1895"><span class="linenos">1895</span></a>            <span class="n">connection_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB-1896"><a href="#GuacamoleDB-1896"><span class="linenos">1896</span></a>                <span class="n">name</span><span class="p">:</span> <span class="n">conn_id</span> <span class="k">for</span> <span class="n">conn_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">connections_info</span>
</span><span id="GuacamoleDB-1897"><a href="#GuacamoleDB-1897"><span class="linenos">1897</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB-1898"><a href="#GuacamoleDB-1898"><span class="linenos">1898</span></a>
</span><span id="GuacamoleDB-1899"><a href="#GuacamoleDB-1899"><span class="linenos">1899</span></a>            <span class="c1"># Now prepare the result array</span>
</span><span id="GuacamoleDB-1900"><a href="#GuacamoleDB-1900"><span class="linenos">1900</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-1901"><a href="#GuacamoleDB-1901"><span class="linenos">1901</span></a>            <span class="k">for</span> <span class="n">conn_info</span> <span class="ow">in</span> <span class="n">connections_info</span><span class="p">:</span>
</span><span id="GuacamoleDB-1902"><a href="#GuacamoleDB-1902"><span class="linenos">1902</span></a>                <span class="n">conn_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">conn_info</span>
</span><span id="GuacamoleDB-1903"><a href="#GuacamoleDB-1903"><span class="linenos">1903</span></a>
</span><span id="GuacamoleDB-1904"><a href="#GuacamoleDB-1904"><span class="linenos">1904</span></a>                <span class="c1"># Get user permissions for this connection - THIS IS THE KEY CHANGE</span>
</span><span id="GuacamoleDB-1905"><a href="#GuacamoleDB-1905"><span class="linenos">1905</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1906"><a href="#GuacamoleDB-1906"><span class="linenos">1906</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1907"><a href="#GuacamoleDB-1907"><span class="linenos">1907</span></a><span class="sd">                    SELECT e.name</span>
</span><span id="GuacamoleDB-1908"><a href="#GuacamoleDB-1908"><span class="linenos">1908</span></a><span class="sd">                    FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB-1909"><a href="#GuacamoleDB-1909"><span class="linenos">1909</span></a><span class="sd">                    JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB-1910"><a href="#GuacamoleDB-1910"><span class="linenos">1910</span></a><span class="sd">                    WHERE cp.connection_id = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1911"><a href="#GuacamoleDB-1911"><span class="linenos">1911</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1912"><a href="#GuacamoleDB-1912"><span class="linenos">1912</span></a>                    <span class="p">(</span><span class="n">conn_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1913"><a href="#GuacamoleDB-1913"><span class="linenos">1913</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-1914"><a href="#GuacamoleDB-1914"><span class="linenos">1914</span></a>
</span><span id="GuacamoleDB-1915"><a href="#GuacamoleDB-1915"><span class="linenos">1915</span></a>                <span class="n">user_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB-1916"><a href="#GuacamoleDB-1916"><span class="linenos">1916</span></a>
</span><span id="GuacamoleDB-1917"><a href="#GuacamoleDB-1917"><span class="linenos">1917</span></a>                <span class="c1"># Append user permissions to the connection info (include connection_id)</span>
</span><span id="GuacamoleDB-1918"><a href="#GuacamoleDB-1918"><span class="linenos">1918</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="GuacamoleDB-1919"><a href="#GuacamoleDB-1919"><span class="linenos">1919</span></a>                    <span class="p">(</span>
</span><span id="GuacamoleDB-1920"><a href="#GuacamoleDB-1920"><span class="linenos">1920</span></a>                        <span class="n">conn_id</span><span class="p">,</span>
</span><span id="GuacamoleDB-1921"><a href="#GuacamoleDB-1921"><span class="linenos">1921</span></a>                        <span class="n">name</span><span class="p">,</span>
</span><span id="GuacamoleDB-1922"><a href="#GuacamoleDB-1922"><span class="linenos">1922</span></a>                        <span class="n">protocol</span><span class="p">,</span>
</span><span id="GuacamoleDB-1923"><a href="#GuacamoleDB-1923"><span class="linenos">1923</span></a>                        <span class="n">host</span><span class="p">,</span>
</span><span id="GuacamoleDB-1924"><a href="#GuacamoleDB-1924"><span class="linenos">1924</span></a>                        <span class="n">port</span><span class="p">,</span>
</span><span id="GuacamoleDB-1925"><a href="#GuacamoleDB-1925"><span class="linenos">1925</span></a>                        <span class="n">groups</span><span class="p">,</span>
</span><span id="GuacamoleDB-1926"><a href="#GuacamoleDB-1926"><span class="linenos">1926</span></a>                        <span class="n">parent</span><span class="p">,</span>
</span><span id="GuacamoleDB-1927"><a href="#GuacamoleDB-1927"><span class="linenos">1927</span></a>                        <span class="n">user_permissions</span><span class="p">,</span>
</span><span id="GuacamoleDB-1928"><a href="#GuacamoleDB-1928"><span class="linenos">1928</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-1929"><a href="#GuacamoleDB-1929"><span class="linenos">1929</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-1930"><a href="#GuacamoleDB-1930"><span class="linenos">1930</span></a>
</span><span id="GuacamoleDB-1931"><a href="#GuacamoleDB-1931"><span class="linenos">1931</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="GuacamoleDB-1932"><a href="#GuacamoleDB-1932"><span class="linenos">1932</span></a>
</span><span id="GuacamoleDB-1933"><a href="#GuacamoleDB-1933"><span class="linenos">1933</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1934"><a href="#GuacamoleDB-1934"><span class="linenos">1934</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing connections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-1935"><a href="#GuacamoleDB-1935"><span class="linenos">1935</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-1936"><a href="#GuacamoleDB-1936"><span class="linenos">1936</span></a>
</span><span id="GuacamoleDB-1937"><a href="#GuacamoleDB-1937"><span class="linenos">1937</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConnectionInfo</span><span class="p">]:</span>
</span><span id="GuacamoleDB-1938"><a href="#GuacamoleDB-1938"><span class="linenos">1938</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a specific connection by its ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1939"><a href="#GuacamoleDB-1939"><span class="linenos">1939</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-1940"><a href="#GuacamoleDB-1940"><span class="linenos">1940</span></a>            <span class="c1"># Get basic connection info with groups</span>
</span><span id="GuacamoleDB-1941"><a href="#GuacamoleDB-1941"><span class="linenos">1941</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1942"><a href="#GuacamoleDB-1942"><span class="linenos">1942</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1943"><a href="#GuacamoleDB-1943"><span class="linenos">1943</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB-1944"><a href="#GuacamoleDB-1944"><span class="linenos">1944</span></a><span class="sd">                    c.connection_id,</span>
</span><span id="GuacamoleDB-1945"><a href="#GuacamoleDB-1945"><span class="linenos">1945</span></a><span class="sd">                    c.connection_name,</span>
</span><span id="GuacamoleDB-1946"><a href="#GuacamoleDB-1946"><span class="linenos">1946</span></a><span class="sd">                    c.protocol,</span>
</span><span id="GuacamoleDB-1947"><a href="#GuacamoleDB-1947"><span class="linenos">1947</span></a><span class="sd">                    MAX(CASE WHEN p1.parameter_name = &#39;hostname&#39; THEN p1.parameter_value END) AS hostname,</span>
</span><span id="GuacamoleDB-1948"><a href="#GuacamoleDB-1948"><span class="linenos">1948</span></a><span class="sd">                    MAX(CASE WHEN p2.parameter_name = &#39;port&#39; THEN p2.parameter_value END) AS port,</span>
</span><span id="GuacamoleDB-1949"><a href="#GuacamoleDB-1949"><span class="linenos">1949</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT CASE WHEN e.type = &#39;USER_GROUP&#39; THEN e.name END) AS groups,</span>
</span><span id="GuacamoleDB-1950"><a href="#GuacamoleDB-1950"><span class="linenos">1950</span></a><span class="sd">                    cg.connection_group_name AS parent</span>
</span><span id="GuacamoleDB-1951"><a href="#GuacamoleDB-1951"><span class="linenos">1951</span></a><span class="sd">                FROM guacamole_connection c</span>
</span><span id="GuacamoleDB-1952"><a href="#GuacamoleDB-1952"><span class="linenos">1952</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p1 </span>
</span><span id="GuacamoleDB-1953"><a href="#GuacamoleDB-1953"><span class="linenos">1953</span></a><span class="sd">                    ON c.connection_id = p1.connection_id AND p1.parameter_name = &#39;hostname&#39;</span>
</span><span id="GuacamoleDB-1954"><a href="#GuacamoleDB-1954"><span class="linenos">1954</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p2 </span>
</span><span id="GuacamoleDB-1955"><a href="#GuacamoleDB-1955"><span class="linenos">1955</span></a><span class="sd">                    ON c.connection_id = p2.connection_id AND p2.parameter_name = &#39;port&#39;</span>
</span><span id="GuacamoleDB-1956"><a href="#GuacamoleDB-1956"><span class="linenos">1956</span></a><span class="sd">                LEFT JOIN guacamole_connection_permission cp </span>
</span><span id="GuacamoleDB-1957"><a href="#GuacamoleDB-1957"><span class="linenos">1957</span></a><span class="sd">                    ON c.connection_id = cp.connection_id</span>
</span><span id="GuacamoleDB-1958"><a href="#GuacamoleDB-1958"><span class="linenos">1958</span></a><span class="sd">                LEFT JOIN guacamole_entity e </span>
</span><span id="GuacamoleDB-1959"><a href="#GuacamoleDB-1959"><span class="linenos">1959</span></a><span class="sd">                    ON cp.entity_id = e.entity_id AND e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-1960"><a href="#GuacamoleDB-1960"><span class="linenos">1960</span></a><span class="sd">                LEFT JOIN guacamole_connection_group cg</span>
</span><span id="GuacamoleDB-1961"><a href="#GuacamoleDB-1961"><span class="linenos">1961</span></a><span class="sd">                    ON c.parent_id = cg.connection_group_id</span>
</span><span id="GuacamoleDB-1962"><a href="#GuacamoleDB-1962"><span class="linenos">1962</span></a><span class="sd">                WHERE c.connection_id = %s</span>
</span><span id="GuacamoleDB-1963"><a href="#GuacamoleDB-1963"><span class="linenos">1963</span></a><span class="sd">                GROUP BY c.connection_id</span>
</span><span id="GuacamoleDB-1964"><a href="#GuacamoleDB-1964"><span class="linenos">1964</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1965"><a href="#GuacamoleDB-1965"><span class="linenos">1965</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1966"><a href="#GuacamoleDB-1966"><span class="linenos">1966</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1967"><a href="#GuacamoleDB-1967"><span class="linenos">1967</span></a>
</span><span id="GuacamoleDB-1968"><a href="#GuacamoleDB-1968"><span class="linenos">1968</span></a>            <span class="n">connection_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-1969"><a href="#GuacamoleDB-1969"><span class="linenos">1969</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">connection_info</span><span class="p">:</span>
</span><span id="GuacamoleDB-1970"><a href="#GuacamoleDB-1970"><span class="linenos">1970</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-1971"><a href="#GuacamoleDB-1971"><span class="linenos">1971</span></a>
</span><span id="GuacamoleDB-1972"><a href="#GuacamoleDB-1972"><span class="linenos">1972</span></a>            <span class="n">conn_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">connection_info</span>
</span><span id="GuacamoleDB-1973"><a href="#GuacamoleDB-1973"><span class="linenos">1973</span></a>
</span><span id="GuacamoleDB-1974"><a href="#GuacamoleDB-1974"><span class="linenos">1974</span></a>            <span class="c1"># Get user permissions for this connection</span>
</span><span id="GuacamoleDB-1975"><a href="#GuacamoleDB-1975"><span class="linenos">1975</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-1976"><a href="#GuacamoleDB-1976"><span class="linenos">1976</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-1977"><a href="#GuacamoleDB-1977"><span class="linenos">1977</span></a><span class="sd">                SELECT e.name</span>
</span><span id="GuacamoleDB-1978"><a href="#GuacamoleDB-1978"><span class="linenos">1978</span></a><span class="sd">                FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB-1979"><a href="#GuacamoleDB-1979"><span class="linenos">1979</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB-1980"><a href="#GuacamoleDB-1980"><span class="linenos">1980</span></a><span class="sd">                WHERE cp.connection_id = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-1981"><a href="#GuacamoleDB-1981"><span class="linenos">1981</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-1982"><a href="#GuacamoleDB-1982"><span class="linenos">1982</span></a>                <span class="p">(</span><span class="n">conn_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-1983"><a href="#GuacamoleDB-1983"><span class="linenos">1983</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1984"><a href="#GuacamoleDB-1984"><span class="linenos">1984</span></a>
</span><span id="GuacamoleDB-1985"><a href="#GuacamoleDB-1985"><span class="linenos">1985</span></a>            <span class="n">user_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB-1986"><a href="#GuacamoleDB-1986"><span class="linenos">1986</span></a>
</span><span id="GuacamoleDB-1987"><a href="#GuacamoleDB-1987"><span class="linenos">1987</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="GuacamoleDB-1988"><a href="#GuacamoleDB-1988"><span class="linenos">1988</span></a>                <span class="n">conn_id</span><span class="p">,</span>
</span><span id="GuacamoleDB-1989"><a href="#GuacamoleDB-1989"><span class="linenos">1989</span></a>                <span class="n">name</span><span class="p">,</span>
</span><span id="GuacamoleDB-1990"><a href="#GuacamoleDB-1990"><span class="linenos">1990</span></a>                <span class="n">protocol</span><span class="p">,</span>
</span><span id="GuacamoleDB-1991"><a href="#GuacamoleDB-1991"><span class="linenos">1991</span></a>                <span class="n">host</span><span class="p">,</span>
</span><span id="GuacamoleDB-1992"><a href="#GuacamoleDB-1992"><span class="linenos">1992</span></a>                <span class="n">port</span><span class="p">,</span>
</span><span id="GuacamoleDB-1993"><a href="#GuacamoleDB-1993"><span class="linenos">1993</span></a>                <span class="n">groups</span><span class="p">,</span>
</span><span id="GuacamoleDB-1994"><a href="#GuacamoleDB-1994"><span class="linenos">1994</span></a>                <span class="n">parent</span><span class="p">,</span>
</span><span id="GuacamoleDB-1995"><a href="#GuacamoleDB-1995"><span class="linenos">1995</span></a>                <span class="n">user_permissions</span><span class="p">,</span>
</span><span id="GuacamoleDB-1996"><a href="#GuacamoleDB-1996"><span class="linenos">1996</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-1997"><a href="#GuacamoleDB-1997"><span class="linenos">1997</span></a>
</span><span id="GuacamoleDB-1998"><a href="#GuacamoleDB-1998"><span class="linenos">1998</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-1999"><a href="#GuacamoleDB-1999"><span class="linenos">1999</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2000"><a href="#GuacamoleDB-2000"><span class="linenos">2000</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2001"><a href="#GuacamoleDB-2001"><span class="linenos">2001</span></a>
</span><span id="GuacamoleDB-2002"><a href="#GuacamoleDB-2002"><span class="linenos">2002</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_usergroups_with_users_and_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GuacamoleDB-2003"><a href="#GuacamoleDB-2003"><span class="linenos">2003</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all user groups with their associated users and connections.</span>
</span><span id="GuacamoleDB-2004"><a href="#GuacamoleDB-2004"><span class="linenos">2004</span></a>
</span><span id="GuacamoleDB-2005"><a href="#GuacamoleDB-2005"><span class="linenos">2005</span></a><span class="sd">        Retrieves a comprehensive mapping of all user groups in the system,</span>
</span><span id="GuacamoleDB-2006"><a href="#GuacamoleDB-2006"><span class="linenos">2006</span></a><span class="sd">        including the users belonging to each group and the connections</span>
</span><span id="GuacamoleDB-2007"><a href="#GuacamoleDB-2007"><span class="linenos">2007</span></a><span class="sd">        accessible to those users through group permissions.</span>
</span><span id="GuacamoleDB-2008"><a href="#GuacamoleDB-2008"><span class="linenos">2008</span></a>
</span><span id="GuacamoleDB-2009"><a href="#GuacamoleDB-2009"><span class="linenos">2009</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2010"><a href="#GuacamoleDB-2010"><span class="linenos">2010</span></a><span class="sd">            Dict[str, Dict[str, Any]]: Nested dictionary with group names as keys.</span>
</span><span id="GuacamoleDB-2011"><a href="#GuacamoleDB-2011"><span class="linenos">2011</span></a><span class="sd">                Each group dictionary contains:</span>
</span><span id="GuacamoleDB-2012"><a href="#GuacamoleDB-2012"><span class="linenos">2012</span></a><span class="sd">                - id (int): The database ID of the user group</span>
</span><span id="GuacamoleDB-2013"><a href="#GuacamoleDB-2013"><span class="linenos">2013</span></a><span class="sd">                - users (List[str]): List of usernames belonging to the group</span>
</span><span id="GuacamoleDB-2014"><a href="#GuacamoleDB-2014"><span class="linenos">2014</span></a><span class="sd">                - connections (List[str]): List of connection names accessible to the group</span>
</span><span id="GuacamoleDB-2015"><a href="#GuacamoleDB-2015"><span class="linenos">2015</span></a>
</span><span id="GuacamoleDB-2016"><a href="#GuacamoleDB-2016"><span class="linenos">2016</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2017"><a href="#GuacamoleDB-2017"><span class="linenos">2017</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-2018"><a href="#GuacamoleDB-2018"><span class="linenos">2018</span></a>
</span><span id="GuacamoleDB-2019"><a href="#GuacamoleDB-2019"><span class="linenos">2019</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2020"><a href="#GuacamoleDB-2020"><span class="linenos">2020</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-2021"><a href="#GuacamoleDB-2021"><span class="linenos">2021</span></a><span class="sd">            ...     result = db.list_usergroups_with_users_and_connections()</span>
</span><span id="GuacamoleDB-2022"><a href="#GuacamoleDB-2022"><span class="linenos">2022</span></a><span class="sd">            ...     admin_group = result.get(&#39;admin&#39;, {})</span>
</span><span id="GuacamoleDB-2023"><a href="#GuacamoleDB-2023"><span class="linenos">2023</span></a><span class="sd">            ...     print(f&quot;Admin users: {admin_group.get(&#39;users&#39;, [])}&quot;)</span>
</span><span id="GuacamoleDB-2024"><a href="#GuacamoleDB-2024"><span class="linenos">2024</span></a><span class="sd">            ...     print(f&quot;Admin connections: {admin_group.get(&#39;connections&#39;, [])}&quot;)</span>
</span><span id="GuacamoleDB-2025"><a href="#GuacamoleDB-2025"><span class="linenos">2025</span></a><span class="sd">            Admin users: [&#39;admin1&#39;, &#39;admin2&#39;]</span>
</span><span id="GuacamoleDB-2026"><a href="#GuacamoleDB-2026"><span class="linenos">2026</span></a><span class="sd">            Admin connections: [&#39;server1&#39;, &#39;server2&#39;]</span>
</span><span id="GuacamoleDB-2027"><a href="#GuacamoleDB-2027"><span class="linenos">2027</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2028"><a href="#GuacamoleDB-2028"><span class="linenos">2028</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2029"><a href="#GuacamoleDB-2029"><span class="linenos">2029</span></a>            <span class="c1"># Get users per group with IDs</span>
</span><span id="GuacamoleDB-2030"><a href="#GuacamoleDB-2030"><span class="linenos">2030</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2031"><a href="#GuacamoleDB-2031"><span class="linenos">2031</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2032"><a href="#GuacamoleDB-2032"><span class="linenos">2032</span></a><span class="sd">                SELECT</span>
</span><span id="GuacamoleDB-2033"><a href="#GuacamoleDB-2033"><span class="linenos">2033</span></a><span class="sd">                    e.name as groupname,</span>
</span><span id="GuacamoleDB-2034"><a href="#GuacamoleDB-2034"><span class="linenos">2034</span></a><span class="sd">                    ug.user_group_id,</span>
</span><span id="GuacamoleDB-2035"><a href="#GuacamoleDB-2035"><span class="linenos">2035</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT ue.name) as users</span>
</span><span id="GuacamoleDB-2036"><a href="#GuacamoleDB-2036"><span class="linenos">2036</span></a><span class="sd">                FROM guacamole_entity e</span>
</span><span id="GuacamoleDB-2037"><a href="#GuacamoleDB-2037"><span class="linenos">2037</span></a><span class="sd">                LEFT JOIN guacamole_user_group ug ON e.entity_id = ug.entity_id</span>
</span><span id="GuacamoleDB-2038"><a href="#GuacamoleDB-2038"><span class="linenos">2038</span></a><span class="sd">                LEFT JOIN guacamole_user_group_member ugm ON ug.user_group_id = ugm.user_group_id</span>
</span><span id="GuacamoleDB-2039"><a href="#GuacamoleDB-2039"><span class="linenos">2039</span></a><span class="sd">                LEFT JOIN guacamole_entity ue ON ugm.member_entity_id = ue.entity_id AND ue.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-2040"><a href="#GuacamoleDB-2040"><span class="linenos">2040</span></a><span class="sd">                WHERE e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-2041"><a href="#GuacamoleDB-2041"><span class="linenos">2041</span></a><span class="sd">                GROUP BY e.name, ug.user_group_id</span>
</span><span id="GuacamoleDB-2042"><a href="#GuacamoleDB-2042"><span class="linenos">2042</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2043"><a href="#GuacamoleDB-2043"><span class="linenos">2043</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2044"><a href="#GuacamoleDB-2044"><span class="linenos">2044</span></a>            <span class="n">groups_users</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB-2045"><a href="#GuacamoleDB-2045"><span class="linenos">2045</span></a>                <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-2046"><a href="#GuacamoleDB-2046"><span class="linenos">2046</span></a>                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB-2047"><a href="#GuacamoleDB-2047"><span class="linenos">2047</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB-2048"><a href="#GuacamoleDB-2048"><span class="linenos">2048</span></a>
</span><span id="GuacamoleDB-2049"><a href="#GuacamoleDB-2049"><span class="linenos">2049</span></a>            <span class="c1"># Get connections per group with IDs</span>
</span><span id="GuacamoleDB-2050"><a href="#GuacamoleDB-2050"><span class="linenos">2050</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2051"><a href="#GuacamoleDB-2051"><span class="linenos">2051</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2052"><a href="#GuacamoleDB-2052"><span class="linenos">2052</span></a><span class="sd">                SELECT</span>
</span><span id="GuacamoleDB-2053"><a href="#GuacamoleDB-2053"><span class="linenos">2053</span></a><span class="sd">                    e.name as groupname,</span>
</span><span id="GuacamoleDB-2054"><a href="#GuacamoleDB-2054"><span class="linenos">2054</span></a><span class="sd">                    ug.user_group_id,</span>
</span><span id="GuacamoleDB-2055"><a href="#GuacamoleDB-2055"><span class="linenos">2055</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT c.connection_name) as connections</span>
</span><span id="GuacamoleDB-2056"><a href="#GuacamoleDB-2056"><span class="linenos">2056</span></a><span class="sd">                FROM guacamole_entity e</span>
</span><span id="GuacamoleDB-2057"><a href="#GuacamoleDB-2057"><span class="linenos">2057</span></a><span class="sd">                LEFT JOIN guacamole_user_group ug ON e.entity_id = ug.entity_id</span>
</span><span id="GuacamoleDB-2058"><a href="#GuacamoleDB-2058"><span class="linenos">2058</span></a><span class="sd">                LEFT JOIN guacamole_connection_permission cp ON e.entity_id = cp.entity_id</span>
</span><span id="GuacamoleDB-2059"><a href="#GuacamoleDB-2059"><span class="linenos">2059</span></a><span class="sd">                LEFT JOIN guacamole_connection c ON cp.connection_id = c.connection_id</span>
</span><span id="GuacamoleDB-2060"><a href="#GuacamoleDB-2060"><span class="linenos">2060</span></a><span class="sd">                WHERE e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-2061"><a href="#GuacamoleDB-2061"><span class="linenos">2061</span></a><span class="sd">                GROUP BY e.name, ug.user_group_id</span>
</span><span id="GuacamoleDB-2062"><a href="#GuacamoleDB-2062"><span class="linenos">2062</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2063"><a href="#GuacamoleDB-2063"><span class="linenos">2063</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2064"><a href="#GuacamoleDB-2064"><span class="linenos">2064</span></a>            <span class="n">groups_connections</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB-2065"><a href="#GuacamoleDB-2065"><span class="linenos">2065</span></a>                <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-2066"><a href="#GuacamoleDB-2066"><span class="linenos">2066</span></a>                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB-2067"><a href="#GuacamoleDB-2067"><span class="linenos">2067</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB-2068"><a href="#GuacamoleDB-2068"><span class="linenos">2068</span></a>
</span><span id="GuacamoleDB-2069"><a href="#GuacamoleDB-2069"><span class="linenos">2069</span></a>            <span class="c1"># Combine results</span>
</span><span id="GuacamoleDB-2070"><a href="#GuacamoleDB-2070"><span class="linenos">2070</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB-2071"><a href="#GuacamoleDB-2071"><span class="linenos">2071</span></a>            <span class="k">for</span> <span class="n">group_key</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">groups_users</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">groups_connections</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="GuacamoleDB-2072"><a href="#GuacamoleDB-2072"><span class="linenos">2072</span></a>                <span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span> <span class="o">=</span> <span class="n">group_key</span>
</span><span id="GuacamoleDB-2073"><a href="#GuacamoleDB-2073"><span class="linenos">2073</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB-2074"><a href="#GuacamoleDB-2074"><span class="linenos">2074</span></a>                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="GuacamoleDB-2075"><a href="#GuacamoleDB-2075"><span class="linenos">2075</span></a>                    <span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="n">groups_users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_key</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="GuacamoleDB-2076"><a href="#GuacamoleDB-2076"><span class="linenos">2076</span></a>                    <span class="s2">&quot;connections&quot;</span><span class="p">:</span> <span class="n">groups_connections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_key</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="GuacamoleDB-2077"><a href="#GuacamoleDB-2077"><span class="linenos">2077</span></a>                <span class="p">}</span>
</span><span id="GuacamoleDB-2078"><a href="#GuacamoleDB-2078"><span class="linenos">2078</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="GuacamoleDB-2079"><a href="#GuacamoleDB-2079"><span class="linenos">2079</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2080"><a href="#GuacamoleDB-2080"><span class="linenos">2080</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing groups with users and connections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2081"><a href="#GuacamoleDB-2081"><span class="linenos">2081</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2082"><a href="#GuacamoleDB-2082"><span class="linenos">2082</span></a>
</span><span id="GuacamoleDB-2083"><a href="#GuacamoleDB-2083"><span class="linenos">2083</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_connection_group_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-2084"><a href="#GuacamoleDB-2084"><span class="linenos">2084</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if setting a parent connection group would create a cycle.</span>
</span><span id="GuacamoleDB-2085"><a href="#GuacamoleDB-2085"><span class="linenos">2085</span></a>
</span><span id="GuacamoleDB-2086"><a href="#GuacamoleDB-2086"><span class="linenos">2086</span></a><span class="sd">        Validates whether assigning a parent group to a connection group would</span>
</span><span id="GuacamoleDB-2087"><a href="#GuacamoleDB-2087"><span class="linenos">2087</span></a><span class="sd">        result in a circular reference in the connection group hierarchy.</span>
</span><span id="GuacamoleDB-2088"><a href="#GuacamoleDB-2088"><span class="linenos">2088</span></a><span class="sd">        This prevents infinite loops and maintains a proper tree structure.</span>
</span><span id="GuacamoleDB-2089"><a href="#GuacamoleDB-2089"><span class="linenos">2089</span></a>
</span><span id="GuacamoleDB-2090"><a href="#GuacamoleDB-2090"><span class="linenos">2090</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-2091"><a href="#GuacamoleDB-2091"><span class="linenos">2091</span></a><span class="sd">            group_id: The database ID of the connection group to be modified.</span>
</span><span id="GuacamoleDB-2092"><a href="#GuacamoleDB-2092"><span class="linenos">2092</span></a><span class="sd">            parent_id: The database ID of the proposed parent group, or None</span>
</span><span id="GuacamoleDB-2093"><a href="#GuacamoleDB-2093"><span class="linenos">2093</span></a><span class="sd">                      to remove the parent relationship.</span>
</span><span id="GuacamoleDB-2094"><a href="#GuacamoleDB-2094"><span class="linenos">2094</span></a>
</span><span id="GuacamoleDB-2095"><a href="#GuacamoleDB-2095"><span class="linenos">2095</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2096"><a href="#GuacamoleDB-2096"><span class="linenos">2096</span></a><span class="sd">            True if setting the parent would create a cycle, False otherwise.</span>
</span><span id="GuacamoleDB-2097"><a href="#GuacamoleDB-2097"><span class="linenos">2097</span></a>
</span><span id="GuacamoleDB-2098"><a href="#GuacamoleDB-2098"><span class="linenos">2098</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2099"><a href="#GuacamoleDB-2099"><span class="linenos">2099</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-2100"><a href="#GuacamoleDB-2100"><span class="linenos">2100</span></a>
</span><span id="GuacamoleDB-2101"><a href="#GuacamoleDB-2101"><span class="linenos">2101</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2102"><a href="#GuacamoleDB-2102"><span class="linenos">2102</span></a><span class="sd">            &gt;&gt;&gt; # Group 1 -&gt; Group 2 -&gt; Group 3 (hierarchy)</span>
</span><span id="GuacamoleDB-2103"><a href="#GuacamoleDB-2103"><span class="linenos">2103</span></a><span class="sd">            &gt;&gt;&gt; # Attempting to make Group 3 parent of Group 1 would create a cycle</span>
</span><span id="GuacamoleDB-2104"><a href="#GuacamoleDB-2104"><span class="linenos">2104</span></a><span class="sd">            &gt;&gt;&gt; db._check_connection_group_cycle(1, 3)  # Returns True</span>
</span><span id="GuacamoleDB-2105"><a href="#GuacamoleDB-2105"><span class="linenos">2105</span></a><span class="sd">            &gt;&gt;&gt; db._check_connection_group_cycle(4, None)  # Returns False</span>
</span><span id="GuacamoleDB-2106"><a href="#GuacamoleDB-2106"><span class="linenos">2106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2107"><a href="#GuacamoleDB-2107"><span class="linenos">2107</span></a>        <span class="k">if</span> <span class="n">parent_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2108"><a href="#GuacamoleDB-2108"><span class="linenos">2108</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GuacamoleDB-2109"><a href="#GuacamoleDB-2109"><span class="linenos">2109</span></a>
</span><span id="GuacamoleDB-2110"><a href="#GuacamoleDB-2110"><span class="linenos">2110</span></a>        <span class="n">current_parent</span> <span class="o">=</span> <span class="n">parent_id</span>
</span><span id="GuacamoleDB-2111"><a href="#GuacamoleDB-2111"><span class="linenos">2111</span></a>        <span class="k">while</span> <span class="n">current_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2112"><a href="#GuacamoleDB-2112"><span class="linenos">2112</span></a>            <span class="k">if</span> <span class="n">current_parent</span> <span class="o">==</span> <span class="n">group_id</span><span class="p">:</span>
</span><span id="GuacamoleDB-2113"><a href="#GuacamoleDB-2113"><span class="linenos">2113</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-2114"><a href="#GuacamoleDB-2114"><span class="linenos">2114</span></a>
</span><span id="GuacamoleDB-2115"><a href="#GuacamoleDB-2115"><span class="linenos">2115</span></a>            <span class="c1"># Get next parent</span>
</span><span id="GuacamoleDB-2116"><a href="#GuacamoleDB-2116"><span class="linenos">2116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2117"><a href="#GuacamoleDB-2117"><span class="linenos">2117</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2118"><a href="#GuacamoleDB-2118"><span class="linenos">2118</span></a><span class="sd">                SELECT parent_id </span>
</span><span id="GuacamoleDB-2119"><a href="#GuacamoleDB-2119"><span class="linenos">2119</span></a><span class="sd">                FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-2120"><a href="#GuacamoleDB-2120"><span class="linenos">2120</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB-2121"><a href="#GuacamoleDB-2121"><span class="linenos">2121</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2122"><a href="#GuacamoleDB-2122"><span class="linenos">2122</span></a>                <span class="p">(</span><span class="n">current_parent</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2123"><a href="#GuacamoleDB-2123"><span class="linenos">2123</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2124"><a href="#GuacamoleDB-2124"><span class="linenos">2124</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2125"><a href="#GuacamoleDB-2125"><span class="linenos">2125</span></a>            <span class="n">current_parent</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2126"><a href="#GuacamoleDB-2126"><span class="linenos">2126</span></a>
</span><span id="GuacamoleDB-2127"><a href="#GuacamoleDB-2127"><span class="linenos">2127</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="GuacamoleDB-2128"><a href="#GuacamoleDB-2128"><span class="linenos">2128</span></a>
</span><span id="GuacamoleDB-2129"><a href="#GuacamoleDB-2129"><span class="linenos">2129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_connection_group</span><span class="p">(</span>
</span><span id="GuacamoleDB-2130"><a href="#GuacamoleDB-2130"><span class="linenos">2130</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent_group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2131"><a href="#GuacamoleDB-2131"><span class="linenos">2131</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-2132"><a href="#GuacamoleDB-2132"><span class="linenos">2132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new connection group in the Guacamole database.</span>
</span><span id="GuacamoleDB-2133"><a href="#GuacamoleDB-2133"><span class="linenos">2133</span></a>
</span><span id="GuacamoleDB-2134"><a href="#GuacamoleDB-2134"><span class="linenos">2134</span></a><span class="sd">        Creates a new connection group with the specified name and optionally</span>
</span><span id="GuacamoleDB-2135"><a href="#GuacamoleDB-2135"><span class="linenos">2135</span></a><span class="sd">        assigns it to a parent group to establish a hierarchical structure.</span>
</span><span id="GuacamoleDB-2136"><a href="#GuacamoleDB-2136"><span class="linenos">2136</span></a>
</span><span id="GuacamoleDB-2137"><a href="#GuacamoleDB-2137"><span class="linenos">2137</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-2138"><a href="#GuacamoleDB-2138"><span class="linenos">2138</span></a><span class="sd">            group_name: Name for the new connection group.</span>
</span><span id="GuacamoleDB-2139"><a href="#GuacamoleDB-2139"><span class="linenos">2139</span></a><span class="sd">            parent_group_name: Optional name of the parent connection group.</span>
</span><span id="GuacamoleDB-2140"><a href="#GuacamoleDB-2140"><span class="linenos">2140</span></a><span class="sd">                              If None, the group will be created at the root level.</span>
</span><span id="GuacamoleDB-2141"><a href="#GuacamoleDB-2141"><span class="linenos">2141</span></a>
</span><span id="GuacamoleDB-2142"><a href="#GuacamoleDB-2142"><span class="linenos">2142</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2143"><a href="#GuacamoleDB-2143"><span class="linenos">2143</span></a><span class="sd">            True if the connection group was created successfully.</span>
</span><span id="GuacamoleDB-2144"><a href="#GuacamoleDB-2144"><span class="linenos">2144</span></a>
</span><span id="GuacamoleDB-2145"><a href="#GuacamoleDB-2145"><span class="linenos">2145</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2146"><a href="#GuacamoleDB-2146"><span class="linenos">2146</span></a><span class="sd">            ValueError: If group name is invalid, parent group doesn&#39;t exist,</span>
</span><span id="GuacamoleDB-2147"><a href="#GuacamoleDB-2147"><span class="linenos">2147</span></a><span class="sd">                       or would create a cycle in the hierarchy.</span>
</span><span id="GuacamoleDB-2148"><a href="#GuacamoleDB-2148"><span class="linenos">2148</span></a><span class="sd">            mysql.connector.Error: If database operation fails.</span>
</span><span id="GuacamoleDB-2149"><a href="#GuacamoleDB-2149"><span class="linenos">2149</span></a>
</span><span id="GuacamoleDB-2150"><a href="#GuacamoleDB-2150"><span class="linenos">2150</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2151"><a href="#GuacamoleDB-2151"><span class="linenos">2151</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-2152"><a href="#GuacamoleDB-2152"><span class="linenos">2152</span></a><span class="sd">            ...     # Create root-level group</span>
</span><span id="GuacamoleDB-2153"><a href="#GuacamoleDB-2153"><span class="linenos">2153</span></a><span class="sd">            ...     db.create_connection_group(&quot;Production Servers&quot;)</span>
</span><span id="GuacamoleDB-2154"><a href="#GuacamoleDB-2154"><span class="linenos">2154</span></a><span class="sd">            ...     # Create child group</span>
</span><span id="GuacamoleDB-2155"><a href="#GuacamoleDB-2155"><span class="linenos">2155</span></a><span class="sd">            ...     db.create_connection_group(&quot;Web Servers&quot;, &quot;Production Servers&quot;)</span>
</span><span id="GuacamoleDB-2156"><a href="#GuacamoleDB-2156"><span class="linenos">2156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2157"><a href="#GuacamoleDB-2157"><span class="linenos">2157</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2158"><a href="#GuacamoleDB-2158"><span class="linenos">2158</span></a>            <span class="n">parent_group_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2159"><a href="#GuacamoleDB-2159"><span class="linenos">2159</span></a>            <span class="k">if</span> <span class="n">parent_group_name</span><span class="p">:</span>
</span><span id="GuacamoleDB-2160"><a href="#GuacamoleDB-2160"><span class="linenos">2160</span></a>                <span class="c1"># Get parent group ID if specified</span>
</span><span id="GuacamoleDB-2161"><a href="#GuacamoleDB-2161"><span class="linenos">2161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2162"><a href="#GuacamoleDB-2162"><span class="linenos">2162</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2163"><a href="#GuacamoleDB-2163"><span class="linenos">2163</span></a><span class="sd">                    SELECT connection_group_id </span>
</span><span id="GuacamoleDB-2164"><a href="#GuacamoleDB-2164"><span class="linenos">2164</span></a><span class="sd">                    FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-2165"><a href="#GuacamoleDB-2165"><span class="linenos">2165</span></a><span class="sd">                    WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB-2166"><a href="#GuacamoleDB-2166"><span class="linenos">2166</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2167"><a href="#GuacamoleDB-2167"><span class="linenos">2167</span></a>                    <span class="p">(</span><span class="n">parent_group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2168"><a href="#GuacamoleDB-2168"><span class="linenos">2168</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2169"><a href="#GuacamoleDB-2169"><span class="linenos">2169</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2170"><a href="#GuacamoleDB-2170"><span class="linenos">2170</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2171"><a href="#GuacamoleDB-2171"><span class="linenos">2171</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2172"><a href="#GuacamoleDB-2172"><span class="linenos">2172</span></a>                        <span class="sa">f</span><span class="s2">&quot;Parent connection group &#39;</span><span class="si">{</span><span class="n">parent_group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="GuacamoleDB-2173"><a href="#GuacamoleDB-2173"><span class="linenos">2173</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-2174"><a href="#GuacamoleDB-2174"><span class="linenos">2174</span></a>                <span class="n">parent_group_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2175"><a href="#GuacamoleDB-2175"><span class="linenos">2175</span></a>
</span><span id="GuacamoleDB-2176"><a href="#GuacamoleDB-2176"><span class="linenos">2176</span></a>                <span class="c1"># Check for cycles - since this is a new group, we can&#39;t be creating a cycle</span>
</span><span id="GuacamoleDB-2177"><a href="#GuacamoleDB-2177"><span class="linenos">2177</span></a>                <span class="c1"># but we should still validate the parent exists and is valid</span>
</span><span id="GuacamoleDB-2178"><a href="#GuacamoleDB-2178"><span class="linenos">2178</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection_group_cycle</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent_group_id</span><span class="p">):</span>
</span><span id="GuacamoleDB-2179"><a href="#GuacamoleDB-2179"><span class="linenos">2179</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2180"><a href="#GuacamoleDB-2180"><span class="linenos">2180</span></a>                        <span class="sa">f</span><span class="s2">&quot;Parent connection group &#39;</span><span class="si">{</span><span class="n">parent_group_name</span><span class="si">}</span><span class="s2">&#39; is invalid&quot;</span>
</span><span id="GuacamoleDB-2181"><a href="#GuacamoleDB-2181"><span class="linenos">2181</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-2182"><a href="#GuacamoleDB-2182"><span class="linenos">2182</span></a>
</span><span id="GuacamoleDB-2183"><a href="#GuacamoleDB-2183"><span class="linenos">2183</span></a>            <span class="c1"># Create the new connection group</span>
</span><span id="GuacamoleDB-2184"><a href="#GuacamoleDB-2184"><span class="linenos">2184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2185"><a href="#GuacamoleDB-2185"><span class="linenos">2185</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2186"><a href="#GuacamoleDB-2186"><span class="linenos">2186</span></a><span class="sd">                INSERT INTO guacamole_connection_group </span>
</span><span id="GuacamoleDB-2187"><a href="#GuacamoleDB-2187"><span class="linenos">2187</span></a><span class="sd">                (connection_group_name, parent_id)</span>
</span><span id="GuacamoleDB-2188"><a href="#GuacamoleDB-2188"><span class="linenos">2188</span></a><span class="sd">                VALUES (%s, %s)</span>
</span><span id="GuacamoleDB-2189"><a href="#GuacamoleDB-2189"><span class="linenos">2189</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2190"><a href="#GuacamoleDB-2190"><span class="linenos">2190</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">parent_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2191"><a href="#GuacamoleDB-2191"><span class="linenos">2191</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2192"><a href="#GuacamoleDB-2192"><span class="linenos">2192</span></a>
</span><span id="GuacamoleDB-2193"><a href="#GuacamoleDB-2193"><span class="linenos">2193</span></a>            <span class="c1"># Verify the group was created</span>
</span><span id="GuacamoleDB-2194"><a href="#GuacamoleDB-2194"><span class="linenos">2194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2195"><a href="#GuacamoleDB-2195"><span class="linenos">2195</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2196"><a href="#GuacamoleDB-2196"><span class="linenos">2196</span></a><span class="sd">                SELECT connection_group_id </span>
</span><span id="GuacamoleDB-2197"><a href="#GuacamoleDB-2197"><span class="linenos">2197</span></a><span class="sd">                FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-2198"><a href="#GuacamoleDB-2198"><span class="linenos">2198</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB-2199"><a href="#GuacamoleDB-2199"><span class="linenos">2199</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2200"><a href="#GuacamoleDB-2200"><span class="linenos">2200</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2201"><a href="#GuacamoleDB-2201"><span class="linenos">2201</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2202"><a href="#GuacamoleDB-2202"><span class="linenos">2202</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB-2203"><a href="#GuacamoleDB-2203"><span class="linenos">2203</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed to create connection group - no ID returned&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2204"><a href="#GuacamoleDB-2204"><span class="linenos">2204</span></a>
</span><span id="GuacamoleDB-2205"><a href="#GuacamoleDB-2205"><span class="linenos">2205</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-2206"><a href="#GuacamoleDB-2206"><span class="linenos">2206</span></a>
</span><span id="GuacamoleDB-2207"><a href="#GuacamoleDB-2207"><span class="linenos">2207</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2208"><a href="#GuacamoleDB-2208"><span class="linenos">2208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating connection group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2209"><a href="#GuacamoleDB-2209"><span class="linenos">2209</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2210"><a href="#GuacamoleDB-2210"><span class="linenos">2210</span></a>
</span><span id="GuacamoleDB-2211"><a href="#GuacamoleDB-2211"><span class="linenos">2211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_permission_to_user</span><span class="p">(</span>
</span><span id="GuacamoleDB-2212"><a href="#GuacamoleDB-2212"><span class="linenos">2212</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB-2213"><a href="#GuacamoleDB-2213"><span class="linenos">2213</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-2214"><a href="#GuacamoleDB-2214"><span class="linenos">2214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Grant connection permission to a specific user&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2215"><a href="#GuacamoleDB-2215"><span class="linenos">2215</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2216"><a href="#GuacamoleDB-2216"><span class="linenos">2216</span></a>            <span class="c1"># Get connection ID</span>
</span><span id="GuacamoleDB-2217"><a href="#GuacamoleDB-2217"><span class="linenos">2217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2218"><a href="#GuacamoleDB-2218"><span class="linenos">2218</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2219"><a href="#GuacamoleDB-2219"><span class="linenos">2219</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB-2220"><a href="#GuacamoleDB-2220"><span class="linenos">2220</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB-2221"><a href="#GuacamoleDB-2221"><span class="linenos">2221</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2222"><a href="#GuacamoleDB-2222"><span class="linenos">2222</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2223"><a href="#GuacamoleDB-2223"><span class="linenos">2223</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2224"><a href="#GuacamoleDB-2224"><span class="linenos">2224</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2225"><a href="#GuacamoleDB-2225"><span class="linenos">2225</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2226"><a href="#GuacamoleDB-2226"><span class="linenos">2226</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2227"><a href="#GuacamoleDB-2227"><span class="linenos">2227</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2228"><a href="#GuacamoleDB-2228"><span class="linenos">2228</span></a>
</span><span id="GuacamoleDB-2229"><a href="#GuacamoleDB-2229"><span class="linenos">2229</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB-2230"><a href="#GuacamoleDB-2230"><span class="linenos">2230</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2231"><a href="#GuacamoleDB-2231"><span class="linenos">2231</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2232"><a href="#GuacamoleDB-2232"><span class="linenos">2232</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-2233"><a href="#GuacamoleDB-2233"><span class="linenos">2233</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-2234"><a href="#GuacamoleDB-2234"><span class="linenos">2234</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2235"><a href="#GuacamoleDB-2235"><span class="linenos">2235</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2236"><a href="#GuacamoleDB-2236"><span class="linenos">2236</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2237"><a href="#GuacamoleDB-2237"><span class="linenos">2237</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2238"><a href="#GuacamoleDB-2238"><span class="linenos">2238</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2239"><a href="#GuacamoleDB-2239"><span class="linenos">2239</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2240"><a href="#GuacamoleDB-2240"><span class="linenos">2240</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2241"><a href="#GuacamoleDB-2241"><span class="linenos">2241</span></a>
</span><span id="GuacamoleDB-2242"><a href="#GuacamoleDB-2242"><span class="linenos">2242</span></a>            <span class="c1"># Check if permission already exists</span>
</span><span id="GuacamoleDB-2243"><a href="#GuacamoleDB-2243"><span class="linenos">2243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2244"><a href="#GuacamoleDB-2244"><span class="linenos">2244</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2245"><a href="#GuacamoleDB-2245"><span class="linenos">2245</span></a><span class="sd">                SELECT 1 FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB-2246"><a href="#GuacamoleDB-2246"><span class="linenos">2246</span></a><span class="sd">                WHERE entity_id = %s AND connection_id = %s</span>
</span><span id="GuacamoleDB-2247"><a href="#GuacamoleDB-2247"><span class="linenos">2247</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2248"><a href="#GuacamoleDB-2248"><span class="linenos">2248</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2249"><a href="#GuacamoleDB-2249"><span class="linenos">2249</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2250"><a href="#GuacamoleDB-2250"><span class="linenos">2250</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB-2251"><a href="#GuacamoleDB-2251"><span class="linenos">2251</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2252"><a href="#GuacamoleDB-2252"><span class="linenos">2252</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; already has permission for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2253"><a href="#GuacamoleDB-2253"><span class="linenos">2253</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2254"><a href="#GuacamoleDB-2254"><span class="linenos">2254</span></a>
</span><span id="GuacamoleDB-2255"><a href="#GuacamoleDB-2255"><span class="linenos">2255</span></a>            <span class="c1"># Grant permission</span>
</span><span id="GuacamoleDB-2256"><a href="#GuacamoleDB-2256"><span class="linenos">2256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2257"><a href="#GuacamoleDB-2257"><span class="linenos">2257</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2258"><a href="#GuacamoleDB-2258"><span class="linenos">2258</span></a><span class="sd">                INSERT INTO guacamole_connection_permission</span>
</span><span id="GuacamoleDB-2259"><a href="#GuacamoleDB-2259"><span class="linenos">2259</span></a><span class="sd">                (entity_id, connection_id, permission)</span>
</span><span id="GuacamoleDB-2260"><a href="#GuacamoleDB-2260"><span class="linenos">2260</span></a><span class="sd">                VALUES (%s, %s, &#39;READ&#39;)</span>
</span><span id="GuacamoleDB-2261"><a href="#GuacamoleDB-2261"><span class="linenos">2261</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2262"><a href="#GuacamoleDB-2262"><span class="linenos">2262</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2263"><a href="#GuacamoleDB-2263"><span class="linenos">2263</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2264"><a href="#GuacamoleDB-2264"><span class="linenos">2264</span></a>
</span><span id="GuacamoleDB-2265"><a href="#GuacamoleDB-2265"><span class="linenos">2265</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-2266"><a href="#GuacamoleDB-2266"><span class="linenos">2266</span></a>
</span><span id="GuacamoleDB-2267"><a href="#GuacamoleDB-2267"><span class="linenos">2267</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2268"><a href="#GuacamoleDB-2268"><span class="linenos">2268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error granting connection permission: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2269"><a href="#GuacamoleDB-2269"><span class="linenos">2269</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2270"><a href="#GuacamoleDB-2270"><span class="linenos">2270</span></a>
</span><span id="GuacamoleDB-2271"><a href="#GuacamoleDB-2271"><span class="linenos">2271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_connection_permission_from_user</span><span class="p">(</span>
</span><span id="GuacamoleDB-2272"><a href="#GuacamoleDB-2272"><span class="linenos">2272</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB-2273"><a href="#GuacamoleDB-2273"><span class="linenos">2273</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-2274"><a href="#GuacamoleDB-2274"><span class="linenos">2274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke connection permission from a specific user&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2275"><a href="#GuacamoleDB-2275"><span class="linenos">2275</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2276"><a href="#GuacamoleDB-2276"><span class="linenos">2276</span></a>            <span class="c1"># Get connection ID</span>
</span><span id="GuacamoleDB-2277"><a href="#GuacamoleDB-2277"><span class="linenos">2277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2278"><a href="#GuacamoleDB-2278"><span class="linenos">2278</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2279"><a href="#GuacamoleDB-2279"><span class="linenos">2279</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB-2280"><a href="#GuacamoleDB-2280"><span class="linenos">2280</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB-2281"><a href="#GuacamoleDB-2281"><span class="linenos">2281</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2282"><a href="#GuacamoleDB-2282"><span class="linenos">2282</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2283"><a href="#GuacamoleDB-2283"><span class="linenos">2283</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2284"><a href="#GuacamoleDB-2284"><span class="linenos">2284</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2285"><a href="#GuacamoleDB-2285"><span class="linenos">2285</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2286"><a href="#GuacamoleDB-2286"><span class="linenos">2286</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2287"><a href="#GuacamoleDB-2287"><span class="linenos">2287</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2288"><a href="#GuacamoleDB-2288"><span class="linenos">2288</span></a>
</span><span id="GuacamoleDB-2289"><a href="#GuacamoleDB-2289"><span class="linenos">2289</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB-2290"><a href="#GuacamoleDB-2290"><span class="linenos">2290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2291"><a href="#GuacamoleDB-2291"><span class="linenos">2291</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2292"><a href="#GuacamoleDB-2292"><span class="linenos">2292</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB-2293"><a href="#GuacamoleDB-2293"><span class="linenos">2293</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-2294"><a href="#GuacamoleDB-2294"><span class="linenos">2294</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2295"><a href="#GuacamoleDB-2295"><span class="linenos">2295</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2296"><a href="#GuacamoleDB-2296"><span class="linenos">2296</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2297"><a href="#GuacamoleDB-2297"><span class="linenos">2297</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2298"><a href="#GuacamoleDB-2298"><span class="linenos">2298</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2299"><a href="#GuacamoleDB-2299"><span class="linenos">2299</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2300"><a href="#GuacamoleDB-2300"><span class="linenos">2300</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2301"><a href="#GuacamoleDB-2301"><span class="linenos">2301</span></a>
</span><span id="GuacamoleDB-2302"><a href="#GuacamoleDB-2302"><span class="linenos">2302</span></a>            <span class="c1"># Check if permission exists</span>
</span><span id="GuacamoleDB-2303"><a href="#GuacamoleDB-2303"><span class="linenos">2303</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2304"><a href="#GuacamoleDB-2304"><span class="linenos">2304</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2305"><a href="#GuacamoleDB-2305"><span class="linenos">2305</span></a><span class="sd">                SELECT 1 FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB-2306"><a href="#GuacamoleDB-2306"><span class="linenos">2306</span></a><span class="sd">                WHERE entity_id = %s AND connection_id = %s</span>
</span><span id="GuacamoleDB-2307"><a href="#GuacamoleDB-2307"><span class="linenos">2307</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2308"><a href="#GuacamoleDB-2308"><span class="linenos">2308</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2309"><a href="#GuacamoleDB-2309"><span class="linenos">2309</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2310"><a href="#GuacamoleDB-2310"><span class="linenos">2310</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB-2311"><a href="#GuacamoleDB-2311"><span class="linenos">2311</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2312"><a href="#GuacamoleDB-2312"><span class="linenos">2312</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; has no permission for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2313"><a href="#GuacamoleDB-2313"><span class="linenos">2313</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2314"><a href="#GuacamoleDB-2314"><span class="linenos">2314</span></a>
</span><span id="GuacamoleDB-2315"><a href="#GuacamoleDB-2315"><span class="linenos">2315</span></a>            <span class="c1"># Revoke permission</span>
</span><span id="GuacamoleDB-2316"><a href="#GuacamoleDB-2316"><span class="linenos">2316</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2317"><a href="#GuacamoleDB-2317"><span class="linenos">2317</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2318"><a href="#GuacamoleDB-2318"><span class="linenos">2318</span></a><span class="sd">                DELETE FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB-2319"><a href="#GuacamoleDB-2319"><span class="linenos">2319</span></a><span class="sd">                WHERE entity_id = %s AND connection_id = %s</span>
</span><span id="GuacamoleDB-2320"><a href="#GuacamoleDB-2320"><span class="linenos">2320</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2321"><a href="#GuacamoleDB-2321"><span class="linenos">2321</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2322"><a href="#GuacamoleDB-2322"><span class="linenos">2322</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2323"><a href="#GuacamoleDB-2323"><span class="linenos">2323</span></a>
</span><span id="GuacamoleDB-2324"><a href="#GuacamoleDB-2324"><span class="linenos">2324</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-2325"><a href="#GuacamoleDB-2325"><span class="linenos">2325</span></a>
</span><span id="GuacamoleDB-2326"><a href="#GuacamoleDB-2326"><span class="linenos">2326</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2327"><a href="#GuacamoleDB-2327"><span class="linenos">2327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error revoking connection permission: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2328"><a href="#GuacamoleDB-2328"><span class="linenos">2328</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2329"><a href="#GuacamoleDB-2329"><span class="linenos">2329</span></a>
</span><span id="GuacamoleDB-2330"><a href="#GuacamoleDB-2330"><span class="linenos">2330</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_connection_group_parent</span><span class="p">(</span>
</span><span id="GuacamoleDB-2331"><a href="#GuacamoleDB-2331"><span class="linenos">2331</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB-2332"><a href="#GuacamoleDB-2332"><span class="linenos">2332</span></a>        <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-2333"><a href="#GuacamoleDB-2333"><span class="linenos">2333</span></a>        <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-2334"><a href="#GuacamoleDB-2334"><span class="linenos">2334</span></a>        <span class="n">new_parent_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB-2335"><a href="#GuacamoleDB-2335"><span class="linenos">2335</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-2336"><a href="#GuacamoleDB-2336"><span class="linenos">2336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set parent connection group for a connection group with cycle detection&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2337"><a href="#GuacamoleDB-2337"><span class="linenos">2337</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2338"><a href="#GuacamoleDB-2338"><span class="linenos">2338</span></a>            <span class="c1"># Use resolver to get group_id and validate inputs</span>
</span><span id="GuacamoleDB-2339"><a href="#GuacamoleDB-2339"><span class="linenos">2339</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_conngroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-2340"><a href="#GuacamoleDB-2340"><span class="linenos">2340</span></a>
</span><span id="GuacamoleDB-2341"><a href="#GuacamoleDB-2341"><span class="linenos">2341</span></a>            <span class="c1"># Get group name for error messages if we only have ID</span>
</span><span id="GuacamoleDB-2342"><a href="#GuacamoleDB-2342"><span class="linenos">2342</span></a>            <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2343"><a href="#GuacamoleDB-2343"><span class="linenos">2343</span></a>                <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_name_by_id</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB-2344"><a href="#GuacamoleDB-2344"><span class="linenos">2344</span></a>
</span><span id="GuacamoleDB-2345"><a href="#GuacamoleDB-2345"><span class="linenos">2345</span></a>            <span class="c1"># Handle NULL parent (empty string)</span>
</span><span id="GuacamoleDB-2346"><a href="#GuacamoleDB-2346"><span class="linenos">2346</span></a>            <span class="n">new_parent_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2347"><a href="#GuacamoleDB-2347"><span class="linenos">2347</span></a>            <span class="k">if</span> <span class="n">new_parent_name</span><span class="p">:</span>
</span><span id="GuacamoleDB-2348"><a href="#GuacamoleDB-2348"><span class="linenos">2348</span></a>                <span class="c1"># Get new parent ID</span>
</span><span id="GuacamoleDB-2349"><a href="#GuacamoleDB-2349"><span class="linenos">2349</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2350"><a href="#GuacamoleDB-2350"><span class="linenos">2350</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2351"><a href="#GuacamoleDB-2351"><span class="linenos">2351</span></a><span class="sd">                    SELECT connection_group_id </span>
</span><span id="GuacamoleDB-2352"><a href="#GuacamoleDB-2352"><span class="linenos">2352</span></a><span class="sd">                    FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-2353"><a href="#GuacamoleDB-2353"><span class="linenos">2353</span></a><span class="sd">                    WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB-2354"><a href="#GuacamoleDB-2354"><span class="linenos">2354</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2355"><a href="#GuacamoleDB-2355"><span class="linenos">2355</span></a>                    <span class="p">(</span><span class="n">new_parent_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2356"><a href="#GuacamoleDB-2356"><span class="linenos">2356</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2357"><a href="#GuacamoleDB-2357"><span class="linenos">2357</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2358"><a href="#GuacamoleDB-2358"><span class="linenos">2358</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2359"><a href="#GuacamoleDB-2359"><span class="linenos">2359</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2360"><a href="#GuacamoleDB-2360"><span class="linenos">2360</span></a>                        <span class="sa">f</span><span class="s2">&quot;Parent connection group &#39;</span><span class="si">{</span><span class="n">new_parent_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="GuacamoleDB-2361"><a href="#GuacamoleDB-2361"><span class="linenos">2361</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-2362"><a href="#GuacamoleDB-2362"><span class="linenos">2362</span></a>                <span class="n">new_parent_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2363"><a href="#GuacamoleDB-2363"><span class="linenos">2363</span></a>
</span><span id="GuacamoleDB-2364"><a href="#GuacamoleDB-2364"><span class="linenos">2364</span></a>                <span class="c1"># Check for cycles using helper method</span>
</span><span id="GuacamoleDB-2365"><a href="#GuacamoleDB-2365"><span class="linenos">2365</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection_group_cycle</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,</span> <span class="n">new_parent_id</span><span class="p">):</span>
</span><span id="GuacamoleDB-2366"><a href="#GuacamoleDB-2366"><span class="linenos">2366</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2367"><a href="#GuacamoleDB-2367"><span class="linenos">2367</span></a>                        <span class="sa">f</span><span class="s2">&quot;Setting parent would create a cycle in connection groups&quot;</span>
</span><span id="GuacamoleDB-2368"><a href="#GuacamoleDB-2368"><span class="linenos">2368</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-2369"><a href="#GuacamoleDB-2369"><span class="linenos">2369</span></a>
</span><span id="GuacamoleDB-2370"><a href="#GuacamoleDB-2370"><span class="linenos">2370</span></a>            <span class="c1"># Update the parent</span>
</span><span id="GuacamoleDB-2371"><a href="#GuacamoleDB-2371"><span class="linenos">2371</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2372"><a href="#GuacamoleDB-2372"><span class="linenos">2372</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2373"><a href="#GuacamoleDB-2373"><span class="linenos">2373</span></a><span class="sd">                UPDATE guacamole_connection_group</span>
</span><span id="GuacamoleDB-2374"><a href="#GuacamoleDB-2374"><span class="linenos">2374</span></a><span class="sd">                SET parent_id = %s</span>
</span><span id="GuacamoleDB-2375"><a href="#GuacamoleDB-2375"><span class="linenos">2375</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB-2376"><a href="#GuacamoleDB-2376"><span class="linenos">2376</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2377"><a href="#GuacamoleDB-2377"><span class="linenos">2377</span></a>                <span class="p">(</span><span class="n">new_parent_id</span><span class="p">,</span> <span class="n">resolved_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2378"><a href="#GuacamoleDB-2378"><span class="linenos">2378</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2379"><a href="#GuacamoleDB-2379"><span class="linenos">2379</span></a>
</span><span id="GuacamoleDB-2380"><a href="#GuacamoleDB-2380"><span class="linenos">2380</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-2381"><a href="#GuacamoleDB-2381"><span class="linenos">2381</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update parent group for &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2382"><a href="#GuacamoleDB-2382"><span class="linenos">2382</span></a>
</span><span id="GuacamoleDB-2383"><a href="#GuacamoleDB-2383"><span class="linenos">2383</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-2384"><a href="#GuacamoleDB-2384"><span class="linenos">2384</span></a>
</span><span id="GuacamoleDB-2385"><a href="#GuacamoleDB-2385"><span class="linenos">2385</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2386"><a href="#GuacamoleDB-2386"><span class="linenos">2386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying connection group parent: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2387"><a href="#GuacamoleDB-2387"><span class="linenos">2387</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2388"><a href="#GuacamoleDB-2388"><span class="linenos">2388</span></a>
</span><span id="GuacamoleDB-2389"><a href="#GuacamoleDB-2389"><span class="linenos">2389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_connection_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]:</span>
</span><span id="GuacamoleDB-2390"><a href="#GuacamoleDB-2390"><span class="linenos">2390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all connection groups with their connections and parent groups&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2391"><a href="#GuacamoleDB-2391"><span class="linenos">2391</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2392"><a href="#GuacamoleDB-2392"><span class="linenos">2392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2393"><a href="#GuacamoleDB-2393"><span class="linenos">2393</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2394"><a href="#GuacamoleDB-2394"><span class="linenos">2394</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB-2395"><a href="#GuacamoleDB-2395"><span class="linenos">2395</span></a><span class="sd">                    cg.connection_group_id,</span>
</span><span id="GuacamoleDB-2396"><a href="#GuacamoleDB-2396"><span class="linenos">2396</span></a><span class="sd">                    cg.connection_group_name,</span>
</span><span id="GuacamoleDB-2397"><a href="#GuacamoleDB-2397"><span class="linenos">2397</span></a><span class="sd">                    cg.parent_id,</span>
</span><span id="GuacamoleDB-2398"><a href="#GuacamoleDB-2398"><span class="linenos">2398</span></a><span class="sd">                    p.connection_group_name as parent_name,</span>
</span><span id="GuacamoleDB-2399"><a href="#GuacamoleDB-2399"><span class="linenos">2399</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT c.connection_name) as connections</span>
</span><span id="GuacamoleDB-2400"><a href="#GuacamoleDB-2400"><span class="linenos">2400</span></a><span class="sd">                FROM guacamole_connection_group cg</span>
</span><span id="GuacamoleDB-2401"><a href="#GuacamoleDB-2401"><span class="linenos">2401</span></a><span class="sd">                LEFT JOIN guacamole_connection_group p ON cg.parent_id = p.connection_group_id</span>
</span><span id="GuacamoleDB-2402"><a href="#GuacamoleDB-2402"><span class="linenos">2402</span></a><span class="sd">                LEFT JOIN guacamole_connection c ON cg.connection_group_id = c.parent_id</span>
</span><span id="GuacamoleDB-2403"><a href="#GuacamoleDB-2403"><span class="linenos">2403</span></a><span class="sd">                GROUP BY cg.connection_group_id</span>
</span><span id="GuacamoleDB-2404"><a href="#GuacamoleDB-2404"><span class="linenos">2404</span></a><span class="sd">                ORDER BY cg.connection_group_name</span>
</span><span id="GuacamoleDB-2405"><a href="#GuacamoleDB-2405"><span class="linenos">2405</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2406"><a href="#GuacamoleDB-2406"><span class="linenos">2406</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2407"><a href="#GuacamoleDB-2407"><span class="linenos">2407</span></a>
</span><span id="GuacamoleDB-2408"><a href="#GuacamoleDB-2408"><span class="linenos">2408</span></a>            <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB-2409"><a href="#GuacamoleDB-2409"><span class="linenos">2409</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
</span><span id="GuacamoleDB-2410"><a href="#GuacamoleDB-2410"><span class="linenos">2410</span></a>                <span class="n">group_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2411"><a href="#GuacamoleDB-2411"><span class="linenos">2411</span></a>                <span class="n">group_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GuacamoleDB-2412"><a href="#GuacamoleDB-2412"><span class="linenos">2412</span></a>                <span class="n">parent_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="GuacamoleDB-2413"><a href="#GuacamoleDB-2413"><span class="linenos">2413</span></a>                <span class="n">parent_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="GuacamoleDB-2414"><a href="#GuacamoleDB-2414"><span class="linenos">2414</span></a>                <span class="n">connections</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-2415"><a href="#GuacamoleDB-2415"><span class="linenos">2415</span></a>
</span><span id="GuacamoleDB-2416"><a href="#GuacamoleDB-2416"><span class="linenos">2416</span></a>                <span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB-2417"><a href="#GuacamoleDB-2417"><span class="linenos">2417</span></a>                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="GuacamoleDB-2418"><a href="#GuacamoleDB-2418"><span class="linenos">2418</span></a>                    <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">parent_name</span> <span class="k">if</span> <span class="n">parent_name</span> <span class="k">else</span> <span class="s2">&quot;ROOT&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2419"><a href="#GuacamoleDB-2419"><span class="linenos">2419</span></a>                    <span class="s2">&quot;connections&quot;</span><span class="p">:</span> <span class="n">connections</span><span class="p">,</span>
</span><span id="GuacamoleDB-2420"><a href="#GuacamoleDB-2420"><span class="linenos">2420</span></a>                <span class="p">}</span>
</span><span id="GuacamoleDB-2421"><a href="#GuacamoleDB-2421"><span class="linenos">2421</span></a>            <span class="k">return</span> <span class="n">groups</span>
</span><span id="GuacamoleDB-2422"><a href="#GuacamoleDB-2422"><span class="linenos">2422</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2423"><a href="#GuacamoleDB-2423"><span class="linenos">2423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing groups: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2424"><a href="#GuacamoleDB-2424"><span class="linenos">2424</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2425"><a href="#GuacamoleDB-2425"><span class="linenos">2425</span></a>
</span><span id="GuacamoleDB-2426"><a href="#GuacamoleDB-2426"><span class="linenos">2426</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_by_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-2427"><a href="#GuacamoleDB-2427"><span class="linenos">2427</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GuacamoleDB-2428"><a href="#GuacamoleDB-2428"><span class="linenos">2428</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]]:</span>
</span><span id="GuacamoleDB-2429"><a href="#GuacamoleDB-2429"><span class="linenos">2429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a specific connection group by its ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2430"><a href="#GuacamoleDB-2430"><span class="linenos">2430</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2431"><a href="#GuacamoleDB-2431"><span class="linenos">2431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2432"><a href="#GuacamoleDB-2432"><span class="linenos">2432</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2433"><a href="#GuacamoleDB-2433"><span class="linenos">2433</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB-2434"><a href="#GuacamoleDB-2434"><span class="linenos">2434</span></a><span class="sd">                    cg.connection_group_id,</span>
</span><span id="GuacamoleDB-2435"><a href="#GuacamoleDB-2435"><span class="linenos">2435</span></a><span class="sd">                    cg.connection_group_name,</span>
</span><span id="GuacamoleDB-2436"><a href="#GuacamoleDB-2436"><span class="linenos">2436</span></a><span class="sd">                    cg.parent_id,</span>
</span><span id="GuacamoleDB-2437"><a href="#GuacamoleDB-2437"><span class="linenos">2437</span></a><span class="sd">                    p.connection_group_name as parent_name,</span>
</span><span id="GuacamoleDB-2438"><a href="#GuacamoleDB-2438"><span class="linenos">2438</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT c.connection_name) as connections</span>
</span><span id="GuacamoleDB-2439"><a href="#GuacamoleDB-2439"><span class="linenos">2439</span></a><span class="sd">                FROM guacamole_connection_group cg</span>
</span><span id="GuacamoleDB-2440"><a href="#GuacamoleDB-2440"><span class="linenos">2440</span></a><span class="sd">                LEFT JOIN guacamole_connection_group p ON cg.parent_id = p.connection_group_id</span>
</span><span id="GuacamoleDB-2441"><a href="#GuacamoleDB-2441"><span class="linenos">2441</span></a><span class="sd">                LEFT JOIN guacamole_connection c ON cg.connection_group_id = c.parent_id</span>
</span><span id="GuacamoleDB-2442"><a href="#GuacamoleDB-2442"><span class="linenos">2442</span></a><span class="sd">                WHERE cg.connection_group_id = %s</span>
</span><span id="GuacamoleDB-2443"><a href="#GuacamoleDB-2443"><span class="linenos">2443</span></a><span class="sd">                GROUP BY cg.connection_group_id</span>
</span><span id="GuacamoleDB-2444"><a href="#GuacamoleDB-2444"><span class="linenos">2444</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2445"><a href="#GuacamoleDB-2445"><span class="linenos">2445</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2446"><a href="#GuacamoleDB-2446"><span class="linenos">2446</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2447"><a href="#GuacamoleDB-2447"><span class="linenos">2447</span></a>
</span><span id="GuacamoleDB-2448"><a href="#GuacamoleDB-2448"><span class="linenos">2448</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2449"><a href="#GuacamoleDB-2449"><span class="linenos">2449</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="p">:</span>
</span><span id="GuacamoleDB-2450"><a href="#GuacamoleDB-2450"><span class="linenos">2450</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2451"><a href="#GuacamoleDB-2451"><span class="linenos">2451</span></a>
</span><span id="GuacamoleDB-2452"><a href="#GuacamoleDB-2452"><span class="linenos">2452</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2453"><a href="#GuacamoleDB-2453"><span class="linenos">2453</span></a>            <span class="n">group_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GuacamoleDB-2454"><a href="#GuacamoleDB-2454"><span class="linenos">2454</span></a>            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="GuacamoleDB-2455"><a href="#GuacamoleDB-2455"><span class="linenos">2455</span></a>            <span class="n">parent_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="GuacamoleDB-2456"><a href="#GuacamoleDB-2456"><span class="linenos">2456</span></a>            <span class="n">connections</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-2457"><a href="#GuacamoleDB-2457"><span class="linenos">2457</span></a>
</span><span id="GuacamoleDB-2458"><a href="#GuacamoleDB-2458"><span class="linenos">2458</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="GuacamoleDB-2459"><a href="#GuacamoleDB-2459"><span class="linenos">2459</span></a>                <span class="n">group_name</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB-2460"><a href="#GuacamoleDB-2460"><span class="linenos">2460</span></a>                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="GuacamoleDB-2461"><a href="#GuacamoleDB-2461"><span class="linenos">2461</span></a>                    <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">parent_name</span> <span class="k">if</span> <span class="n">parent_name</span> <span class="k">else</span> <span class="s2">&quot;ROOT&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2462"><a href="#GuacamoleDB-2462"><span class="linenos">2462</span></a>                    <span class="s2">&quot;connections&quot;</span><span class="p">:</span> <span class="n">connections</span><span class="p">,</span>
</span><span id="GuacamoleDB-2463"><a href="#GuacamoleDB-2463"><span class="linenos">2463</span></a>                <span class="p">}</span>
</span><span id="GuacamoleDB-2464"><a href="#GuacamoleDB-2464"><span class="linenos">2464</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB-2465"><a href="#GuacamoleDB-2465"><span class="linenos">2465</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2466"><a href="#GuacamoleDB-2466"><span class="linenos">2466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection group by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2467"><a href="#GuacamoleDB-2467"><span class="linenos">2467</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2468"><a href="#GuacamoleDB-2468"><span class="linenos">2468</span></a>
</span><span id="GuacamoleDB-2469"><a href="#GuacamoleDB-2469"><span class="linenos">2469</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB-2470"><a href="#GuacamoleDB-2470"><span class="linenos">2470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get connection name by ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2471"><a href="#GuacamoleDB-2471"><span class="linenos">2471</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2472"><a href="#GuacamoleDB-2472"><span class="linenos">2472</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2473"><a href="#GuacamoleDB-2473"><span class="linenos">2473</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2474"><a href="#GuacamoleDB-2474"><span class="linenos">2474</span></a><span class="sd">                SELECT connection_name </span>
</span><span id="GuacamoleDB-2475"><a href="#GuacamoleDB-2475"><span class="linenos">2475</span></a><span class="sd">                FROM guacamole_connection </span>
</span><span id="GuacamoleDB-2476"><a href="#GuacamoleDB-2476"><span class="linenos">2476</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-2477"><a href="#GuacamoleDB-2477"><span class="linenos">2477</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2478"><a href="#GuacamoleDB-2478"><span class="linenos">2478</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2479"><a href="#GuacamoleDB-2479"><span class="linenos">2479</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2480"><a href="#GuacamoleDB-2480"><span class="linenos">2480</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2481"><a href="#GuacamoleDB-2481"><span class="linenos">2481</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2482"><a href="#GuacamoleDB-2482"><span class="linenos">2482</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2483"><a href="#GuacamoleDB-2483"><span class="linenos">2483</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection name by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2484"><a href="#GuacamoleDB-2484"><span class="linenos">2484</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2485"><a href="#GuacamoleDB-2485"><span class="linenos">2485</span></a>
</span><span id="GuacamoleDB-2486"><a href="#GuacamoleDB-2486"><span class="linenos">2486</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB-2487"><a href="#GuacamoleDB-2487"><span class="linenos">2487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get connection group name by ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2488"><a href="#GuacamoleDB-2488"><span class="linenos">2488</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2489"><a href="#GuacamoleDB-2489"><span class="linenos">2489</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2490"><a href="#GuacamoleDB-2490"><span class="linenos">2490</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2491"><a href="#GuacamoleDB-2491"><span class="linenos">2491</span></a><span class="sd">                SELECT connection_group_name </span>
</span><span id="GuacamoleDB-2492"><a href="#GuacamoleDB-2492"><span class="linenos">2492</span></a><span class="sd">                FROM guacamole_connection_group </span>
</span><span id="GuacamoleDB-2493"><a href="#GuacamoleDB-2493"><span class="linenos">2493</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB-2494"><a href="#GuacamoleDB-2494"><span class="linenos">2494</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2495"><a href="#GuacamoleDB-2495"><span class="linenos">2495</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2496"><a href="#GuacamoleDB-2496"><span class="linenos">2496</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2497"><a href="#GuacamoleDB-2497"><span class="linenos">2497</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2498"><a href="#GuacamoleDB-2498"><span class="linenos">2498</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2499"><a href="#GuacamoleDB-2499"><span class="linenos">2499</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2500"><a href="#GuacamoleDB-2500"><span class="linenos">2500</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection group name by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2501"><a href="#GuacamoleDB-2501"><span class="linenos">2501</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB-2502"><a href="#GuacamoleDB-2502"><span class="linenos">2502</span></a>
</span><span id="GuacamoleDB-2503"><a href="#GuacamoleDB-2503"><span class="linenos">2503</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_positive_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-2504"><a href="#GuacamoleDB-2504"><span class="linenos">2504</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">id_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;entity&quot;</span>
</span><span id="GuacamoleDB-2505"><a href="#GuacamoleDB-2505"><span class="linenos">2505</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="GuacamoleDB-2506"><a href="#GuacamoleDB-2506"><span class="linenos">2506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that ID is a positive integer&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2507"><a href="#GuacamoleDB-2507"><span class="linenos">2507</span></a>        <span class="k">if</span> <span class="n">id_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">id_value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-2508"><a href="#GuacamoleDB-2508"><span class="linenos">2508</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2509"><a href="#GuacamoleDB-2509"><span class="linenos">2509</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2"> ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB-2510"><a href="#GuacamoleDB-2510"><span class="linenos">2510</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2511"><a href="#GuacamoleDB-2511"><span class="linenos">2511</span></a>        <span class="k">return</span> <span class="n">id_value</span>
</span><span id="GuacamoleDB-2512"><a href="#GuacamoleDB-2512"><span class="linenos">2512</span></a>
</span><span id="GuacamoleDB-2513"><a href="#GuacamoleDB-2513"><span class="linenos">2513</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-2514"><a href="#GuacamoleDB-2514"><span class="linenos">2514</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2515"><a href="#GuacamoleDB-2515"><span class="linenos">2515</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB-2516"><a href="#GuacamoleDB-2516"><span class="linenos">2516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs and resolve to connection_id with centralized validation.</span>
</span><span id="GuacamoleDB-2517"><a href="#GuacamoleDB-2517"><span class="linenos">2517</span></a>
</span><span id="GuacamoleDB-2518"><a href="#GuacamoleDB-2518"><span class="linenos">2518</span></a><span class="sd">        This is a core utility method that handles the common pattern of accepting</span>
</span><span id="GuacamoleDB-2519"><a href="#GuacamoleDB-2519"><span class="linenos">2519</span></a><span class="sd">        either a connection name or ID and resolving it to a validated connection ID.</span>
</span><span id="GuacamoleDB-2520"><a href="#GuacamoleDB-2520"><span class="linenos">2520</span></a><span class="sd">        Provides comprehensive input validation and error handling.</span>
</span><span id="GuacamoleDB-2521"><a href="#GuacamoleDB-2521"><span class="linenos">2521</span></a>
</span><span id="GuacamoleDB-2522"><a href="#GuacamoleDB-2522"><span class="linenos">2522</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-2523"><a href="#GuacamoleDB-2523"><span class="linenos">2523</span></a><span class="sd">            connection_name: The connection name to resolve. Optional.</span>
</span><span id="GuacamoleDB-2524"><a href="#GuacamoleDB-2524"><span class="linenos">2524</span></a><span class="sd">            connection_id: The connection ID to validate. Optional.</span>
</span><span id="GuacamoleDB-2525"><a href="#GuacamoleDB-2525"><span class="linenos">2525</span></a>
</span><span id="GuacamoleDB-2526"><a href="#GuacamoleDB-2526"><span class="linenos">2526</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2527"><a href="#GuacamoleDB-2527"><span class="linenos">2527</span></a><span class="sd">            The validated connection ID.</span>
</span><span id="GuacamoleDB-2528"><a href="#GuacamoleDB-2528"><span class="linenos">2528</span></a>
</span><span id="GuacamoleDB-2529"><a href="#GuacamoleDB-2529"><span class="linenos">2529</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2530"><a href="#GuacamoleDB-2530"><span class="linenos">2530</span></a><span class="sd">            ValueError: If neither or both parameters are provided, if ID is invalid,</span>
</span><span id="GuacamoleDB-2531"><a href="#GuacamoleDB-2531"><span class="linenos">2531</span></a><span class="sd">                       if connection doesn&#39;t exist, or if database error occurs.</span>
</span><span id="GuacamoleDB-2532"><a href="#GuacamoleDB-2532"><span class="linenos">2532</span></a>
</span><span id="GuacamoleDB-2533"><a href="#GuacamoleDB-2533"><span class="linenos">2533</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB-2534"><a href="#GuacamoleDB-2534"><span class="linenos">2534</span></a><span class="sd">            Exactly one of connection_name or connection_id must be provided.</span>
</span><span id="GuacamoleDB-2535"><a href="#GuacamoleDB-2535"><span class="linenos">2535</span></a><span class="sd">            This method is used by many other methods for consistent ID resolution.</span>
</span><span id="GuacamoleDB-2536"><a href="#GuacamoleDB-2536"><span class="linenos">2536</span></a>
</span><span id="GuacamoleDB-2537"><a href="#GuacamoleDB-2537"><span class="linenos">2537</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2538"><a href="#GuacamoleDB-2538"><span class="linenos">2538</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-2539"><a href="#GuacamoleDB-2539"><span class="linenos">2539</span></a><span class="sd">            ...     # Resolve by name</span>
</span><span id="GuacamoleDB-2540"><a href="#GuacamoleDB-2540"><span class="linenos">2540</span></a><span class="sd">            ...     conn_id = db.resolve_connection_id(connection_name=&#39;my-server&#39;)</span>
</span><span id="GuacamoleDB-2541"><a href="#GuacamoleDB-2541"><span class="linenos">2541</span></a><span class="sd">            ...     # Resolve by ID (validates existence)</span>
</span><span id="GuacamoleDB-2542"><a href="#GuacamoleDB-2542"><span class="linenos">2542</span></a><span class="sd">            ...     conn_id = db.resolve_connection_id(connection_id=123)</span>
</span><span id="GuacamoleDB-2543"><a href="#GuacamoleDB-2543"><span class="linenos">2543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2544"><a href="#GuacamoleDB-2544"><span class="linenos">2544</span></a>        <span class="c1"># Validate exactly one parameter provided</span>
</span><span id="GuacamoleDB-2545"><a href="#GuacamoleDB-2545"><span class="linenos">2545</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">connection_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">connection_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GuacamoleDB-2546"><a href="#GuacamoleDB-2546"><span class="linenos">2546</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2547"><a href="#GuacamoleDB-2547"><span class="linenos">2547</span></a>                <span class="s2">&quot;Exactly one of connection_name or connection_id must be provided&quot;</span>
</span><span id="GuacamoleDB-2548"><a href="#GuacamoleDB-2548"><span class="linenos">2548</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2549"><a href="#GuacamoleDB-2549"><span class="linenos">2549</span></a>
</span><span id="GuacamoleDB-2550"><a href="#GuacamoleDB-2550"><span class="linenos">2550</span></a>        <span class="c1"># If ID provided, validate and return it</span>
</span><span id="GuacamoleDB-2551"><a href="#GuacamoleDB-2551"><span class="linenos">2551</span></a>        <span class="k">if</span> <span class="n">connection_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2552"><a href="#GuacamoleDB-2552"><span class="linenos">2552</span></a>            <span class="k">if</span> <span class="n">connection_id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-2553"><a href="#GuacamoleDB-2553"><span class="linenos">2553</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2554"><a href="#GuacamoleDB-2554"><span class="linenos">2554</span></a>                    <span class="s2">&quot;Connection ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB-2555"><a href="#GuacamoleDB-2555"><span class="linenos">2555</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2556"><a href="#GuacamoleDB-2556"><span class="linenos">2556</span></a>
</span><span id="GuacamoleDB-2557"><a href="#GuacamoleDB-2557"><span class="linenos">2557</span></a>            <span class="c1"># Verify the connection exists</span>
</span><span id="GuacamoleDB-2558"><a href="#GuacamoleDB-2558"><span class="linenos">2558</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2559"><a href="#GuacamoleDB-2559"><span class="linenos">2559</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2560"><a href="#GuacamoleDB-2560"><span class="linenos">2560</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2561"><a href="#GuacamoleDB-2561"><span class="linenos">2561</span></a><span class="sd">                    SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB-2562"><a href="#GuacamoleDB-2562"><span class="linenos">2562</span></a><span class="sd">                    WHERE connection_id = %s</span>
</span><span id="GuacamoleDB-2563"><a href="#GuacamoleDB-2563"><span class="linenos">2563</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2564"><a href="#GuacamoleDB-2564"><span class="linenos">2564</span></a>                    <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2565"><a href="#GuacamoleDB-2565"><span class="linenos">2565</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2566"><a href="#GuacamoleDB-2566"><span class="linenos">2566</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2567"><a href="#GuacamoleDB-2567"><span class="linenos">2567</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2568"><a href="#GuacamoleDB-2568"><span class="linenos">2568</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection with ID </span><span class="si">{</span><span class="n">connection_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2569"><a href="#GuacamoleDB-2569"><span class="linenos">2569</span></a>                <span class="k">return</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB-2570"><a href="#GuacamoleDB-2570"><span class="linenos">2570</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2571"><a href="#GuacamoleDB-2571"><span class="linenos">2571</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving connection ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2572"><a href="#GuacamoleDB-2572"><span class="linenos">2572</span></a>
</span><span id="GuacamoleDB-2573"><a href="#GuacamoleDB-2573"><span class="linenos">2573</span></a>        <span class="c1"># If name provided, resolve to ID</span>
</span><span id="GuacamoleDB-2574"><a href="#GuacamoleDB-2574"><span class="linenos">2574</span></a>        <span class="k">if</span> <span class="n">connection_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2575"><a href="#GuacamoleDB-2575"><span class="linenos">2575</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2576"><a href="#GuacamoleDB-2576"><span class="linenos">2576</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2577"><a href="#GuacamoleDB-2577"><span class="linenos">2577</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2578"><a href="#GuacamoleDB-2578"><span class="linenos">2578</span></a><span class="sd">                    SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB-2579"><a href="#GuacamoleDB-2579"><span class="linenos">2579</span></a><span class="sd">                    WHERE connection_name = %s</span>
</span><span id="GuacamoleDB-2580"><a href="#GuacamoleDB-2580"><span class="linenos">2580</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2581"><a href="#GuacamoleDB-2581"><span class="linenos">2581</span></a>                    <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2582"><a href="#GuacamoleDB-2582"><span class="linenos">2582</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2583"><a href="#GuacamoleDB-2583"><span class="linenos">2583</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2584"><a href="#GuacamoleDB-2584"><span class="linenos">2584</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2585"><a href="#GuacamoleDB-2585"><span class="linenos">2585</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2586"><a href="#GuacamoleDB-2586"><span class="linenos">2586</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2587"><a href="#GuacamoleDB-2587"><span class="linenos">2587</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2588"><a href="#GuacamoleDB-2588"><span class="linenos">2588</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving connection name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2589"><a href="#GuacamoleDB-2589"><span class="linenos">2589</span></a>
</span><span id="GuacamoleDB-2590"><a href="#GuacamoleDB-2590"><span class="linenos">2590</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_conngroup_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-2591"><a href="#GuacamoleDB-2591"><span class="linenos">2591</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2592"><a href="#GuacamoleDB-2592"><span class="linenos">2592</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB-2593"><a href="#GuacamoleDB-2593"><span class="linenos">2593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs and resolve to connection_group_id with centralized validation&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2594"><a href="#GuacamoleDB-2594"><span class="linenos">2594</span></a>        <span class="c1"># Validate exactly one parameter provided</span>
</span><span id="GuacamoleDB-2595"><a href="#GuacamoleDB-2595"><span class="linenos">2595</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">group_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GuacamoleDB-2596"><a href="#GuacamoleDB-2596"><span class="linenos">2596</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Exactly one of group_name or group_id must be provided&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2597"><a href="#GuacamoleDB-2597"><span class="linenos">2597</span></a>
</span><span id="GuacamoleDB-2598"><a href="#GuacamoleDB-2598"><span class="linenos">2598</span></a>        <span class="c1"># If ID provided, validate and return it</span>
</span><span id="GuacamoleDB-2599"><a href="#GuacamoleDB-2599"><span class="linenos">2599</span></a>        <span class="k">if</span> <span class="n">group_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2600"><a href="#GuacamoleDB-2600"><span class="linenos">2600</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-2601"><a href="#GuacamoleDB-2601"><span class="linenos">2601</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2602"><a href="#GuacamoleDB-2602"><span class="linenos">2602</span></a>                    <span class="s2">&quot;Connection group ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB-2603"><a href="#GuacamoleDB-2603"><span class="linenos">2603</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2604"><a href="#GuacamoleDB-2604"><span class="linenos">2604</span></a>
</span><span id="GuacamoleDB-2605"><a href="#GuacamoleDB-2605"><span class="linenos">2605</span></a>            <span class="c1"># Verify the connection group exists</span>
</span><span id="GuacamoleDB-2606"><a href="#GuacamoleDB-2606"><span class="linenos">2606</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2607"><a href="#GuacamoleDB-2607"><span class="linenos">2607</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2608"><a href="#GuacamoleDB-2608"><span class="linenos">2608</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2609"><a href="#GuacamoleDB-2609"><span class="linenos">2609</span></a><span class="sd">                    SELECT connection_group_id FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-2610"><a href="#GuacamoleDB-2610"><span class="linenos">2610</span></a><span class="sd">                    WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB-2611"><a href="#GuacamoleDB-2611"><span class="linenos">2611</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2612"><a href="#GuacamoleDB-2612"><span class="linenos">2612</span></a>                    <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2613"><a href="#GuacamoleDB-2613"><span class="linenos">2613</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2614"><a href="#GuacamoleDB-2614"><span class="linenos">2614</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2615"><a href="#GuacamoleDB-2615"><span class="linenos">2615</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2616"><a href="#GuacamoleDB-2616"><span class="linenos">2616</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group with ID </span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2617"><a href="#GuacamoleDB-2617"><span class="linenos">2617</span></a>                <span class="k">return</span> <span class="n">group_id</span>
</span><span id="GuacamoleDB-2618"><a href="#GuacamoleDB-2618"><span class="linenos">2618</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2619"><a href="#GuacamoleDB-2619"><span class="linenos">2619</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2620"><a href="#GuacamoleDB-2620"><span class="linenos">2620</span></a>                    <span class="sa">f</span><span class="s2">&quot;Database error while resolving connection group ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-2621"><a href="#GuacamoleDB-2621"><span class="linenos">2621</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2622"><a href="#GuacamoleDB-2622"><span class="linenos">2622</span></a>
</span><span id="GuacamoleDB-2623"><a href="#GuacamoleDB-2623"><span class="linenos">2623</span></a>        <span class="c1"># If name provided, resolve to ID</span>
</span><span id="GuacamoleDB-2624"><a href="#GuacamoleDB-2624"><span class="linenos">2624</span></a>        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2625"><a href="#GuacamoleDB-2625"><span class="linenos">2625</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2626"><a href="#GuacamoleDB-2626"><span class="linenos">2626</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2627"><a href="#GuacamoleDB-2627"><span class="linenos">2627</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2628"><a href="#GuacamoleDB-2628"><span class="linenos">2628</span></a><span class="sd">                    SELECT connection_group_id FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-2629"><a href="#GuacamoleDB-2629"><span class="linenos">2629</span></a><span class="sd">                    WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB-2630"><a href="#GuacamoleDB-2630"><span class="linenos">2630</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2631"><a href="#GuacamoleDB-2631"><span class="linenos">2631</span></a>                    <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2632"><a href="#GuacamoleDB-2632"><span class="linenos">2632</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2633"><a href="#GuacamoleDB-2633"><span class="linenos">2633</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2634"><a href="#GuacamoleDB-2634"><span class="linenos">2634</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2635"><a href="#GuacamoleDB-2635"><span class="linenos">2635</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2636"><a href="#GuacamoleDB-2636"><span class="linenos">2636</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2637"><a href="#GuacamoleDB-2637"><span class="linenos">2637</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2638"><a href="#GuacamoleDB-2638"><span class="linenos">2638</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2639"><a href="#GuacamoleDB-2639"><span class="linenos">2639</span></a>                    <span class="sa">f</span><span class="s2">&quot;Database error while resolving connection group name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-2640"><a href="#GuacamoleDB-2640"><span class="linenos">2640</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2641"><a href="#GuacamoleDB-2641"><span class="linenos">2641</span></a>
</span><span id="GuacamoleDB-2642"><a href="#GuacamoleDB-2642"><span class="linenos">2642</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_usergroup_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-2643"><a href="#GuacamoleDB-2643"><span class="linenos">2643</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2644"><a href="#GuacamoleDB-2644"><span class="linenos">2644</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB-2645"><a href="#GuacamoleDB-2645"><span class="linenos">2645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs and resolve to user_group_id with centralized validation&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2646"><a href="#GuacamoleDB-2646"><span class="linenos">2646</span></a>        <span class="c1"># Validate exactly one parameter provided</span>
</span><span id="GuacamoleDB-2647"><a href="#GuacamoleDB-2647"><span class="linenos">2647</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">group_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GuacamoleDB-2648"><a href="#GuacamoleDB-2648"><span class="linenos">2648</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Exactly one of group_name or group_id must be provided&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2649"><a href="#GuacamoleDB-2649"><span class="linenos">2649</span></a>
</span><span id="GuacamoleDB-2650"><a href="#GuacamoleDB-2650"><span class="linenos">2650</span></a>        <span class="c1"># If ID provided, validate and return it</span>
</span><span id="GuacamoleDB-2651"><a href="#GuacamoleDB-2651"><span class="linenos">2651</span></a>        <span class="k">if</span> <span class="n">group_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2652"><a href="#GuacamoleDB-2652"><span class="linenos">2652</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-2653"><a href="#GuacamoleDB-2653"><span class="linenos">2653</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2654"><a href="#GuacamoleDB-2654"><span class="linenos">2654</span></a>                    <span class="s2">&quot;Usergroup ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB-2655"><a href="#GuacamoleDB-2655"><span class="linenos">2655</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2656"><a href="#GuacamoleDB-2656"><span class="linenos">2656</span></a>
</span><span id="GuacamoleDB-2657"><a href="#GuacamoleDB-2657"><span class="linenos">2657</span></a>            <span class="c1"># Verify the usergroup exists</span>
</span><span id="GuacamoleDB-2658"><a href="#GuacamoleDB-2658"><span class="linenos">2658</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2659"><a href="#GuacamoleDB-2659"><span class="linenos">2659</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2660"><a href="#GuacamoleDB-2660"><span class="linenos">2660</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2661"><a href="#GuacamoleDB-2661"><span class="linenos">2661</span></a><span class="sd">                    SELECT user_group_id FROM guacamole_user_group</span>
</span><span id="GuacamoleDB-2662"><a href="#GuacamoleDB-2662"><span class="linenos">2662</span></a><span class="sd">                    WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB-2663"><a href="#GuacamoleDB-2663"><span class="linenos">2663</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2664"><a href="#GuacamoleDB-2664"><span class="linenos">2664</span></a>                    <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2665"><a href="#GuacamoleDB-2665"><span class="linenos">2665</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2666"><a href="#GuacamoleDB-2666"><span class="linenos">2666</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2667"><a href="#GuacamoleDB-2667"><span class="linenos">2667</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2668"><a href="#GuacamoleDB-2668"><span class="linenos">2668</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup with ID </span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2669"><a href="#GuacamoleDB-2669"><span class="linenos">2669</span></a>                <span class="k">return</span> <span class="n">group_id</span>
</span><span id="GuacamoleDB-2670"><a href="#GuacamoleDB-2670"><span class="linenos">2670</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2671"><a href="#GuacamoleDB-2671"><span class="linenos">2671</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving usergroup ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2672"><a href="#GuacamoleDB-2672"><span class="linenos">2672</span></a>
</span><span id="GuacamoleDB-2673"><a href="#GuacamoleDB-2673"><span class="linenos">2673</span></a>        <span class="c1"># If name provided, resolve to ID</span>
</span><span id="GuacamoleDB-2674"><a href="#GuacamoleDB-2674"><span class="linenos">2674</span></a>        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2675"><a href="#GuacamoleDB-2675"><span class="linenos">2675</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2676"><a href="#GuacamoleDB-2676"><span class="linenos">2676</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2677"><a href="#GuacamoleDB-2677"><span class="linenos">2677</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2678"><a href="#GuacamoleDB-2678"><span class="linenos">2678</span></a><span class="sd">                    SELECT user_group_id FROM guacamole_user_group g</span>
</span><span id="GuacamoleDB-2679"><a href="#GuacamoleDB-2679"><span class="linenos">2679</span></a><span class="sd">                    JOIN guacamole_entity e ON g.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB-2680"><a href="#GuacamoleDB-2680"><span class="linenos">2680</span></a><span class="sd">                    WHERE e.name = %s</span>
</span><span id="GuacamoleDB-2681"><a href="#GuacamoleDB-2681"><span class="linenos">2681</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2682"><a href="#GuacamoleDB-2682"><span class="linenos">2682</span></a>                    <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2683"><a href="#GuacamoleDB-2683"><span class="linenos">2683</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2684"><a href="#GuacamoleDB-2684"><span class="linenos">2684</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2685"><a href="#GuacamoleDB-2685"><span class="linenos">2685</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2686"><a href="#GuacamoleDB-2686"><span class="linenos">2686</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2687"><a href="#GuacamoleDB-2687"><span class="linenos">2687</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2688"><a href="#GuacamoleDB-2688"><span class="linenos">2688</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2689"><a href="#GuacamoleDB-2689"><span class="linenos">2689</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving usergroup name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2690"><a href="#GuacamoleDB-2690"><span class="linenos">2690</span></a>
</span><span id="GuacamoleDB-2691"><a href="#GuacamoleDB-2691"><span class="linenos">2691</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">usergroup_exists_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-2692"><a href="#GuacamoleDB-2692"><span class="linenos">2692</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a usergroup exists by ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2693"><a href="#GuacamoleDB-2693"><span class="linenos">2693</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2694"><a href="#GuacamoleDB-2694"><span class="linenos">2694</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2695"><a href="#GuacamoleDB-2695"><span class="linenos">2695</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2696"><a href="#GuacamoleDB-2696"><span class="linenos">2696</span></a><span class="sd">                SELECT user_group_id FROM guacamole_user_group</span>
</span><span id="GuacamoleDB-2697"><a href="#GuacamoleDB-2697"><span class="linenos">2697</span></a><span class="sd">                WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB-2698"><a href="#GuacamoleDB-2698"><span class="linenos">2698</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2699"><a href="#GuacamoleDB-2699"><span class="linenos">2699</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2700"><a href="#GuacamoleDB-2700"><span class="linenos">2700</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2701"><a href="#GuacamoleDB-2701"><span class="linenos">2701</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-2702"><a href="#GuacamoleDB-2702"><span class="linenos">2702</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2703"><a href="#GuacamoleDB-2703"><span class="linenos">2703</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while checking usergroup existence: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2704"><a href="#GuacamoleDB-2704"><span class="linenos">2704</span></a>
</span><span id="GuacamoleDB-2705"><a href="#GuacamoleDB-2705"><span class="linenos">2705</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_usergroup_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="GuacamoleDB-2706"><a href="#GuacamoleDB-2706"><span class="linenos">2706</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get user group name by its database ID.</span>
</span><span id="GuacamoleDB-2707"><a href="#GuacamoleDB-2707"><span class="linenos">2707</span></a>
</span><span id="GuacamoleDB-2708"><a href="#GuacamoleDB-2708"><span class="linenos">2708</span></a><span class="sd">        Retrieves the name of a user group given its database ID.</span>
</span><span id="GuacamoleDB-2709"><a href="#GuacamoleDB-2709"><span class="linenos">2709</span></a><span class="sd">        This is useful for converting internal IDs back to human-readable names.</span>
</span><span id="GuacamoleDB-2710"><a href="#GuacamoleDB-2710"><span class="linenos">2710</span></a>
</span><span id="GuacamoleDB-2711"><a href="#GuacamoleDB-2711"><span class="linenos">2711</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-2712"><a href="#GuacamoleDB-2712"><span class="linenos">2712</span></a><span class="sd">            group_id: The database ID of the user group.</span>
</span><span id="GuacamoleDB-2713"><a href="#GuacamoleDB-2713"><span class="linenos">2713</span></a>
</span><span id="GuacamoleDB-2714"><a href="#GuacamoleDB-2714"><span class="linenos">2714</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2715"><a href="#GuacamoleDB-2715"><span class="linenos">2715</span></a><span class="sd">            The name of the user group.</span>
</span><span id="GuacamoleDB-2716"><a href="#GuacamoleDB-2716"><span class="linenos">2716</span></a>
</span><span id="GuacamoleDB-2717"><a href="#GuacamoleDB-2717"><span class="linenos">2717</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2718"><a href="#GuacamoleDB-2718"><span class="linenos">2718</span></a><span class="sd">            ValueError: If user group with the specified ID is not found.</span>
</span><span id="GuacamoleDB-2719"><a href="#GuacamoleDB-2719"><span class="linenos">2719</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-2720"><a href="#GuacamoleDB-2720"><span class="linenos">2720</span></a>
</span><span id="GuacamoleDB-2721"><a href="#GuacamoleDB-2721"><span class="linenos">2721</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2722"><a href="#GuacamoleDB-2722"><span class="linenos">2722</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-2723"><a href="#GuacamoleDB-2723"><span class="linenos">2723</span></a><span class="sd">            ...     name = db.get_usergroup_name_by_id(42)</span>
</span><span id="GuacamoleDB-2724"><a href="#GuacamoleDB-2724"><span class="linenos">2724</span></a><span class="sd">            ...     print(f&quot;Group name: {name}&quot;)</span>
</span><span id="GuacamoleDB-2725"><a href="#GuacamoleDB-2725"><span class="linenos">2725</span></a><span class="sd">            Group name: admin-group</span>
</span><span id="GuacamoleDB-2726"><a href="#GuacamoleDB-2726"><span class="linenos">2726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2727"><a href="#GuacamoleDB-2727"><span class="linenos">2727</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2728"><a href="#GuacamoleDB-2728"><span class="linenos">2728</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2729"><a href="#GuacamoleDB-2729"><span class="linenos">2729</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2730"><a href="#GuacamoleDB-2730"><span class="linenos">2730</span></a><span class="sd">                SELECT e.name FROM guacamole_entity e</span>
</span><span id="GuacamoleDB-2731"><a href="#GuacamoleDB-2731"><span class="linenos">2731</span></a><span class="sd">                JOIN guacamole_user_group g ON e.entity_id = g.entity_id</span>
</span><span id="GuacamoleDB-2732"><a href="#GuacamoleDB-2732"><span class="linenos">2732</span></a><span class="sd">                WHERE g.user_group_id = %s</span>
</span><span id="GuacamoleDB-2733"><a href="#GuacamoleDB-2733"><span class="linenos">2733</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2734"><a href="#GuacamoleDB-2734"><span class="linenos">2734</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2735"><a href="#GuacamoleDB-2735"><span class="linenos">2735</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2736"><a href="#GuacamoleDB-2736"><span class="linenos">2736</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2737"><a href="#GuacamoleDB-2737"><span class="linenos">2737</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2738"><a href="#GuacamoleDB-2738"><span class="linenos">2738</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup with ID </span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2739"><a href="#GuacamoleDB-2739"><span class="linenos">2739</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2740"><a href="#GuacamoleDB-2740"><span class="linenos">2740</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2741"><a href="#GuacamoleDB-2741"><span class="linenos">2741</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while getting usergroup name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2742"><a href="#GuacamoleDB-2742"><span class="linenos">2742</span></a>
</span><span id="GuacamoleDB-2743"><a href="#GuacamoleDB-2743"><span class="linenos">2743</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_groups_with_users</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="GuacamoleDB-2744"><a href="#GuacamoleDB-2744"><span class="linenos">2744</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all user groups with their associated users.</span>
</span><span id="GuacamoleDB-2745"><a href="#GuacamoleDB-2745"><span class="linenos">2745</span></a>
</span><span id="GuacamoleDB-2746"><a href="#GuacamoleDB-2746"><span class="linenos">2746</span></a><span class="sd">        Retrieves a mapping of user group names to the list of usernames</span>
</span><span id="GuacamoleDB-2747"><a href="#GuacamoleDB-2747"><span class="linenos">2747</span></a><span class="sd">        that belong to each group. This provides a simplified view of</span>
</span><span id="GuacamoleDB-2748"><a href="#GuacamoleDB-2748"><span class="linenos">2748</span></a><span class="sd">        user group membership.</span>
</span><span id="GuacamoleDB-2749"><a href="#GuacamoleDB-2749"><span class="linenos">2749</span></a>
</span><span id="GuacamoleDB-2750"><a href="#GuacamoleDB-2750"><span class="linenos">2750</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2751"><a href="#GuacamoleDB-2751"><span class="linenos">2751</span></a><span class="sd">            Dict[str, List[str]]: Mapping of group names to lists of usernames.</span>
</span><span id="GuacamoleDB-2752"><a href="#GuacamoleDB-2752"><span class="linenos">2752</span></a><span class="sd">                Groups with no members will have an empty list.</span>
</span><span id="GuacamoleDB-2753"><a href="#GuacamoleDB-2753"><span class="linenos">2753</span></a>
</span><span id="GuacamoleDB-2754"><a href="#GuacamoleDB-2754"><span class="linenos">2754</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2755"><a href="#GuacamoleDB-2755"><span class="linenos">2755</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-2756"><a href="#GuacamoleDB-2756"><span class="linenos">2756</span></a>
</span><span id="GuacamoleDB-2757"><a href="#GuacamoleDB-2757"><span class="linenos">2757</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2758"><a href="#GuacamoleDB-2758"><span class="linenos">2758</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-2759"><a href="#GuacamoleDB-2759"><span class="linenos">2759</span></a><span class="sd">            ...     groups = db.list_groups_with_users()</span>
</span><span id="GuacamoleDB-2760"><a href="#GuacamoleDB-2760"><span class="linenos">2760</span></a><span class="sd">            ...     for group_name, users in groups.items():</span>
</span><span id="GuacamoleDB-2761"><a href="#GuacamoleDB-2761"><span class="linenos">2761</span></a><span class="sd">            ...         print(f&quot;{group_name}: {users}&quot;)</span>
</span><span id="GuacamoleDB-2762"><a href="#GuacamoleDB-2762"><span class="linenos">2762</span></a><span class="sd">            admin: [&#39;admin1&#39;, &#39;admin2&#39;]</span>
</span><span id="GuacamoleDB-2763"><a href="#GuacamoleDB-2763"><span class="linenos">2763</span></a><span class="sd">            users: [&#39;john.doe&#39;, &#39;jane.smith&#39;]</span>
</span><span id="GuacamoleDB-2764"><a href="#GuacamoleDB-2764"><span class="linenos">2764</span></a><span class="sd">            guests: []</span>
</span><span id="GuacamoleDB-2765"><a href="#GuacamoleDB-2765"><span class="linenos">2765</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2766"><a href="#GuacamoleDB-2766"><span class="linenos">2766</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2767"><a href="#GuacamoleDB-2767"><span class="linenos">2767</span></a><span class="s2">            SELECT </span>
</span><span id="GuacamoleDB-2768"><a href="#GuacamoleDB-2768"><span class="linenos">2768</span></a><span class="s2">                e.name as groupname,</span>
</span><span id="GuacamoleDB-2769"><a href="#GuacamoleDB-2769"><span class="linenos">2769</span></a><span class="s2">                GROUP_CONCAT(DISTINCT ue.name) as usernames</span>
</span><span id="GuacamoleDB-2770"><a href="#GuacamoleDB-2770"><span class="linenos">2770</span></a><span class="s2">            FROM guacamole_entity e</span>
</span><span id="GuacamoleDB-2771"><a href="#GuacamoleDB-2771"><span class="linenos">2771</span></a><span class="s2">            LEFT JOIN guacamole_user_group ug ON e.entity_id = ug.entity_id</span>
</span><span id="GuacamoleDB-2772"><a href="#GuacamoleDB-2772"><span class="linenos">2772</span></a><span class="s2">            LEFT JOIN guacamole_user_group_member ugm ON ug.user_group_id = ugm.user_group_id</span>
</span><span id="GuacamoleDB-2773"><a href="#GuacamoleDB-2773"><span class="linenos">2773</span></a><span class="s2">            LEFT JOIN guacamole_entity ue ON ugm.member_entity_id = ue.entity_id AND ue.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-2774"><a href="#GuacamoleDB-2774"><span class="linenos">2774</span></a><span class="s2">            WHERE e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB-2775"><a href="#GuacamoleDB-2775"><span class="linenos">2775</span></a><span class="s2">            GROUP BY e.name</span>
</span><span id="GuacamoleDB-2776"><a href="#GuacamoleDB-2776"><span class="linenos">2776</span></a><span class="s2">            ORDER BY e.name</span>
</span><span id="GuacamoleDB-2777"><a href="#GuacamoleDB-2777"><span class="linenos">2777</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2778"><a href="#GuacamoleDB-2778"><span class="linenos">2778</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="GuacamoleDB-2779"><a href="#GuacamoleDB-2779"><span class="linenos">2779</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB-2780"><a href="#GuacamoleDB-2780"><span class="linenos">2780</span></a>
</span><span id="GuacamoleDB-2781"><a href="#GuacamoleDB-2781"><span class="linenos">2781</span></a>        <span class="n">groups_users</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB-2782"><a href="#GuacamoleDB-2782"><span class="linenos">2782</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="GuacamoleDB-2783"><a href="#GuacamoleDB-2783"><span class="linenos">2783</span></a>            <span class="n">groupname</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2784"><a href="#GuacamoleDB-2784"><span class="linenos">2784</span></a>            <span class="n">usernames</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB-2785"><a href="#GuacamoleDB-2785"><span class="linenos">2785</span></a>            <span class="n">groups_users</span><span class="p">[</span><span class="n">groupname</span><span class="p">]</span> <span class="o">=</span> <span class="n">usernames</span>
</span><span id="GuacamoleDB-2786"><a href="#GuacamoleDB-2786"><span class="linenos">2786</span></a>
</span><span id="GuacamoleDB-2787"><a href="#GuacamoleDB-2787"><span class="linenos">2787</span></a>        <span class="k">return</span> <span class="n">groups_users</span>
</span><span id="GuacamoleDB-2788"><a href="#GuacamoleDB-2788"><span class="linenos">2788</span></a>
</span><span id="GuacamoleDB-2789"><a href="#GuacamoleDB-2789"><span class="linenos">2789</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">debug_connection_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB-2790"><a href="#GuacamoleDB-2790"><span class="linenos">2790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Debug function to check and display permissions for a connection.</span>
</span><span id="GuacamoleDB-2791"><a href="#GuacamoleDB-2791"><span class="linenos">2791</span></a>
</span><span id="GuacamoleDB-2792"><a href="#GuacamoleDB-2792"><span class="linenos">2792</span></a><span class="sd">        Outputs detailed debugging information about all permissions associated</span>
</span><span id="GuacamoleDB-2793"><a href="#GuacamoleDB-2793"><span class="linenos">2793</span></a><span class="sd">        with a specific connection, including both user and user group permissions.</span>
</span><span id="GuacamoleDB-2794"><a href="#GuacamoleDB-2794"><span class="linenos">2794</span></a><span class="sd">        This function is intended for troubleshooting connection access issues.</span>
</span><span id="GuacamoleDB-2795"><a href="#GuacamoleDB-2795"><span class="linenos">2795</span></a>
</span><span id="GuacamoleDB-2796"><a href="#GuacamoleDB-2796"><span class="linenos">2796</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-2797"><a href="#GuacamoleDB-2797"><span class="linenos">2797</span></a><span class="sd">            connection_name: The name of the connection to debug.</span>
</span><span id="GuacamoleDB-2798"><a href="#GuacamoleDB-2798"><span class="linenos">2798</span></a>
</span><span id="GuacamoleDB-2799"><a href="#GuacamoleDB-2799"><span class="linenos">2799</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2800"><a href="#GuacamoleDB-2800"><span class="linenos">2800</span></a><span class="sd">            None (outputs debug information to stdout).</span>
</span><span id="GuacamoleDB-2801"><a href="#GuacamoleDB-2801"><span class="linenos">2801</span></a>
</span><span id="GuacamoleDB-2802"><a href="#GuacamoleDB-2802"><span class="linenos">2802</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2803"><a href="#GuacamoleDB-2803"><span class="linenos">2803</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB-2804"><a href="#GuacamoleDB-2804"><span class="linenos">2804</span></a>
</span><span id="GuacamoleDB-2805"><a href="#GuacamoleDB-2805"><span class="linenos">2805</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2806"><a href="#GuacamoleDB-2806"><span class="linenos">2806</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-2807"><a href="#GuacamoleDB-2807"><span class="linenos">2807</span></a><span class="sd">            ...     db.debug_connection_permissions(&quot;my-server&quot;)</span>
</span><span id="GuacamoleDB-2808"><a href="#GuacamoleDB-2808"><span class="linenos">2808</span></a><span class="sd">            [DEBUG] Checking permissions for connection &#39;my-server&#39;</span>
</span><span id="GuacamoleDB-2809"><a href="#GuacamoleDB-2809"><span class="linenos">2809</span></a><span class="sd">            [DEBUG] Connection ID: 42</span>
</span><span id="GuacamoleDB-2810"><a href="#GuacamoleDB-2810"><span class="linenos">2810</span></a><span class="sd">            [DEBUG] Found 2 permissions:</span>
</span><span id="GuacamoleDB-2811"><a href="#GuacamoleDB-2811"><span class="linenos">2811</span></a><span class="sd">            [DEBUG]   Entity ID: 15, Name: john.doe, Type: USER, Permission: READ</span>
</span><span id="GuacamoleDB-2812"><a href="#GuacamoleDB-2812"><span class="linenos">2812</span></a><span class="sd">            [DEBUG]   Entity ID: 20, Name: admin-group, Type: USER_GROUP, Permission: READ</span>
</span><span id="GuacamoleDB-2813"><a href="#GuacamoleDB-2813"><span class="linenos">2813</span></a><span class="sd">            [DEBUG] Found 1 user permissions:</span>
</span><span id="GuacamoleDB-2814"><a href="#GuacamoleDB-2814"><span class="linenos">2814</span></a><span class="sd">            [DEBUG]   User: john.doe</span>
</span><span id="GuacamoleDB-2815"><a href="#GuacamoleDB-2815"><span class="linenos">2815</span></a><span class="sd">            [DEBUG] End of debug info</span>
</span><span id="GuacamoleDB-2816"><a href="#GuacamoleDB-2816"><span class="linenos">2816</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2817"><a href="#GuacamoleDB-2817"><span class="linenos">2817</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2818"><a href="#GuacamoleDB-2818"><span class="linenos">2818</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking permissions for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2819"><a href="#GuacamoleDB-2819"><span class="linenos">2819</span></a>
</span><span id="GuacamoleDB-2820"><a href="#GuacamoleDB-2820"><span class="linenos">2820</span></a>            <span class="c1"># Get connection ID</span>
</span><span id="GuacamoleDB-2821"><a href="#GuacamoleDB-2821"><span class="linenos">2821</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2822"><a href="#GuacamoleDB-2822"><span class="linenos">2822</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2823"><a href="#GuacamoleDB-2823"><span class="linenos">2823</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB-2824"><a href="#GuacamoleDB-2824"><span class="linenos">2824</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB-2825"><a href="#GuacamoleDB-2825"><span class="linenos">2825</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2826"><a href="#GuacamoleDB-2826"><span class="linenos">2826</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2827"><a href="#GuacamoleDB-2827"><span class="linenos">2827</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2828"><a href="#GuacamoleDB-2828"><span class="linenos">2828</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2829"><a href="#GuacamoleDB-2829"><span class="linenos">2829</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2830"><a href="#GuacamoleDB-2830"><span class="linenos">2830</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2831"><a href="#GuacamoleDB-2831"><span class="linenos">2831</span></a>                <span class="k">return</span>
</span><span id="GuacamoleDB-2832"><a href="#GuacamoleDB-2832"><span class="linenos">2832</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2833"><a href="#GuacamoleDB-2833"><span class="linenos">2833</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection ID: </span><span class="si">{</span><span class="n">connection_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2834"><a href="#GuacamoleDB-2834"><span class="linenos">2834</span></a>
</span><span id="GuacamoleDB-2835"><a href="#GuacamoleDB-2835"><span class="linenos">2835</span></a>            <span class="c1"># Check all permissions</span>
</span><span id="GuacamoleDB-2836"><a href="#GuacamoleDB-2836"><span class="linenos">2836</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2837"><a href="#GuacamoleDB-2837"><span class="linenos">2837</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2838"><a href="#GuacamoleDB-2838"><span class="linenos">2838</span></a><span class="sd">                SELECT cp.entity_id, e.name, e.type, cp.permission</span>
</span><span id="GuacamoleDB-2839"><a href="#GuacamoleDB-2839"><span class="linenos">2839</span></a><span class="sd">                FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB-2840"><a href="#GuacamoleDB-2840"><span class="linenos">2840</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB-2841"><a href="#GuacamoleDB-2841"><span class="linenos">2841</span></a><span class="sd">                WHERE cp.connection_id = %s</span>
</span><span id="GuacamoleDB-2842"><a href="#GuacamoleDB-2842"><span class="linenos">2842</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2843"><a href="#GuacamoleDB-2843"><span class="linenos">2843</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2844"><a href="#GuacamoleDB-2844"><span class="linenos">2844</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2845"><a href="#GuacamoleDB-2845"><span class="linenos">2845</span></a>
</span><span id="GuacamoleDB-2846"><a href="#GuacamoleDB-2846"><span class="linenos">2846</span></a>            <span class="n">permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB-2847"><a href="#GuacamoleDB-2847"><span class="linenos">2847</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB-2848"><a href="#GuacamoleDB-2848"><span class="linenos">2848</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="GuacamoleDB-2849"><a href="#GuacamoleDB-2849"><span class="linenos">2849</span></a>                    <span class="sa">f</span><span class="s2">&quot;No permissions found for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2850"><a href="#GuacamoleDB-2850"><span class="linenos">2850</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2851"><a href="#GuacamoleDB-2851"><span class="linenos">2851</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-2852"><a href="#GuacamoleDB-2852"><span class="linenos">2852</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">permissions</span><span class="p">)</span><span class="si">}</span><span class="s2"> permissions:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2853"><a href="#GuacamoleDB-2853"><span class="linenos">2853</span></a>                <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB-2854"><a href="#GuacamoleDB-2854"><span class="linenos">2854</span></a>                    <span class="n">entity_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">perm</span>
</span><span id="GuacamoleDB-2855"><a href="#GuacamoleDB-2855"><span class="linenos">2855</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="GuacamoleDB-2856"><a href="#GuacamoleDB-2856"><span class="linenos">2856</span></a>                        <span class="sa">f</span><span class="s2">&quot;  Entity ID: </span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s2">, Name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, Type: </span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">, Permission: </span><span class="si">{</span><span class="n">permission</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-2857"><a href="#GuacamoleDB-2857"><span class="linenos">2857</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-2858"><a href="#GuacamoleDB-2858"><span class="linenos">2858</span></a>
</span><span id="GuacamoleDB-2859"><a href="#GuacamoleDB-2859"><span class="linenos">2859</span></a>            <span class="c1"># Specifically check user permissions</span>
</span><span id="GuacamoleDB-2860"><a href="#GuacamoleDB-2860"><span class="linenos">2860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2861"><a href="#GuacamoleDB-2861"><span class="linenos">2861</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2862"><a href="#GuacamoleDB-2862"><span class="linenos">2862</span></a><span class="sd">                SELECT e.name</span>
</span><span id="GuacamoleDB-2863"><a href="#GuacamoleDB-2863"><span class="linenos">2863</span></a><span class="sd">                FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB-2864"><a href="#GuacamoleDB-2864"><span class="linenos">2864</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB-2865"><a href="#GuacamoleDB-2865"><span class="linenos">2865</span></a><span class="sd">                WHERE cp.connection_id = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-2866"><a href="#GuacamoleDB-2866"><span class="linenos">2866</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2867"><a href="#GuacamoleDB-2867"><span class="linenos">2867</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2868"><a href="#GuacamoleDB-2868"><span class="linenos">2868</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2869"><a href="#GuacamoleDB-2869"><span class="linenos">2869</span></a>
</span><span id="GuacamoleDB-2870"><a href="#GuacamoleDB-2870"><span class="linenos">2870</span></a>            <span class="n">user_permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB-2871"><a href="#GuacamoleDB-2871"><span class="linenos">2871</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB-2872"><a href="#GuacamoleDB-2872"><span class="linenos">2872</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="GuacamoleDB-2873"><a href="#GuacamoleDB-2873"><span class="linenos">2873</span></a>                    <span class="sa">f</span><span class="s2">&quot;No user permissions found for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2874"><a href="#GuacamoleDB-2874"><span class="linenos">2874</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2875"><a href="#GuacamoleDB-2875"><span class="linenos">2875</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-2876"><a href="#GuacamoleDB-2876"><span class="linenos">2876</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">user_permissions</span><span class="p">)</span><span class="si">}</span><span class="s2"> user permissions:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2877"><a href="#GuacamoleDB-2877"><span class="linenos">2877</span></a>                <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">user_permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB-2878"><a href="#GuacamoleDB-2878"><span class="linenos">2878</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  User: </span><span class="si">{</span><span class="n">perm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2879"><a href="#GuacamoleDB-2879"><span class="linenos">2879</span></a>
</span><span id="GuacamoleDB-2880"><a href="#GuacamoleDB-2880"><span class="linenos">2880</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;End of debug info&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2881"><a href="#GuacamoleDB-2881"><span class="linenos">2881</span></a>
</span><span id="GuacamoleDB-2882"><a href="#GuacamoleDB-2882"><span class="linenos">2882</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-2883"><a href="#GuacamoleDB-2883"><span class="linenos">2883</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error debugging permissions: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2884"><a href="#GuacamoleDB-2884"><span class="linenos">2884</span></a>
</span><span id="GuacamoleDB-2885"><a href="#GuacamoleDB-2885"><span class="linenos">2885</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_group_permission_to_user</span><span class="p">(</span>
</span><span id="GuacamoleDB-2886"><a href="#GuacamoleDB-2886"><span class="linenos">2886</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB-2887"><a href="#GuacamoleDB-2887"><span class="linenos">2887</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-2888"><a href="#GuacamoleDB-2888"><span class="linenos">2888</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Grant connection group permission to a specific user.</span>
</span><span id="GuacamoleDB-2889"><a href="#GuacamoleDB-2889"><span class="linenos">2889</span></a>
</span><span id="GuacamoleDB-2890"><a href="#GuacamoleDB-2890"><span class="linenos">2890</span></a><span class="sd">        Grants READ permission to a user for accessing a connection group.</span>
</span><span id="GuacamoleDB-2891"><a href="#GuacamoleDB-2891"><span class="linenos">2891</span></a><span class="sd">        This allows the user to see and use all connections within that group.</span>
</span><span id="GuacamoleDB-2892"><a href="#GuacamoleDB-2892"><span class="linenos">2892</span></a>
</span><span id="GuacamoleDB-2893"><a href="#GuacamoleDB-2893"><span class="linenos">2893</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-2894"><a href="#GuacamoleDB-2894"><span class="linenos">2894</span></a><span class="sd">            username: Name of the user to grant permission to.</span>
</span><span id="GuacamoleDB-2895"><a href="#GuacamoleDB-2895"><span class="linenos">2895</span></a><span class="sd">            conngroup_name: Name of the connection group to grant access to.</span>
</span><span id="GuacamoleDB-2896"><a href="#GuacamoleDB-2896"><span class="linenos">2896</span></a>
</span><span id="GuacamoleDB-2897"><a href="#GuacamoleDB-2897"><span class="linenos">2897</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-2898"><a href="#GuacamoleDB-2898"><span class="linenos">2898</span></a><span class="sd">            True if the permission was granted successfully.</span>
</span><span id="GuacamoleDB-2899"><a href="#GuacamoleDB-2899"><span class="linenos">2899</span></a>
</span><span id="GuacamoleDB-2900"><a href="#GuacamoleDB-2900"><span class="linenos">2900</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-2901"><a href="#GuacamoleDB-2901"><span class="linenos">2901</span></a><span class="sd">            ValueError: If username or connection group name is invalid, or if</span>
</span><span id="GuacamoleDB-2902"><a href="#GuacamoleDB-2902"><span class="linenos">2902</span></a><span class="sd">                       the user or connection group doesn&#39;t exist.</span>
</span><span id="GuacamoleDB-2903"><a href="#GuacamoleDB-2903"><span class="linenos">2903</span></a><span class="sd">            mysql.connector.Error: If database operation fails.</span>
</span><span id="GuacamoleDB-2904"><a href="#GuacamoleDB-2904"><span class="linenos">2904</span></a>
</span><span id="GuacamoleDB-2905"><a href="#GuacamoleDB-2905"><span class="linenos">2905</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-2906"><a href="#GuacamoleDB-2906"><span class="linenos">2906</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-2907"><a href="#GuacamoleDB-2907"><span class="linenos">2907</span></a><span class="sd">            ...     success = db.grant_connection_group_permission_to_user(</span>
</span><span id="GuacamoleDB-2908"><a href="#GuacamoleDB-2908"><span class="linenos">2908</span></a><span class="sd">            ...         &quot;john.doe&quot;, &quot;Production Servers&quot;</span>
</span><span id="GuacamoleDB-2909"><a href="#GuacamoleDB-2909"><span class="linenos">2909</span></a><span class="sd">            ...     )</span>
</span><span id="GuacamoleDB-2910"><a href="#GuacamoleDB-2910"><span class="linenos">2910</span></a><span class="sd">            ...     print(f&quot;Permission granted: {success}&quot;)</span>
</span><span id="GuacamoleDB-2911"><a href="#GuacamoleDB-2911"><span class="linenos">2911</span></a><span class="sd">            Permission granted: True</span>
</span><span id="GuacamoleDB-2912"><a href="#GuacamoleDB-2912"><span class="linenos">2912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2913"><a href="#GuacamoleDB-2913"><span class="linenos">2913</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB-2914"><a href="#GuacamoleDB-2914"><span class="linenos">2914</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2915"><a href="#GuacamoleDB-2915"><span class="linenos">2915</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">conngroup_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB-2916"><a href="#GuacamoleDB-2916"><span class="linenos">2916</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group name must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2917"><a href="#GuacamoleDB-2917"><span class="linenos">2917</span></a>
</span><span id="GuacamoleDB-2918"><a href="#GuacamoleDB-2918"><span class="linenos">2918</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-2919"><a href="#GuacamoleDB-2919"><span class="linenos">2919</span></a>            <span class="c1"># Get connection group ID</span>
</span><span id="GuacamoleDB-2920"><a href="#GuacamoleDB-2920"><span class="linenos">2920</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2921"><a href="#GuacamoleDB-2921"><span class="linenos">2921</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2922"><a href="#GuacamoleDB-2922"><span class="linenos">2922</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-2923"><a href="#GuacamoleDB-2923"><span class="linenos">2923</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB-2924"><a href="#GuacamoleDB-2924"><span class="linenos">2924</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-2925"><a href="#GuacamoleDB-2925"><span class="linenos">2925</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2926"><a href="#GuacamoleDB-2926"><span class="linenos">2926</span></a>                <span class="p">(</span><span class="n">conngroup_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2927"><a href="#GuacamoleDB-2927"><span class="linenos">2927</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2928"><a href="#GuacamoleDB-2928"><span class="linenos">2928</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2929"><a href="#GuacamoleDB-2929"><span class="linenos">2929</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2930"><a href="#GuacamoleDB-2930"><span class="linenos">2930</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-2931"><a href="#GuacamoleDB-2931"><span class="linenos">2931</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group lookup failed for: </span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-2932"><a href="#GuacamoleDB-2932"><span class="linenos">2932</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2933"><a href="#GuacamoleDB-2933"><span class="linenos">2933</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2934"><a href="#GuacamoleDB-2934"><span class="linenos">2934</span></a>            <span class="n">connection_group_id</span><span class="p">,</span> <span class="n">actual_conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-2935"><a href="#GuacamoleDB-2935"><span class="linenos">2935</span></a>
</span><span id="GuacamoleDB-2936"><a href="#GuacamoleDB-2936"><span class="linenos">2936</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB-2937"><a href="#GuacamoleDB-2937"><span class="linenos">2937</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2938"><a href="#GuacamoleDB-2938"><span class="linenos">2938</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2939"><a href="#GuacamoleDB-2939"><span class="linenos">2939</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB-2940"><a href="#GuacamoleDB-2940"><span class="linenos">2940</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-2941"><a href="#GuacamoleDB-2941"><span class="linenos">2941</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-2942"><a href="#GuacamoleDB-2942"><span class="linenos">2942</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2943"><a href="#GuacamoleDB-2943"><span class="linenos">2943</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-2944"><a href="#GuacamoleDB-2944"><span class="linenos">2944</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2945"><a href="#GuacamoleDB-2945"><span class="linenos">2945</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2946"><a href="#GuacamoleDB-2946"><span class="linenos">2946</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-2947"><a href="#GuacamoleDB-2947"><span class="linenos">2947</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2948"><a href="#GuacamoleDB-2948"><span class="linenos">2948</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-2949"><a href="#GuacamoleDB-2949"><span class="linenos">2949</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-2950"><a href="#GuacamoleDB-2950"><span class="linenos">2950</span></a>
</span><span id="GuacamoleDB-2951"><a href="#GuacamoleDB-2951"><span class="linenos">2951</span></a>            <span class="c1"># Check if permission already exists</span>
</span><span id="GuacamoleDB-2952"><a href="#GuacamoleDB-2952"><span class="linenos">2952</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2953"><a href="#GuacamoleDB-2953"><span class="linenos">2953</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2954"><a href="#GuacamoleDB-2954"><span class="linenos">2954</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-2955"><a href="#GuacamoleDB-2955"><span class="linenos">2955</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-2956"><a href="#GuacamoleDB-2956"><span class="linenos">2956</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-2957"><a href="#GuacamoleDB-2957"><span class="linenos">2957</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2958"><a href="#GuacamoleDB-2958"><span class="linenos">2958</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2959"><a href="#GuacamoleDB-2959"><span class="linenos">2959</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-2960"><a href="#GuacamoleDB-2960"><span class="linenos">2960</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-2961"><a href="#GuacamoleDB-2961"><span class="linenos">2961</span></a>            <span class="k">if</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB-2962"><a href="#GuacamoleDB-2962"><span class="linenos">2962</span></a>                <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-2963"><a href="#GuacamoleDB-2963"><span class="linenos">2963</span></a>                <span class="k">if</span> <span class="n">permission_type</span> <span class="o">==</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-2964"><a href="#GuacamoleDB-2964"><span class="linenos">2964</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-2965"><a href="#GuacamoleDB-2965"><span class="linenos">2965</span></a>                        <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; already has permission for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2966"><a href="#GuacamoleDB-2966"><span class="linenos">2966</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-2967"><a href="#GuacamoleDB-2967"><span class="linenos">2967</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-2968"><a href="#GuacamoleDB-2968"><span class="linenos">2968</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-2969"><a href="#GuacamoleDB-2969"><span class="linenos">2969</span></a>                        <span class="sa">f</span><span class="s2">&quot;Updating existing permission &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2970"><a href="#GuacamoleDB-2970"><span class="linenos">2970</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-2971"><a href="#GuacamoleDB-2971"><span class="linenos">2971</span></a>
</span><span id="GuacamoleDB-2972"><a href="#GuacamoleDB-2972"><span class="linenos">2972</span></a>            <span class="c1"># Grant permission (INSERT or UPDATE if unexpected permission exists)</span>
</span><span id="GuacamoleDB-2973"><a href="#GuacamoleDB-2973"><span class="linenos">2973</span></a>            <span class="k">if</span> <span class="n">existing_permission</span> <span class="ow">and</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-2974"><a href="#GuacamoleDB-2974"><span class="linenos">2974</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2975"><a href="#GuacamoleDB-2975"><span class="linenos">2975</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2976"><a href="#GuacamoleDB-2976"><span class="linenos">2976</span></a><span class="sd">                    UPDATE guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-2977"><a href="#GuacamoleDB-2977"><span class="linenos">2977</span></a><span class="sd">                    SET permission = &#39;READ&#39;</span>
</span><span id="GuacamoleDB-2978"><a href="#GuacamoleDB-2978"><span class="linenos">2978</span></a><span class="sd">                    WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-2979"><a href="#GuacamoleDB-2979"><span class="linenos">2979</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2980"><a href="#GuacamoleDB-2980"><span class="linenos">2980</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2981"><a href="#GuacamoleDB-2981"><span class="linenos">2981</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2982"><a href="#GuacamoleDB-2982"><span class="linenos">2982</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-2983"><a href="#GuacamoleDB-2983"><span class="linenos">2983</span></a>                    <span class="sa">f</span><span class="s2">&quot;Updated permission to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; on connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2984"><a href="#GuacamoleDB-2984"><span class="linenos">2984</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2985"><a href="#GuacamoleDB-2985"><span class="linenos">2985</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-2986"><a href="#GuacamoleDB-2986"><span class="linenos">2986</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-2987"><a href="#GuacamoleDB-2987"><span class="linenos">2987</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-2988"><a href="#GuacamoleDB-2988"><span class="linenos">2988</span></a><span class="sd">                    INSERT INTO guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-2989"><a href="#GuacamoleDB-2989"><span class="linenos">2989</span></a><span class="sd">                    (entity_id, connection_group_id, permission)</span>
</span><span id="GuacamoleDB-2990"><a href="#GuacamoleDB-2990"><span class="linenos">2990</span></a><span class="sd">                    VALUES (%s, %s, &#39;READ&#39;)</span>
</span><span id="GuacamoleDB-2991"><a href="#GuacamoleDB-2991"><span class="linenos">2991</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-2992"><a href="#GuacamoleDB-2992"><span class="linenos">2992</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-2993"><a href="#GuacamoleDB-2993"><span class="linenos">2993</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2994"><a href="#GuacamoleDB-2994"><span class="linenos">2994</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-2995"><a href="#GuacamoleDB-2995"><span class="linenos">2995</span></a>                    <span class="sa">f</span><span class="s2">&quot;Granted &#39;READ&#39; permission to user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-2996"><a href="#GuacamoleDB-2996"><span class="linenos">2996</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-2997"><a href="#GuacamoleDB-2997"><span class="linenos">2997</span></a>
</span><span id="GuacamoleDB-2998"><a href="#GuacamoleDB-2998"><span class="linenos">2998</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-2999"><a href="#GuacamoleDB-2999"><span class="linenos">2999</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-3000"><a href="#GuacamoleDB-3000"><span class="linenos">3000</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error granting connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3001"><a href="#GuacamoleDB-3001"><span class="linenos">3001</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB-3002"><a href="#GuacamoleDB-3002"><span class="linenos">3002</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="GuacamoleDB-3003"><a href="#GuacamoleDB-3003"><span class="linenos">3003</span></a>
</span><span id="GuacamoleDB-3004"><a href="#GuacamoleDB-3004"><span class="linenos">3004</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_connection_group_permission_from_user</span><span class="p">(</span>
</span><span id="GuacamoleDB-3005"><a href="#GuacamoleDB-3005"><span class="linenos">3005</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB-3006"><a href="#GuacamoleDB-3006"><span class="linenos">3006</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-3007"><a href="#GuacamoleDB-3007"><span class="linenos">3007</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke connection group permission from a specific user&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3008"><a href="#GuacamoleDB-3008"><span class="linenos">3008</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB-3009"><a href="#GuacamoleDB-3009"><span class="linenos">3009</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3010"><a href="#GuacamoleDB-3010"><span class="linenos">3010</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">conngroup_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB-3011"><a href="#GuacamoleDB-3011"><span class="linenos">3011</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group name must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3012"><a href="#GuacamoleDB-3012"><span class="linenos">3012</span></a>
</span><span id="GuacamoleDB-3013"><a href="#GuacamoleDB-3013"><span class="linenos">3013</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-3014"><a href="#GuacamoleDB-3014"><span class="linenos">3014</span></a>            <span class="c1"># Get connection group ID</span>
</span><span id="GuacamoleDB-3015"><a href="#GuacamoleDB-3015"><span class="linenos">3015</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3016"><a href="#GuacamoleDB-3016"><span class="linenos">3016</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3017"><a href="#GuacamoleDB-3017"><span class="linenos">3017</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-3018"><a href="#GuacamoleDB-3018"><span class="linenos">3018</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB-3019"><a href="#GuacamoleDB-3019"><span class="linenos">3019</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3020"><a href="#GuacamoleDB-3020"><span class="linenos">3020</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3021"><a href="#GuacamoleDB-3021"><span class="linenos">3021</span></a>                <span class="p">(</span><span class="n">conngroup_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB-3022"><a href="#GuacamoleDB-3022"><span class="linenos">3022</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3023"><a href="#GuacamoleDB-3023"><span class="linenos">3023</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3024"><a href="#GuacamoleDB-3024"><span class="linenos">3024</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-3025"><a href="#GuacamoleDB-3025"><span class="linenos">3025</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3026"><a href="#GuacamoleDB-3026"><span class="linenos">3026</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group lookup failed for: </span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3027"><a href="#GuacamoleDB-3027"><span class="linenos">3027</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3028"><a href="#GuacamoleDB-3028"><span class="linenos">3028</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3029"><a href="#GuacamoleDB-3029"><span class="linenos">3029</span></a>            <span class="n">connection_group_id</span><span class="p">,</span> <span class="n">actual_conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-3030"><a href="#GuacamoleDB-3030"><span class="linenos">3030</span></a>
</span><span id="GuacamoleDB-3031"><a href="#GuacamoleDB-3031"><span class="linenos">3031</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB-3032"><a href="#GuacamoleDB-3032"><span class="linenos">3032</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3033"><a href="#GuacamoleDB-3033"><span class="linenos">3033</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3034"><a href="#GuacamoleDB-3034"><span class="linenos">3034</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB-3035"><a href="#GuacamoleDB-3035"><span class="linenos">3035</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-3036"><a href="#GuacamoleDB-3036"><span class="linenos">3036</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3037"><a href="#GuacamoleDB-3037"><span class="linenos">3037</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3038"><a href="#GuacamoleDB-3038"><span class="linenos">3038</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-3039"><a href="#GuacamoleDB-3039"><span class="linenos">3039</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3040"><a href="#GuacamoleDB-3040"><span class="linenos">3040</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3041"><a href="#GuacamoleDB-3041"><span class="linenos">3041</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-3042"><a href="#GuacamoleDB-3042"><span class="linenos">3042</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3043"><a href="#GuacamoleDB-3043"><span class="linenos">3043</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3044"><a href="#GuacamoleDB-3044"><span class="linenos">3044</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-3045"><a href="#GuacamoleDB-3045"><span class="linenos">3045</span></a>
</span><span id="GuacamoleDB-3046"><a href="#GuacamoleDB-3046"><span class="linenos">3046</span></a>            <span class="c1"># Check if permission exists and get its type</span>
</span><span id="GuacamoleDB-3047"><a href="#GuacamoleDB-3047"><span class="linenos">3047</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3048"><a href="#GuacamoleDB-3048"><span class="linenos">3048</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3049"><a href="#GuacamoleDB-3049"><span class="linenos">3049</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-3050"><a href="#GuacamoleDB-3050"><span class="linenos">3050</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-3051"><a href="#GuacamoleDB-3051"><span class="linenos">3051</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3052"><a href="#GuacamoleDB-3052"><span class="linenos">3052</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3053"><a href="#GuacamoleDB-3053"><span class="linenos">3053</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-3054"><a href="#GuacamoleDB-3054"><span class="linenos">3054</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3055"><a href="#GuacamoleDB-3055"><span class="linenos">3055</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3056"><a href="#GuacamoleDB-3056"><span class="linenos">3056</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB-3057"><a href="#GuacamoleDB-3057"><span class="linenos">3057</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-3058"><a href="#GuacamoleDB-3058"><span class="linenos">3058</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; has no permission for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3059"><a href="#GuacamoleDB-3059"><span class="linenos">3059</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3060"><a href="#GuacamoleDB-3060"><span class="linenos">3060</span></a>
</span><span id="GuacamoleDB-3061"><a href="#GuacamoleDB-3061"><span class="linenos">3061</span></a>            <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-3062"><a href="#GuacamoleDB-3062"><span class="linenos">3062</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3063"><a href="#GuacamoleDB-3063"><span class="linenos">3063</span></a>                <span class="sa">f</span><span class="s2">&quot;Revoking &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3064"><a href="#GuacamoleDB-3064"><span class="linenos">3064</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3065"><a href="#GuacamoleDB-3065"><span class="linenos">3065</span></a>
</span><span id="GuacamoleDB-3066"><a href="#GuacamoleDB-3066"><span class="linenos">3066</span></a>            <span class="c1"># Revoke permission</span>
</span><span id="GuacamoleDB-3067"><a href="#GuacamoleDB-3067"><span class="linenos">3067</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3068"><a href="#GuacamoleDB-3068"><span class="linenos">3068</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3069"><a href="#GuacamoleDB-3069"><span class="linenos">3069</span></a><span class="sd">                DELETE FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-3070"><a href="#GuacamoleDB-3070"><span class="linenos">3070</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-3071"><a href="#GuacamoleDB-3071"><span class="linenos">3071</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3072"><a href="#GuacamoleDB-3072"><span class="linenos">3072</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3073"><a href="#GuacamoleDB-3073"><span class="linenos">3073</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-3074"><a href="#GuacamoleDB-3074"><span class="linenos">3074</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3075"><a href="#GuacamoleDB-3075"><span class="linenos">3075</span></a>
</span><span id="GuacamoleDB-3076"><a href="#GuacamoleDB-3076"><span class="linenos">3076</span></a>            <span class="c1"># Verify deletion was successful</span>
</span><span id="GuacamoleDB-3077"><a href="#GuacamoleDB-3077"><span class="linenos">3077</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-3078"><a href="#GuacamoleDB-3078"><span class="linenos">3078</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-3079"><a href="#GuacamoleDB-3079"><span class="linenos">3079</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to revoke permission - no rows affected. Permission may have been removed by another operation.&quot;</span>
</span><span id="GuacamoleDB-3080"><a href="#GuacamoleDB-3080"><span class="linenos">3080</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3081"><a href="#GuacamoleDB-3081"><span class="linenos">3081</span></a>
</span><span id="GuacamoleDB-3082"><a href="#GuacamoleDB-3082"><span class="linenos">3082</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3083"><a href="#GuacamoleDB-3083"><span class="linenos">3083</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully revoked &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3084"><a href="#GuacamoleDB-3084"><span class="linenos">3084</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3085"><a href="#GuacamoleDB-3085"><span class="linenos">3085</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-3086"><a href="#GuacamoleDB-3086"><span class="linenos">3086</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-3087"><a href="#GuacamoleDB-3087"><span class="linenos">3087</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error revoking connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3088"><a href="#GuacamoleDB-3088"><span class="linenos">3088</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB-3089"><a href="#GuacamoleDB-3089"><span class="linenos">3089</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="GuacamoleDB-3090"><a href="#GuacamoleDB-3090"><span class="linenos">3090</span></a>
</span><span id="GuacamoleDB-3091"><a href="#GuacamoleDB-3091"><span class="linenos">3091</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_atomic_permission_operation</span><span class="p">(</span>
</span><span id="GuacamoleDB-3092"><a href="#GuacamoleDB-3092"><span class="linenos">3092</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">operation_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="GuacamoleDB-3093"><a href="#GuacamoleDB-3093"><span class="linenos">3093</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="GuacamoleDB-3094"><a href="#GuacamoleDB-3094"><span class="linenos">3094</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a database operation with proper error handling and validation&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3095"><a href="#GuacamoleDB-3095"><span class="linenos">3095</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-3096"><a href="#GuacamoleDB-3096"><span class="linenos">3096</span></a>            <span class="k">return</span> <span class="n">operation_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="GuacamoleDB-3097"><a href="#GuacamoleDB-3097"><span class="linenos">3097</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-3098"><a href="#GuacamoleDB-3098"><span class="linenos">3098</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error during permission operation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3099"><a href="#GuacamoleDB-3099"><span class="linenos">3099</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB-3100"><a href="#GuacamoleDB-3100"><span class="linenos">3100</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="GuacamoleDB-3101"><a href="#GuacamoleDB-3101"><span class="linenos">3101</span></a>
</span><span id="GuacamoleDB-3102"><a href="#GuacamoleDB-3102"><span class="linenos">3102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_group_permission_to_user_by_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-3103"><a href="#GuacamoleDB-3103"><span class="linenos">3103</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GuacamoleDB-3104"><a href="#GuacamoleDB-3104"><span class="linenos">3104</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-3105"><a href="#GuacamoleDB-3105"><span class="linenos">3105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Grant connection group permission to a user using connection group ID.</span>
</span><span id="GuacamoleDB-3106"><a href="#GuacamoleDB-3106"><span class="linenos">3106</span></a>
</span><span id="GuacamoleDB-3107"><a href="#GuacamoleDB-3107"><span class="linenos">3107</span></a><span class="sd">        Grants READ permission to a user for accessing a connection group</span>
</span><span id="GuacamoleDB-3108"><a href="#GuacamoleDB-3108"><span class="linenos">3108</span></a><span class="sd">        when you have the database ID rather than the name.</span>
</span><span id="GuacamoleDB-3109"><a href="#GuacamoleDB-3109"><span class="linenos">3109</span></a>
</span><span id="GuacamoleDB-3110"><a href="#GuacamoleDB-3110"><span class="linenos">3110</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB-3111"><a href="#GuacamoleDB-3111"><span class="linenos">3111</span></a><span class="sd">            username: Name of the user to grant permission to.</span>
</span><span id="GuacamoleDB-3112"><a href="#GuacamoleDB-3112"><span class="linenos">3112</span></a><span class="sd">            conngroup_id: Database ID of the connection group to grant access to.</span>
</span><span id="GuacamoleDB-3113"><a href="#GuacamoleDB-3113"><span class="linenos">3113</span></a>
</span><span id="GuacamoleDB-3114"><a href="#GuacamoleDB-3114"><span class="linenos">3114</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB-3115"><a href="#GuacamoleDB-3115"><span class="linenos">3115</span></a><span class="sd">            True if the permission was granted successfully.</span>
</span><span id="GuacamoleDB-3116"><a href="#GuacamoleDB-3116"><span class="linenos">3116</span></a>
</span><span id="GuacamoleDB-3117"><a href="#GuacamoleDB-3117"><span class="linenos">3117</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB-3118"><a href="#GuacamoleDB-3118"><span class="linenos">3118</span></a><span class="sd">            ValueError: If username is invalid, conngroup_id is not a positive</span>
</span><span id="GuacamoleDB-3119"><a href="#GuacamoleDB-3119"><span class="linenos">3119</span></a><span class="sd">                       integer, or if the user or connection group doesn&#39;t exist.</span>
</span><span id="GuacamoleDB-3120"><a href="#GuacamoleDB-3120"><span class="linenos">3120</span></a><span class="sd">            mysql.connector.Error: If database operation fails.</span>
</span><span id="GuacamoleDB-3121"><a href="#GuacamoleDB-3121"><span class="linenos">3121</span></a>
</span><span id="GuacamoleDB-3122"><a href="#GuacamoleDB-3122"><span class="linenos">3122</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB-3123"><a href="#GuacamoleDB-3123"><span class="linenos">3123</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB-3124"><a href="#GuacamoleDB-3124"><span class="linenos">3124</span></a><span class="sd">            ...     success = db.grant_connection_group_permission_to_user_by_id(</span>
</span><span id="GuacamoleDB-3125"><a href="#GuacamoleDB-3125"><span class="linenos">3125</span></a><span class="sd">            ...         &quot;john.doe&quot;, 42</span>
</span><span id="GuacamoleDB-3126"><a href="#GuacamoleDB-3126"><span class="linenos">3126</span></a><span class="sd">            ...     )</span>
</span><span id="GuacamoleDB-3127"><a href="#GuacamoleDB-3127"><span class="linenos">3127</span></a><span class="sd">            ...     print(f&quot;Permission granted: {success}&quot;)</span>
</span><span id="GuacamoleDB-3128"><a href="#GuacamoleDB-3128"><span class="linenos">3128</span></a><span class="sd">            Permission granted: True</span>
</span><span id="GuacamoleDB-3129"><a href="#GuacamoleDB-3129"><span class="linenos">3129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3130"><a href="#GuacamoleDB-3130"><span class="linenos">3130</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB-3131"><a href="#GuacamoleDB-3131"><span class="linenos">3131</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3132"><a href="#GuacamoleDB-3132"><span class="linenos">3132</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="GuacamoleDB-3133"><a href="#GuacamoleDB-3133"><span class="linenos">3133</span></a>            <span class="n">conngroup_id</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-3134"><a href="#GuacamoleDB-3134"><span class="linenos">3134</span></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="GuacamoleDB-3135"><a href="#GuacamoleDB-3135"><span class="linenos">3135</span></a>            <span class="ow">or</span> <span class="n">conngroup_id</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GuacamoleDB-3136"><a href="#GuacamoleDB-3136"><span class="linenos">3136</span></a>        <span class="p">):</span>
</span><span id="GuacamoleDB-3137"><a href="#GuacamoleDB-3137"><span class="linenos">3137</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group ID must be a positive integer&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3138"><a href="#GuacamoleDB-3138"><span class="linenos">3138</span></a>
</span><span id="GuacamoleDB-3139"><a href="#GuacamoleDB-3139"><span class="linenos">3139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-3140"><a href="#GuacamoleDB-3140"><span class="linenos">3140</span></a>            <span class="c1"># Get connection group name for error messages</span>
</span><span id="GuacamoleDB-3141"><a href="#GuacamoleDB-3141"><span class="linenos">3141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3142"><a href="#GuacamoleDB-3142"><span class="linenos">3142</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3143"><a href="#GuacamoleDB-3143"><span class="linenos">3143</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-3144"><a href="#GuacamoleDB-3144"><span class="linenos">3144</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB-3145"><a href="#GuacamoleDB-3145"><span class="linenos">3145</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3146"><a href="#GuacamoleDB-3146"><span class="linenos">3146</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3147"><a href="#GuacamoleDB-3147"><span class="linenos">3147</span></a>                <span class="p">(</span><span class="n">conngroup_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-3148"><a href="#GuacamoleDB-3148"><span class="linenos">3148</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3149"><a href="#GuacamoleDB-3149"><span class="linenos">3149</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3150"><a href="#GuacamoleDB-3150"><span class="linenos">3150</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-3151"><a href="#GuacamoleDB-3151"><span class="linenos">3151</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3152"><a href="#GuacamoleDB-3152"><span class="linenos">3152</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group ID lookup failed for: </span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3153"><a href="#GuacamoleDB-3153"><span class="linenos">3153</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3154"><a href="#GuacamoleDB-3154"><span class="linenos">3154</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3155"><a href="#GuacamoleDB-3155"><span class="linenos">3155</span></a>            <span class="n">actual_conngroup_id</span><span class="p">,</span> <span class="n">conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-3156"><a href="#GuacamoleDB-3156"><span class="linenos">3156</span></a>
</span><span id="GuacamoleDB-3157"><a href="#GuacamoleDB-3157"><span class="linenos">3157</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB-3158"><a href="#GuacamoleDB-3158"><span class="linenos">3158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3159"><a href="#GuacamoleDB-3159"><span class="linenos">3159</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3160"><a href="#GuacamoleDB-3160"><span class="linenos">3160</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB-3161"><a href="#GuacamoleDB-3161"><span class="linenos">3161</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-3162"><a href="#GuacamoleDB-3162"><span class="linenos">3162</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3163"><a href="#GuacamoleDB-3163"><span class="linenos">3163</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3164"><a href="#GuacamoleDB-3164"><span class="linenos">3164</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-3165"><a href="#GuacamoleDB-3165"><span class="linenos">3165</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3166"><a href="#GuacamoleDB-3166"><span class="linenos">3166</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3167"><a href="#GuacamoleDB-3167"><span class="linenos">3167</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-3168"><a href="#GuacamoleDB-3168"><span class="linenos">3168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3169"><a href="#GuacamoleDB-3169"><span class="linenos">3169</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3170"><a href="#GuacamoleDB-3170"><span class="linenos">3170</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-3171"><a href="#GuacamoleDB-3171"><span class="linenos">3171</span></a>
</span><span id="GuacamoleDB-3172"><a href="#GuacamoleDB-3172"><span class="linenos">3172</span></a>            <span class="c1"># Check if permission already exists</span>
</span><span id="GuacamoleDB-3173"><a href="#GuacamoleDB-3173"><span class="linenos">3173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3174"><a href="#GuacamoleDB-3174"><span class="linenos">3174</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3175"><a href="#GuacamoleDB-3175"><span class="linenos">3175</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-3176"><a href="#GuacamoleDB-3176"><span class="linenos">3176</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-3177"><a href="#GuacamoleDB-3177"><span class="linenos">3177</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3178"><a href="#GuacamoleDB-3178"><span class="linenos">3178</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3179"><a href="#GuacamoleDB-3179"><span class="linenos">3179</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-3180"><a href="#GuacamoleDB-3180"><span class="linenos">3180</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3181"><a href="#GuacamoleDB-3181"><span class="linenos">3181</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3182"><a href="#GuacamoleDB-3182"><span class="linenos">3182</span></a>            <span class="k">if</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB-3183"><a href="#GuacamoleDB-3183"><span class="linenos">3183</span></a>                <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-3184"><a href="#GuacamoleDB-3184"><span class="linenos">3184</span></a>                <span class="k">if</span> <span class="n">permission_type</span> <span class="o">==</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-3185"><a href="#GuacamoleDB-3185"><span class="linenos">3185</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-3186"><a href="#GuacamoleDB-3186"><span class="linenos">3186</span></a>                        <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; already has permission for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3187"><a href="#GuacamoleDB-3187"><span class="linenos">3187</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-3188"><a href="#GuacamoleDB-3188"><span class="linenos">3188</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-3189"><a href="#GuacamoleDB-3189"><span class="linenos">3189</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3190"><a href="#GuacamoleDB-3190"><span class="linenos">3190</span></a>                        <span class="sa">f</span><span class="s2">&quot;Updating existing permission &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3191"><a href="#GuacamoleDB-3191"><span class="linenos">3191</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB-3192"><a href="#GuacamoleDB-3192"><span class="linenos">3192</span></a>
</span><span id="GuacamoleDB-3193"><a href="#GuacamoleDB-3193"><span class="linenos">3193</span></a>            <span class="c1"># Grant permission (INSERT or UPDATE if unexpected permission exists)</span>
</span><span id="GuacamoleDB-3194"><a href="#GuacamoleDB-3194"><span class="linenos">3194</span></a>            <span class="k">if</span> <span class="n">existing_permission</span> <span class="ow">and</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB-3195"><a href="#GuacamoleDB-3195"><span class="linenos">3195</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3196"><a href="#GuacamoleDB-3196"><span class="linenos">3196</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3197"><a href="#GuacamoleDB-3197"><span class="linenos">3197</span></a><span class="sd">                    UPDATE guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-3198"><a href="#GuacamoleDB-3198"><span class="linenos">3198</span></a><span class="sd">                    SET permission = &#39;READ&#39;</span>
</span><span id="GuacamoleDB-3199"><a href="#GuacamoleDB-3199"><span class="linenos">3199</span></a><span class="sd">                    WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-3200"><a href="#GuacamoleDB-3200"><span class="linenos">3200</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3201"><a href="#GuacamoleDB-3201"><span class="linenos">3201</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-3202"><a href="#GuacamoleDB-3202"><span class="linenos">3202</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3203"><a href="#GuacamoleDB-3203"><span class="linenos">3203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3204"><a href="#GuacamoleDB-3204"><span class="linenos">3204</span></a>                    <span class="sa">f</span><span class="s2">&quot;Updated permission to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; on connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3205"><a href="#GuacamoleDB-3205"><span class="linenos">3205</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3206"><a href="#GuacamoleDB-3206"><span class="linenos">3206</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB-3207"><a href="#GuacamoleDB-3207"><span class="linenos">3207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3208"><a href="#GuacamoleDB-3208"><span class="linenos">3208</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3209"><a href="#GuacamoleDB-3209"><span class="linenos">3209</span></a><span class="sd">                    INSERT INTO guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-3210"><a href="#GuacamoleDB-3210"><span class="linenos">3210</span></a><span class="sd">                    (entity_id, connection_group_id, permission)</span>
</span><span id="GuacamoleDB-3211"><a href="#GuacamoleDB-3211"><span class="linenos">3211</span></a><span class="sd">                    VALUES (%s, %s, &#39;READ&#39;)</span>
</span><span id="GuacamoleDB-3212"><a href="#GuacamoleDB-3212"><span class="linenos">3212</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3213"><a href="#GuacamoleDB-3213"><span class="linenos">3213</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-3214"><a href="#GuacamoleDB-3214"><span class="linenos">3214</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3215"><a href="#GuacamoleDB-3215"><span class="linenos">3215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3216"><a href="#GuacamoleDB-3216"><span class="linenos">3216</span></a>                    <span class="sa">f</span><span class="s2">&quot;Granted &#39;READ&#39; permission to user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3217"><a href="#GuacamoleDB-3217"><span class="linenos">3217</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3218"><a href="#GuacamoleDB-3218"><span class="linenos">3218</span></a>
</span><span id="GuacamoleDB-3219"><a href="#GuacamoleDB-3219"><span class="linenos">3219</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-3220"><a href="#GuacamoleDB-3220"><span class="linenos">3220</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-3221"><a href="#GuacamoleDB-3221"><span class="linenos">3221</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error granting connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3222"><a href="#GuacamoleDB-3222"><span class="linenos">3222</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB-3223"><a href="#GuacamoleDB-3223"><span class="linenos">3223</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="GuacamoleDB-3224"><a href="#GuacamoleDB-3224"><span class="linenos">3224</span></a>
</span><span id="GuacamoleDB-3225"><a href="#GuacamoleDB-3225"><span class="linenos">3225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_connection_group_permission_from_user_by_id</span><span class="p">(</span>
</span><span id="GuacamoleDB-3226"><a href="#GuacamoleDB-3226"><span class="linenos">3226</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GuacamoleDB-3227"><a href="#GuacamoleDB-3227"><span class="linenos">3227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB-3228"><a href="#GuacamoleDB-3228"><span class="linenos">3228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke connection group permission from a specific user by connection group ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3229"><a href="#GuacamoleDB-3229"><span class="linenos">3229</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB-3230"><a href="#GuacamoleDB-3230"><span class="linenos">3230</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3231"><a href="#GuacamoleDB-3231"><span class="linenos">3231</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="GuacamoleDB-3232"><a href="#GuacamoleDB-3232"><span class="linenos">3232</span></a>            <span class="n">conngroup_id</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="GuacamoleDB-3233"><a href="#GuacamoleDB-3233"><span class="linenos">3233</span></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="GuacamoleDB-3234"><a href="#GuacamoleDB-3234"><span class="linenos">3234</span></a>            <span class="ow">or</span> <span class="n">conngroup_id</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GuacamoleDB-3235"><a href="#GuacamoleDB-3235"><span class="linenos">3235</span></a>        <span class="p">):</span>
</span><span id="GuacamoleDB-3236"><a href="#GuacamoleDB-3236"><span class="linenos">3236</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group ID must be a positive integer&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3237"><a href="#GuacamoleDB-3237"><span class="linenos">3237</span></a>
</span><span id="GuacamoleDB-3238"><a href="#GuacamoleDB-3238"><span class="linenos">3238</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB-3239"><a href="#GuacamoleDB-3239"><span class="linenos">3239</span></a>            <span class="c1"># Get connection group name for error messages</span>
</span><span id="GuacamoleDB-3240"><a href="#GuacamoleDB-3240"><span class="linenos">3240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3241"><a href="#GuacamoleDB-3241"><span class="linenos">3241</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3242"><a href="#GuacamoleDB-3242"><span class="linenos">3242</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB-3243"><a href="#GuacamoleDB-3243"><span class="linenos">3243</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB-3244"><a href="#GuacamoleDB-3244"><span class="linenos">3244</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3245"><a href="#GuacamoleDB-3245"><span class="linenos">3245</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3246"><a href="#GuacamoleDB-3246"><span class="linenos">3246</span></a>                <span class="p">(</span><span class="n">conngroup_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB-3247"><a href="#GuacamoleDB-3247"><span class="linenos">3247</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3248"><a href="#GuacamoleDB-3248"><span class="linenos">3248</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3249"><a href="#GuacamoleDB-3249"><span class="linenos">3249</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-3250"><a href="#GuacamoleDB-3250"><span class="linenos">3250</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3251"><a href="#GuacamoleDB-3251"><span class="linenos">3251</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group ID lookup failed for: </span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3252"><a href="#GuacamoleDB-3252"><span class="linenos">3252</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3253"><a href="#GuacamoleDB-3253"><span class="linenos">3253</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3254"><a href="#GuacamoleDB-3254"><span class="linenos">3254</span></a>            <span class="n">actual_conngroup_id</span><span class="p">,</span> <span class="n">conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-3255"><a href="#GuacamoleDB-3255"><span class="linenos">3255</span></a>
</span><span id="GuacamoleDB-3256"><a href="#GuacamoleDB-3256"><span class="linenos">3256</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB-3257"><a href="#GuacamoleDB-3257"><span class="linenos">3257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3258"><a href="#GuacamoleDB-3258"><span class="linenos">3258</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3259"><a href="#GuacamoleDB-3259"><span class="linenos">3259</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB-3260"><a href="#GuacamoleDB-3260"><span class="linenos">3260</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB-3261"><a href="#GuacamoleDB-3261"><span class="linenos">3261</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3262"><a href="#GuacamoleDB-3262"><span class="linenos">3262</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3263"><a href="#GuacamoleDB-3263"><span class="linenos">3263</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB-3264"><a href="#GuacamoleDB-3264"><span class="linenos">3264</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3265"><a href="#GuacamoleDB-3265"><span class="linenos">3265</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3266"><a href="#GuacamoleDB-3266"><span class="linenos">3266</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB-3267"><a href="#GuacamoleDB-3267"><span class="linenos">3267</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3268"><a href="#GuacamoleDB-3268"><span class="linenos">3268</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB-3269"><a href="#GuacamoleDB-3269"><span class="linenos">3269</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB-3270"><a href="#GuacamoleDB-3270"><span class="linenos">3270</span></a>
</span><span id="GuacamoleDB-3271"><a href="#GuacamoleDB-3271"><span class="linenos">3271</span></a>            <span class="c1"># Check if permission exists and get its type</span>
</span><span id="GuacamoleDB-3272"><a href="#GuacamoleDB-3272"><span class="linenos">3272</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3273"><a href="#GuacamoleDB-3273"><span class="linenos">3273</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3274"><a href="#GuacamoleDB-3274"><span class="linenos">3274</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-3275"><a href="#GuacamoleDB-3275"><span class="linenos">3275</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-3276"><a href="#GuacamoleDB-3276"><span class="linenos">3276</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3277"><a href="#GuacamoleDB-3277"><span class="linenos">3277</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3278"><a href="#GuacamoleDB-3278"><span class="linenos">3278</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-3279"><a href="#GuacamoleDB-3279"><span class="linenos">3279</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3280"><a href="#GuacamoleDB-3280"><span class="linenos">3280</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB-3281"><a href="#GuacamoleDB-3281"><span class="linenos">3281</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB-3282"><a href="#GuacamoleDB-3282"><span class="linenos">3282</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-3283"><a href="#GuacamoleDB-3283"><span class="linenos">3283</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; has no permission for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3284"><a href="#GuacamoleDB-3284"><span class="linenos">3284</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3285"><a href="#GuacamoleDB-3285"><span class="linenos">3285</span></a>
</span><span id="GuacamoleDB-3286"><a href="#GuacamoleDB-3286"><span class="linenos">3286</span></a>            <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB-3287"><a href="#GuacamoleDB-3287"><span class="linenos">3287</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3288"><a href="#GuacamoleDB-3288"><span class="linenos">3288</span></a>                <span class="sa">f</span><span class="s2">&quot;Revoking &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3289"><a href="#GuacamoleDB-3289"><span class="linenos">3289</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3290"><a href="#GuacamoleDB-3290"><span class="linenos">3290</span></a>
</span><span id="GuacamoleDB-3291"><a href="#GuacamoleDB-3291"><span class="linenos">3291</span></a>            <span class="c1"># Revoke permission</span>
</span><span id="GuacamoleDB-3292"><a href="#GuacamoleDB-3292"><span class="linenos">3292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB-3293"><a href="#GuacamoleDB-3293"><span class="linenos">3293</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB-3294"><a href="#GuacamoleDB-3294"><span class="linenos">3294</span></a><span class="sd">                DELETE FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB-3295"><a href="#GuacamoleDB-3295"><span class="linenos">3295</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB-3296"><a href="#GuacamoleDB-3296"><span class="linenos">3296</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB-3297"><a href="#GuacamoleDB-3297"><span class="linenos">3297</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB-3298"><a href="#GuacamoleDB-3298"><span class="linenos">3298</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB-3299"><a href="#GuacamoleDB-3299"><span class="linenos">3299</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3300"><a href="#GuacamoleDB-3300"><span class="linenos">3300</span></a>
</span><span id="GuacamoleDB-3301"><a href="#GuacamoleDB-3301"><span class="linenos">3301</span></a>            <span class="c1"># Verify deletion was successful</span>
</span><span id="GuacamoleDB-3302"><a href="#GuacamoleDB-3302"><span class="linenos">3302</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB-3303"><a href="#GuacamoleDB-3303"><span class="linenos">3303</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB-3304"><a href="#GuacamoleDB-3304"><span class="linenos">3304</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to revoke permission - no rows affected. Permission may have been removed by another operation.&quot;</span>
</span><span id="GuacamoleDB-3305"><a href="#GuacamoleDB-3305"><span class="linenos">3305</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB-3306"><a href="#GuacamoleDB-3306"><span class="linenos">3306</span></a>
</span><span id="GuacamoleDB-3307"><a href="#GuacamoleDB-3307"><span class="linenos">3307</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB-3308"><a href="#GuacamoleDB-3308"><span class="linenos">3308</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully revoked &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB-3309"><a href="#GuacamoleDB-3309"><span class="linenos">3309</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB-3310"><a href="#GuacamoleDB-3310"><span class="linenos">3310</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB-3311"><a href="#GuacamoleDB-3311"><span class="linenos">3311</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB-3312"><a href="#GuacamoleDB-3312"><span class="linenos">3312</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error revoking connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB-3313"><a href="#GuacamoleDB-3313"><span class="linenos">3313</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB-3314"><a href="#GuacamoleDB-3314"><span class="linenos">3314</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span></pre></div>


            <div class="docstring"><p>Database interface for Apache Guacamole management.</p>

<p>Provides a high-level interface for managing Apache Guacamole database entities
including users, user groups, connections, connection groups, and permissions.
This class handles MySQL database connections and provides methods for CRUD
operations on Guacamole entities.</p>

<p>Attributes:
    CONNECTION_PARAMETERS: Dictionary defining valid connection parameters by protocol.
    USER_PARAMETERS: Dictionary defining valid user account parameters.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="using-config-file">Using config file</h1>
      
      <p>with GuacamoleDB("~/.guacaman.ini") as db:
          ...     users = db.list_users()
          ...     print(f"Found {len(users)} users")</p>
      
      <h1 id="using-environment-variables">Using environment variables</h1>
      
      <p>import os
      os.environ['GUACALIB_HOST'] = 'localhost'
      os.environ['GUACALIB_USER'] = 'guacamole_user'
      os.environ['GUACALIB_PASSWORD'] = 'secret_password'
      os.environ['GUACALIB_DATABASE'] = 'guacamole_db'
      with GuacamoleDB() as db:
          ...     users = db.list_users()
          ...     print(f"Found {len(users)} users")</p>
    </blockquote>
  </blockquote>
</blockquote>

<p>Note:
    This class implements the context manager protocol for automatic
    database connection handling and transaction management.</p>

<pre><code>Database connection can be configured using:
1. Environment variables (GUACALIB_HOST, GUACALIB_USER, GUACALIB_PASSWORD,
   GUACALIB_DATABASE) - takes precedence
2. Configuration file with [mysql] section containing host, user, password,
   and database keys
</code></pre>
</div>


                            <div id="GuacamoleDB.__init__" class="classattr">
                                        <input id="GuacamoleDB.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GuacamoleDB</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;db_config.ini&#39;</span>, </span><span class="param"><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="GuacamoleDB.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.__init__-71"><a href="#GuacamoleDB.__init__-71"><span class="linenos">71</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;db_config.ini&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.__init__-72"><a href="#GuacamoleDB.__init__-72"><span class="linenos">72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize GuacamoleDB with configuration and database connection.</span>
</span><span id="GuacamoleDB.__init__-73"><a href="#GuacamoleDB.__init__-73"><span class="linenos">73</span></a>
</span><span id="GuacamoleDB.__init__-74"><a href="#GuacamoleDB.__init__-74"><span class="linenos">74</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.__init__-75"><a href="#GuacamoleDB.__init__-75"><span class="linenos">75</span></a><span class="sd">            config_file: Path to MySQL configuration file. Defaults to &quot;db_config.ini&quot;.</span>
</span><span id="GuacamoleDB.__init__-76"><a href="#GuacamoleDB.__init__-76"><span class="linenos">76</span></a><span class="sd">            debug: Enable debug output for database operations. Defaults to False.</span>
</span><span id="GuacamoleDB.__init__-77"><a href="#GuacamoleDB.__init__-77"><span class="linenos">77</span></a>
</span><span id="GuacamoleDB.__init__-78"><a href="#GuacamoleDB.__init__-78"><span class="linenos">78</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.__init__-79"><a href="#GuacamoleDB.__init__-79"><span class="linenos">79</span></a><span class="sd">            SystemExit: If configuration file is not found or invalid and environment</span>
</span><span id="GuacamoleDB.__init__-80"><a href="#GuacamoleDB.__init__-80"><span class="linenos">80</span></a><span class="sd">                       variables are not set.</span>
</span><span id="GuacamoleDB.__init__-81"><a href="#GuacamoleDB.__init__-81"><span class="linenos">81</span></a><span class="sd">            mysql.connector.Error: If database connection fails.</span>
</span><span id="GuacamoleDB.__init__-82"><a href="#GuacamoleDB.__init__-82"><span class="linenos">82</span></a>
</span><span id="GuacamoleDB.__init__-83"><a href="#GuacamoleDB.__init__-83"><span class="linenos">83</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.__init__-84"><a href="#GuacamoleDB.__init__-84"><span class="linenos">84</span></a><span class="sd">            Configuration is loaded in the following priority order:</span>
</span><span id="GuacamoleDB.__init__-85"><a href="#GuacamoleDB.__init__-85"><span class="linenos">85</span></a><span class="sd">            1. Environment variables (GUACALIB_HOST, GUACALIB_USER, GUACALIB_PASSWORD,</span>
</span><span id="GuacamoleDB.__init__-86"><a href="#GuacamoleDB.__init__-86"><span class="linenos">86</span></a><span class="sd">               GUACALIB_DATABASE)</span>
</span><span id="GuacamoleDB.__init__-87"><a href="#GuacamoleDB.__init__-87"><span class="linenos">87</span></a><span class="sd">            2. Configuration file containing a [mysql] section with host, user,</span>
</span><span id="GuacamoleDB.__init__-88"><a href="#GuacamoleDB.__init__-88"><span class="linenos">88</span></a><span class="sd">               password, and database keys.</span>
</span><span id="GuacamoleDB.__init__-89"><a href="#GuacamoleDB.__init__-89"><span class="linenos">89</span></a>
</span><span id="GuacamoleDB.__init__-90"><a href="#GuacamoleDB.__init__-90"><span class="linenos">90</span></a><span class="sd">            Environment variables take precedence over configuration file settings.</span>
</span><span id="GuacamoleDB.__init__-91"><a href="#GuacamoleDB.__init__-91"><span class="linenos">91</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.__init__-92"><a href="#GuacamoleDB.__init__-92"><span class="linenos">92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="GuacamoleDB.__init__-93"><a href="#GuacamoleDB.__init__-93"><span class="linenos">93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB.__init__-94"><a href="#GuacamoleDB.__init__-94"><span class="linenos">94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">db_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</span><span id="GuacamoleDB.__init__-95"><a href="#GuacamoleDB.__init__-95"><span class="linenos">95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect_db</span><span class="p">()</span>
</span><span id="GuacamoleDB.__init__-96"><a href="#GuacamoleDB.__init__-96"><span class="linenos">96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Initialize GuacamoleDB with configuration and database connection.</p>

<p>Args:
    config_file: Path to MySQL configuration file. Defaults to "db_config.ini".
    debug: Enable debug output for database operations. Defaults to False.</p>

<p>Raises:
    SystemExit: If configuration file is not found or invalid and environment
               variables are not set.
    mysql.connector.Error: If database connection fails.</p>

<p>Note:
    Configuration is loaded in the following priority order:
    1. Environment variables (GUACALIB_HOST, GUACALIB_USER, GUACALIB_PASSWORD,
       GUACALIB_DATABASE)
    2. Configuration file containing a [mysql] section with host, user,
       password, and database keys.</p>

<pre><code>Environment variables take precedence over configuration file settings.
</code></pre>
</div>


                            </div>
                            <div id="GuacamoleDB.CONNECTION_PARAMETERS" class="classattr">
                                <div class="attr variable">
            <span class="name">CONNECTION_PARAMETERS</span>        =
<input id="GuacamoleDB.CONNECTION_PARAMETERS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="GuacamoleDB.CONNECTION_PARAMETERS-view-value"></label><span class="default_value">{&#39;Dictionary defining all supported Guacamole connection parameters.\n\n    Each parameter entry contains the following keys:\n        - type: MySQL data type for storing the parameter\n        - description: Human-readable description of the parameter\&#39;s purpose\n        - default: Default value when parameter is not specified\n        - ref: Optional reference to Guacamole documentation URL\n        - table: Database table where parameter is stored (&#34;connection&#34; or &#34;parameter&#34;)\n\n    The dictionary is organized by functional categories:\n    - Core connection parameters (protocol, limits, proxy settings)\n    - Network and authentication parameters (hostname, port, credentials)\n    - Display and graphics settings (resolution, color depth, encoding)\n    - Audio and device redirection settings\n    - Session recording and logging parameters\n    - Protocol-specific features (SSH terminal, RDP gateway, etc.)\n    protocol&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The protocol to use with this connection.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/jdbc-auth.html#connections-and-parameters&#39;, &#39;table&#39;: &#39;connection&#39;}, &#39;max_connections&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Maximum number of connections allowed to this connection&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/jdbc-auth.html#connections-and-parameters&#39;, &#39;table&#39;: &#39;connection&#39;}, &#39;max_connections_per_user&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Maximum number of connections allowed per user&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/jdbc-auth.html#connections-and-parameters&#39;, &#39;table&#39;: &#39;connection&#39;}, &#39;proxy_hostname&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The hostname or IP address of the Guacamole proxy.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/jdbc-auth.html#connections-and-parameters&#39;, &#39;table&#39;: &#39;connection&#39;}, &#39;proxy_port&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;The TCP port number of the Guacamole proxy daemon.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/jdbc-auth.html#connections-and-parameters&#39;, &#39;table&#39;: &#39;connection&#39;}, &#39;connection_weight&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;The weight for a connection.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/jdbc-auth.html#connections-and-parameters&#39;, &#39;table&#39;: &#39;connection&#39;}, &#39;failover_only&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Whether this connection should be used for failover situations only.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/jdbc-auth.html#connections-and-parameters&#39;, &#39;table&#39;: &#39;connection&#39;}, &#39;username&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The username to use to authenticate, if any.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;private-key&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The entire contents of the private key to use for public key authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#ssh-authentication&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;listen-timeout&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;If reverse connection is in use, the maximum amount of time to wait.&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#reverse-vnc-connections&#39;, &#39;default&#39;: &#39;5000&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;reverse-connect&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Whether reverse connection should be used. &#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#reverse-vnc-connections&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;host-key&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The known hosts entry for the SSH server.&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#ssh-network-parameters&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;server-alive-interval&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Configure the the server keepalive interval. The minimum value is 2.&#39;, &#39;default&#39;: &#39;0&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#ssh-network-parameters&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;passphrase&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The passphrase to use to decrypt the private key for use in public key authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#ssh-authentication&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-audio&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, audio support will be enabled.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#audio-support-via-pulseaudio&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;audio-servername&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The name of the PulseAudio server to connect to.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#audio-support-via-pulseaudio&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;clipboard-encoding&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The encoding to assume for the VNC clipboard&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#clipboard-encoding&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;autoretry&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;The number of times to retry connecting before giving up and returning an error.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#network-parameters&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-sftp&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Whether file transfer should be enabled.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-hostname&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Hostname of the SFTP server.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-port&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Port of the SFTP server.&#39;, &#39;default&#39;: &#39;22&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-host-key&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The known hosts entry for the SFTP server.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-username&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Username for SFTP authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-password&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Password for SFTP authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-private-key&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Private key for SFTP authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-passphrase&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Passphrase for SFTP private key.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-directory&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The directory to upload files to if they are simply dragged and dropped, and thus otherwise lack a specific upload location.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-root-directory&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The directory to expose to connected users via Guacamoles file browser.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-disable-download&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true downloads from the remote system to the client (browser) will be disabled.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-disable-upload&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true uploads from the client (browser) to the remote system will be disabled.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;timezone&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;This parameter allows you to control the timezone.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#internationalization-locale-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;locale&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The specific locale to request for the SSH session.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#internationalization-locale-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;command&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The command to execute over the SSH session, if any.&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#running-a-command-instead-of-a-shell&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;terminal-type&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;This parameter sets the terminal emulator type string that is passed to the server.&#39;, &#39;default&#39;: &#39;linux&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#controlling-terminal-behavior&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;color-scheme&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The color scheme to use for the terminal session.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#terminal-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;font-name&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Font to use for SSH terminal.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#terminal-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;font-size&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Font size in points for SSH terminal.&#39;, &#39;default&#39;: &#39;12&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#terminal-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;scrollback&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Number of lines in SSH terminal scrollback buffer.&#39;, &#39;default&#39;: &#39;1000&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#terminal-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;backspace&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;ASCII code that the backspace key sends to the remote system. Default is 127 (Delete).&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#controlling-terminal-behavior&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;hostname&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The hostname or IP address of the server Guacamole should connect to.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;port&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Port of the remote server, usually 22 for SSH, 3389 for RDP and 5900 for VNC&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;password&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Password for the connection (VNC password, SSH password, etc.)&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;dest-host&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The destination host to request when connecting to a VNC proxy.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#vnc-repeater&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;dest-port&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The destination port to request when connecting to a VNC proxy.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#vnc-repeater&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-upload&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, uploads from the client (browser) to the remote server location will be disabled. &#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-download&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true downloads from the remote server to client (browser) will be disabled.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;static-channels&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;A comma-separated list of static channel names to open and expose as pipes (up to 7 characters each)&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;console-audio&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, audio will be explicitly enabled in the console (admin) session of the RDP server.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;create-drive-path&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, and file transfer is enabled, the directory specified by the drive-path parameter will automatically be created if it does not yet exist.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;drive-path&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The directory on the Guacamole server in which transferred files should be stored.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;drive-name&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The name of the filesystem used when passed through to the RDP session.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-drive&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable file transfer support by setting this parameter to &#34;true&#34;.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;printer-name&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The name of the redirected printer device that is passed through to the RDP session.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-printing&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable printing by setting this parameter to &#34;true&#34;.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-touch&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to &#34;true&#34;, support for multi-touch events will be enabled&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-audio-input&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, audio input support (microphone) will be enabled&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-audio&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Disable sound by setting this parameter to &#34;true&#34;&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#device-redirection&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;read-only&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Whether the connection is read-only (true/false)&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;encodings&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;A space-delimited list of VNC encodings to use.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;cursor&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;If set to remote, the mouse pointer will be rendered remotely,&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;swap-red-blue&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;The red and blue components of each color are swapped.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;force-lossless&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Whether this connection should only use lossless compression for graphical updates. &#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#rdp-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;resize-method&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The method to use to update the RDP server when the width or height of the client display changes: display-update|reconnect&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#rdp-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;dpi&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;The desired effective resolution of the client display, in DPI.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#rdp-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;height&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;The height of the display to request, in pixels.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#rdp-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;width&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;The width of the display to request, in pixels.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#rdp-display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;color-depth&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;The color depth to request, in bits-per-pixel. Allowed 8, 16, 24, or 32 (bits-per-pixel).&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#display-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;server-layout&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The server-side keyboard layout (like en-us-qwerty, etc).&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#session-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;initial-program&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The full path to the program to run immediately upon connecting.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#session-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;console&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, you will be connected to the console (admin) session of the RDP server.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#session-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;client-name&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;If this parameter is specified, Guacamole will use its value as hostname.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#session-settings&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;normalize-clipboard&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The type of line ending normalization to apply to text within the clipboard, if any: preserve|unix|windows&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#clipboard-normalization&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-auth&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, authentication will be disabled.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-security&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;security&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The security mode to use for the RDP connection: any|nla|nla-ext|tls|vmconnect|rdp&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-security&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;domain&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The domain to use when attempting authentication, if any. This parameter is optional&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-security&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;gateway-hostname&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Hostname of the RD Gateway server.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remote-desktop-gateway&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;gateway-port&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Port of the RD Gateway server.&#39;, &#39;default&#39;: &#39;443&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remote-desktop-gateway&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;gateway-username&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Username for RD Gateway authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remote-desktop-gateway&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;gateway-password&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Password for RD Gateway authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remote-desktop-gateway&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;gateway-domain&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Domain for RD Gateway authentication.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remote-desktop-gateway&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;preconnection-id&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Integer ID for preconnection PDU.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#preconnection-pdu-hyper-v-vmconnect&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;preconnection-blob&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;String blob for preconnection PDU.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#preconnection-pdu-hyper-v-vmconnect&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;remote-app&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;RemoteApp program alias to launch.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remoteapp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;remote-app-dir&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Working directory for the RemoteApp.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remoteapp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;remote-app-args&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Arguments for the RemoteApp.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#remoteapp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-wallpaper&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable desktop wallpaper in RDP session.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-theming&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable theming of windows and controls.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-font-smoothing&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable font smoothing (ClearType).&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-full-window-drag&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable full window drag (show contents while dragging).&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-desktop-composition&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable desktop composition (Aero).&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;enable-menu-animations&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Enable menu animations.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;username-regex&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Regular expression for detecting username prompt in telnet.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#telnet-authentication&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;password-regex&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Regular expression for detecting password prompt in telnet.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#telnet-authentication&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;login-success-regex&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Regular expression for detecting successful login in telnet.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#telnet-authentication&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;login-failure-regex&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Regular expression for detecting failed login in telnet.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#telnet-authentication&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;load-balance-info&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Load balancing information for RDP connection brokers.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#load-balancing-and-rdp-connection-brokers&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-bitmap-caching&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Disable RDP bitmap caching functionality.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-offscreen-caching&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Disable caching of offscreen regions.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-glyph-caching&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Disable caching of frequently used symbols/fonts. DISABLED due GUACAMOLE-1191.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#performance-flags&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;container&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Name of Kubernetes container to attach to.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#network-container-parameters&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;exec-command&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Command to run in Kubernetes container.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#network-container-parameters&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;pod&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The name of the Kubernetes pod containing with the container being attached to.&#39;, &#39;default&#39;: &#39;default&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#network-container-parameters&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;namespace&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The name of the Kubernetes namespace of the pod containing the container being attached to&#39;, &#39;default&#39;: &#39;default&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#network-container-parameters&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;sftp-server-alive-interval&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Interval in seconds to send keepalive packets to SFTP server.&#39;, &#39;default&#39;: &#39;0&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#sftp&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;wol-send-packet&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;Send Wake-on-LAN packet before connecting.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#wake-on-lan&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;wol-mac-addr&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;MAC address for Wake-on-LAN packet.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#wake-on-lan&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;wol-broadcast-addr&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Broadcast address for Wake-on-LAN packet.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#wake-on-lan&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;wol-udp-port&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;UDP port for Wake-on-LAN packet.&#39;, &#39;default&#39;: &#39;9&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#wake-on-lan&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;wol-wait-time&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;description&#39;: &#39;Seconds to wait after sending Wake-on-LAN packet.&#39;, &#39;default&#39;: &#39;0&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#wake-on-lan&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;typescript-path&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Directory in which typescript files should be created.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#text-session-recording-typescripts&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;create-typescript-path&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If true, automatically create the typescript-path directory if it does not exist.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#text-session-recording-typescripts&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;typescript-name&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Base filename for typescript data and timing files.&#39;, &#39;default&#39;: &#39;typescript&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#text-session-recording-typescripts&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;recording-path&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Directory in which screen recording files should be created.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#graphical-session-recording&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;create-recording-path&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If true, automatically create the recording-path directory if it does not exist.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#graphical-session-recording&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;recording-name&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;Filename to use for created recordings.&#39;, &#39;default&#39;: &#39;recording&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#graphical-session-recording&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;recording-exclude-output&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If true, exclude graphical output from the recording.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#graphical-session-recording&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;recording-exclude-mouse&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If true, exclude mouse events from the recording.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#graphical-session-recording&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;recording-include-keys&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If true, include key events in the recording.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#graphical-session-recording&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-copy&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, disables copying from the remote clipboard to the client.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#disabling-clipboard-access&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;disable-paste&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, disables pasting from the client clipboard to the remote session.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#disabling-clipboard-access&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;ignore-cert&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, the validity of the SSL/TLS certificate used by the Kubernetes server will be ignored if it cannot be validated. Optional.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-ssl-tls&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;ca-cert&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The certificate of the certificate authority that signed the certificate of the Kubernetes server, in PEM format. Optional.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-ssl-tls&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;client-key&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The key to use if performing SSL/TLS client authentication to authenticate with the Kubernetes server, in PEM format. Optional.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-ssl-tls&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;client-cert&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;The certificate to use if performing SSL/TLS client authentication to authenticate with the Kubernetes server, in PEM format.  Optional.&#39;, &#39;default&#39;: &#39;NULL&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-ssl-tls&#39;, &#39;table&#39;: &#39;parameter&#39;}, &#39;use-ssl&#39;: {&#39;type&#39;: &#39;boolean&#39;, &#39;description&#39;: &#39;If set to true, SSL/TLS will be used to connect to the Kubernetes server. Optional.&#39;, &#39;default&#39;: &#39;false&#39;, &#39;ref&#39;: &#39;https://guacamole.apache.org/doc/gug/configuring-guacamole.html#authentication-and-ssl-tls&#39;, &#39;table&#39;: &#39;parameter&#39;}}</span>

        
    </div>
    <a class="headerlink" href="#GuacamoleDB.CONNECTION_PARAMETERS"></a>
    
    

                            </div>
                            <div id="GuacamoleDB.USER_PARAMETERS" class="classattr">
                                <div class="attr variable">
            <span class="name">USER_PARAMETERS</span>        =
<input id="GuacamoleDB.USER_PARAMETERS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="GuacamoleDB.USER_PARAMETERS-view-value"></label><span class="default_value">{&#39;disabled&#39;: {&#39;type&#39;: &#39;tinyint&#39;, &#39;description&#39;: &#39;Whether the user is disabled (0=enabled, 1=disabled)&#39;, &#39;default&#39;: &#39;0&#39;}, &#39;expired&#39;: {&#39;type&#39;: &#39;tinyint&#39;, &#39;description&#39;: &#39;Whether the user account is expired (0=active, 1=expired)&#39;, &#39;default&#39;: &#39;0&#39;}, &#39;access_window_start&#39;: {&#39;type&#39;: &#39;time&#39;, &#39;description&#39;: &#39;Start of allowed access time window (HH:MM:SS)&#39;, &#39;default&#39;: &#39;NULL&#39;}, &#39;access_window_end&#39;: {&#39;type&#39;: &#39;time&#39;, &#39;description&#39;: &#39;End of allowed access time window (HH:MM:SS)&#39;, &#39;default&#39;: &#39;NULL&#39;}, &#39;valid_from&#39;: {&#39;type&#39;: &#39;date&#39;, &#39;description&#39;: &#39;Date when account becomes valid (YYYY-MM-DD)&#39;, &#39;default&#39;: &#39;NULL&#39;}, &#39;valid_until&#39;: {&#39;type&#39;: &#39;date&#39;, &#39;description&#39;: &#39;Date when account expires (YYYY-MM-DD)&#39;, &#39;default&#39;: &#39;NULL&#39;}, &#39;timezone&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#39;User\&#39;s timezone (e.g., &#34;America/New_York&#34;)&#39;, &#39;default&#39;: &#39;NULL&#39;}, &#39;full_name&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#34;User&#39;s full name&#34;, &#39;default&#39;: &#39;NULL&#39;}, &#39;email_address&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#34;User&#39;s email address&#34;, &#39;default&#39;: &#39;NULL&#39;}, &#39;organization&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#34;User&#39;s organization&#34;, &#39;default&#39;: &#39;NULL&#39;}, &#39;organizational_role&#39;: {&#39;type&#39;: &#39;string&#39;, &#39;description&#39;: &#34;User&#39;s role within the organization&#34;, &#39;default&#39;: &#39;NULL&#39;}}</span>

        
    </div>
    <a class="headerlink" href="#GuacamoleDB.USER_PARAMETERS"></a>
    
    

                            </div>
                            <div id="GuacamoleDB.debug" class="classattr">
                                <div class="attr variable">
            <span class="name">debug</span>

        
    </div>
    <a class="headerlink" href="#GuacamoleDB.debug"></a>
    
    

                            </div>
                            <div id="GuacamoleDB.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#GuacamoleDB.logger"></a>
    
    

                            </div>
                            <div id="GuacamoleDB.db_config" class="classattr">
                                <div class="attr variable">
            <span class="name">db_config</span>

        
    </div>
    <a class="headerlink" href="#GuacamoleDB.db_config"></a>
    
    

                            </div>
                            <div id="GuacamoleDB.conn" class="classattr">
                                <div class="attr variable">
            <span class="name">conn</span>

        
    </div>
    <a class="headerlink" href="#GuacamoleDB.conn"></a>
    
    

                            </div>
                            <div id="GuacamoleDB.cursor" class="classattr">
                                <div class="attr variable">
            <span class="name">cursor</span>

        
    </div>
    <a class="headerlink" href="#GuacamoleDB.cursor"></a>
    
    

                            </div>
                            <div id="GuacamoleDB.debug_print" class="classattr">
                                        <input id="GuacamoleDB.debug_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">debug_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.debug_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.debug_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.debug_print-157"><a href="#GuacamoleDB.debug_print-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">debug_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_print-158"><a href="#GuacamoleDB.debug_print-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print debug messages if debug mode is enabled with credential scrubbing.</span>
</span><span id="GuacamoleDB.debug_print-159"><a href="#GuacamoleDB.debug_print-159"><span class="linenos">159</span></a>
</span><span id="GuacamoleDB.debug_print-160"><a href="#GuacamoleDB.debug_print-160"><span class="linenos">160</span></a><span class="sd">        This method provides backward compatibility by using logging when configured</span>
</span><span id="GuacamoleDB.debug_print-161"><a href="#GuacamoleDB.debug_print-161"><span class="linenos">161</span></a><span class="sd">        and falling back to print statements when logging is not available. All</span>
</span><span id="GuacamoleDB.debug_print-162"><a href="#GuacamoleDB.debug_print-162"><span class="linenos">162</span></a><span class="sd">        messages are scrubbed for sensitive credentials before output.</span>
</span><span id="GuacamoleDB.debug_print-163"><a href="#GuacamoleDB.debug_print-163"><span class="linenos">163</span></a>
</span><span id="GuacamoleDB.debug_print-164"><a href="#GuacamoleDB.debug_print-164"><span class="linenos">164</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.debug_print-165"><a href="#GuacamoleDB.debug_print-165"><span class="linenos">165</span></a><span class="sd">            *args: Arguments to pass to print function or logger. All arguments</span>
</span><span id="GuacamoleDB.debug_print-166"><a href="#GuacamoleDB.debug_print-166"><span class="linenos">166</span></a><span class="sd">                  will be converted to strings and scrubbed for credentials.</span>
</span><span id="GuacamoleDB.debug_print-167"><a href="#GuacamoleDB.debug_print-167"><span class="linenos">167</span></a><span class="sd">            **kwargs: Keyword arguments to pass to print function or logger.</span>
</span><span id="GuacamoleDB.debug_print-168"><a href="#GuacamoleDB.debug_print-168"><span class="linenos">168</span></a>
</span><span id="GuacamoleDB.debug_print-169"><a href="#GuacamoleDB.debug_print-169"><span class="linenos">169</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.debug_print-170"><a href="#GuacamoleDB.debug_print-170"><span class="linenos">170</span></a><span class="sd">            This method automatically scrubs all arguments for sensitive</span>
</span><span id="GuacamoleDB.debug_print-171"><a href="#GuacamoleDB.debug_print-171"><span class="linenos">171</span></a><span class="sd">            credentials before output to prevent accidental exposure in logs</span>
</span><span id="GuacamoleDB.debug_print-172"><a href="#GuacamoleDB.debug_print-172"><span class="linenos">172</span></a><span class="sd">            or debug output. It maintains the original debug functionality</span>
</span><span id="GuacamoleDB.debug_print-173"><a href="#GuacamoleDB.debug_print-173"><span class="linenos">173</span></a><span class="sd">            while enhancing security.</span>
</span><span id="GuacamoleDB.debug_print-174"><a href="#GuacamoleDB.debug_print-174"><span class="linenos">174</span></a>
</span><span id="GuacamoleDB.debug_print-175"><a href="#GuacamoleDB.debug_print-175"><span class="linenos">175</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.debug_print-176"><a href="#GuacamoleDB.debug_print-176"><span class="linenos">176</span></a><span class="sd">            &gt;&gt;&gt; self.debug_print(&quot;Connecting with password=secret123&quot;)</span>
</span><span id="GuacamoleDB.debug_print-177"><a href="#GuacamoleDB.debug_print-177"><span class="linenos">177</span></a><span class="sd">            [DEBUG] Connecting with password=[REDACTED]</span>
</span><span id="GuacamoleDB.debug_print-178"><a href="#GuacamoleDB.debug_print-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.debug_print-179"><a href="#GuacamoleDB.debug_print-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_print-180"><a href="#GuacamoleDB.debug_print-180"><span class="linenos">180</span></a>            <span class="c1"># Convert all arguments to strings and scrub credentials</span>
</span><span id="GuacamoleDB.debug_print-181"><a href="#GuacamoleDB.debug_print-181"><span class="linenos">181</span></a>            <span class="n">scrubbed_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.debug_print-182"><a href="#GuacamoleDB.debug_print-182"><span class="linenos">182</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_print-183"><a href="#GuacamoleDB.debug_print-183"><span class="linenos">183</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB.debug_print-184"><a href="#GuacamoleDB.debug_print-184"><span class="linenos">184</span></a>                    <span class="n">scrubbed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
</span><span id="GuacamoleDB.debug_print-185"><a href="#GuacamoleDB.debug_print-185"><span class="linenos">185</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_print-186"><a href="#GuacamoleDB.debug_print-186"><span class="linenos">186</span></a>                    <span class="c1"># For non-string arguments, convert to string then scrub</span>
</span><span id="GuacamoleDB.debug_print-187"><a href="#GuacamoleDB.debug_print-187"><span class="linenos">187</span></a>                    <span class="n">scrubbed_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)))</span>
</span><span id="GuacamoleDB.debug_print-188"><a href="#GuacamoleDB.debug_print-188"><span class="linenos">188</span></a>
</span><span id="GuacamoleDB.debug_print-189"><a href="#GuacamoleDB.debug_print-189"><span class="linenos">189</span></a>            <span class="c1"># Try to use logging if it&#39;s configured, otherwise fall back to print</span>
</span><span id="GuacamoleDB.debug_print-190"><a href="#GuacamoleDB.debug_print-190"><span class="linenos">190</span></a>            <span class="c1"># Check if logging has been configured by checking if the logger has handlers</span>
</span><span id="GuacamoleDB.debug_print-191"><a href="#GuacamoleDB.debug_print-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="s1">&#39;handlers&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_print-192"><a href="#GuacamoleDB.debug_print-192"><span class="linenos">192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scrubbed_args</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_print-193"><a href="#GuacamoleDB.debug_print-193"><span class="linenos">193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_print-194"><a href="#GuacamoleDB.debug_print-194"><span class="linenos">194</span></a>                <span class="c1"># Fallback to original print behavior</span>
</span><span id="GuacamoleDB.debug_print-195"><a href="#GuacamoleDB.debug_print-195"><span class="linenos">195</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">scrubbed_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print debug messages if debug mode is enabled with credential scrubbing.</p>

<p>This method provides backward compatibility by using logging when configured
and falling back to print statements when logging is not available. All
messages are scrubbed for sensitive credentials before output.</p>

<p>Args:
    <em>args: Arguments to pass to print function or logger. All arguments
          will be converted to strings and scrubbed for credentials.
    *</em>kwargs: Keyword arguments to pass to print function or logger.</p>

<p>Note:
    This method automatically scrubs all arguments for sensitive
    credentials before output to prevent accidental exposure in logs
    or debug output. It maintains the original debug functionality
    while enhancing security.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>self.debug_print("Connecting with password=secret123")
          [DEBUG] Connecting with password=[REDACTED]</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.read_config" class="classattr">
                                        <input id="GuacamoleDB.read_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">read_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.read_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.read_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.read_config-239"><a href="#GuacamoleDB.read_config-239"><span class="linenos">239</span></a>    <span class="nd">@staticmethod</span>
</span><span id="GuacamoleDB.read_config-240"><a href="#GuacamoleDB.read_config-240"><span class="linenos">240</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_config</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConnectionConfig</span><span class="p">:</span>
</span><span id="GuacamoleDB.read_config-241"><a href="#GuacamoleDB.read_config-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read and validate MySQL database configuration from environment variables or file.</span>
</span><span id="GuacamoleDB.read_config-242"><a href="#GuacamoleDB.read_config-242"><span class="linenos">242</span></a>
</span><span id="GuacamoleDB.read_config-243"><a href="#GuacamoleDB.read_config-243"><span class="linenos">243</span></a><span class="sd">        First checks for environment variables (GUACALIB_HOST, GUACALIB_USER,</span>
</span><span id="GuacamoleDB.read_config-244"><a href="#GuacamoleDB.read_config-244"><span class="linenos">244</span></a><span class="sd">        GUACALIB_PASSWORD, GUACALIB_DATABASE). If all required environment variables</span>
</span><span id="GuacamoleDB.read_config-245"><a href="#GuacamoleDB.read_config-245"><span class="linenos">245</span></a><span class="sd">        are present, they are used. Otherwise, falls back to reading from configuration</span>
</span><span id="GuacamoleDB.read_config-246"><a href="#GuacamoleDB.read_config-246"><span class="linenos">246</span></a><span class="sd">        file.</span>
</span><span id="GuacamoleDB.read_config-247"><a href="#GuacamoleDB.read_config-247"><span class="linenos">247</span></a>
</span><span id="GuacamoleDB.read_config-248"><a href="#GuacamoleDB.read_config-248"><span class="linenos">248</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.read_config-249"><a href="#GuacamoleDB.read_config-249"><span class="linenos">249</span></a><span class="sd">            config_file: Path to the configuration file.</span>
</span><span id="GuacamoleDB.read_config-250"><a href="#GuacamoleDB.read_config-250"><span class="linenos">250</span></a>
</span><span id="GuacamoleDB.read_config-251"><a href="#GuacamoleDB.read_config-251"><span class="linenos">251</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.read_config-252"><a href="#GuacamoleDB.read_config-252"><span class="linenos">252</span></a><span class="sd">            Dictionary containing MySQL connection parameters with keys:</span>
</span><span id="GuacamoleDB.read_config-253"><a href="#GuacamoleDB.read_config-253"><span class="linenos">253</span></a><span class="sd">            &#39;host&#39;, &#39;user&#39;, &#39;password&#39;, &#39;database&#39;.</span>
</span><span id="GuacamoleDB.read_config-254"><a href="#GuacamoleDB.read_config-254"><span class="linenos">254</span></a>
</span><span id="GuacamoleDB.read_config-255"><a href="#GuacamoleDB.read_config-255"><span class="linenos">255</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.read_config-256"><a href="#GuacamoleDB.read_config-256"><span class="linenos">256</span></a><span class="sd">            SystemExit: If config file is not found, missing required sections,</span>
</span><span id="GuacamoleDB.read_config-257"><a href="#GuacamoleDB.read_config-257"><span class="linenos">257</span></a><span class="sd">                       contains invalid configuration, or environment variables</span>
</span><span id="GuacamoleDB.read_config-258"><a href="#GuacamoleDB.read_config-258"><span class="linenos">258</span></a><span class="sd">                       are incomplete.</span>
</span><span id="GuacamoleDB.read_config-259"><a href="#GuacamoleDB.read_config-259"><span class="linenos">259</span></a>
</span><span id="GuacamoleDB.read_config-260"><a href="#GuacamoleDB.read_config-260"><span class="linenos">260</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.read_config-261"><a href="#GuacamoleDB.read_config-261"><span class="linenos">261</span></a><span class="sd">            &gt;&gt;&gt; # Using environment variables</span>
</span><span id="GuacamoleDB.read_config-262"><a href="#GuacamoleDB.read_config-262"><span class="linenos">262</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_HOST&#39;] = &#39;localhost&#39;</span>
</span><span id="GuacamoleDB.read_config-263"><a href="#GuacamoleDB.read_config-263"><span class="linenos">263</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_USER&#39;] = &#39;guacamole_user&#39;</span>
</span><span id="GuacamoleDB.read_config-264"><a href="#GuacamoleDB.read_config-264"><span class="linenos">264</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_PASSWORD&#39;] = &#39;secret_password&#39;</span>
</span><span id="GuacamoleDB.read_config-265"><a href="#GuacamoleDB.read_config-265"><span class="linenos">265</span></a><span class="sd">            &gt;&gt;&gt; os.environ[&#39;GUACALIB_DATABASE&#39;] = &#39;guacamole_db&#39;</span>
</span><span id="GuacamoleDB.read_config-266"><a href="#GuacamoleDB.read_config-266"><span class="linenos">266</span></a><span class="sd">            &gt;&gt;&gt; config = GuacamoleDB.read_config(&quot;~/.guacaman.ini&quot;)</span>
</span><span id="GuacamoleDB.read_config-267"><a href="#GuacamoleDB.read_config-267"><span class="linenos">267</span></a><span class="sd">            &gt;&gt;&gt; print(config[&#39;host&#39;])</span>
</span><span id="GuacamoleDB.read_config-268"><a href="#GuacamoleDB.read_config-268"><span class="linenos">268</span></a><span class="sd">            &#39;localhost&#39;</span>
</span><span id="GuacamoleDB.read_config-269"><a href="#GuacamoleDB.read_config-269"><span class="linenos">269</span></a>
</span><span id="GuacamoleDB.read_config-270"><a href="#GuacamoleDB.read_config-270"><span class="linenos">270</span></a><span class="sd">            &gt;&gt;&gt; # Using config file</span>
</span><span id="GuacamoleDB.read_config-271"><a href="#GuacamoleDB.read_config-271"><span class="linenos">271</span></a><span class="sd">            &gt;&gt;&gt; config = GuacamoleDB.read_config(&quot;~/.guacaman.ini&quot;)</span>
</span><span id="GuacamoleDB.read_config-272"><a href="#GuacamoleDB.read_config-272"><span class="linenos">272</span></a><span class="sd">            &gt;&gt;&gt; print(config[&#39;host&#39;])</span>
</span><span id="GuacamoleDB.read_config-273"><a href="#GuacamoleDB.read_config-273"><span class="linenos">273</span></a><span class="sd">            &#39;localhost&#39;</span>
</span><span id="GuacamoleDB.read_config-274"><a href="#GuacamoleDB.read_config-274"><span class="linenos">274</span></a>
</span><span id="GuacamoleDB.read_config-275"><a href="#GuacamoleDB.read_config-275"><span class="linenos">275</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.read_config-276"><a href="#GuacamoleDB.read_config-276"><span class="linenos">276</span></a><span class="sd">            Environment variables take precedence over configuration file settings.</span>
</span><span id="GuacamoleDB.read_config-277"><a href="#GuacamoleDB.read_config-277"><span class="linenos">277</span></a>
</span><span id="GuacamoleDB.read_config-278"><a href="#GuacamoleDB.read_config-278"><span class="linenos">278</span></a><span class="sd">            Environment variables:</span>
</span><span id="GuacamoleDB.read_config-279"><a href="#GuacamoleDB.read_config-279"><span class="linenos">279</span></a><span class="sd">            - GUACALIB_HOST: MySQL server hostname</span>
</span><span id="GuacamoleDB.read_config-280"><a href="#GuacamoleDB.read_config-280"><span class="linenos">280</span></a><span class="sd">            - GUACALIB_USER: MySQL username</span>
</span><span id="GuacamoleDB.read_config-281"><a href="#GuacamoleDB.read_config-281"><span class="linenos">281</span></a><span class="sd">            - GUACALIB_PASSWORD: MySQL password</span>
</span><span id="GuacamoleDB.read_config-282"><a href="#GuacamoleDB.read_config-282"><span class="linenos">282</span></a><span class="sd">            - GUACALIB_DATABASE: MySQL database name</span>
</span><span id="GuacamoleDB.read_config-283"><a href="#GuacamoleDB.read_config-283"><span class="linenos">283</span></a>
</span><span id="GuacamoleDB.read_config-284"><a href="#GuacamoleDB.read_config-284"><span class="linenos">284</span></a><span class="sd">            Configuration file format:</span>
</span><span id="GuacamoleDB.read_config-285"><a href="#GuacamoleDB.read_config-285"><span class="linenos">285</span></a><span class="sd">            [mysql]</span>
</span><span id="GuacamoleDB.read_config-286"><a href="#GuacamoleDB.read_config-286"><span class="linenos">286</span></a><span class="sd">            host = localhost</span>
</span><span id="GuacamoleDB.read_config-287"><a href="#GuacamoleDB.read_config-287"><span class="linenos">287</span></a><span class="sd">            user = guacamole_user</span>
</span><span id="GuacamoleDB.read_config-288"><a href="#GuacamoleDB.read_config-288"><span class="linenos">288</span></a><span class="sd">            password = secret_password</span>
</span><span id="GuacamoleDB.read_config-289"><a href="#GuacamoleDB.read_config-289"><span class="linenos">289</span></a><span class="sd">            database = guacamole_db</span>
</span><span id="GuacamoleDB.read_config-290"><a href="#GuacamoleDB.read_config-290"><span class="linenos">290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.read_config-291"><a href="#GuacamoleDB.read_config-291"><span class="linenos">291</span></a>        <span class="c1"># First try to get configuration from environment variables</span>
</span><span id="GuacamoleDB.read_config-292"><a href="#GuacamoleDB.read_config-292"><span class="linenos">292</span></a>        <span class="n">env_vars</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB.read_config-293"><a href="#GuacamoleDB.read_config-293"><span class="linenos">293</span></a>            <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_HOST&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB.read_config-294"><a href="#GuacamoleDB.read_config-294"><span class="linenos">294</span></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_USER&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB.read_config-295"><a href="#GuacamoleDB.read_config-295"><span class="linenos">295</span></a>            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_PASSWORD&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB.read_config-296"><a href="#GuacamoleDB.read_config-296"><span class="linenos">296</span></a>            <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GUACALIB_DATABASE&quot;</span><span class="p">),</span>
</span><span id="GuacamoleDB.read_config-297"><a href="#GuacamoleDB.read_config-297"><span class="linenos">297</span></a>        <span class="p">}</span>
</span><span id="GuacamoleDB.read_config-298"><a href="#GuacamoleDB.read_config-298"><span class="linenos">298</span></a>
</span><span id="GuacamoleDB.read_config-299"><a href="#GuacamoleDB.read_config-299"><span class="linenos">299</span></a>        <span class="c1"># Check if all required environment variables are present</span>
</span><span id="GuacamoleDB.read_config-300"><a href="#GuacamoleDB.read_config-300"><span class="linenos">300</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">env_vars</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span id="GuacamoleDB.read_config-301"><a href="#GuacamoleDB.read_config-301"><span class="linenos">301</span></a>            <span class="k">return</span> <span class="n">env_vars</span>
</span><span id="GuacamoleDB.read_config-302"><a href="#GuacamoleDB.read_config-302"><span class="linenos">302</span></a>
</span><span id="GuacamoleDB.read_config-303"><a href="#GuacamoleDB.read_config-303"><span class="linenos">303</span></a>        <span class="c1"># If environment variables are not complete, fall back to config file</span>
</span><span id="GuacamoleDB.read_config-304"><a href="#GuacamoleDB.read_config-304"><span class="linenos">304</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</span><span id="GuacamoleDB.read_config-305"><a href="#GuacamoleDB.read_config-305"><span class="linenos">305</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
</span><span id="GuacamoleDB.read_config-306"><a href="#GuacamoleDB.read_config-306"><span class="linenos">306</span></a>            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-307"><a href="#GuacamoleDB.read_config-307"><span class="linenos">307</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file not found: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-308"><a href="#GuacamoleDB.read_config-308"><span class="linenos">308</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Config file not found. Please set environment variables or create a config file at ~/.guacaman.ini&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-309"><a href="#GuacamoleDB.read_config-309"><span class="linenos">309</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option 1: Set environment variables:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-310"><a href="#GuacamoleDB.read_config-310"><span class="linenos">310</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_HOST=your_mysql_host&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-311"><a href="#GuacamoleDB.read_config-311"><span class="linenos">311</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_USER=your_mysql_user&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-312"><a href="#GuacamoleDB.read_config-312"><span class="linenos">312</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_PASSWORD=your_mysql_password&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-313"><a href="#GuacamoleDB.read_config-313"><span class="linenos">313</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;export GUACALIB_DATABASE=your_mysql_database&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-314"><a href="#GuacamoleDB.read_config-314"><span class="linenos">314</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option 2: Create a config file with the following format:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-315"><a href="#GuacamoleDB.read_config-315"><span class="linenos">315</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[mysql]&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-316"><a href="#GuacamoleDB.read_config-316"><span class="linenos">316</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;host = your_mysql_host&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-317"><a href="#GuacamoleDB.read_config-317"><span class="linenos">317</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;user = your_mysql_user&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-318"><a href="#GuacamoleDB.read_config-318"><span class="linenos">318</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;password = your_mysql_password&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-319"><a href="#GuacamoleDB.read_config-319"><span class="linenos">319</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;database = your_mysql_database&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-320"><a href="#GuacamoleDB.read_config-320"><span class="linenos">320</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-321"><a href="#GuacamoleDB.read_config-321"><span class="linenos">321</span></a>
</span><span id="GuacamoleDB.read_config-322"><a href="#GuacamoleDB.read_config-322"><span class="linenos">322</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.read_config-323"><a href="#GuacamoleDB.read_config-323"><span class="linenos">323</span></a>            <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-324"><a href="#GuacamoleDB.read_config-324"><span class="linenos">324</span></a>            <span class="k">if</span> <span class="s2">&quot;mysql&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
</span><span id="GuacamoleDB.read_config-325"><a href="#GuacamoleDB.read_config-325"><span class="linenos">325</span></a>                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-326"><a href="#GuacamoleDB.read_config-326"><span class="linenos">326</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing [mysql] section in config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-327"><a href="#GuacamoleDB.read_config-327"><span class="linenos">327</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Missing [mysql] section in config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-328"><a href="#GuacamoleDB.read_config-328"><span class="linenos">328</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-329"><a href="#GuacamoleDB.read_config-329"><span class="linenos">329</span></a>
</span><span id="GuacamoleDB.read_config-330"><a href="#GuacamoleDB.read_config-330"><span class="linenos">330</span></a>            <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">]</span>
</span><span id="GuacamoleDB.read_config-331"><a href="#GuacamoleDB.read_config-331"><span class="linenos">331</span></a>            <span class="n">missing_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">]]</span>
</span><span id="GuacamoleDB.read_config-332"><a href="#GuacamoleDB.read_config-332"><span class="linenos">332</span></a>            <span class="k">if</span> <span class="n">missing_keys</span><span class="p">:</span>
</span><span id="GuacamoleDB.read_config-333"><a href="#GuacamoleDB.read_config-333"><span class="linenos">333</span></a>                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-334"><a href="#GuacamoleDB.read_config-334"><span class="linenos">334</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required keys in [mysql] section: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_keys</span><span class="p">)</span><span class="si">}</span><span class="s2"> in config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-335"><a href="#GuacamoleDB.read_config-335"><span class="linenos">335</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="GuacamoleDB.read_config-336"><a href="#GuacamoleDB.read_config-336"><span class="linenos">336</span></a>                    <span class="sa">f</span><span class="s2">&quot;Error: Missing required keys in [mysql] section: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.read_config-337"><a href="#GuacamoleDB.read_config-337"><span class="linenos">337</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.read_config-338"><a href="#GuacamoleDB.read_config-338"><span class="linenos">338</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-339"><a href="#GuacamoleDB.read_config-339"><span class="linenos">339</span></a>                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-340"><a href="#GuacamoleDB.read_config-340"><span class="linenos">340</span></a>
</span><span id="GuacamoleDB.read_config-341"><a href="#GuacamoleDB.read_config-341"><span class="linenos">341</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="GuacamoleDB.read_config-342"><a href="#GuacamoleDB.read_config-342"><span class="linenos">342</span></a>                <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;host&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB.read_config-343"><a href="#GuacamoleDB.read_config-343"><span class="linenos">343</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;user&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB.read_config-344"><a href="#GuacamoleDB.read_config-344"><span class="linenos">344</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;password&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB.read_config-345"><a href="#GuacamoleDB.read_config-345"><span class="linenos">345</span></a>                <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">][</span><span class="s2">&quot;database&quot;</span><span class="p">],</span>
</span><span id="GuacamoleDB.read_config-346"><a href="#GuacamoleDB.read_config-346"><span class="linenos">346</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB.read_config-347"><a href="#GuacamoleDB.read_config-347"><span class="linenos">347</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.read_config-348"><a href="#GuacamoleDB.read_config-348"><span class="linenos">348</span></a>            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib.db&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-349"><a href="#GuacamoleDB.read_config-349"><span class="linenos">349</span></a>            <span class="c1"># Simple credential scrubbing for static method</span>
</span><span id="GuacamoleDB.read_config-350"><a href="#GuacamoleDB.read_config-350"><span class="linenos">350</span></a>            <span class="n">scrubbed_error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;password=&#39;</span><span class="p">,</span> <span class="s1">&#39;password=[REDACTED]&#39;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-351"><a href="#GuacamoleDB.read_config-351"><span class="linenos">351</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading config file </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">scrubbed_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-352"><a href="#GuacamoleDB.read_config-352"><span class="linenos">352</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading config file </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.read_config-353"><a href="#GuacamoleDB.read_config-353"><span class="linenos">353</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read and validate MySQL database configuration from environment variables or file.</p>

<p>First checks for environment variables (GUACALIB_HOST, GUACALIB_USER,
GUACALIB_PASSWORD, GUACALIB_DATABASE). If all required environment variables
are present, they are used. Otherwise, falls back to reading from configuration
file.</p>

<p>Args:
    config_file: Path to the configuration file.</p>

<p>Returns:
    Dictionary containing MySQL connection parameters with keys:
    'host', 'user', 'password', 'database'.</p>

<p>Raises:
    SystemExit: If config file is not found, missing required sections,
               contains invalid configuration, or environment variables
               are incomplete.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="using-environment-variables">Using environment variables</h1>
      
      <p>os.environ['GUACALIB_HOST'] = 'localhost'
      os.environ['GUACALIB_USER'] = 'guacamole_user'
      os.environ['GUACALIB_PASSWORD'] = 'secret_password'
      os.environ['GUACALIB_DATABASE'] = 'guacamole_db'
      config = <a href="#GuacamoleDB.read_config">GuacamoleDB.read_config</a>("~/.guacaman.ini")
      print(config['host'])
          'localhost'</p>

<pre><code>&gt;&gt;&gt; # Using config file
&gt;&gt;&gt; config = <a href="#GuacamoleDB.read_config">GuacamoleDB.read_config</a>("~/.guacaman.ini")
&gt;&gt;&gt; print(config['host'])
'localhost'
</code></pre>
      
      <p>Note:
          Environment variables take precedence over configuration file settings.</p>

<pre><code>Environment variables:
- GUACALIB_HOST: MySQL server hostname
- GUACALIB_USER: MySQL username
- GUACALIB_PASSWORD: MySQL password
- GUACALIB_DATABASE: MySQL database name

Configuration file format:
[mysql]
host = localhost
user = guacamole_user
password = secret_password
database = guacamole_db
</code></pre>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.connect_db" class="classattr">
                                        <input id="GuacamoleDB.connect_db-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">connect_db</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">MySQLConnection</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.connect_db-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.connect_db"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.connect_db-355"><a href="#GuacamoleDB.connect_db-355"><span class="linenos">355</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MySQLConnection</span><span class="p">:</span>
</span><span id="GuacamoleDB.connect_db-356"><a href="#GuacamoleDB.connect_db-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Establish MySQL database connection using loaded configuration.</span>
</span><span id="GuacamoleDB.connect_db-357"><a href="#GuacamoleDB.connect_db-357"><span class="linenos">357</span></a>
</span><span id="GuacamoleDB.connect_db-358"><a href="#GuacamoleDB.connect_db-358"><span class="linenos">358</span></a><span class="sd">        Creates a MySQL connection using the configuration loaded by read_config().</span>
</span><span id="GuacamoleDB.connect_db-359"><a href="#GuacamoleDB.connect_db-359"><span class="linenos">359</span></a><span class="sd">        Sets UTF8MB4 charset and collation for proper Unicode support.</span>
</span><span id="GuacamoleDB.connect_db-360"><a href="#GuacamoleDB.connect_db-360"><span class="linenos">360</span></a>
</span><span id="GuacamoleDB.connect_db-361"><a href="#GuacamoleDB.connect_db-361"><span class="linenos">361</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.connect_db-362"><a href="#GuacamoleDB.connect_db-362"><span class="linenos">362</span></a><span class="sd">            MySQLConnection object for database operations.</span>
</span><span id="GuacamoleDB.connect_db-363"><a href="#GuacamoleDB.connect_db-363"><span class="linenos">363</span></a>
</span><span id="GuacamoleDB.connect_db-364"><a href="#GuacamoleDB.connect_db-364"><span class="linenos">364</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.connect_db-365"><a href="#GuacamoleDB.connect_db-365"><span class="linenos">365</span></a><span class="sd">            SystemExit: If database connection fails.</span>
</span><span id="GuacamoleDB.connect_db-366"><a href="#GuacamoleDB.connect_db-366"><span class="linenos">366</span></a><span class="sd">            mysql.connector.Error: For various MySQL connection errors.</span>
</span><span id="GuacamoleDB.connect_db-367"><a href="#GuacamoleDB.connect_db-367"><span class="linenos">367</span></a>
</span><span id="GuacamoleDB.connect_db-368"><a href="#GuacamoleDB.connect_db-368"><span class="linenos">368</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.connect_db-369"><a href="#GuacamoleDB.connect_db-369"><span class="linenos">369</span></a><span class="sd">            Uses UTF8MB4 charset to support full Unicode including emoji and</span>
</span><span id="GuacamoleDB.connect_db-370"><a href="#GuacamoleDB.connect_db-370"><span class="linenos">370</span></a><span class="sd">            special characters. Connection parameters are loaded from the</span>
</span><span id="GuacamoleDB.connect_db-371"><a href="#GuacamoleDB.connect_db-371"><span class="linenos">371</span></a><span class="sd">            configuration file during initialization.</span>
</span><span id="GuacamoleDB.connect_db-372"><a href="#GuacamoleDB.connect_db-372"><span class="linenos">372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.connect_db-373"><a href="#GuacamoleDB.connect_db-373"><span class="linenos">373</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.connect_db-374"><a href="#GuacamoleDB.connect_db-374"><span class="linenos">374</span></a>            <span class="n">conn</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span><span id="GuacamoleDB.connect_db-375"><a href="#GuacamoleDB.connect_db-375"><span class="linenos">375</span></a>                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">db_config</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf8mb4&quot;</span><span class="p">,</span> <span class="n">collation</span><span class="o">=</span><span class="s2">&quot;utf8mb4_general_ci&quot;</span>
</span><span id="GuacamoleDB.connect_db-376"><a href="#GuacamoleDB.connect_db-376"><span class="linenos">376</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.connect_db-377"><a href="#GuacamoleDB.connect_db-377"><span class="linenos">377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database connection established to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.connect_db-378"><a href="#GuacamoleDB.connect_db-378"><span class="linenos">378</span></a>            <span class="k">return</span> <span class="n">conn</span>
</span><span id="GuacamoleDB.connect_db-379"><a href="#GuacamoleDB.connect_db-379"><span class="linenos">379</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.connect_db-380"><a href="#GuacamoleDB.connect_db-380"><span class="linenos">380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database connection failed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.connect_db-381"><a href="#GuacamoleDB.connect_db-381"><span class="linenos">381</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Establish MySQL database connection using loaded configuration.</p>

<p>Creates a MySQL connection using the configuration loaded by read_config().
Sets UTF8MB4 charset and collation for proper Unicode support.</p>

<p>Returns:
    MySQLConnection object for database operations.</p>

<p>Raises:
    SystemExit: If database connection fails.
    mysql.connector.Error: For various MySQL connection errors.</p>

<p>Note:
    Uses UTF8MB4 charset to support full Unicode including emoji and
    special characters. Connection parameters are loaded from the
    configuration file during initialization.</p>
</div>


                            </div>
                            <div id="GuacamoleDB.list_users" class="classattr">
                                        <input id="GuacamoleDB.list_users-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_users</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.list_users-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.list_users"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.list_users-383"><a href="#GuacamoleDB.list_users-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_users</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB.list_users-384"><a href="#GuacamoleDB.list_users-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all users from the Guacamole database.</span>
</span><span id="GuacamoleDB.list_users-385"><a href="#GuacamoleDB.list_users-385"><span class="linenos">385</span></a>
</span><span id="GuacamoleDB.list_users-386"><a href="#GuacamoleDB.list_users-386"><span class="linenos">386</span></a><span class="sd">        Queries the guacamole_entity table to find all entities of type &#39;USER&#39;</span>
</span><span id="GuacamoleDB.list_users-387"><a href="#GuacamoleDB.list_users-387"><span class="linenos">387</span></a><span class="sd">        and returns them as an alphabetically sorted list.</span>
</span><span id="GuacamoleDB.list_users-388"><a href="#GuacamoleDB.list_users-388"><span class="linenos">388</span></a>
</span><span id="GuacamoleDB.list_users-389"><a href="#GuacamoleDB.list_users-389"><span class="linenos">389</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.list_users-390"><a href="#GuacamoleDB.list_users-390"><span class="linenos">390</span></a><span class="sd">            List of usernames sorted alphabetically.</span>
</span><span id="GuacamoleDB.list_users-391"><a href="#GuacamoleDB.list_users-391"><span class="linenos">391</span></a>
</span><span id="GuacamoleDB.list_users-392"><a href="#GuacamoleDB.list_users-392"><span class="linenos">392</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.list_users-393"><a href="#GuacamoleDB.list_users-393"><span class="linenos">393</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.list_users-394"><a href="#GuacamoleDB.list_users-394"><span class="linenos">394</span></a>
</span><span id="GuacamoleDB.list_users-395"><a href="#GuacamoleDB.list_users-395"><span class="linenos">395</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.list_users-396"><a href="#GuacamoleDB.list_users-396"><span class="linenos">396</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.list_users-397"><a href="#GuacamoleDB.list_users-397"><span class="linenos">397</span></a><span class="sd">            ...     users = db.list_users()</span>
</span><span id="GuacamoleDB.list_users-398"><a href="#GuacamoleDB.list_users-398"><span class="linenos">398</span></a><span class="sd">            ...     print(f&quot;Found users: {&#39;, &#39;.join(users)}&quot;)</span>
</span><span id="GuacamoleDB.list_users-399"><a href="#GuacamoleDB.list_users-399"><span class="linenos">399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_users-400"><a href="#GuacamoleDB.list_users-400"><span class="linenos">400</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_users-401"><a href="#GuacamoleDB.list_users-401"><span class="linenos">401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_users-402"><a href="#GuacamoleDB.list_users-402"><span class="linenos">402</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_users-403"><a href="#GuacamoleDB.list_users-403"><span class="linenos">403</span></a><span class="sd">                SELECT name</span>
</span><span id="GuacamoleDB.list_users-404"><a href="#GuacamoleDB.list_users-404"><span class="linenos">404</span></a><span class="sd">                FROM guacamole_entity</span>
</span><span id="GuacamoleDB.list_users-405"><a href="#GuacamoleDB.list_users-405"><span class="linenos">405</span></a><span class="sd">                WHERE type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.list_users-406"><a href="#GuacamoleDB.list_users-406"><span class="linenos">406</span></a><span class="sd">                ORDER BY name</span>
</span><span id="GuacamoleDB.list_users-407"><a href="#GuacamoleDB.list_users-407"><span class="linenos">407</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_users-408"><a href="#GuacamoleDB.list_users-408"><span class="linenos">408</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.list_users-409"><a href="#GuacamoleDB.list_users-409"><span class="linenos">409</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB.list_users-410"><a href="#GuacamoleDB.list_users-410"><span class="linenos">410</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_users-411"><a href="#GuacamoleDB.list_users-411"><span class="linenos">411</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list users: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.list_users-412"><a href="#GuacamoleDB.list_users-412"><span class="linenos">412</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve all users from the Guacamole database.</p>

<p>Queries the guacamole_entity table to find all entities of type 'USER'
and returns them as an alphabetically sorted list.</p>

<p>Returns:
    List of usernames sorted alphabetically.</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     users = db.list_users()
          ...     print(f"Found users: {', '.join(users)}")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.list_usergroups" class="classattr">
                                        <input id="GuacamoleDB.list_usergroups-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_usergroups</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.list_usergroups-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.list_usergroups"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.list_usergroups-414"><a href="#GuacamoleDB.list_usergroups-414"><span class="linenos">414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_usergroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB.list_usergroups-415"><a href="#GuacamoleDB.list_usergroups-415"><span class="linenos">415</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all user groups from the Guacamole database.</span>
</span><span id="GuacamoleDB.list_usergroups-416"><a href="#GuacamoleDB.list_usergroups-416"><span class="linenos">416</span></a>
</span><span id="GuacamoleDB.list_usergroups-417"><a href="#GuacamoleDB.list_usergroups-417"><span class="linenos">417</span></a><span class="sd">        Queries the guacamole_entity table to find all entities of type &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.list_usergroups-418"><a href="#GuacamoleDB.list_usergroups-418"><span class="linenos">418</span></a><span class="sd">        and returns them as an alphabetically sorted list.</span>
</span><span id="GuacamoleDB.list_usergroups-419"><a href="#GuacamoleDB.list_usergroups-419"><span class="linenos">419</span></a>
</span><span id="GuacamoleDB.list_usergroups-420"><a href="#GuacamoleDB.list_usergroups-420"><span class="linenos">420</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.list_usergroups-421"><a href="#GuacamoleDB.list_usergroups-421"><span class="linenos">421</span></a><span class="sd">            List of user group names sorted alphabetically.</span>
</span><span id="GuacamoleDB.list_usergroups-422"><a href="#GuacamoleDB.list_usergroups-422"><span class="linenos">422</span></a>
</span><span id="GuacamoleDB.list_usergroups-423"><a href="#GuacamoleDB.list_usergroups-423"><span class="linenos">423</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.list_usergroups-424"><a href="#GuacamoleDB.list_usergroups-424"><span class="linenos">424</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.list_usergroups-425"><a href="#GuacamoleDB.list_usergroups-425"><span class="linenos">425</span></a>
</span><span id="GuacamoleDB.list_usergroups-426"><a href="#GuacamoleDB.list_usergroups-426"><span class="linenos">426</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.list_usergroups-427"><a href="#GuacamoleDB.list_usergroups-427"><span class="linenos">427</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.list_usergroups-428"><a href="#GuacamoleDB.list_usergroups-428"><span class="linenos">428</span></a><span class="sd">            ...     groups = db.list_usergroups()</span>
</span><span id="GuacamoleDB.list_usergroups-429"><a href="#GuacamoleDB.list_usergroups-429"><span class="linenos">429</span></a><span class="sd">            ...     print(f&quot;Found groups: {&#39;, &#39;.join(groups)}&quot;)</span>
</span><span id="GuacamoleDB.list_usergroups-430"><a href="#GuacamoleDB.list_usergroups-430"><span class="linenos">430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups-431"><a href="#GuacamoleDB.list_usergroups-431"><span class="linenos">431</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_usergroups-432"><a href="#GuacamoleDB.list_usergroups-432"><span class="linenos">432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_usergroups-433"><a href="#GuacamoleDB.list_usergroups-433"><span class="linenos">433</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups-434"><a href="#GuacamoleDB.list_usergroups-434"><span class="linenos">434</span></a><span class="sd">                SELECT name</span>
</span><span id="GuacamoleDB.list_usergroups-435"><a href="#GuacamoleDB.list_usergroups-435"><span class="linenos">435</span></a><span class="sd">                FROM guacamole_entity</span>
</span><span id="GuacamoleDB.list_usergroups-436"><a href="#GuacamoleDB.list_usergroups-436"><span class="linenos">436</span></a><span class="sd">                WHERE type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.list_usergroups-437"><a href="#GuacamoleDB.list_usergroups-437"><span class="linenos">437</span></a><span class="sd">                ORDER BY name</span>
</span><span id="GuacamoleDB.list_usergroups-438"><a href="#GuacamoleDB.list_usergroups-438"><span class="linenos">438</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups-439"><a href="#GuacamoleDB.list_usergroups-439"><span class="linenos">439</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.list_usergroups-440"><a href="#GuacamoleDB.list_usergroups-440"><span class="linenos">440</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB.list_usergroups-441"><a href="#GuacamoleDB.list_usergroups-441"><span class="linenos">441</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_usergroups-442"><a href="#GuacamoleDB.list_usergroups-442"><span class="linenos">442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to list usergroups: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.list_usergroups-443"><a href="#GuacamoleDB.list_usergroups-443"><span class="linenos">443</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve all user groups from the Guacamole database.</p>

<p>Queries the guacamole_entity table to find all entities of type 'USER_GROUP'
and returns them as an alphabetically sorted list.</p>

<p>Returns:
    List of user group names sorted alphabetically.</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     groups = db.list_usergroups()
          ...     print(f"Found groups: {', '.join(groups)}")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.usergroup_exists" class="classattr">
                                        <input id="GuacamoleDB.usergroup_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">usergroup_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.usergroup_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.usergroup_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.usergroup_exists-445"><a href="#GuacamoleDB.usergroup_exists-445"><span class="linenos">445</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">usergroup_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.usergroup_exists-446"><a href="#GuacamoleDB.usergroup_exists-446"><span class="linenos">446</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a user group exists in the Guacamole database.</span>
</span><span id="GuacamoleDB.usergroup_exists-447"><a href="#GuacamoleDB.usergroup_exists-447"><span class="linenos">447</span></a>
</span><span id="GuacamoleDB.usergroup_exists-448"><a href="#GuacamoleDB.usergroup_exists-448"><span class="linenos">448</span></a><span class="sd">        Queries the guacamole_entity table to determine if a user group with the</span>
</span><span id="GuacamoleDB.usergroup_exists-449"><a href="#GuacamoleDB.usergroup_exists-449"><span class="linenos">449</span></a><span class="sd">        specified name exists.</span>
</span><span id="GuacamoleDB.usergroup_exists-450"><a href="#GuacamoleDB.usergroup_exists-450"><span class="linenos">450</span></a>
</span><span id="GuacamoleDB.usergroup_exists-451"><a href="#GuacamoleDB.usergroup_exists-451"><span class="linenos">451</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.usergroup_exists-452"><a href="#GuacamoleDB.usergroup_exists-452"><span class="linenos">452</span></a><span class="sd">            group_name: The user group name to check for existence.</span>
</span><span id="GuacamoleDB.usergroup_exists-453"><a href="#GuacamoleDB.usergroup_exists-453"><span class="linenos">453</span></a>
</span><span id="GuacamoleDB.usergroup_exists-454"><a href="#GuacamoleDB.usergroup_exists-454"><span class="linenos">454</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.usergroup_exists-455"><a href="#GuacamoleDB.usergroup_exists-455"><span class="linenos">455</span></a><span class="sd">            True if the user group exists, False otherwise.</span>
</span><span id="GuacamoleDB.usergroup_exists-456"><a href="#GuacamoleDB.usergroup_exists-456"><span class="linenos">456</span></a>
</span><span id="GuacamoleDB.usergroup_exists-457"><a href="#GuacamoleDB.usergroup_exists-457"><span class="linenos">457</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.usergroup_exists-458"><a href="#GuacamoleDB.usergroup_exists-458"><span class="linenos">458</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.usergroup_exists-459"><a href="#GuacamoleDB.usergroup_exists-459"><span class="linenos">459</span></a>
</span><span id="GuacamoleDB.usergroup_exists-460"><a href="#GuacamoleDB.usergroup_exists-460"><span class="linenos">460</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.usergroup_exists-461"><a href="#GuacamoleDB.usergroup_exists-461"><span class="linenos">461</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.usergroup_exists-462"><a href="#GuacamoleDB.usergroup_exists-462"><span class="linenos">462</span></a><span class="sd">            ...     if db.usergroup_exists(&#39;admins&#39;):</span>
</span><span id="GuacamoleDB.usergroup_exists-463"><a href="#GuacamoleDB.usergroup_exists-463"><span class="linenos">463</span></a><span class="sd">            ...         print(&quot;Admin group exists&quot;)</span>
</span><span id="GuacamoleDB.usergroup_exists-464"><a href="#GuacamoleDB.usergroup_exists-464"><span class="linenos">464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.usergroup_exists-465"><a href="#GuacamoleDB.usergroup_exists-465"><span class="linenos">465</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.usergroup_exists-466"><a href="#GuacamoleDB.usergroup_exists-466"><span class="linenos">466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.usergroup_exists-467"><a href="#GuacamoleDB.usergroup_exists-467"><span class="linenos">467</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.usergroup_exists-468"><a href="#GuacamoleDB.usergroup_exists-468"><span class="linenos">468</span></a><span class="sd">                SELECT COUNT(*) FROM guacamole_entity</span>
</span><span id="GuacamoleDB.usergroup_exists-469"><a href="#GuacamoleDB.usergroup_exists-469"><span class="linenos">469</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.usergroup_exists-470"><a href="#GuacamoleDB.usergroup_exists-470"><span class="linenos">470</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.usergroup_exists-471"><a href="#GuacamoleDB.usergroup_exists-471"><span class="linenos">471</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.usergroup_exists-472"><a href="#GuacamoleDB.usergroup_exists-472"><span class="linenos">472</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.usergroup_exists-473"><a href="#GuacamoleDB.usergroup_exists-473"><span class="linenos">473</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="GuacamoleDB.usergroup_exists-474"><a href="#GuacamoleDB.usergroup_exists-474"><span class="linenos">474</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.usergroup_exists-475"><a href="#GuacamoleDB.usergroup_exists-475"><span class="linenos">475</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking usergroup existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.usergroup_exists-476"><a href="#GuacamoleDB.usergroup_exists-476"><span class="linenos">476</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Check if a user group exists in the Guacamole database.</p>

<p>Queries the guacamole_entity table to determine if a user group with the
specified name exists.</p>

<p>Args:
    group_name: The user group name to check for existence.</p>

<p>Returns:
    True if the user group exists, False otherwise.</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     if db.usergroup_exists('admins'):
          ...         print("Admin group exists")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.get_usergroup_id" class="classattr">
                                        <input id="GuacamoleDB.get_usergroup_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_usergroup_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_usergroup_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_usergroup_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_usergroup_id-478"><a href="#GuacamoleDB.get_usergroup_id-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_usergroup_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_id-479"><a href="#GuacamoleDB.get_usergroup_id-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the database ID for a user group by name.</span>
</span><span id="GuacamoleDB.get_usergroup_id-480"><a href="#GuacamoleDB.get_usergroup_id-480"><span class="linenos">480</span></a>
</span><span id="GuacamoleDB.get_usergroup_id-481"><a href="#GuacamoleDB.get_usergroup_id-481"><span class="linenos">481</span></a><span class="sd">        Queries the guacamole_user_group and guacamole_entity tables to find</span>
</span><span id="GuacamoleDB.get_usergroup_id-482"><a href="#GuacamoleDB.get_usergroup_id-482"><span class="linenos">482</span></a><span class="sd">        the internal database ID for a user group.</span>
</span><span id="GuacamoleDB.get_usergroup_id-483"><a href="#GuacamoleDB.get_usergroup_id-483"><span class="linenos">483</span></a>
</span><span id="GuacamoleDB.get_usergroup_id-484"><a href="#GuacamoleDB.get_usergroup_id-484"><span class="linenos">484</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.get_usergroup_id-485"><a href="#GuacamoleDB.get_usergroup_id-485"><span class="linenos">485</span></a><span class="sd">            group_name: The name of the user group.</span>
</span><span id="GuacamoleDB.get_usergroup_id-486"><a href="#GuacamoleDB.get_usergroup_id-486"><span class="linenos">486</span></a>
</span><span id="GuacamoleDB.get_usergroup_id-487"><a href="#GuacamoleDB.get_usergroup_id-487"><span class="linenos">487</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.get_usergroup_id-488"><a href="#GuacamoleDB.get_usergroup_id-488"><span class="linenos">488</span></a><span class="sd">            The user group ID from the database.</span>
</span><span id="GuacamoleDB.get_usergroup_id-489"><a href="#GuacamoleDB.get_usergroup_id-489"><span class="linenos">489</span></a>
</span><span id="GuacamoleDB.get_usergroup_id-490"><a href="#GuacamoleDB.get_usergroup_id-490"><span class="linenos">490</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.get_usergroup_id-491"><a href="#GuacamoleDB.get_usergroup_id-491"><span class="linenos">491</span></a><span class="sd">            ValueError: If the user group is not found.</span>
</span><span id="GuacamoleDB.get_usergroup_id-492"><a href="#GuacamoleDB.get_usergroup_id-492"><span class="linenos">492</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.get_usergroup_id-493"><a href="#GuacamoleDB.get_usergroup_id-493"><span class="linenos">493</span></a>
</span><span id="GuacamoleDB.get_usergroup_id-494"><a href="#GuacamoleDB.get_usergroup_id-494"><span class="linenos">494</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.get_usergroup_id-495"><a href="#GuacamoleDB.get_usergroup_id-495"><span class="linenos">495</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.get_usergroup_id-496"><a href="#GuacamoleDB.get_usergroup_id-496"><span class="linenos">496</span></a><span class="sd">            ...     group_id = db.get_usergroup_id(&#39;admins&#39;)</span>
</span><span id="GuacamoleDB.get_usergroup_id-497"><a href="#GuacamoleDB.get_usergroup_id-497"><span class="linenos">497</span></a><span class="sd">            ...     print(f&quot;Admin group ID: {group_id}&quot;)</span>
</span><span id="GuacamoleDB.get_usergroup_id-498"><a href="#GuacamoleDB.get_usergroup_id-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_usergroup_id-499"><a href="#GuacamoleDB.get_usergroup_id-499"><span class="linenos">499</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_id-500"><a href="#GuacamoleDB.get_usergroup_id-500"><span class="linenos">500</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_usergroup_id-501"><a href="#GuacamoleDB.get_usergroup_id-501"><span class="linenos">501</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_usergroup_id-502"><a href="#GuacamoleDB.get_usergroup_id-502"><span class="linenos">502</span></a><span class="sd">                SELECT user_group_id</span>
</span><span id="GuacamoleDB.get_usergroup_id-503"><a href="#GuacamoleDB.get_usergroup_id-503"><span class="linenos">503</span></a><span class="sd">                FROM guacamole_user_group g</span>
</span><span id="GuacamoleDB.get_usergroup_id-504"><a href="#GuacamoleDB.get_usergroup_id-504"><span class="linenos">504</span></a><span class="sd">                JOIN guacamole_entity e ON g.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB.get_usergroup_id-505"><a href="#GuacamoleDB.get_usergroup_id-505"><span class="linenos">505</span></a><span class="sd">                WHERE e.name = %s AND e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.get_usergroup_id-506"><a href="#GuacamoleDB.get_usergroup_id-506"><span class="linenos">506</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_usergroup_id-507"><a href="#GuacamoleDB.get_usergroup_id-507"><span class="linenos">507</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_usergroup_id-508"><a href="#GuacamoleDB.get_usergroup_id-508"><span class="linenos">508</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_usergroup_id-509"><a href="#GuacamoleDB.get_usergroup_id-509"><span class="linenos">509</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_usergroup_id-510"><a href="#GuacamoleDB.get_usergroup_id-510"><span class="linenos">510</span></a>            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_id-511"><a href="#GuacamoleDB.get_usergroup_id-511"><span class="linenos">511</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_usergroup_id-512"><a href="#GuacamoleDB.get_usergroup_id-512"><span class="linenos">512</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_id-513"><a href="#GuacamoleDB.get_usergroup_id-513"><span class="linenos">513</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_usergroup_id-514"><a href="#GuacamoleDB.get_usergroup_id-514"><span class="linenos">514</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_id-515"><a href="#GuacamoleDB.get_usergroup_id-515"><span class="linenos">515</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting usergroup ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_usergroup_id-516"><a href="#GuacamoleDB.get_usergroup_id-516"><span class="linenos">516</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Get the database ID for a user group by name.</p>

<p>Queries the guacamole_user_group and guacamole_entity tables to find
the internal database ID for a user group.</p>

<p>Args:
    group_name: The name of the user group.</p>

<p>Returns:
    The user group ID from the database.</p>

<p>Raises:
    ValueError: If the user group is not found.
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     group_id = db.get_usergroup_id('admins')
          ...     print(f"Admin group ID: {group_id}")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.user_exists" class="classattr">
                                        <input id="GuacamoleDB.user_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">user_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.user_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.user_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.user_exists-518"><a href="#GuacamoleDB.user_exists-518"><span class="linenos">518</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">user_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.user_exists-519"><a href="#GuacamoleDB.user_exists-519"><span class="linenos">519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a user exists in the Guacamole database.</span>
</span><span id="GuacamoleDB.user_exists-520"><a href="#GuacamoleDB.user_exists-520"><span class="linenos">520</span></a>
</span><span id="GuacamoleDB.user_exists-521"><a href="#GuacamoleDB.user_exists-521"><span class="linenos">521</span></a><span class="sd">        Queries the guacamole_entity table to determine if a user with the</span>
</span><span id="GuacamoleDB.user_exists-522"><a href="#GuacamoleDB.user_exists-522"><span class="linenos">522</span></a><span class="sd">        specified username exists.</span>
</span><span id="GuacamoleDB.user_exists-523"><a href="#GuacamoleDB.user_exists-523"><span class="linenos">523</span></a>
</span><span id="GuacamoleDB.user_exists-524"><a href="#GuacamoleDB.user_exists-524"><span class="linenos">524</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.user_exists-525"><a href="#GuacamoleDB.user_exists-525"><span class="linenos">525</span></a><span class="sd">            username: The username to check for existence.</span>
</span><span id="GuacamoleDB.user_exists-526"><a href="#GuacamoleDB.user_exists-526"><span class="linenos">526</span></a>
</span><span id="GuacamoleDB.user_exists-527"><a href="#GuacamoleDB.user_exists-527"><span class="linenos">527</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.user_exists-528"><a href="#GuacamoleDB.user_exists-528"><span class="linenos">528</span></a><span class="sd">            True if the user exists, False otherwise.</span>
</span><span id="GuacamoleDB.user_exists-529"><a href="#GuacamoleDB.user_exists-529"><span class="linenos">529</span></a>
</span><span id="GuacamoleDB.user_exists-530"><a href="#GuacamoleDB.user_exists-530"><span class="linenos">530</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.user_exists-531"><a href="#GuacamoleDB.user_exists-531"><span class="linenos">531</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.user_exists-532"><a href="#GuacamoleDB.user_exists-532"><span class="linenos">532</span></a>
</span><span id="GuacamoleDB.user_exists-533"><a href="#GuacamoleDB.user_exists-533"><span class="linenos">533</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.user_exists-534"><a href="#GuacamoleDB.user_exists-534"><span class="linenos">534</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.user_exists-535"><a href="#GuacamoleDB.user_exists-535"><span class="linenos">535</span></a><span class="sd">            ...     if db.user_exists(&#39;admin&#39;):</span>
</span><span id="GuacamoleDB.user_exists-536"><a href="#GuacamoleDB.user_exists-536"><span class="linenos">536</span></a><span class="sd">            ...         print(&quot;Admin user exists&quot;)</span>
</span><span id="GuacamoleDB.user_exists-537"><a href="#GuacamoleDB.user_exists-537"><span class="linenos">537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.user_exists-538"><a href="#GuacamoleDB.user_exists-538"><span class="linenos">538</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.user_exists-539"><a href="#GuacamoleDB.user_exists-539"><span class="linenos">539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.user_exists-540"><a href="#GuacamoleDB.user_exists-540"><span class="linenos">540</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.user_exists-541"><a href="#GuacamoleDB.user_exists-541"><span class="linenos">541</span></a><span class="sd">                SELECT COUNT(*) FROM guacamole_entity</span>
</span><span id="GuacamoleDB.user_exists-542"><a href="#GuacamoleDB.user_exists-542"><span class="linenos">542</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.user_exists-543"><a href="#GuacamoleDB.user_exists-543"><span class="linenos">543</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.user_exists-544"><a href="#GuacamoleDB.user_exists-544"><span class="linenos">544</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.user_exists-545"><a href="#GuacamoleDB.user_exists-545"><span class="linenos">545</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.user_exists-546"><a href="#GuacamoleDB.user_exists-546"><span class="linenos">546</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="GuacamoleDB.user_exists-547"><a href="#GuacamoleDB.user_exists-547"><span class="linenos">547</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.user_exists-548"><a href="#GuacamoleDB.user_exists-548"><span class="linenos">548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking user existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.user_exists-549"><a href="#GuacamoleDB.user_exists-549"><span class="linenos">549</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Check if a user exists in the Guacamole database.</p>

<p>Queries the guacamole_entity table to determine if a user with the
specified username exists.</p>

<p>Args:
    username: The username to check for existence.</p>

<p>Returns:
    True if the user exists, False otherwise.</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     if db.user_exists('admin'):
          ...         print("Admin user exists")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.get_connection_group_id_by_name" class="classattr">
                                        <input id="GuacamoleDB.get_connection_group_id_by_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_connection_group_id_by_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_connection_group_id_by_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_connection_group_id_by_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_connection_group_id_by_name-610"><a href="#GuacamoleDB.get_connection_group_id_by_name-610"><span class="linenos">610</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_id_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-611"><a href="#GuacamoleDB.get_connection_group_id_by_name-611"><span class="linenos">611</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get connection group ID by name from the database.</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-612"><a href="#GuacamoleDB.get_connection_group_id_by_name-612"><span class="linenos">612</span></a>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-613"><a href="#GuacamoleDB.get_connection_group_id_by_name-613"><span class="linenos">613</span></a><span class="sd">        Retrieves the database ID for a connection group given its name.</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-614"><a href="#GuacamoleDB.get_connection_group_id_by_name-614"><span class="linenos">614</span></a><span class="sd">        Returns None for empty group names to handle root-level assignments.</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-615"><a href="#GuacamoleDB.get_connection_group_id_by_name-615"><span class="linenos">615</span></a>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-616"><a href="#GuacamoleDB.get_connection_group_id_by_name-616"><span class="linenos">616</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-617"><a href="#GuacamoleDB.get_connection_group_id_by_name-617"><span class="linenos">617</span></a><span class="sd">            group_name: Name of the connection group to look up.</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-618"><a href="#GuacamoleDB.get_connection_group_id_by_name-618"><span class="linenos">618</span></a>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-619"><a href="#GuacamoleDB.get_connection_group_id_by_name-619"><span class="linenos">619</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-620"><a href="#GuacamoleDB.get_connection_group_id_by_name-620"><span class="linenos">620</span></a><span class="sd">            The database ID of the connection group, or None if group_name is empty.</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-621"><a href="#GuacamoleDB.get_connection_group_id_by_name-621"><span class="linenos">621</span></a>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-622"><a href="#GuacamoleDB.get_connection_group_id_by_name-622"><span class="linenos">622</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-623"><a href="#GuacamoleDB.get_connection_group_id_by_name-623"><span class="linenos">623</span></a><span class="sd">            ValueError: If the connection group with the specified name is not found.</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-624"><a href="#GuacamoleDB.get_connection_group_id_by_name-624"><span class="linenos">624</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-625"><a href="#GuacamoleDB.get_connection_group_id_by_name-625"><span class="linenos">625</span></a>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-626"><a href="#GuacamoleDB.get_connection_group_id_by_name-626"><span class="linenos">626</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-627"><a href="#GuacamoleDB.get_connection_group_id_by_name-627"><span class="linenos">627</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-628"><a href="#GuacamoleDB.get_connection_group_id_by_name-628"><span class="linenos">628</span></a><span class="sd">            ...     group_id = db.get_connection_group_id_by_name(&quot;Production Servers&quot;)</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-629"><a href="#GuacamoleDB.get_connection_group_id_by_name-629"><span class="linenos">629</span></a><span class="sd">            ...     print(f&quot;Group ID: {group_id}&quot;)</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-630"><a href="#GuacamoleDB.get_connection_group_id_by_name-630"><span class="linenos">630</span></a><span class="sd">            Group ID: 42</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-631"><a href="#GuacamoleDB.get_connection_group_id_by_name-631"><span class="linenos">631</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-632"><a href="#GuacamoleDB.get_connection_group_id_by_name-632"><span class="linenos">632</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-633"><a href="#GuacamoleDB.get_connection_group_id_by_name-633"><span class="linenos">633</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">group_name</span><span class="p">:</span>  <span class="c1"># Handle empty group name as explicit NULL</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-634"><a href="#GuacamoleDB.get_connection_group_id_by_name-634"><span class="linenos">634</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-635"><a href="#GuacamoleDB.get_connection_group_id_by_name-635"><span class="linenos">635</span></a>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-636"><a href="#GuacamoleDB.get_connection_group_id_by_name-636"><span class="linenos">636</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-637"><a href="#GuacamoleDB.get_connection_group_id_by_name-637"><span class="linenos">637</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-638"><a href="#GuacamoleDB.get_connection_group_id_by_name-638"><span class="linenos">638</span></a><span class="sd">                SELECT connection_group_id </span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-639"><a href="#GuacamoleDB.get_connection_group_id_by_name-639"><span class="linenos">639</span></a><span class="sd">                FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-640"><a href="#GuacamoleDB.get_connection_group_id_by_name-640"><span class="linenos">640</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-641"><a href="#GuacamoleDB.get_connection_group_id_by_name-641"><span class="linenos">641</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-642"><a href="#GuacamoleDB.get_connection_group_id_by_name-642"><span class="linenos">642</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-643"><a href="#GuacamoleDB.get_connection_group_id_by_name-643"><span class="linenos">643</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-644"><a href="#GuacamoleDB.get_connection_group_id_by_name-644"><span class="linenos">644</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-645"><a href="#GuacamoleDB.get_connection_group_id_by_name-645"><span class="linenos">645</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-646"><a href="#GuacamoleDB.get_connection_group_id_by_name-646"><span class="linenos">646</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-647"><a href="#GuacamoleDB.get_connection_group_id_by_name-647"><span class="linenos">647</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-648"><a href="#GuacamoleDB.get_connection_group_id_by_name-648"><span class="linenos">648</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-649"><a href="#GuacamoleDB.get_connection_group_id_by_name-649"><span class="linenos">649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection group ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id_by_name-650"><a href="#GuacamoleDB.get_connection_group_id_by_name-650"><span class="linenos">650</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Get connection group ID by name from the database.</p>

<p>Retrieves the database ID for a connection group given its name.
Returns None for empty group names to handle root-level assignments.</p>

<p>Args:
    group_name: Name of the connection group to look up.</p>

<p>Returns:
    The database ID of the connection group, or None if group_name is empty.</p>

<p>Raises:
    ValueError: If the connection group with the specified name is not found.
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     group_id = db.get_connection_group_id_by_name("Production Servers")
          ...     print(f"Group ID: {group_id}")
          Group ID: 42</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.modify_connection_parent_group" class="classattr">
                                        <input id="GuacamoleDB.modify_connection_parent_group-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modify_connection_parent_group</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.modify_connection_parent_group-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.modify_connection_parent_group"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.modify_connection_parent_group-652"><a href="#GuacamoleDB.modify_connection_parent_group-652"><span class="linenos">652</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_connection_parent_group</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-653"><a href="#GuacamoleDB.modify_connection_parent_group-653"><span class="linenos">653</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-654"><a href="#GuacamoleDB.modify_connection_parent_group-654"><span class="linenos">654</span></a>        <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-655"><a href="#GuacamoleDB.modify_connection_parent_group-655"><span class="linenos">655</span></a>        <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-656"><a href="#GuacamoleDB.modify_connection_parent_group-656"><span class="linenos">656</span></a>        <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-657"><a href="#GuacamoleDB.modify_connection_parent_group-657"><span class="linenos">657</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-658"><a href="#GuacamoleDB.modify_connection_parent_group-658"><span class="linenos">658</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set parent connection group for a connection&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-659"><a href="#GuacamoleDB.modify_connection_parent_group-659"><span class="linenos">659</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-660"><a href="#GuacamoleDB.modify_connection_parent_group-660"><span class="linenos">660</span></a>            <span class="c1"># Use resolver to get connection_id and validate inputs</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-661"><a href="#GuacamoleDB.modify_connection_parent_group-661"><span class="linenos">661</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-662"><a href="#GuacamoleDB.modify_connection_parent_group-662"><span class="linenos">662</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-663"><a href="#GuacamoleDB.modify_connection_parent_group-663"><span class="linenos">663</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-664"><a href="#GuacamoleDB.modify_connection_parent_group-664"><span class="linenos">664</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-665"><a href="#GuacamoleDB.modify_connection_parent_group-665"><span class="linenos">665</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-666"><a href="#GuacamoleDB.modify_connection_parent_group-666"><span class="linenos">666</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_id_by_name</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">group_name</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-667"><a href="#GuacamoleDB.modify_connection_parent_group-667"><span class="linenos">667</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-668"><a href="#GuacamoleDB.modify_connection_parent_group-668"><span class="linenos">668</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-669"><a href="#GuacamoleDB.modify_connection_parent_group-669"><span class="linenos">669</span></a>            <span class="c1"># Get current parent</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-670"><a href="#GuacamoleDB.modify_connection_parent_group-670"><span class="linenos">670</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-671"><a href="#GuacamoleDB.modify_connection_parent_group-671"><span class="linenos">671</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-672"><a href="#GuacamoleDB.modify_connection_parent_group-672"><span class="linenos">672</span></a><span class="sd">                SELECT parent_id </span>
</span><span id="GuacamoleDB.modify_connection_parent_group-673"><a href="#GuacamoleDB.modify_connection_parent_group-673"><span class="linenos">673</span></a><span class="sd">                FROM guacamole_connection </span>
</span><span id="GuacamoleDB.modify_connection_parent_group-674"><a href="#GuacamoleDB.modify_connection_parent_group-674"><span class="linenos">674</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-675"><a href="#GuacamoleDB.modify_connection_parent_group-675"><span class="linenos">675</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-676"><a href="#GuacamoleDB.modify_connection_parent_group-676"><span class="linenos">676</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-677"><a href="#GuacamoleDB.modify_connection_parent_group-677"><span class="linenos">677</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-678"><a href="#GuacamoleDB.modify_connection_parent_group-678"><span class="linenos">678</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-679"><a href="#GuacamoleDB.modify_connection_parent_group-679"><span class="linenos">679</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-680"><a href="#GuacamoleDB.modify_connection_parent_group-680"><span class="linenos">680</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-681"><a href="#GuacamoleDB.modify_connection_parent_group-681"><span class="linenos">681</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection with ID </span><span class="si">{</span><span class="n">resolved_connection_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-682"><a href="#GuacamoleDB.modify_connection_parent_group-682"><span class="linenos">682</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-683"><a href="#GuacamoleDB.modify_connection_parent_group-683"><span class="linenos">683</span></a>            <span class="n">current_parent_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-684"><a href="#GuacamoleDB.modify_connection_parent_group-684"><span class="linenos">684</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-685"><a href="#GuacamoleDB.modify_connection_parent_group-685"><span class="linenos">685</span></a>            <span class="c1"># Get connection name for error messages if we only have ID</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-686"><a href="#GuacamoleDB.modify_connection_parent_group-686"><span class="linenos">686</span></a>            <span class="k">if</span> <span class="n">connection_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-687"><a href="#GuacamoleDB.modify_connection_parent_group-687"><span class="linenos">687</span></a>                <span class="n">connection_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_name_by_id</span><span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-688"><a href="#GuacamoleDB.modify_connection_parent_group-688"><span class="linenos">688</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-689"><a href="#GuacamoleDB.modify_connection_parent_group-689"><span class="linenos">689</span></a>            <span class="c1"># Check if we&#39;re trying to set to same group</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-690"><a href="#GuacamoleDB.modify_connection_parent_group-690"><span class="linenos">690</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">==</span> <span class="n">current_parent_id</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-691"><a href="#GuacamoleDB.modify_connection_parent_group-691"><span class="linenos">691</span></a>                <span class="k">if</span> <span class="n">group_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-692"><a href="#GuacamoleDB.modify_connection_parent_group-692"><span class="linenos">692</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-693"><a href="#GuacamoleDB.modify_connection_parent_group-693"><span class="linenos">693</span></a>                        <span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; already has no parent group&quot;</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-694"><a href="#GuacamoleDB.modify_connection_parent_group-694"><span class="linenos">694</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-695"><a href="#GuacamoleDB.modify_connection_parent_group-695"><span class="linenos">695</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-696"><a href="#GuacamoleDB.modify_connection_parent_group-696"><span class="linenos">696</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-697"><a href="#GuacamoleDB.modify_connection_parent_group-697"><span class="linenos">697</span></a>                        <span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; is already in group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-698"><a href="#GuacamoleDB.modify_connection_parent_group-698"><span class="linenos">698</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-699"><a href="#GuacamoleDB.modify_connection_parent_group-699"><span class="linenos">699</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-700"><a href="#GuacamoleDB.modify_connection_parent_group-700"><span class="linenos">700</span></a>            <span class="c1"># Update parent ID</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-701"><a href="#GuacamoleDB.modify_connection_parent_group-701"><span class="linenos">701</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-702"><a href="#GuacamoleDB.modify_connection_parent_group-702"><span class="linenos">702</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-703"><a href="#GuacamoleDB.modify_connection_parent_group-703"><span class="linenos">703</span></a><span class="sd">                UPDATE guacamole_connection</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-704"><a href="#GuacamoleDB.modify_connection_parent_group-704"><span class="linenos">704</span></a><span class="sd">                SET parent_id = %s</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-705"><a href="#GuacamoleDB.modify_connection_parent_group-705"><span class="linenos">705</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-706"><a href="#GuacamoleDB.modify_connection_parent_group-706"><span class="linenos">706</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-707"><a href="#GuacamoleDB.modify_connection_parent_group-707"><span class="linenos">707</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">resolved_connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-708"><a href="#GuacamoleDB.modify_connection_parent_group-708"><span class="linenos">708</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-709"><a href="#GuacamoleDB.modify_connection_parent_group-709"><span class="linenos">709</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-710"><a href="#GuacamoleDB.modify_connection_parent_group-710"><span class="linenos">710</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-711"><a href="#GuacamoleDB.modify_connection_parent_group-711"><span class="linenos">711</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-712"><a href="#GuacamoleDB.modify_connection_parent_group-712"><span class="linenos">712</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to update parent group for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-713"><a href="#GuacamoleDB.modify_connection_parent_group-713"><span class="linenos">713</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-714"><a href="#GuacamoleDB.modify_connection_parent_group-714"><span class="linenos">714</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-715"><a href="#GuacamoleDB.modify_connection_parent_group-715"><span class="linenos">715</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-716"><a href="#GuacamoleDB.modify_connection_parent_group-716"><span class="linenos">716</span></a>
</span><span id="GuacamoleDB.modify_connection_parent_group-717"><a href="#GuacamoleDB.modify_connection_parent_group-717"><span class="linenos">717</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-718"><a href="#GuacamoleDB.modify_connection_parent_group-718"><span class="linenos">718</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying connection parent group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_parent_group-719"><a href="#GuacamoleDB.modify_connection_parent_group-719"><span class="linenos">719</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Set parent connection group for a connection</p>
</div>


                            </div>
                            <div id="GuacamoleDB.get_connection_user_permissions" class="classattr">
                                        <input id="GuacamoleDB.get_connection_user_permissions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_connection_user_permissions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_connection_user_permissions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_connection_user_permissions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_connection_user_permissions-721"><a href="#GuacamoleDB.get_connection_user_permissions-721"><span class="linenos">721</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_user_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-722"><a href="#GuacamoleDB.get_connection_user_permissions-722"><span class="linenos">722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of users with direct permissions to a connection&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-723"><a href="#GuacamoleDB.get_connection_user_permissions-723"><span class="linenos">723</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-724"><a href="#GuacamoleDB.get_connection_user_permissions-724"><span class="linenos">724</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-725"><a href="#GuacamoleDB.get_connection_user_permissions-725"><span class="linenos">725</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-726"><a href="#GuacamoleDB.get_connection_user_permissions-726"><span class="linenos">726</span></a><span class="sd">                SELECT e.name</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-727"><a href="#GuacamoleDB.get_connection_user_permissions-727"><span class="linenos">727</span></a><span class="sd">                FROM guacamole_connection c</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-728"><a href="#GuacamoleDB.get_connection_user_permissions-728"><span class="linenos">728</span></a><span class="sd">                JOIN guacamole_connection_permission cp ON c.connection_id = cp.connection_id</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-729"><a href="#GuacamoleDB.get_connection_user_permissions-729"><span class="linenos">729</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-730"><a href="#GuacamoleDB.get_connection_user_permissions-730"><span class="linenos">730</span></a><span class="sd">                WHERE c.connection_name = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-731"><a href="#GuacamoleDB.get_connection_user_permissions-731"><span class="linenos">731</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-732"><a href="#GuacamoleDB.get_connection_user_permissions-732"><span class="linenos">732</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-733"><a href="#GuacamoleDB.get_connection_user_permissions-733"><span class="linenos">733</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-734"><a href="#GuacamoleDB.get_connection_user_permissions-734"><span class="linenos">734</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-735"><a href="#GuacamoleDB.get_connection_user_permissions-735"><span class="linenos">735</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-736"><a href="#GuacamoleDB.get_connection_user_permissions-736"><span class="linenos">736</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection user permissions: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_user_permissions-737"><a href="#GuacamoleDB.get_connection_user_permissions-737"><span class="linenos">737</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Get list of users with direct permissions to a connection</p>
</div>


                            </div>
                            <div id="GuacamoleDB.modify_connection" class="classattr">
                                        <input id="GuacamoleDB.modify_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modify_connection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">param_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">param_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.modify_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.modify_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.modify_connection-739"><a href="#GuacamoleDB.modify_connection-739"><span class="linenos">739</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_connection</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-740"><a href="#GuacamoleDB.modify_connection-740"><span class="linenos">740</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-741"><a href="#GuacamoleDB.modify_connection-741"><span class="linenos">741</span></a>        <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-742"><a href="#GuacamoleDB.modify_connection-742"><span class="linenos">742</span></a>        <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-743"><a href="#GuacamoleDB.modify_connection-743"><span class="linenos">743</span></a>        <span class="n">param_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-744"><a href="#GuacamoleDB.modify_connection-744"><span class="linenos">744</span></a>        <span class="n">param_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-745"><a href="#GuacamoleDB.modify_connection-745"><span class="linenos">745</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-746"><a href="#GuacamoleDB.modify_connection-746"><span class="linenos">746</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify a connection parameter in either guacamole_connection or guacamole_connection_parameter table&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-747"><a href="#GuacamoleDB.modify_connection-747"><span class="linenos">747</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-748"><a href="#GuacamoleDB.modify_connection-748"><span class="linenos">748</span></a>            <span class="c1"># Validate parameter name</span>
</span><span id="GuacamoleDB.modify_connection-749"><a href="#GuacamoleDB.modify_connection-749"><span class="linenos">749</span></a>            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONNECTION_PARAMETERS</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-750"><a href="#GuacamoleDB.modify_connection-750"><span class="linenos">750</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-751"><a href="#GuacamoleDB.modify_connection-751"><span class="linenos">751</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">. Run &#39;guacaman conn modify&#39; without arguments to see allowed parameters.&quot;</span>
</span><span id="GuacamoleDB.modify_connection-752"><a href="#GuacamoleDB.modify_connection-752"><span class="linenos">752</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-753"><a href="#GuacamoleDB.modify_connection-753"><span class="linenos">753</span></a>
</span><span id="GuacamoleDB.modify_connection-754"><a href="#GuacamoleDB.modify_connection-754"><span class="linenos">754</span></a>            <span class="c1"># Use resolver to get connection_id and validate inputs</span>
</span><span id="GuacamoleDB.modify_connection-755"><a href="#GuacamoleDB.modify_connection-755"><span class="linenos">755</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-756"><a href="#GuacamoleDB.modify_connection-756"><span class="linenos">756</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB.modify_connection-757"><a href="#GuacamoleDB.modify_connection-757"><span class="linenos">757</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-758"><a href="#GuacamoleDB.modify_connection-758"><span class="linenos">758</span></a>
</span><span id="GuacamoleDB.modify_connection-759"><a href="#GuacamoleDB.modify_connection-759"><span class="linenos">759</span></a>            <span class="n">param_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONNECTION_PARAMETERS</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span>
</span><span id="GuacamoleDB.modify_connection-760"><a href="#GuacamoleDB.modify_connection-760"><span class="linenos">760</span></a>            <span class="n">param_table</span> <span class="o">=</span> <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span>
</span><span id="GuacamoleDB.modify_connection-761"><a href="#GuacamoleDB.modify_connection-761"><span class="linenos">761</span></a>
</span><span id="GuacamoleDB.modify_connection-762"><a href="#GuacamoleDB.modify_connection-762"><span class="linenos">762</span></a>            <span class="c1"># Update the parameter based on which table it belongs to</span>
</span><span id="GuacamoleDB.modify_connection-763"><a href="#GuacamoleDB.modify_connection-763"><span class="linenos">763</span></a>            <span class="k">if</span> <span class="n">param_table</span> <span class="o">==</span> <span class="s2">&quot;connection&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-764"><a href="#GuacamoleDB.modify_connection-764"><span class="linenos">764</span></a>                <span class="c1"># Validate parameter value based on type</span>
</span><span id="GuacamoleDB.modify_connection-765"><a href="#GuacamoleDB.modify_connection-765"><span class="linenos">765</span></a>                <span class="k">if</span> <span class="n">param_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-766"><a href="#GuacamoleDB.modify_connection-766"><span class="linenos">766</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-767"><a href="#GuacamoleDB.modify_connection-767"><span class="linenos">767</span></a>                        <span class="n">param_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-768"><a href="#GuacamoleDB.modify_connection-768"><span class="linenos">768</span></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-769"><a href="#GuacamoleDB.modify_connection-769"><span class="linenos">769</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> must be an integer&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-770"><a href="#GuacamoleDB.modify_connection-770"><span class="linenos">770</span></a>
</span><span id="GuacamoleDB.modify_connection-771"><a href="#GuacamoleDB.modify_connection-771"><span class="linenos">771</span></a>                <span class="c1"># Update in guacamole_connection table</span>
</span><span id="GuacamoleDB.modify_connection-772"><a href="#GuacamoleDB.modify_connection-772"><span class="linenos">772</span></a>                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-773"><a href="#GuacamoleDB.modify_connection-773"><span class="linenos">773</span></a><span class="s2">                    UPDATE guacamole_connection </span>
</span><span id="GuacamoleDB.modify_connection-774"><a href="#GuacamoleDB.modify_connection-774"><span class="linenos">774</span></a><span class="s2">                    SET </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> = %s</span>
</span><span id="GuacamoleDB.modify_connection-775"><a href="#GuacamoleDB.modify_connection-775"><span class="linenos">775</span></a><span class="s2">                    WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.modify_connection-776"><a href="#GuacamoleDB.modify_connection-776"><span class="linenos">776</span></a><span class="s2">                &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-777"><a href="#GuacamoleDB.modify_connection-777"><span class="linenos">777</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="n">resolved_connection_id</span><span class="p">))</span>
</span><span id="GuacamoleDB.modify_connection-778"><a href="#GuacamoleDB.modify_connection-778"><span class="linenos">778</span></a>
</span><span id="GuacamoleDB.modify_connection-779"><a href="#GuacamoleDB.modify_connection-779"><span class="linenos">779</span></a>            <span class="k">elif</span> <span class="n">param_table</span> <span class="o">==</span> <span class="s2">&quot;parameter&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-780"><a href="#GuacamoleDB.modify_connection-780"><span class="linenos">780</span></a>                <span class="c1"># Special handling for read-only parameter</span>
</span><span id="GuacamoleDB.modify_connection-781"><a href="#GuacamoleDB.modify_connection-781"><span class="linenos">781</span></a>                <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;read-only&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-782"><a href="#GuacamoleDB.modify_connection-782"><span class="linenos">782</span></a>                    <span class="c1"># Validate boolean value</span>
</span><span id="GuacamoleDB.modify_connection-783"><a href="#GuacamoleDB.modify_connection-783"><span class="linenos">783</span></a>                    <span class="k">if</span> <span class="n">param_value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">):</span>
</span><span id="GuacamoleDB.modify_connection-784"><a href="#GuacamoleDB.modify_connection-784"><span class="linenos">784</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-785"><a href="#GuacamoleDB.modify_connection-785"><span class="linenos">785</span></a>                            <span class="s2">&quot;Parameter read-only must be &#39;true&#39; or &#39;false&#39;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-786"><a href="#GuacamoleDB.modify_connection-786"><span class="linenos">786</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-787"><a href="#GuacamoleDB.modify_connection-787"><span class="linenos">787</span></a>
</span><span id="GuacamoleDB.modify_connection-788"><a href="#GuacamoleDB.modify_connection-788"><span class="linenos">788</span></a>                    <span class="c1"># For read-only, we either add with &#39;true&#39; or remove the parameter</span>
</span><span id="GuacamoleDB.modify_connection-789"><a href="#GuacamoleDB.modify_connection-789"><span class="linenos">789</span></a>                    <span class="k">if</span> <span class="n">param_value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-790"><a href="#GuacamoleDB.modify_connection-790"><span class="linenos">790</span></a>                        <span class="c1"># Check if parameter already exists</span>
</span><span id="GuacamoleDB.modify_connection-791"><a href="#GuacamoleDB.modify_connection-791"><span class="linenos">791</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-792"><a href="#GuacamoleDB.modify_connection-792"><span class="linenos">792</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-793"><a href="#GuacamoleDB.modify_connection-793"><span class="linenos">793</span></a><span class="sd">                            SELECT parameter_value FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.modify_connection-794"><a href="#GuacamoleDB.modify_connection-794"><span class="linenos">794</span></a><span class="sd">                            WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB.modify_connection-795"><a href="#GuacamoleDB.modify_connection-795"><span class="linenos">795</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-796"><a href="#GuacamoleDB.modify_connection-796"><span class="linenos">796</span></a>                            <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection-797"><a href="#GuacamoleDB.modify_connection-797"><span class="linenos">797</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-798"><a href="#GuacamoleDB.modify_connection-798"><span class="linenos">798</span></a>
</span><span id="GuacamoleDB.modify_connection-799"><a href="#GuacamoleDB.modify_connection-799"><span class="linenos">799</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB.modify_connection-800"><a href="#GuacamoleDB.modify_connection-800"><span class="linenos">800</span></a>                            <span class="c1"># Update existing parameter</span>
</span><span id="GuacamoleDB.modify_connection-801"><a href="#GuacamoleDB.modify_connection-801"><span class="linenos">801</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-802"><a href="#GuacamoleDB.modify_connection-802"><span class="linenos">802</span></a><span class="w">                                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-803"><a href="#GuacamoleDB.modify_connection-803"><span class="linenos">803</span></a><span class="sd">                                UPDATE guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.modify_connection-804"><a href="#GuacamoleDB.modify_connection-804"><span class="linenos">804</span></a><span class="sd">                                SET parameter_value = &#39;true&#39;</span>
</span><span id="GuacamoleDB.modify_connection-805"><a href="#GuacamoleDB.modify_connection-805"><span class="linenos">805</span></a><span class="sd">                                WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB.modify_connection-806"><a href="#GuacamoleDB.modify_connection-806"><span class="linenos">806</span></a><span class="sd">                            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-807"><a href="#GuacamoleDB.modify_connection-807"><span class="linenos">807</span></a>                                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection-808"><a href="#GuacamoleDB.modify_connection-808"><span class="linenos">808</span></a>                            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-809"><a href="#GuacamoleDB.modify_connection-809"><span class="linenos">809</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-810"><a href="#GuacamoleDB.modify_connection-810"><span class="linenos">810</span></a>                            <span class="c1"># Insert new parameter</span>
</span><span id="GuacamoleDB.modify_connection-811"><a href="#GuacamoleDB.modify_connection-811"><span class="linenos">811</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-812"><a href="#GuacamoleDB.modify_connection-812"><span class="linenos">812</span></a><span class="w">                                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-813"><a href="#GuacamoleDB.modify_connection-813"><span class="linenos">813</span></a><span class="sd">                                INSERT INTO guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.modify_connection-814"><a href="#GuacamoleDB.modify_connection-814"><span class="linenos">814</span></a><span class="sd">                                (connection_id, parameter_name, parameter_value)</span>
</span><span id="GuacamoleDB.modify_connection-815"><a href="#GuacamoleDB.modify_connection-815"><span class="linenos">815</span></a><span class="sd">                                VALUES (%s, %s, &#39;true&#39;)</span>
</span><span id="GuacamoleDB.modify_connection-816"><a href="#GuacamoleDB.modify_connection-816"><span class="linenos">816</span></a><span class="sd">                            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-817"><a href="#GuacamoleDB.modify_connection-817"><span class="linenos">817</span></a>                                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection-818"><a href="#GuacamoleDB.modify_connection-818"><span class="linenos">818</span></a>                            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-819"><a href="#GuacamoleDB.modify_connection-819"><span class="linenos">819</span></a>                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># param_value.lower() == &#39;false&#39;</span>
</span><span id="GuacamoleDB.modify_connection-820"><a href="#GuacamoleDB.modify_connection-820"><span class="linenos">820</span></a>                        <span class="c1"># Remove the parameter if it exists</span>
</span><span id="GuacamoleDB.modify_connection-821"><a href="#GuacamoleDB.modify_connection-821"><span class="linenos">821</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-822"><a href="#GuacamoleDB.modify_connection-822"><span class="linenos">822</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-823"><a href="#GuacamoleDB.modify_connection-823"><span class="linenos">823</span></a><span class="sd">                            DELETE FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.modify_connection-824"><a href="#GuacamoleDB.modify_connection-824"><span class="linenos">824</span></a><span class="sd">                            WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB.modify_connection-825"><a href="#GuacamoleDB.modify_connection-825"><span class="linenos">825</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-826"><a href="#GuacamoleDB.modify_connection-826"><span class="linenos">826</span></a>                            <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection-827"><a href="#GuacamoleDB.modify_connection-827"><span class="linenos">827</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-828"><a href="#GuacamoleDB.modify_connection-828"><span class="linenos">828</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-829"><a href="#GuacamoleDB.modify_connection-829"><span class="linenos">829</span></a>                    <span class="c1"># Special handling for color-depth</span>
</span><span id="GuacamoleDB.modify_connection-830"><a href="#GuacamoleDB.modify_connection-830"><span class="linenos">830</span></a>                    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;color-depth&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-831"><a href="#GuacamoleDB.modify_connection-831"><span class="linenos">831</span></a>                        <span class="k">if</span> <span class="n">param_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="s2">&quot;24&quot;</span><span class="p">,</span> <span class="s2">&quot;32&quot;</span><span class="p">):</span>
</span><span id="GuacamoleDB.modify_connection-832"><a href="#GuacamoleDB.modify_connection-832"><span class="linenos">832</span></a>                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-833"><a href="#GuacamoleDB.modify_connection-833"><span class="linenos">833</span></a>                                <span class="s2">&quot;color-depth must be one of: 8, 16, 24, 32&quot;</span>
</span><span id="GuacamoleDB.modify_connection-834"><a href="#GuacamoleDB.modify_connection-834"><span class="linenos">834</span></a>                            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-835"><a href="#GuacamoleDB.modify_connection-835"><span class="linenos">835</span></a>
</span><span id="GuacamoleDB.modify_connection-836"><a href="#GuacamoleDB.modify_connection-836"><span class="linenos">836</span></a>                    <span class="c1"># Regular parameter handling</span>
</span><span id="GuacamoleDB.modify_connection-837"><a href="#GuacamoleDB.modify_connection-837"><span class="linenos">837</span></a>                    <span class="c1"># Check if parameter already exists</span>
</span><span id="GuacamoleDB.modify_connection-838"><a href="#GuacamoleDB.modify_connection-838"><span class="linenos">838</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-839"><a href="#GuacamoleDB.modify_connection-839"><span class="linenos">839</span></a><span class="w">                        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-840"><a href="#GuacamoleDB.modify_connection-840"><span class="linenos">840</span></a><span class="sd">                        SELECT parameter_value FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.modify_connection-841"><a href="#GuacamoleDB.modify_connection-841"><span class="linenos">841</span></a><span class="sd">                        WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB.modify_connection-842"><a href="#GuacamoleDB.modify_connection-842"><span class="linenos">842</span></a><span class="sd">                    &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-843"><a href="#GuacamoleDB.modify_connection-843"><span class="linenos">843</span></a>                        <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection-844"><a href="#GuacamoleDB.modify_connection-844"><span class="linenos">844</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-845"><a href="#GuacamoleDB.modify_connection-845"><span class="linenos">845</span></a>
</span><span id="GuacamoleDB.modify_connection-846"><a href="#GuacamoleDB.modify_connection-846"><span class="linenos">846</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB.modify_connection-847"><a href="#GuacamoleDB.modify_connection-847"><span class="linenos">847</span></a>                        <span class="c1"># Update existing parameter</span>
</span><span id="GuacamoleDB.modify_connection-848"><a href="#GuacamoleDB.modify_connection-848"><span class="linenos">848</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-849"><a href="#GuacamoleDB.modify_connection-849"><span class="linenos">849</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-850"><a href="#GuacamoleDB.modify_connection-850"><span class="linenos">850</span></a><span class="sd">                            UPDATE guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.modify_connection-851"><a href="#GuacamoleDB.modify_connection-851"><span class="linenos">851</span></a><span class="sd">                            SET parameter_value = %s</span>
</span><span id="GuacamoleDB.modify_connection-852"><a href="#GuacamoleDB.modify_connection-852"><span class="linenos">852</span></a><span class="sd">                            WHERE connection_id = %s AND parameter_name = %s</span>
</span><span id="GuacamoleDB.modify_connection-853"><a href="#GuacamoleDB.modify_connection-853"><span class="linenos">853</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-854"><a href="#GuacamoleDB.modify_connection-854"><span class="linenos">854</span></a>                            <span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection-855"><a href="#GuacamoleDB.modify_connection-855"><span class="linenos">855</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-856"><a href="#GuacamoleDB.modify_connection-856"><span class="linenos">856</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-857"><a href="#GuacamoleDB.modify_connection-857"><span class="linenos">857</span></a>                        <span class="c1"># Insert new parameter</span>
</span><span id="GuacamoleDB.modify_connection-858"><a href="#GuacamoleDB.modify_connection-858"><span class="linenos">858</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection-859"><a href="#GuacamoleDB.modify_connection-859"><span class="linenos">859</span></a><span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection-860"><a href="#GuacamoleDB.modify_connection-860"><span class="linenos">860</span></a><span class="sd">                            INSERT INTO guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.modify_connection-861"><a href="#GuacamoleDB.modify_connection-861"><span class="linenos">861</span></a><span class="sd">                            (connection_id, parameter_name, parameter_value)</span>
</span><span id="GuacamoleDB.modify_connection-862"><a href="#GuacamoleDB.modify_connection-862"><span class="linenos">862</span></a><span class="sd">                            VALUES (%s, %s, %s)</span>
</span><span id="GuacamoleDB.modify_connection-863"><a href="#GuacamoleDB.modify_connection-863"><span class="linenos">863</span></a><span class="sd">                        &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection-864"><a href="#GuacamoleDB.modify_connection-864"><span class="linenos">864</span></a>                            <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection-865"><a href="#GuacamoleDB.modify_connection-865"><span class="linenos">865</span></a>                        <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-866"><a href="#GuacamoleDB.modify_connection-866"><span class="linenos">866</span></a>
</span><span id="GuacamoleDB.modify_connection-867"><a href="#GuacamoleDB.modify_connection-867"><span class="linenos">867</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-868"><a href="#GuacamoleDB.modify_connection-868"><span class="linenos">868</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update connection parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-869"><a href="#GuacamoleDB.modify_connection-869"><span class="linenos">869</span></a>
</span><span id="GuacamoleDB.modify_connection-870"><a href="#GuacamoleDB.modify_connection-870"><span class="linenos">870</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.modify_connection-871"><a href="#GuacamoleDB.modify_connection-871"><span class="linenos">871</span></a>
</span><span id="GuacamoleDB.modify_connection-872"><a href="#GuacamoleDB.modify_connection-872"><span class="linenos">872</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection-873"><a href="#GuacamoleDB.modify_connection-873"><span class="linenos">873</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying connection parameter: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection-874"><a href="#GuacamoleDB.modify_connection-874"><span class="linenos">874</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Modify a connection parameter in either guacamole_connection or guacamole_connection_parameter table</p>
</div>


                            </div>
                            <div id="GuacamoleDB.change_user_password" class="classattr">
                                        <input id="GuacamoleDB.change_user_password-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">change_user_password</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">new_password</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.change_user_password-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.change_user_password"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.change_user_password-876"><a href="#GuacamoleDB.change_user_password-876"><span class="linenos">876</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">change_user_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.change_user_password-877"><a href="#GuacamoleDB.change_user_password-877"><span class="linenos">877</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the password for an existing user.</span>
</span><span id="GuacamoleDB.change_user_password-878"><a href="#GuacamoleDB.change_user_password-878"><span class="linenos">878</span></a>
</span><span id="GuacamoleDB.change_user_password-879"><a href="#GuacamoleDB.change_user_password-879"><span class="linenos">879</span></a><span class="sd">        Updates a user&#39;s password with secure hashing using a new random salt.</span>
</span><span id="GuacamoleDB.change_user_password-880"><a href="#GuacamoleDB.change_user_password-880"><span class="linenos">880</span></a><span class="sd">        Uses the same hashing method as create_user() for consistency.</span>
</span><span id="GuacamoleDB.change_user_password-881"><a href="#GuacamoleDB.change_user_password-881"><span class="linenos">881</span></a>
</span><span id="GuacamoleDB.change_user_password-882"><a href="#GuacamoleDB.change_user_password-882"><span class="linenos">882</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.change_user_password-883"><a href="#GuacamoleDB.change_user_password-883"><span class="linenos">883</span></a><span class="sd">            username: The username whose password should be changed.</span>
</span><span id="GuacamoleDB.change_user_password-884"><a href="#GuacamoleDB.change_user_password-884"><span class="linenos">884</span></a><span class="sd">            new_password: The new password to set.</span>
</span><span id="GuacamoleDB.change_user_password-885"><a href="#GuacamoleDB.change_user_password-885"><span class="linenos">885</span></a>
</span><span id="GuacamoleDB.change_user_password-886"><a href="#GuacamoleDB.change_user_password-886"><span class="linenos">886</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.change_user_password-887"><a href="#GuacamoleDB.change_user_password-887"><span class="linenos">887</span></a><span class="sd">            True if password was successfully changed.</span>
</span><span id="GuacamoleDB.change_user_password-888"><a href="#GuacamoleDB.change_user_password-888"><span class="linenos">888</span></a>
</span><span id="GuacamoleDB.change_user_password-889"><a href="#GuacamoleDB.change_user_password-889"><span class="linenos">889</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.change_user_password-890"><a href="#GuacamoleDB.change_user_password-890"><span class="linenos">890</span></a><span class="sd">            ValueError: If user is not found or password update fails.</span>
</span><span id="GuacamoleDB.change_user_password-891"><a href="#GuacamoleDB.change_user_password-891"><span class="linenos">891</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB.change_user_password-892"><a href="#GuacamoleDB.change_user_password-892"><span class="linenos">892</span></a>
</span><span id="GuacamoleDB.change_user_password-893"><a href="#GuacamoleDB.change_user_password-893"><span class="linenos">893</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.change_user_password-894"><a href="#GuacamoleDB.change_user_password-894"><span class="linenos">894</span></a><span class="sd">            Generates a new random salt for security. The password date is</span>
</span><span id="GuacamoleDB.change_user_password-895"><a href="#GuacamoleDB.change_user_password-895"><span class="linenos">895</span></a><span class="sd">            updated to track when the password was last changed.</span>
</span><span id="GuacamoleDB.change_user_password-896"><a href="#GuacamoleDB.change_user_password-896"><span class="linenos">896</span></a>
</span><span id="GuacamoleDB.change_user_password-897"><a href="#GuacamoleDB.change_user_password-897"><span class="linenos">897</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.change_user_password-898"><a href="#GuacamoleDB.change_user_password-898"><span class="linenos">898</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.change_user_password-899"><a href="#GuacamoleDB.change_user_password-899"><span class="linenos">899</span></a><span class="sd">            ...     db.change_user_password(&#39;user1&#39;, &#39;newsecurepassword&#39;)</span>
</span><span id="GuacamoleDB.change_user_password-900"><a href="#GuacamoleDB.change_user_password-900"><span class="linenos">900</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.change_user_password-901"><a href="#GuacamoleDB.change_user_password-901"><span class="linenos">901</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.change_user_password-902"><a href="#GuacamoleDB.change_user_password-902"><span class="linenos">902</span></a>            <span class="c1"># Generate random 32-byte salt</span>
</span><span id="GuacamoleDB.change_user_password-903"><a href="#GuacamoleDB.change_user_password-903"><span class="linenos">903</span></a>            <span class="n">salt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="GuacamoleDB.change_user_password-904"><a href="#GuacamoleDB.change_user_password-904"><span class="linenos">904</span></a>
</span><span id="GuacamoleDB.change_user_password-905"><a href="#GuacamoleDB.change_user_password-905"><span class="linenos">905</span></a>            <span class="c1"># Convert salt to uppercase hex string as Guacamole expects</span>
</span><span id="GuacamoleDB.change_user_password-906"><a href="#GuacamoleDB.change_user_password-906"><span class="linenos">906</span></a>            <span class="n">salt_hex</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">salt</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="GuacamoleDB.change_user_password-907"><a href="#GuacamoleDB.change_user_password-907"><span class="linenos">907</span></a>
</span><span id="GuacamoleDB.change_user_password-908"><a href="#GuacamoleDB.change_user_password-908"><span class="linenos">908</span></a>            <span class="c1"># Create password hash using Guacamole&#39;s method: SHA256(password + hex(salt))</span>
</span><span id="GuacamoleDB.change_user_password-909"><a href="#GuacamoleDB.change_user_password-909"><span class="linenos">909</span></a>            <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">new_password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">salt_hex</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span><span id="GuacamoleDB.change_user_password-910"><a href="#GuacamoleDB.change_user_password-910"><span class="linenos">910</span></a>
</span><span id="GuacamoleDB.change_user_password-911"><a href="#GuacamoleDB.change_user_password-911"><span class="linenos">911</span></a>            <span class="c1"># Get user entity_id</span>
</span><span id="GuacamoleDB.change_user_password-912"><a href="#GuacamoleDB.change_user_password-912"><span class="linenos">912</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.change_user_password-913"><a href="#GuacamoleDB.change_user_password-913"><span class="linenos">913</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.change_user_password-914"><a href="#GuacamoleDB.change_user_password-914"><span class="linenos">914</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.change_user_password-915"><a href="#GuacamoleDB.change_user_password-915"><span class="linenos">915</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.change_user_password-916"><a href="#GuacamoleDB.change_user_password-916"><span class="linenos">916</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.change_user_password-917"><a href="#GuacamoleDB.change_user_password-917"><span class="linenos">917</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.change_user_password-918"><a href="#GuacamoleDB.change_user_password-918"><span class="linenos">918</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.change_user_password-919"><a href="#GuacamoleDB.change_user_password-919"><span class="linenos">919</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.change_user_password-920"><a href="#GuacamoleDB.change_user_password-920"><span class="linenos">920</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.change_user_password-921"><a href="#GuacamoleDB.change_user_password-921"><span class="linenos">921</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.change_user_password-922"><a href="#GuacamoleDB.change_user_password-922"><span class="linenos">922</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.change_user_password-923"><a href="#GuacamoleDB.change_user_password-923"><span class="linenos">923</span></a>
</span><span id="GuacamoleDB.change_user_password-924"><a href="#GuacamoleDB.change_user_password-924"><span class="linenos">924</span></a>            <span class="c1"># Update the password</span>
</span><span id="GuacamoleDB.change_user_password-925"><a href="#GuacamoleDB.change_user_password-925"><span class="linenos">925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.change_user_password-926"><a href="#GuacamoleDB.change_user_password-926"><span class="linenos">926</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.change_user_password-927"><a href="#GuacamoleDB.change_user_password-927"><span class="linenos">927</span></a><span class="sd">                UPDATE guacamole_user</span>
</span><span id="GuacamoleDB.change_user_password-928"><a href="#GuacamoleDB.change_user_password-928"><span class="linenos">928</span></a><span class="sd">                SET password_hash = %s,</span>
</span><span id="GuacamoleDB.change_user_password-929"><a href="#GuacamoleDB.change_user_password-929"><span class="linenos">929</span></a><span class="sd">                    password_salt = %s,</span>
</span><span id="GuacamoleDB.change_user_password-930"><a href="#GuacamoleDB.change_user_password-930"><span class="linenos">930</span></a><span class="sd">                    password_date = NOW()</span>
</span><span id="GuacamoleDB.change_user_password-931"><a href="#GuacamoleDB.change_user_password-931"><span class="linenos">931</span></a><span class="sd">                WHERE entity_id = %s</span>
</span><span id="GuacamoleDB.change_user_password-932"><a href="#GuacamoleDB.change_user_password-932"><span class="linenos">932</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.change_user_password-933"><a href="#GuacamoleDB.change_user_password-933"><span class="linenos">933</span></a>                <span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.change_user_password-934"><a href="#GuacamoleDB.change_user_password-934"><span class="linenos">934</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.change_user_password-935"><a href="#GuacamoleDB.change_user_password-935"><span class="linenos">935</span></a>
</span><span id="GuacamoleDB.change_user_password-936"><a href="#GuacamoleDB.change_user_password-936"><span class="linenos">936</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.change_user_password-937"><a href="#GuacamoleDB.change_user_password-937"><span class="linenos">937</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update password for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.change_user_password-938"><a href="#GuacamoleDB.change_user_password-938"><span class="linenos">938</span></a>
</span><span id="GuacamoleDB.change_user_password-939"><a href="#GuacamoleDB.change_user_password-939"><span class="linenos">939</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.change_user_password-940"><a href="#GuacamoleDB.change_user_password-940"><span class="linenos">940</span></a>
</span><span id="GuacamoleDB.change_user_password-941"><a href="#GuacamoleDB.change_user_password-941"><span class="linenos">941</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.change_user_password-942"><a href="#GuacamoleDB.change_user_password-942"><span class="linenos">942</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error changing password: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.change_user_password-943"><a href="#GuacamoleDB.change_user_password-943"><span class="linenos">943</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Change the password for an existing user.</p>

<p>Updates a user's password with secure hashing using a new random salt.
Uses the same hashing method as create_user() for consistency.</p>

<p>Args:
    username: The username whose password should be changed.
    new_password: The new password to set.</p>

<p>Returns:
    True if password was successfully changed.</p>

<p>Raises:
    ValueError: If user is not found or password update fails.
    mysql.connector.Error: If database operations fail.</p>

<p>Note:
    Generates a new random salt for security. The password date is
    updated to track when the password was last changed.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     db.change_user_password('user1', 'newsecurepassword')</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.modify_user" class="classattr">
                                        <input id="GuacamoleDB.modify_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modify_user</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">username</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">param_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.modify_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.modify_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.modify_user-945"><a href="#GuacamoleDB.modify_user-945"><span class="linenos"> 945</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_user</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_user-946"><a href="#GuacamoleDB.modify_user-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">param_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="GuacamoleDB.modify_user-947"><a href="#GuacamoleDB.modify_user-947"><span class="linenos"> 947</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_user-948"><a href="#GuacamoleDB.modify_user-948"><span class="linenos"> 948</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modify a user parameter in the Guacamole database.</span>
</span><span id="GuacamoleDB.modify_user-949"><a href="#GuacamoleDB.modify_user-949"><span class="linenos"> 949</span></a>
</span><span id="GuacamoleDB.modify_user-950"><a href="#GuacamoleDB.modify_user-950"><span class="linenos"> 950</span></a><span class="sd">        Updates user account parameters such as disabled status, expiration dates,</span>
</span><span id="GuacamoleDB.modify_user-951"><a href="#GuacamoleDB.modify_user-951"><span class="linenos"> 951</span></a><span class="sd">        time windows, timezone, and contact information.</span>
</span><span id="GuacamoleDB.modify_user-952"><a href="#GuacamoleDB.modify_user-952"><span class="linenos"> 952</span></a>
</span><span id="GuacamoleDB.modify_user-953"><a href="#GuacamoleDB.modify_user-953"><span class="linenos"> 953</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.modify_user-954"><a href="#GuacamoleDB.modify_user-954"><span class="linenos"> 954</span></a><span class="sd">            username: The username to modify.</span>
</span><span id="GuacamoleDB.modify_user-955"><a href="#GuacamoleDB.modify_user-955"><span class="linenos"> 955</span></a><span class="sd">            param_name: The parameter name to modify.</span>
</span><span id="GuacamoleDB.modify_user-956"><a href="#GuacamoleDB.modify_user-956"><span class="linenos"> 956</span></a><span class="sd">            param_value: The new value for the parameter.</span>
</span><span id="GuacamoleDB.modify_user-957"><a href="#GuacamoleDB.modify_user-957"><span class="linenos"> 957</span></a>
</span><span id="GuacamoleDB.modify_user-958"><a href="#GuacamoleDB.modify_user-958"><span class="linenos"> 958</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.modify_user-959"><a href="#GuacamoleDB.modify_user-959"><span class="linenos"> 959</span></a><span class="sd">            True if the parameter was successfully updated.</span>
</span><span id="GuacamoleDB.modify_user-960"><a href="#GuacamoleDB.modify_user-960"><span class="linenos"> 960</span></a>
</span><span id="GuacamoleDB.modify_user-961"><a href="#GuacamoleDB.modify_user-961"><span class="linenos"> 961</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.modify_user-962"><a href="#GuacamoleDB.modify_user-962"><span class="linenos"> 962</span></a><span class="sd">            ValueError: If parameter name is invalid, user doesn&#39;t exist,</span>
</span><span id="GuacamoleDB.modify_user-963"><a href="#GuacamoleDB.modify_user-963"><span class="linenos"> 963</span></a><span class="sd">                       or parameter update fails.</span>
</span><span id="GuacamoleDB.modify_user-964"><a href="#GuacamoleDB.modify_user-964"><span class="linenos"> 964</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB.modify_user-965"><a href="#GuacamoleDB.modify_user-965"><span class="linenos"> 965</span></a>
</span><span id="GuacamoleDB.modify_user-966"><a href="#GuacamoleDB.modify_user-966"><span class="linenos"> 966</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.modify_user-967"><a href="#GuacamoleDB.modify_user-967"><span class="linenos"> 967</span></a><span class="sd">            Valid parameters are defined in USER_PARAMETERS. Boolean values</span>
</span><span id="GuacamoleDB.modify_user-968"><a href="#GuacamoleDB.modify_user-968"><span class="linenos"> 968</span></a><span class="sd">            should be passed as &#39;0&#39; (false) or &#39;1&#39; (true) for tinyint fields.</span>
</span><span id="GuacamoleDB.modify_user-969"><a href="#GuacamoleDB.modify_user-969"><span class="linenos"> 969</span></a>
</span><span id="GuacamoleDB.modify_user-970"><a href="#GuacamoleDB.modify_user-970"><span class="linenos"> 970</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.modify_user-971"><a href="#GuacamoleDB.modify_user-971"><span class="linenos"> 971</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.modify_user-972"><a href="#GuacamoleDB.modify_user-972"><span class="linenos"> 972</span></a><span class="sd">            ...     db.modify_user(&#39;user1&#39;, &#39;disabled&#39;, &#39;1&#39;)</span>
</span><span id="GuacamoleDB.modify_user-973"><a href="#GuacamoleDB.modify_user-973"><span class="linenos"> 973</span></a><span class="sd">            ...     db.modify_user(&#39;user1&#39;, &#39;full_name&#39;, &#39;John Doe&#39;)</span>
</span><span id="GuacamoleDB.modify_user-974"><a href="#GuacamoleDB.modify_user-974"><span class="linenos"> 974</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_user-975"><a href="#GuacamoleDB.modify_user-975"><span class="linenos"> 975</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_user-976"><a href="#GuacamoleDB.modify_user-976"><span class="linenos"> 976</span></a>            <span class="c1"># Validate parameter name</span>
</span><span id="GuacamoleDB.modify_user-977"><a href="#GuacamoleDB.modify_user-977"><span class="linenos"> 977</span></a>            <span class="k">if</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">USER_PARAMETERS</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_user-978"><a href="#GuacamoleDB.modify_user-978"><span class="linenos"> 978</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_user-979"><a href="#GuacamoleDB.modify_user-979"><span class="linenos"> 979</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">. Run &#39;guacaman user modify&#39; without arguments to see allowed parameters.&quot;</span>
</span><span id="GuacamoleDB.modify_user-980"><a href="#GuacamoleDB.modify_user-980"><span class="linenos"> 980</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.modify_user-981"><a href="#GuacamoleDB.modify_user-981"><span class="linenos"> 981</span></a>
</span><span id="GuacamoleDB.modify_user-982"><a href="#GuacamoleDB.modify_user-982"><span class="linenos"> 982</span></a>            <span class="c1"># Validate parameter value based on type</span>
</span><span id="GuacamoleDB.modify_user-983"><a href="#GuacamoleDB.modify_user-983"><span class="linenos"> 983</span></a>            <span class="n">param_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">USER_PARAMETERS</span><span class="p">[</span><span class="n">param_name</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="GuacamoleDB.modify_user-984"><a href="#GuacamoleDB.modify_user-984"><span class="linenos"> 984</span></a>            <span class="k">if</span> <span class="n">param_type</span> <span class="o">==</span> <span class="s2">&quot;tinyint&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_user-985"><a href="#GuacamoleDB.modify_user-985"><span class="linenos"> 985</span></a>                <span class="k">if</span> <span class="n">param_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">):</span>
</span><span id="GuacamoleDB.modify_user-986"><a href="#GuacamoleDB.modify_user-986"><span class="linenos"> 986</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> must be 0 or 1&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_user-987"><a href="#GuacamoleDB.modify_user-987"><span class="linenos"> 987</span></a>                <span class="n">param_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_user-988"><a href="#GuacamoleDB.modify_user-988"><span class="linenos"> 988</span></a>
</span><span id="GuacamoleDB.modify_user-989"><a href="#GuacamoleDB.modify_user-989"><span class="linenos"> 989</span></a>            <span class="c1"># Get user entity_id</span>
</span><span id="GuacamoleDB.modify_user-990"><a href="#GuacamoleDB.modify_user-990"><span class="linenos"> 990</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_user-991"><a href="#GuacamoleDB.modify_user-991"><span class="linenos"> 991</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_user-992"><a href="#GuacamoleDB.modify_user-992"><span class="linenos"> 992</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.modify_user-993"><a href="#GuacamoleDB.modify_user-993"><span class="linenos"> 993</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.modify_user-994"><a href="#GuacamoleDB.modify_user-994"><span class="linenos"> 994</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_user-995"><a href="#GuacamoleDB.modify_user-995"><span class="linenos"> 995</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.modify_user-996"><a href="#GuacamoleDB.modify_user-996"><span class="linenos"> 996</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_user-997"><a href="#GuacamoleDB.modify_user-997"><span class="linenos"> 997</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.modify_user-998"><a href="#GuacamoleDB.modify_user-998"><span class="linenos"> 998</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_user-999"><a href="#GuacamoleDB.modify_user-999"><span class="linenos"> 999</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_user-1000"><a href="#GuacamoleDB.modify_user-1000"><span class="linenos">1000</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.modify_user-1001"><a href="#GuacamoleDB.modify_user-1001"><span class="linenos">1001</span></a>
</span><span id="GuacamoleDB.modify_user-1002"><a href="#GuacamoleDB.modify_user-1002"><span class="linenos">1002</span></a>            <span class="c1"># Update the parameter</span>
</span><span id="GuacamoleDB.modify_user-1003"><a href="#GuacamoleDB.modify_user-1003"><span class="linenos">1003</span></a>            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_user-1004"><a href="#GuacamoleDB.modify_user-1004"><span class="linenos">1004</span></a><span class="s2">                UPDATE guacamole_user</span>
</span><span id="GuacamoleDB.modify_user-1005"><a href="#GuacamoleDB.modify_user-1005"><span class="linenos">1005</span></a><span class="s2">                SET </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2"> = %s</span>
</span><span id="GuacamoleDB.modify_user-1006"><a href="#GuacamoleDB.modify_user-1006"><span class="linenos">1006</span></a><span class="s2">                WHERE entity_id = %s</span>
</span><span id="GuacamoleDB.modify_user-1007"><a href="#GuacamoleDB.modify_user-1007"><span class="linenos">1007</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_user-1008"><a href="#GuacamoleDB.modify_user-1008"><span class="linenos">1008</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">param_value</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">))</span>
</span><span id="GuacamoleDB.modify_user-1009"><a href="#GuacamoleDB.modify_user-1009"><span class="linenos">1009</span></a>
</span><span id="GuacamoleDB.modify_user-1010"><a href="#GuacamoleDB.modify_user-1010"><span class="linenos">1010</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_user-1011"><a href="#GuacamoleDB.modify_user-1011"><span class="linenos">1011</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update user parameter: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_user-1012"><a href="#GuacamoleDB.modify_user-1012"><span class="linenos">1012</span></a>
</span><span id="GuacamoleDB.modify_user-1013"><a href="#GuacamoleDB.modify_user-1013"><span class="linenos">1013</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.modify_user-1014"><a href="#GuacamoleDB.modify_user-1014"><span class="linenos">1014</span></a>
</span><span id="GuacamoleDB.modify_user-1015"><a href="#GuacamoleDB.modify_user-1015"><span class="linenos">1015</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_user-1016"><a href="#GuacamoleDB.modify_user-1016"><span class="linenos">1016</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying user parameter: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_user-1017"><a href="#GuacamoleDB.modify_user-1017"><span class="linenos">1017</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Modify a user parameter in the Guacamole database.</p>

<p>Updates user account parameters such as disabled status, expiration dates,
time windows, timezone, and contact information.</p>

<p>Args:
    username: The username to modify.
    param_name: The parameter name to modify.
    param_value: The new value for the parameter.</p>

<p>Returns:
    True if the parameter was successfully updated.</p>

<p>Raises:
    ValueError: If parameter name is invalid, user doesn't exist,
               or parameter update fails.
    mysql.connector.Error: If database operations fail.</p>

<p>Note:
    Valid parameters are defined in USER_PARAMETERS. Boolean values
    should be passed as '0' (false) or '1' (true) for tinyint fields.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     db.modify_user('user1', 'disabled', '1')
          ...     db.modify_user('user1', 'full_name', 'John Doe')</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.delete_existing_user" class="classattr">
                                        <input id="GuacamoleDB.delete_existing_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_existing_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.delete_existing_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.delete_existing_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.delete_existing_user-1019"><a href="#GuacamoleDB.delete_existing_user-1019"><span class="linenos">1019</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_user-1020"><a href="#GuacamoleDB.delete_existing_user-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a user and all associated data from the Guacamole database.</span>
</span><span id="GuacamoleDB.delete_existing_user-1021"><a href="#GuacamoleDB.delete_existing_user-1021"><span class="linenos">1021</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1022"><a href="#GuacamoleDB.delete_existing_user-1022"><span class="linenos">1022</span></a><span class="sd">        Removes a user completely from the system, including their entity record,</span>
</span><span id="GuacamoleDB.delete_existing_user-1023"><a href="#GuacamoleDB.delete_existing_user-1023"><span class="linenos">1023</span></a><span class="sd">        user account, group memberships, and all permissions. This operation</span>
</span><span id="GuacamoleDB.delete_existing_user-1024"><a href="#GuacamoleDB.delete_existing_user-1024"><span class="linenos">1024</span></a><span class="sd">        cascades through all related tables to maintain database integrity.</span>
</span><span id="GuacamoleDB.delete_existing_user-1025"><a href="#GuacamoleDB.delete_existing_user-1025"><span class="linenos">1025</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1026"><a href="#GuacamoleDB.delete_existing_user-1026"><span class="linenos">1026</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.delete_existing_user-1027"><a href="#GuacamoleDB.delete_existing_user-1027"><span class="linenos">1027</span></a><span class="sd">            username: The username to delete.</span>
</span><span id="GuacamoleDB.delete_existing_user-1028"><a href="#GuacamoleDB.delete_existing_user-1028"><span class="linenos">1028</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1029"><a href="#GuacamoleDB.delete_existing_user-1029"><span class="linenos">1029</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.delete_existing_user-1030"><a href="#GuacamoleDB.delete_existing_user-1030"><span class="linenos">1030</span></a><span class="sd">            ValueError: If the user doesn&#39;t exist.</span>
</span><span id="GuacamoleDB.delete_existing_user-1031"><a href="#GuacamoleDB.delete_existing_user-1031"><span class="linenos">1031</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB.delete_existing_user-1032"><a href="#GuacamoleDB.delete_existing_user-1032"><span class="linenos">1032</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1033"><a href="#GuacamoleDB.delete_existing_user-1033"><span class="linenos">1033</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.delete_existing_user-1034"><a href="#GuacamoleDB.delete_existing_user-1034"><span class="linenos">1034</span></a><span class="sd">            This is a destructive operation that cannot be undone. The user and</span>
</span><span id="GuacamoleDB.delete_existing_user-1035"><a href="#GuacamoleDB.delete_existing_user-1035"><span class="linenos">1035</span></a><span class="sd">            all their associated permissions and memberships are permanently</span>
</span><span id="GuacamoleDB.delete_existing_user-1036"><a href="#GuacamoleDB.delete_existing_user-1036"><span class="linenos">1036</span></a><span class="sd">            removed. Deletions are performed in the correct order to respect</span>
</span><span id="GuacamoleDB.delete_existing_user-1037"><a href="#GuacamoleDB.delete_existing_user-1037"><span class="linenos">1037</span></a><span class="sd">            foreign key constraints.</span>
</span><span id="GuacamoleDB.delete_existing_user-1038"><a href="#GuacamoleDB.delete_existing_user-1038"><span class="linenos">1038</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1039"><a href="#GuacamoleDB.delete_existing_user-1039"><span class="linenos">1039</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.delete_existing_user-1040"><a href="#GuacamoleDB.delete_existing_user-1040"><span class="linenos">1040</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.delete_existing_user-1041"><a href="#GuacamoleDB.delete_existing_user-1041"><span class="linenos">1041</span></a><span class="sd">            ...     db.delete_existing_user(&#39;olduser&#39;)</span>
</span><span id="GuacamoleDB.delete_existing_user-1042"><a href="#GuacamoleDB.delete_existing_user-1042"><span class="linenos">1042</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_user-1043"><a href="#GuacamoleDB.delete_existing_user-1043"><span class="linenos">1043</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_user-1044"><a href="#GuacamoleDB.delete_existing_user-1044"><span class="linenos">1044</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_exists</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
</span><span id="GuacamoleDB.delete_existing_user-1045"><a href="#GuacamoleDB.delete_existing_user-1045"><span class="linenos">1045</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1046"><a href="#GuacamoleDB.delete_existing_user-1046"><span class="linenos">1046</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1047"><a href="#GuacamoleDB.delete_existing_user-1047"><span class="linenos">1047</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting user: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1048"><a href="#GuacamoleDB.delete_existing_user-1048"><span class="linenos">1048</span></a>            <span class="c1"># Delete user group permissions first</span>
</span><span id="GuacamoleDB.delete_existing_user-1049"><a href="#GuacamoleDB.delete_existing_user-1049"><span class="linenos">1049</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_user-1050"><a href="#GuacamoleDB.delete_existing_user-1050"><span class="linenos">1050</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_user-1051"><a href="#GuacamoleDB.delete_existing_user-1051"><span class="linenos">1051</span></a><span class="sd">                DELETE FROM guacamole_user_group_permission</span>
</span><span id="GuacamoleDB.delete_existing_user-1052"><a href="#GuacamoleDB.delete_existing_user-1052"><span class="linenos">1052</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_user-1053"><a href="#GuacamoleDB.delete_existing_user-1053"><span class="linenos">1053</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.delete_existing_user-1054"><a href="#GuacamoleDB.delete_existing_user-1054"><span class="linenos">1054</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.delete_existing_user-1055"><a href="#GuacamoleDB.delete_existing_user-1055"><span class="linenos">1055</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_user-1056"><a href="#GuacamoleDB.delete_existing_user-1056"><span class="linenos">1056</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_user-1057"><a href="#GuacamoleDB.delete_existing_user-1057"><span class="linenos">1057</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_user-1058"><a href="#GuacamoleDB.delete_existing_user-1058"><span class="linenos">1058</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1059"><a href="#GuacamoleDB.delete_existing_user-1059"><span class="linenos">1059</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1060"><a href="#GuacamoleDB.delete_existing_user-1060"><span class="linenos">1060</span></a>            <span class="c1"># Delete user group memberships</span>
</span><span id="GuacamoleDB.delete_existing_user-1061"><a href="#GuacamoleDB.delete_existing_user-1061"><span class="linenos">1061</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_user-1062"><a href="#GuacamoleDB.delete_existing_user-1062"><span class="linenos">1062</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_user-1063"><a href="#GuacamoleDB.delete_existing_user-1063"><span class="linenos">1063</span></a><span class="sd">                DELETE FROM guacamole_user_group_member</span>
</span><span id="GuacamoleDB.delete_existing_user-1064"><a href="#GuacamoleDB.delete_existing_user-1064"><span class="linenos">1064</span></a><span class="sd">                WHERE member_entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_user-1065"><a href="#GuacamoleDB.delete_existing_user-1065"><span class="linenos">1065</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.delete_existing_user-1066"><a href="#GuacamoleDB.delete_existing_user-1066"><span class="linenos">1066</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.delete_existing_user-1067"><a href="#GuacamoleDB.delete_existing_user-1067"><span class="linenos">1067</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_user-1068"><a href="#GuacamoleDB.delete_existing_user-1068"><span class="linenos">1068</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_user-1069"><a href="#GuacamoleDB.delete_existing_user-1069"><span class="linenos">1069</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_user-1070"><a href="#GuacamoleDB.delete_existing_user-1070"><span class="linenos">1070</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1071"><a href="#GuacamoleDB.delete_existing_user-1071"><span class="linenos">1071</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1072"><a href="#GuacamoleDB.delete_existing_user-1072"><span class="linenos">1072</span></a>            <span class="c1"># Delete user permissions</span>
</span><span id="GuacamoleDB.delete_existing_user-1073"><a href="#GuacamoleDB.delete_existing_user-1073"><span class="linenos">1073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_user-1074"><a href="#GuacamoleDB.delete_existing_user-1074"><span class="linenos">1074</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_user-1075"><a href="#GuacamoleDB.delete_existing_user-1075"><span class="linenos">1075</span></a><span class="sd">                DELETE FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB.delete_existing_user-1076"><a href="#GuacamoleDB.delete_existing_user-1076"><span class="linenos">1076</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_user-1077"><a href="#GuacamoleDB.delete_existing_user-1077"><span class="linenos">1077</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.delete_existing_user-1078"><a href="#GuacamoleDB.delete_existing_user-1078"><span class="linenos">1078</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.delete_existing_user-1079"><a href="#GuacamoleDB.delete_existing_user-1079"><span class="linenos">1079</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_user-1080"><a href="#GuacamoleDB.delete_existing_user-1080"><span class="linenos">1080</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_user-1081"><a href="#GuacamoleDB.delete_existing_user-1081"><span class="linenos">1081</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_user-1082"><a href="#GuacamoleDB.delete_existing_user-1082"><span class="linenos">1082</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1083"><a href="#GuacamoleDB.delete_existing_user-1083"><span class="linenos">1083</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1084"><a href="#GuacamoleDB.delete_existing_user-1084"><span class="linenos">1084</span></a>            <span class="c1"># Delete user</span>
</span><span id="GuacamoleDB.delete_existing_user-1085"><a href="#GuacamoleDB.delete_existing_user-1085"><span class="linenos">1085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_user-1086"><a href="#GuacamoleDB.delete_existing_user-1086"><span class="linenos">1086</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_user-1087"><a href="#GuacamoleDB.delete_existing_user-1087"><span class="linenos">1087</span></a><span class="sd">                DELETE FROM guacamole_user</span>
</span><span id="GuacamoleDB.delete_existing_user-1088"><a href="#GuacamoleDB.delete_existing_user-1088"><span class="linenos">1088</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_user-1089"><a href="#GuacamoleDB.delete_existing_user-1089"><span class="linenos">1089</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.delete_existing_user-1090"><a href="#GuacamoleDB.delete_existing_user-1090"><span class="linenos">1090</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.delete_existing_user-1091"><a href="#GuacamoleDB.delete_existing_user-1091"><span class="linenos">1091</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_user-1092"><a href="#GuacamoleDB.delete_existing_user-1092"><span class="linenos">1092</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_user-1093"><a href="#GuacamoleDB.delete_existing_user-1093"><span class="linenos">1093</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_user-1094"><a href="#GuacamoleDB.delete_existing_user-1094"><span class="linenos">1094</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1095"><a href="#GuacamoleDB.delete_existing_user-1095"><span class="linenos">1095</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1096"><a href="#GuacamoleDB.delete_existing_user-1096"><span class="linenos">1096</span></a>            <span class="c1"># Delete entity</span>
</span><span id="GuacamoleDB.delete_existing_user-1097"><a href="#GuacamoleDB.delete_existing_user-1097"><span class="linenos">1097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_user-1098"><a href="#GuacamoleDB.delete_existing_user-1098"><span class="linenos">1098</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_user-1099"><a href="#GuacamoleDB.delete_existing_user-1099"><span class="linenos">1099</span></a><span class="sd">                DELETE FROM guacamole_entity</span>
</span><span id="GuacamoleDB.delete_existing_user-1100"><a href="#GuacamoleDB.delete_existing_user-1100"><span class="linenos">1100</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.delete_existing_user-1101"><a href="#GuacamoleDB.delete_existing_user-1101"><span class="linenos">1101</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_user-1102"><a href="#GuacamoleDB.delete_existing_user-1102"><span class="linenos">1102</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_user-1103"><a href="#GuacamoleDB.delete_existing_user-1103"><span class="linenos">1103</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1104"><a href="#GuacamoleDB.delete_existing_user-1104"><span class="linenos">1104</span></a>
</span><span id="GuacamoleDB.delete_existing_user-1105"><a href="#GuacamoleDB.delete_existing_user-1105"><span class="linenos">1105</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_user-1106"><a href="#GuacamoleDB.delete_existing_user-1106"><span class="linenos">1106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_user-1107"><a href="#GuacamoleDB.delete_existing_user-1107"><span class="linenos">1107</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Delete a user and all associated data from the Guacamole database.</p>

<p>Removes a user completely from the system, including their entity record,
user account, group memberships, and all permissions. This operation
cascades through all related tables to maintain database integrity.</p>

<p>Args:
    username: The username to delete.</p>

<p>Raises:
    ValueError: If the user doesn't exist.
    mysql.connector.Error: If database operations fail.</p>

<p>Note:
    This is a destructive operation that cannot be undone. The user and
    all their associated permissions and memberships are permanently
    removed. Deletions are performed in the correct order to respect
    foreign key constraints.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     db.delete_existing_user('olduser')</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.delete_existing_usergroup" class="classattr">
                                        <input id="GuacamoleDB.delete_existing_usergroup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_existing_usergroup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.delete_existing_usergroup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.delete_existing_usergroup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.delete_existing_usergroup-1109"><a href="#GuacamoleDB.delete_existing_usergroup-1109"><span class="linenos">1109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1110"><a href="#GuacamoleDB.delete_existing_usergroup-1110"><span class="linenos">1110</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1111"><a href="#GuacamoleDB.delete_existing_usergroup-1111"><span class="linenos">1111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting usergroup: </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1112"><a href="#GuacamoleDB.delete_existing_usergroup-1112"><span class="linenos">1112</span></a>            <span class="c1"># Delete group memberships</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1113"><a href="#GuacamoleDB.delete_existing_usergroup-1113"><span class="linenos">1113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1114"><a href="#GuacamoleDB.delete_existing_usergroup-1114"><span class="linenos">1114</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1115"><a href="#GuacamoleDB.delete_existing_usergroup-1115"><span class="linenos">1115</span></a><span class="sd">                DELETE FROM guacamole_user_group_member </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1116"><a href="#GuacamoleDB.delete_existing_usergroup-1116"><span class="linenos">1116</span></a><span class="sd">                WHERE user_group_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1117"><a href="#GuacamoleDB.delete_existing_usergroup-1117"><span class="linenos">1117</span></a><span class="sd">                    SELECT user_group_id FROM guacamole_user_group </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1118"><a href="#GuacamoleDB.delete_existing_usergroup-1118"><span class="linenos">1118</span></a><span class="sd">                    WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1119"><a href="#GuacamoleDB.delete_existing_usergroup-1119"><span class="linenos">1119</span></a><span class="sd">                        SELECT entity_id FROM guacamole_entity </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1120"><a href="#GuacamoleDB.delete_existing_usergroup-1120"><span class="linenos">1120</span></a><span class="sd">                        WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1121"><a href="#GuacamoleDB.delete_existing_usergroup-1121"><span class="linenos">1121</span></a><span class="sd">                    )</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1122"><a href="#GuacamoleDB.delete_existing_usergroup-1122"><span class="linenos">1122</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1123"><a href="#GuacamoleDB.delete_existing_usergroup-1123"><span class="linenos">1123</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1124"><a href="#GuacamoleDB.delete_existing_usergroup-1124"><span class="linenos">1124</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1125"><a href="#GuacamoleDB.delete_existing_usergroup-1125"><span class="linenos">1125</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1126"><a href="#GuacamoleDB.delete_existing_usergroup-1126"><span class="linenos">1126</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup-1127"><a href="#GuacamoleDB.delete_existing_usergroup-1127"><span class="linenos">1127</span></a>            <span class="c1"># Delete group permissions</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1128"><a href="#GuacamoleDB.delete_existing_usergroup-1128"><span class="linenos">1128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1129"><a href="#GuacamoleDB.delete_existing_usergroup-1129"><span class="linenos">1129</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1130"><a href="#GuacamoleDB.delete_existing_usergroup-1130"><span class="linenos">1130</span></a><span class="sd">                DELETE FROM guacamole_connection_permission </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1131"><a href="#GuacamoleDB.delete_existing_usergroup-1131"><span class="linenos">1131</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1132"><a href="#GuacamoleDB.delete_existing_usergroup-1132"><span class="linenos">1132</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1133"><a href="#GuacamoleDB.delete_existing_usergroup-1133"><span class="linenos">1133</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1134"><a href="#GuacamoleDB.delete_existing_usergroup-1134"><span class="linenos">1134</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1135"><a href="#GuacamoleDB.delete_existing_usergroup-1135"><span class="linenos">1135</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1136"><a href="#GuacamoleDB.delete_existing_usergroup-1136"><span class="linenos">1136</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1137"><a href="#GuacamoleDB.delete_existing_usergroup-1137"><span class="linenos">1137</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1138"><a href="#GuacamoleDB.delete_existing_usergroup-1138"><span class="linenos">1138</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup-1139"><a href="#GuacamoleDB.delete_existing_usergroup-1139"><span class="linenos">1139</span></a>            <span class="c1"># Delete user group</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1140"><a href="#GuacamoleDB.delete_existing_usergroup-1140"><span class="linenos">1140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1141"><a href="#GuacamoleDB.delete_existing_usergroup-1141"><span class="linenos">1141</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1142"><a href="#GuacamoleDB.delete_existing_usergroup-1142"><span class="linenos">1142</span></a><span class="sd">                DELETE FROM guacamole_user_group </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1143"><a href="#GuacamoleDB.delete_existing_usergroup-1143"><span class="linenos">1143</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1144"><a href="#GuacamoleDB.delete_existing_usergroup-1144"><span class="linenos">1144</span></a><span class="sd">                    SELECT entity_id FROM guacamole_entity </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1145"><a href="#GuacamoleDB.delete_existing_usergroup-1145"><span class="linenos">1145</span></a><span class="sd">                    WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1146"><a href="#GuacamoleDB.delete_existing_usergroup-1146"><span class="linenos">1146</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1147"><a href="#GuacamoleDB.delete_existing_usergroup-1147"><span class="linenos">1147</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1148"><a href="#GuacamoleDB.delete_existing_usergroup-1148"><span class="linenos">1148</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1149"><a href="#GuacamoleDB.delete_existing_usergroup-1149"><span class="linenos">1149</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1150"><a href="#GuacamoleDB.delete_existing_usergroup-1150"><span class="linenos">1150</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup-1151"><a href="#GuacamoleDB.delete_existing_usergroup-1151"><span class="linenos">1151</span></a>            <span class="c1"># Delete entity</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1152"><a href="#GuacamoleDB.delete_existing_usergroup-1152"><span class="linenos">1152</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1153"><a href="#GuacamoleDB.delete_existing_usergroup-1153"><span class="linenos">1153</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1154"><a href="#GuacamoleDB.delete_existing_usergroup-1154"><span class="linenos">1154</span></a><span class="sd">                DELETE FROM guacamole_entity </span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1155"><a href="#GuacamoleDB.delete_existing_usergroup-1155"><span class="linenos">1155</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1156"><a href="#GuacamoleDB.delete_existing_usergroup-1156"><span class="linenos">1156</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1157"><a href="#GuacamoleDB.delete_existing_usergroup-1157"><span class="linenos">1157</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1158"><a href="#GuacamoleDB.delete_existing_usergroup-1158"><span class="linenos">1158</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1159"><a href="#GuacamoleDB.delete_existing_usergroup-1159"><span class="linenos">1159</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup-1160"><a href="#GuacamoleDB.delete_existing_usergroup-1160"><span class="linenos">1160</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1161"><a href="#GuacamoleDB.delete_existing_usergroup-1161"><span class="linenos">1161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup-1162"><a href="#GuacamoleDB.delete_existing_usergroup-1162"><span class="linenos">1162</span></a>            <span class="k">raise</span>
</span></pre></div>


    

                            </div>
                            <div id="GuacamoleDB.delete_existing_usergroup_by_id" class="classattr">
                                        <input id="GuacamoleDB.delete_existing_usergroup_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_existing_usergroup_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.delete_existing_usergroup_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.delete_existing_usergroup_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1164"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1164"><span class="linenos">1164</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_usergroup_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1165"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1165"><span class="linenos">1165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a usergroup by ID and all its associated data&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1166"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1166"><span class="linenos">1166</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1167"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1167"><span class="linenos">1167</span></a>            <span class="c1"># Validate and resolve the group ID</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1168"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1168"><span class="linenos">1168</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_usergroup_id</span><span class="p">(</span><span class="n">group_id</span><span class="o">=</span><span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1169"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1169"><span class="linenos">1169</span></a>            <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_usergroup_name_by_id</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1170"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1170"><span class="linenos">1170</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1171"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1171"><span class="linenos">1171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1172"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1172"><span class="linenos">1172</span></a>                <span class="sa">f</span><span class="s2">&quot;Attempting to delete usergroup: </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">resolved_group_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1173"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1173"><span class="linenos">1173</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1174"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1174"><span class="linenos">1174</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1175"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1175"><span class="linenos">1175</span></a>            <span class="c1"># Delete group memberships</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1176"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1176"><span class="linenos">1176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1177"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1177"><span class="linenos">1177</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1178"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1178"><span class="linenos">1178</span></a><span class="sd">                DELETE FROM guacamole_user_group_member </span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1179"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1179"><span class="linenos">1179</span></a><span class="sd">                WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1180"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1180"><span class="linenos">1180</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1181"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1181"><span class="linenos">1181</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1182"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1182"><span class="linenos">1182</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1183"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1183"><span class="linenos">1183</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1184"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1184"><span class="linenos">1184</span></a>            <span class="c1"># Delete group permissions</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1185"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1185"><span class="linenos">1185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1186"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1186"><span class="linenos">1186</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1187"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1187"><span class="linenos">1187</span></a><span class="sd">                DELETE FROM guacamole_connection_permission </span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1188"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1188"><span class="linenos">1188</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1189"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1189"><span class="linenos">1189</span></a><span class="sd">                    SELECT entity_id FROM guacamole_user_group </span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1190"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1190"><span class="linenos">1190</span></a><span class="sd">                    WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1191"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1191"><span class="linenos">1191</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1192"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1192"><span class="linenos">1192</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1193"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1193"><span class="linenos">1193</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1194"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1194"><span class="linenos">1194</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1195"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1195"><span class="linenos">1195</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1196"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1196"><span class="linenos">1196</span></a>            <span class="c1"># Delete user group</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1197"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1197"><span class="linenos">1197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1198"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1198"><span class="linenos">1198</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1199"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1199"><span class="linenos">1199</span></a><span class="sd">                DELETE FROM guacamole_user_group </span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1200"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1200"><span class="linenos">1200</span></a><span class="sd">                WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1201"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1201"><span class="linenos">1201</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1202"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1202"><span class="linenos">1202</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1203"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1203"><span class="linenos">1203</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1204"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1204"><span class="linenos">1204</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1205"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1205"><span class="linenos">1205</span></a>            <span class="c1"># Delete entity</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1206"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1206"><span class="linenos">1206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1207"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1207"><span class="linenos">1207</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1208"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1208"><span class="linenos">1208</span></a><span class="sd">                DELETE FROM guacamole_entity </span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1209"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1209"><span class="linenos">1209</span></a><span class="sd">                WHERE entity_id IN (</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1210"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1210"><span class="linenos">1210</span></a><span class="sd">                    SELECT entity_id FROM guacamole_user_group </span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1211"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1211"><span class="linenos">1211</span></a><span class="sd">                    WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1212"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1212"><span class="linenos">1212</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1213"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1213"><span class="linenos">1213</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1214"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1214"><span class="linenos">1214</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1215"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1215"><span class="linenos">1215</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1216"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1216"><span class="linenos">1216</span></a>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1217"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1217"><span class="linenos">1217</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1218"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1218"><span class="linenos">1218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1219"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1219"><span class="linenos">1219</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1220"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1220"><span class="linenos">1220</span></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1221"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1221"><span class="linenos">1221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1222"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1222"><span class="linenos">1222</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_usergroup_by_id-1223"><a href="#GuacamoleDB.delete_existing_usergroup_by_id-1223"><span class="linenos">1223</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Delete a usergroup by ID and all its associated data</p>
</div>


                            </div>
                            <div id="GuacamoleDB.delete_existing_connection" class="classattr">
                                        <input id="GuacamoleDB.delete_existing_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_existing_connection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.delete_existing_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.delete_existing_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.delete_existing_connection-1225"><a href="#GuacamoleDB.delete_existing_connection-1225"><span class="linenos">1225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_existing_connection</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_connection-1226"><a href="#GuacamoleDB.delete_existing_connection-1226"><span class="linenos">1226</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.delete_existing_connection-1227"><a href="#GuacamoleDB.delete_existing_connection-1227"><span class="linenos">1227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_connection-1228"><a href="#GuacamoleDB.delete_existing_connection-1228"><span class="linenos">1228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a connection and all its associated data&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_connection-1229"><a href="#GuacamoleDB.delete_existing_connection-1229"><span class="linenos">1229</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_connection-1230"><a href="#GuacamoleDB.delete_existing_connection-1230"><span class="linenos">1230</span></a>            <span class="c1"># Use resolver to get connection_id and validate inputs</span>
</span><span id="GuacamoleDB.delete_existing_connection-1231"><a href="#GuacamoleDB.delete_existing_connection-1231"><span class="linenos">1231</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_connection-1232"><a href="#GuacamoleDB.delete_existing_connection-1232"><span class="linenos">1232</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB.delete_existing_connection-1233"><a href="#GuacamoleDB.delete_existing_connection-1233"><span class="linenos">1233</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1234"><a href="#GuacamoleDB.delete_existing_connection-1234"><span class="linenos">1234</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1235"><a href="#GuacamoleDB.delete_existing_connection-1235"><span class="linenos">1235</span></a>            <span class="c1"># Get connection name for logging if we only have ID</span>
</span><span id="GuacamoleDB.delete_existing_connection-1236"><a href="#GuacamoleDB.delete_existing_connection-1236"><span class="linenos">1236</span></a>            <span class="k">if</span> <span class="n">connection_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_connection-1237"><a href="#GuacamoleDB.delete_existing_connection-1237"><span class="linenos">1237</span></a>                <span class="n">connection_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_name_by_id</span><span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1238"><a href="#GuacamoleDB.delete_existing_connection-1238"><span class="linenos">1238</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1239"><a href="#GuacamoleDB.delete_existing_connection-1239"><span class="linenos">1239</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_connection-1240"><a href="#GuacamoleDB.delete_existing_connection-1240"><span class="linenos">1240</span></a>                <span class="sa">f</span><span class="s2">&quot;Attempting to delete connection: </span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">resolved_connection_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GuacamoleDB.delete_existing_connection-1241"><a href="#GuacamoleDB.delete_existing_connection-1241"><span class="linenos">1241</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1242"><a href="#GuacamoleDB.delete_existing_connection-1242"><span class="linenos">1242</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1243"><a href="#GuacamoleDB.delete_existing_connection-1243"><span class="linenos">1243</span></a>            <span class="c1"># Delete connection history</span>
</span><span id="GuacamoleDB.delete_existing_connection-1244"><a href="#GuacamoleDB.delete_existing_connection-1244"><span class="linenos">1244</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection history...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1245"><a href="#GuacamoleDB.delete_existing_connection-1245"><span class="linenos">1245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_connection-1246"><a href="#GuacamoleDB.delete_existing_connection-1246"><span class="linenos">1246</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_connection-1247"><a href="#GuacamoleDB.delete_existing_connection-1247"><span class="linenos">1247</span></a><span class="sd">                DELETE FROM guacamole_connection_history</span>
</span><span id="GuacamoleDB.delete_existing_connection-1248"><a href="#GuacamoleDB.delete_existing_connection-1248"><span class="linenos">1248</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_connection-1249"><a href="#GuacamoleDB.delete_existing_connection-1249"><span class="linenos">1249</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_connection-1250"><a href="#GuacamoleDB.delete_existing_connection-1250"><span class="linenos">1250</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_connection-1251"><a href="#GuacamoleDB.delete_existing_connection-1251"><span class="linenos">1251</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1252"><a href="#GuacamoleDB.delete_existing_connection-1252"><span class="linenos">1252</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1253"><a href="#GuacamoleDB.delete_existing_connection-1253"><span class="linenos">1253</span></a>            <span class="c1"># Delete connection parameters</span>
</span><span id="GuacamoleDB.delete_existing_connection-1254"><a href="#GuacamoleDB.delete_existing_connection-1254"><span class="linenos">1254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection parameters...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1255"><a href="#GuacamoleDB.delete_existing_connection-1255"><span class="linenos">1255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_connection-1256"><a href="#GuacamoleDB.delete_existing_connection-1256"><span class="linenos">1256</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_connection-1257"><a href="#GuacamoleDB.delete_existing_connection-1257"><span class="linenos">1257</span></a><span class="sd">                DELETE FROM guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.delete_existing_connection-1258"><a href="#GuacamoleDB.delete_existing_connection-1258"><span class="linenos">1258</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_connection-1259"><a href="#GuacamoleDB.delete_existing_connection-1259"><span class="linenos">1259</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_connection-1260"><a href="#GuacamoleDB.delete_existing_connection-1260"><span class="linenos">1260</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_connection-1261"><a href="#GuacamoleDB.delete_existing_connection-1261"><span class="linenos">1261</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1262"><a href="#GuacamoleDB.delete_existing_connection-1262"><span class="linenos">1262</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1263"><a href="#GuacamoleDB.delete_existing_connection-1263"><span class="linenos">1263</span></a>            <span class="c1"># Delete connection permissions</span>
</span><span id="GuacamoleDB.delete_existing_connection-1264"><a href="#GuacamoleDB.delete_existing_connection-1264"><span class="linenos">1264</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection permissions...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1265"><a href="#GuacamoleDB.delete_existing_connection-1265"><span class="linenos">1265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_connection-1266"><a href="#GuacamoleDB.delete_existing_connection-1266"><span class="linenos">1266</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_connection-1267"><a href="#GuacamoleDB.delete_existing_connection-1267"><span class="linenos">1267</span></a><span class="sd">                DELETE FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB.delete_existing_connection-1268"><a href="#GuacamoleDB.delete_existing_connection-1268"><span class="linenos">1268</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_connection-1269"><a href="#GuacamoleDB.delete_existing_connection-1269"><span class="linenos">1269</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_connection-1270"><a href="#GuacamoleDB.delete_existing_connection-1270"><span class="linenos">1270</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_connection-1271"><a href="#GuacamoleDB.delete_existing_connection-1271"><span class="linenos">1271</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1272"><a href="#GuacamoleDB.delete_existing_connection-1272"><span class="linenos">1272</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1273"><a href="#GuacamoleDB.delete_existing_connection-1273"><span class="linenos">1273</span></a>            <span class="c1"># Finally delete the connection</span>
</span><span id="GuacamoleDB.delete_existing_connection-1274"><a href="#GuacamoleDB.delete_existing_connection-1274"><span class="linenos">1274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1275"><a href="#GuacamoleDB.delete_existing_connection-1275"><span class="linenos">1275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_existing_connection-1276"><a href="#GuacamoleDB.delete_existing_connection-1276"><span class="linenos">1276</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_existing_connection-1277"><a href="#GuacamoleDB.delete_existing_connection-1277"><span class="linenos">1277</span></a><span class="sd">                DELETE FROM guacamole_connection</span>
</span><span id="GuacamoleDB.delete_existing_connection-1278"><a href="#GuacamoleDB.delete_existing_connection-1278"><span class="linenos">1278</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.delete_existing_connection-1279"><a href="#GuacamoleDB.delete_existing_connection-1279"><span class="linenos">1279</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_existing_connection-1280"><a href="#GuacamoleDB.delete_existing_connection-1280"><span class="linenos">1280</span></a>                <span class="p">(</span><span class="n">resolved_connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_existing_connection-1281"><a href="#GuacamoleDB.delete_existing_connection-1281"><span class="linenos">1281</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1282"><a href="#GuacamoleDB.delete_existing_connection-1282"><span class="linenos">1282</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1283"><a href="#GuacamoleDB.delete_existing_connection-1283"><span class="linenos">1283</span></a>            <span class="c1"># Commit the transaction</span>
</span><span id="GuacamoleDB.delete_existing_connection-1284"><a href="#GuacamoleDB.delete_existing_connection-1284"><span class="linenos">1284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Committing transaction...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1285"><a href="#GuacamoleDB.delete_existing_connection-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="GuacamoleDB.delete_existing_connection-1286"><a href="#GuacamoleDB.delete_existing_connection-1286"><span class="linenos">1286</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1287"><a href="#GuacamoleDB.delete_existing_connection-1287"><span class="linenos">1287</span></a>
</span><span id="GuacamoleDB.delete_existing_connection-1288"><a href="#GuacamoleDB.delete_existing_connection-1288"><span class="linenos">1288</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_existing_connection-1289"><a href="#GuacamoleDB.delete_existing_connection-1289"><span class="linenos">1289</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing connection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_existing_connection-1290"><a href="#GuacamoleDB.delete_existing_connection-1290"><span class="linenos">1290</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Delete a connection and all its associated data</p>
</div>


                            </div>
                            <div id="GuacamoleDB.delete_connection_group" class="classattr">
                                        <input id="GuacamoleDB.delete_connection_group-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">delete_connection_group</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.delete_connection_group-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.delete_connection_group"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.delete_connection_group-1292"><a href="#GuacamoleDB.delete_connection_group-1292"><span class="linenos">1292</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_connection_group</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_connection_group-1293"><a href="#GuacamoleDB.delete_connection_group-1293"><span class="linenos">1293</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.delete_connection_group-1294"><a href="#GuacamoleDB.delete_connection_group-1294"><span class="linenos">1294</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_connection_group-1295"><a href="#GuacamoleDB.delete_connection_group-1295"><span class="linenos">1295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a connection group and update references to it&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_connection_group-1296"><a href="#GuacamoleDB.delete_connection_group-1296"><span class="linenos">1296</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_connection_group-1297"><a href="#GuacamoleDB.delete_connection_group-1297"><span class="linenos">1297</span></a>            <span class="c1"># Use resolver to get group_id and validate inputs</span>
</span><span id="GuacamoleDB.delete_connection_group-1298"><a href="#GuacamoleDB.delete_connection_group-1298"><span class="linenos">1298</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_conngroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1299"><a href="#GuacamoleDB.delete_connection_group-1299"><span class="linenos">1299</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1300"><a href="#GuacamoleDB.delete_connection_group-1300"><span class="linenos">1300</span></a>            <span class="c1"># Get group name for logging if we only have ID</span>
</span><span id="GuacamoleDB.delete_connection_group-1301"><a href="#GuacamoleDB.delete_connection_group-1301"><span class="linenos">1301</span></a>            <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_connection_group-1302"><a href="#GuacamoleDB.delete_connection_group-1302"><span class="linenos">1302</span></a>                <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_name_by_id</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1303"><a href="#GuacamoleDB.delete_connection_group-1303"><span class="linenos">1303</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1304"><a href="#GuacamoleDB.delete_connection_group-1304"><span class="linenos">1304</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_connection_group-1305"><a href="#GuacamoleDB.delete_connection_group-1305"><span class="linenos">1305</span></a>                <span class="sa">f</span><span class="s2">&quot;Attempting to delete connection group: </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2"> (ID: </span><span class="si">{</span><span class="n">resolved_group_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GuacamoleDB.delete_connection_group-1306"><a href="#GuacamoleDB.delete_connection_group-1306"><span class="linenos">1306</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1307"><a href="#GuacamoleDB.delete_connection_group-1307"><span class="linenos">1307</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1308"><a href="#GuacamoleDB.delete_connection_group-1308"><span class="linenos">1308</span></a>            <span class="c1"># Update any child groups to have NULL parent</span>
</span><span id="GuacamoleDB.delete_connection_group-1309"><a href="#GuacamoleDB.delete_connection_group-1309"><span class="linenos">1309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Updating child groups to have NULL parent...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1310"><a href="#GuacamoleDB.delete_connection_group-1310"><span class="linenos">1310</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_connection_group-1311"><a href="#GuacamoleDB.delete_connection_group-1311"><span class="linenos">1311</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_connection_group-1312"><a href="#GuacamoleDB.delete_connection_group-1312"><span class="linenos">1312</span></a><span class="sd">                UPDATE guacamole_connection_group</span>
</span><span id="GuacamoleDB.delete_connection_group-1313"><a href="#GuacamoleDB.delete_connection_group-1313"><span class="linenos">1313</span></a><span class="sd">                SET parent_id = NULL</span>
</span><span id="GuacamoleDB.delete_connection_group-1314"><a href="#GuacamoleDB.delete_connection_group-1314"><span class="linenos">1314</span></a><span class="sd">                WHERE parent_id = %s</span>
</span><span id="GuacamoleDB.delete_connection_group-1315"><a href="#GuacamoleDB.delete_connection_group-1315"><span class="linenos">1315</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_connection_group-1316"><a href="#GuacamoleDB.delete_connection_group-1316"><span class="linenos">1316</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_connection_group-1317"><a href="#GuacamoleDB.delete_connection_group-1317"><span class="linenos">1317</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1318"><a href="#GuacamoleDB.delete_connection_group-1318"><span class="linenos">1318</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1319"><a href="#GuacamoleDB.delete_connection_group-1319"><span class="linenos">1319</span></a>            <span class="c1"># Update any connections to have NULL parent</span>
</span><span id="GuacamoleDB.delete_connection_group-1320"><a href="#GuacamoleDB.delete_connection_group-1320"><span class="linenos">1320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Updating connections to have NULL parent...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1321"><a href="#GuacamoleDB.delete_connection_group-1321"><span class="linenos">1321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_connection_group-1322"><a href="#GuacamoleDB.delete_connection_group-1322"><span class="linenos">1322</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_connection_group-1323"><a href="#GuacamoleDB.delete_connection_group-1323"><span class="linenos">1323</span></a><span class="sd">                UPDATE guacamole_connection</span>
</span><span id="GuacamoleDB.delete_connection_group-1324"><a href="#GuacamoleDB.delete_connection_group-1324"><span class="linenos">1324</span></a><span class="sd">                SET parent_id = NULL</span>
</span><span id="GuacamoleDB.delete_connection_group-1325"><a href="#GuacamoleDB.delete_connection_group-1325"><span class="linenos">1325</span></a><span class="sd">                WHERE parent_id = %s</span>
</span><span id="GuacamoleDB.delete_connection_group-1326"><a href="#GuacamoleDB.delete_connection_group-1326"><span class="linenos">1326</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_connection_group-1327"><a href="#GuacamoleDB.delete_connection_group-1327"><span class="linenos">1327</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_connection_group-1328"><a href="#GuacamoleDB.delete_connection_group-1328"><span class="linenos">1328</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1329"><a href="#GuacamoleDB.delete_connection_group-1329"><span class="linenos">1329</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1330"><a href="#GuacamoleDB.delete_connection_group-1330"><span class="linenos">1330</span></a>            <span class="c1"># Delete the group</span>
</span><span id="GuacamoleDB.delete_connection_group-1331"><a href="#GuacamoleDB.delete_connection_group-1331"><span class="linenos">1331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Deleting connection group...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1332"><a href="#GuacamoleDB.delete_connection_group-1332"><span class="linenos">1332</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.delete_connection_group-1333"><a href="#GuacamoleDB.delete_connection_group-1333"><span class="linenos">1333</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.delete_connection_group-1334"><a href="#GuacamoleDB.delete_connection_group-1334"><span class="linenos">1334</span></a><span class="sd">                DELETE FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.delete_connection_group-1335"><a href="#GuacamoleDB.delete_connection_group-1335"><span class="linenos">1335</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB.delete_connection_group-1336"><a href="#GuacamoleDB.delete_connection_group-1336"><span class="linenos">1336</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.delete_connection_group-1337"><a href="#GuacamoleDB.delete_connection_group-1337"><span class="linenos">1337</span></a>                <span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.delete_connection_group-1338"><a href="#GuacamoleDB.delete_connection_group-1338"><span class="linenos">1338</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1339"><a href="#GuacamoleDB.delete_connection_group-1339"><span class="linenos">1339</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1340"><a href="#GuacamoleDB.delete_connection_group-1340"><span class="linenos">1340</span></a>            <span class="c1"># Commit the transaction</span>
</span><span id="GuacamoleDB.delete_connection_group-1341"><a href="#GuacamoleDB.delete_connection_group-1341"><span class="linenos">1341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s2">&quot;Committing transaction...&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1342"><a href="#GuacamoleDB.delete_connection_group-1342"><span class="linenos">1342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="GuacamoleDB.delete_connection_group-1343"><a href="#GuacamoleDB.delete_connection_group-1343"><span class="linenos">1343</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted connection group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1344"><a href="#GuacamoleDB.delete_connection_group-1344"><span class="linenos">1344</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.delete_connection_group-1345"><a href="#GuacamoleDB.delete_connection_group-1345"><span class="linenos">1345</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1346"><a href="#GuacamoleDB.delete_connection_group-1346"><span class="linenos">1346</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_connection_group-1347"><a href="#GuacamoleDB.delete_connection_group-1347"><span class="linenos">1347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting connection group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1348"><a href="#GuacamoleDB.delete_connection_group-1348"><span class="linenos">1348</span></a>            <span class="k">raise</span>
</span><span id="GuacamoleDB.delete_connection_group-1349"><a href="#GuacamoleDB.delete_connection_group-1349"><span class="linenos">1349</span></a>
</span><span id="GuacamoleDB.delete_connection_group-1350"><a href="#GuacamoleDB.delete_connection_group-1350"><span class="linenos">1350</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.delete_connection_group-1351"><a href="#GuacamoleDB.delete_connection_group-1351"><span class="linenos">1351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting existing connection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.delete_connection_group-1352"><a href="#GuacamoleDB.delete_connection_group-1352"><span class="linenos">1352</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Delete a connection group and update references to it</p>
</div>


                            </div>
                            <div id="GuacamoleDB.create_user" class="classattr">
                                        <input id="GuacamoleDB.create_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">password</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.create_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.create_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.create_user-1354"><a href="#GuacamoleDB.create_user-1354"><span class="linenos">1354</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_user-1355"><a href="#GuacamoleDB.create_user-1355"><span class="linenos">1355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new user in the Guacamole database.</span>
</span><span id="GuacamoleDB.create_user-1356"><a href="#GuacamoleDB.create_user-1356"><span class="linenos">1356</span></a>
</span><span id="GuacamoleDB.create_user-1357"><a href="#GuacamoleDB.create_user-1357"><span class="linenos">1357</span></a><span class="sd">        Creates a new user with secure password hashing using Guacamole&#39;s</span>
</span><span id="GuacamoleDB.create_user-1358"><a href="#GuacamoleDB.create_user-1358"><span class="linenos">1358</span></a><span class="sd">        authentication method. Generates a random salt and hashes the password</span>
</span><span id="GuacamoleDB.create_user-1359"><a href="#GuacamoleDB.create_user-1359"><span class="linenos">1359</span></a><span class="sd">        using SHA256.</span>
</span><span id="GuacamoleDB.create_user-1360"><a href="#GuacamoleDB.create_user-1360"><span class="linenos">1360</span></a>
</span><span id="GuacamoleDB.create_user-1361"><a href="#GuacamoleDB.create_user-1361"><span class="linenos">1361</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.create_user-1362"><a href="#GuacamoleDB.create_user-1362"><span class="linenos">1362</span></a><span class="sd">            username: The username for the new user.</span>
</span><span id="GuacamoleDB.create_user-1363"><a href="#GuacamoleDB.create_user-1363"><span class="linenos">1363</span></a><span class="sd">            password: The password for the new user.</span>
</span><span id="GuacamoleDB.create_user-1364"><a href="#GuacamoleDB.create_user-1364"><span class="linenos">1364</span></a>
</span><span id="GuacamoleDB.create_user-1365"><a href="#GuacamoleDB.create_user-1365"><span class="linenos">1365</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.create_user-1366"><a href="#GuacamoleDB.create_user-1366"><span class="linenos">1366</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB.create_user-1367"><a href="#GuacamoleDB.create_user-1367"><span class="linenos">1367</span></a>
</span><span id="GuacamoleDB.create_user-1368"><a href="#GuacamoleDB.create_user-1368"><span class="linenos">1368</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.create_user-1369"><a href="#GuacamoleDB.create_user-1369"><span class="linenos">1369</span></a><span class="sd">            Uses Guacamole&#39;s password hashing method: SHA256(password + hex(salt)).</span>
</span><span id="GuacamoleDB.create_user-1370"><a href="#GuacamoleDB.create_user-1370"><span class="linenos">1370</span></a><span class="sd">            The salt is a random 32-byte value for security. This method creates</span>
</span><span id="GuacamoleDB.create_user-1371"><a href="#GuacamoleDB.create_user-1371"><span class="linenos">1371</span></a><span class="sd">            both the entity record and the user record with password credentials.</span>
</span><span id="GuacamoleDB.create_user-1372"><a href="#GuacamoleDB.create_user-1372"><span class="linenos">1372</span></a>
</span><span id="GuacamoleDB.create_user-1373"><a href="#GuacamoleDB.create_user-1373"><span class="linenos">1373</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.create_user-1374"><a href="#GuacamoleDB.create_user-1374"><span class="linenos">1374</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.create_user-1375"><a href="#GuacamoleDB.create_user-1375"><span class="linenos">1375</span></a><span class="sd">            ...     db.create_user(&#39;newuser&#39;, &#39;securepassword&#39;)</span>
</span><span id="GuacamoleDB.create_user-1376"><a href="#GuacamoleDB.create_user-1376"><span class="linenos">1376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_user-1377"><a href="#GuacamoleDB.create_user-1377"><span class="linenos">1377</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_user-1378"><a href="#GuacamoleDB.create_user-1378"><span class="linenos">1378</span></a>            <span class="c1"># Generate random 32-byte salt</span>
</span><span id="GuacamoleDB.create_user-1379"><a href="#GuacamoleDB.create_user-1379"><span class="linenos">1379</span></a>            <span class="n">salt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_user-1380"><a href="#GuacamoleDB.create_user-1380"><span class="linenos">1380</span></a>
</span><span id="GuacamoleDB.create_user-1381"><a href="#GuacamoleDB.create_user-1381"><span class="linenos">1381</span></a>            <span class="c1"># Convert salt to uppercase hex string as Guacamole expects</span>
</span><span id="GuacamoleDB.create_user-1382"><a href="#GuacamoleDB.create_user-1382"><span class="linenos">1382</span></a>            <span class="n">salt_hex</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">salt</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="GuacamoleDB.create_user-1383"><a href="#GuacamoleDB.create_user-1383"><span class="linenos">1383</span></a>
</span><span id="GuacamoleDB.create_user-1384"><a href="#GuacamoleDB.create_user-1384"><span class="linenos">1384</span></a>            <span class="c1"># Create password hash using Guacamole&#39;s method: SHA256(password + hex(salt))</span>
</span><span id="GuacamoleDB.create_user-1385"><a href="#GuacamoleDB.create_user-1385"><span class="linenos">1385</span></a>            <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">salt_hex</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span><span id="GuacamoleDB.create_user-1386"><a href="#GuacamoleDB.create_user-1386"><span class="linenos">1386</span></a>
</span><span id="GuacamoleDB.create_user-1387"><a href="#GuacamoleDB.create_user-1387"><span class="linenos">1387</span></a>            <span class="c1"># Get binary representations</span>
</span><span id="GuacamoleDB.create_user-1388"><a href="#GuacamoleDB.create_user-1388"><span class="linenos">1388</span></a>            <span class="n">password_hash</span> <span class="o">=</span> <span class="n">digest</span>  <span class="c1"># SHA256 hash of (password + hex(salt))</span>
</span><span id="GuacamoleDB.create_user-1389"><a href="#GuacamoleDB.create_user-1389"><span class="linenos">1389</span></a>            <span class="n">password_salt</span> <span class="o">=</span> <span class="n">salt</span>  <span class="c1"># Original raw bytes salt</span>
</span><span id="GuacamoleDB.create_user-1390"><a href="#GuacamoleDB.create_user-1390"><span class="linenos">1390</span></a>
</span><span id="GuacamoleDB.create_user-1391"><a href="#GuacamoleDB.create_user-1391"><span class="linenos">1391</span></a>            <span class="c1"># Create entity</span>
</span><span id="GuacamoleDB.create_user-1392"><a href="#GuacamoleDB.create_user-1392"><span class="linenos">1392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_user-1393"><a href="#GuacamoleDB.create_user-1393"><span class="linenos">1393</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_user-1394"><a href="#GuacamoleDB.create_user-1394"><span class="linenos">1394</span></a><span class="sd">                INSERT INTO guacamole_entity (name, type)</span>
</span><span id="GuacamoleDB.create_user-1395"><a href="#GuacamoleDB.create_user-1395"><span class="linenos">1395</span></a><span class="sd">                VALUES (%s, &#39;USER&#39;)</span>
</span><span id="GuacamoleDB.create_user-1396"><a href="#GuacamoleDB.create_user-1396"><span class="linenos">1396</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_user-1397"><a href="#GuacamoleDB.create_user-1397"><span class="linenos">1397</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.create_user-1398"><a href="#GuacamoleDB.create_user-1398"><span class="linenos">1398</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_user-1399"><a href="#GuacamoleDB.create_user-1399"><span class="linenos">1399</span></a>
</span><span id="GuacamoleDB.create_user-1400"><a href="#GuacamoleDB.create_user-1400"><span class="linenos">1400</span></a>            <span class="c1"># Create user with proper binary data</span>
</span><span id="GuacamoleDB.create_user-1401"><a href="#GuacamoleDB.create_user-1401"><span class="linenos">1401</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_user-1402"><a href="#GuacamoleDB.create_user-1402"><span class="linenos">1402</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_user-1403"><a href="#GuacamoleDB.create_user-1403"><span class="linenos">1403</span></a><span class="sd">                INSERT INTO guacamole_user</span>
</span><span id="GuacamoleDB.create_user-1404"><a href="#GuacamoleDB.create_user-1404"><span class="linenos">1404</span></a><span class="sd">                    (entity_id, password_hash, password_salt, password_date)</span>
</span><span id="GuacamoleDB.create_user-1405"><a href="#GuacamoleDB.create_user-1405"><span class="linenos">1405</span></a><span class="sd">                SELECT</span>
</span><span id="GuacamoleDB.create_user-1406"><a href="#GuacamoleDB.create_user-1406"><span class="linenos">1406</span></a><span class="sd">                    entity_id,</span>
</span><span id="GuacamoleDB.create_user-1407"><a href="#GuacamoleDB.create_user-1407"><span class="linenos">1407</span></a><span class="sd">                    %s,</span>
</span><span id="GuacamoleDB.create_user-1408"><a href="#GuacamoleDB.create_user-1408"><span class="linenos">1408</span></a><span class="sd">                    %s,</span>
</span><span id="GuacamoleDB.create_user-1409"><a href="#GuacamoleDB.create_user-1409"><span class="linenos">1409</span></a><span class="sd">                    NOW()</span>
</span><span id="GuacamoleDB.create_user-1410"><a href="#GuacamoleDB.create_user-1410"><span class="linenos">1410</span></a><span class="sd">            FROM guacamole_entity</span>
</span><span id="GuacamoleDB.create_user-1411"><a href="#GuacamoleDB.create_user-1411"><span class="linenos">1411</span></a><span class="sd">            WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.create_user-1412"><a href="#GuacamoleDB.create_user-1412"><span class="linenos">1412</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_user-1413"><a href="#GuacamoleDB.create_user-1413"><span class="linenos">1413</span></a>                <span class="p">(</span><span class="n">password_hash</span><span class="p">,</span> <span class="n">password_salt</span><span class="p">,</span> <span class="n">username</span><span class="p">),</span>
</span><span id="GuacamoleDB.create_user-1414"><a href="#GuacamoleDB.create_user-1414"><span class="linenos">1414</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_user-1415"><a href="#GuacamoleDB.create_user-1415"><span class="linenos">1415</span></a>
</span><span id="GuacamoleDB.create_user-1416"><a href="#GuacamoleDB.create_user-1416"><span class="linenos">1416</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; created successfully&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_user-1417"><a href="#GuacamoleDB.create_user-1417"><span class="linenos">1417</span></a>
</span><span id="GuacamoleDB.create_user-1418"><a href="#GuacamoleDB.create_user-1418"><span class="linenos">1418</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_user-1419"><a href="#GuacamoleDB.create_user-1419"><span class="linenos">1419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_user-1420"><a href="#GuacamoleDB.create_user-1420"><span class="linenos">1420</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Create a new user in the Guacamole database.</p>

<p>Creates a new user with secure password hashing using Guacamole's
authentication method. Generates a random salt and hashes the password
using SHA256.</p>

<p>Args:
    username: The username for the new user.
    password: The password for the new user.</p>

<p>Raises:
    mysql.connector.Error: If database operations fail.</p>

<p>Note:
    Uses Guacamole's password hashing method: SHA256(password + hex(salt)).
    The salt is a random 32-byte value for security. This method creates
    both the entity record and the user record with password credentials.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     db.create_user('newuser', 'securepassword')</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.create_usergroup" class="classattr">
                                        <input id="GuacamoleDB.create_usergroup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_usergroup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.create_usergroup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.create_usergroup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.create_usergroup-1422"><a href="#GuacamoleDB.create_usergroup-1422"><span class="linenos">1422</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_usergroup-1423"><a href="#GuacamoleDB.create_usergroup-1423"><span class="linenos">1423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new user group in the Guacamole database.</span>
</span><span id="GuacamoleDB.create_usergroup-1424"><a href="#GuacamoleDB.create_usergroup-1424"><span class="linenos">1424</span></a>
</span><span id="GuacamoleDB.create_usergroup-1425"><a href="#GuacamoleDB.create_usergroup-1425"><span class="linenos">1425</span></a><span class="sd">        Creates both the entity record and the user group record for a new</span>
</span><span id="GuacamoleDB.create_usergroup-1426"><a href="#GuacamoleDB.create_usergroup-1426"><span class="linenos">1426</span></a><span class="sd">        user group with disabled status set to FALSE (enabled).</span>
</span><span id="GuacamoleDB.create_usergroup-1427"><a href="#GuacamoleDB.create_usergroup-1427"><span class="linenos">1427</span></a>
</span><span id="GuacamoleDB.create_usergroup-1428"><a href="#GuacamoleDB.create_usergroup-1428"><span class="linenos">1428</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.create_usergroup-1429"><a href="#GuacamoleDB.create_usergroup-1429"><span class="linenos">1429</span></a><span class="sd">            group_name: The name for the new user group.</span>
</span><span id="GuacamoleDB.create_usergroup-1430"><a href="#GuacamoleDB.create_usergroup-1430"><span class="linenos">1430</span></a>
</span><span id="GuacamoleDB.create_usergroup-1431"><a href="#GuacamoleDB.create_usergroup-1431"><span class="linenos">1431</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.create_usergroup-1432"><a href="#GuacamoleDB.create_usergroup-1432"><span class="linenos">1432</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB.create_usergroup-1433"><a href="#GuacamoleDB.create_usergroup-1433"><span class="linenos">1433</span></a>
</span><span id="GuacamoleDB.create_usergroup-1434"><a href="#GuacamoleDB.create_usergroup-1434"><span class="linenos">1434</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.create_usergroup-1435"><a href="#GuacamoleDB.create_usergroup-1435"><span class="linenos">1435</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.create_usergroup-1436"><a href="#GuacamoleDB.create_usergroup-1436"><span class="linenos">1436</span></a><span class="sd">            ...     db.create_usergroup(&#39;developers&#39;)</span>
</span><span id="GuacamoleDB.create_usergroup-1437"><a href="#GuacamoleDB.create_usergroup-1437"><span class="linenos">1437</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_usergroup-1438"><a href="#GuacamoleDB.create_usergroup-1438"><span class="linenos">1438</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_usergroup-1439"><a href="#GuacamoleDB.create_usergroup-1439"><span class="linenos">1439</span></a>            <span class="c1"># Create entity</span>
</span><span id="GuacamoleDB.create_usergroup-1440"><a href="#GuacamoleDB.create_usergroup-1440"><span class="linenos">1440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_usergroup-1441"><a href="#GuacamoleDB.create_usergroup-1441"><span class="linenos">1441</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_usergroup-1442"><a href="#GuacamoleDB.create_usergroup-1442"><span class="linenos">1442</span></a><span class="sd">                INSERT INTO guacamole_entity (name, type)</span>
</span><span id="GuacamoleDB.create_usergroup-1443"><a href="#GuacamoleDB.create_usergroup-1443"><span class="linenos">1443</span></a><span class="sd">                VALUES (%s, &#39;USER_GROUP&#39;)</span>
</span><span id="GuacamoleDB.create_usergroup-1444"><a href="#GuacamoleDB.create_usergroup-1444"><span class="linenos">1444</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_usergroup-1445"><a href="#GuacamoleDB.create_usergroup-1445"><span class="linenos">1445</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.create_usergroup-1446"><a href="#GuacamoleDB.create_usergroup-1446"><span class="linenos">1446</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_usergroup-1447"><a href="#GuacamoleDB.create_usergroup-1447"><span class="linenos">1447</span></a>
</span><span id="GuacamoleDB.create_usergroup-1448"><a href="#GuacamoleDB.create_usergroup-1448"><span class="linenos">1448</span></a>            <span class="c1"># Create group</span>
</span><span id="GuacamoleDB.create_usergroup-1449"><a href="#GuacamoleDB.create_usergroup-1449"><span class="linenos">1449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_usergroup-1450"><a href="#GuacamoleDB.create_usergroup-1450"><span class="linenos">1450</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_usergroup-1451"><a href="#GuacamoleDB.create_usergroup-1451"><span class="linenos">1451</span></a><span class="sd">                INSERT INTO guacamole_user_group (entity_id, disabled)</span>
</span><span id="GuacamoleDB.create_usergroup-1452"><a href="#GuacamoleDB.create_usergroup-1452"><span class="linenos">1452</span></a><span class="sd">                SELECT entity_id, FALSE</span>
</span><span id="GuacamoleDB.create_usergroup-1453"><a href="#GuacamoleDB.create_usergroup-1453"><span class="linenos">1453</span></a><span class="sd">                FROM guacamole_entity</span>
</span><span id="GuacamoleDB.create_usergroup-1454"><a href="#GuacamoleDB.create_usergroup-1454"><span class="linenos">1454</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.create_usergroup-1455"><a href="#GuacamoleDB.create_usergroup-1455"><span class="linenos">1455</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_usergroup-1456"><a href="#GuacamoleDB.create_usergroup-1456"><span class="linenos">1456</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.create_usergroup-1457"><a href="#GuacamoleDB.create_usergroup-1457"><span class="linenos">1457</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_usergroup-1458"><a href="#GuacamoleDB.create_usergroup-1458"><span class="linenos">1458</span></a>
</span><span id="GuacamoleDB.create_usergroup-1459"><a href="#GuacamoleDB.create_usergroup-1459"><span class="linenos">1459</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_usergroup-1460"><a href="#GuacamoleDB.create_usergroup-1460"><span class="linenos">1460</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_usergroup-1461"><a href="#GuacamoleDB.create_usergroup-1461"><span class="linenos">1461</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Create a new user group in the Guacamole database.</p>

<p>Creates both the entity record and the user group record for a new
user group with disabled status set to FALSE (enabled).</p>

<p>Args:
    group_name: The name for the new user group.</p>

<p>Raises:
    mysql.connector.Error: If database operations fail.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     db.create_usergroup('developers')</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.add_user_to_usergroup" class="classattr">
                                        <input id="GuacamoleDB.add_user_to_usergroup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_user_to_usergroup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.add_user_to_usergroup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.add_user_to_usergroup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.add_user_to_usergroup-1463"><a href="#GuacamoleDB.add_user_to_usergroup-1463"><span class="linenos">1463</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_user_to_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1464"><a href="#GuacamoleDB.add_user_to_usergroup-1464"><span class="linenos">1464</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1465"><a href="#GuacamoleDB.add_user_to_usergroup-1465"><span class="linenos">1465</span></a>            <span class="c1"># Get the group ID</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1466"><a href="#GuacamoleDB.add_user_to_usergroup-1466"><span class="linenos">1466</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_usergroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1467"><a href="#GuacamoleDB.add_user_to_usergroup-1467"><span class="linenos">1467</span></a>
</span><span id="GuacamoleDB.add_user_to_usergroup-1468"><a href="#GuacamoleDB.add_user_to_usergroup-1468"><span class="linenos">1468</span></a>            <span class="c1"># Get the user&#39;s entity ID</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1469"><a href="#GuacamoleDB.add_user_to_usergroup-1469"><span class="linenos">1469</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1470"><a href="#GuacamoleDB.add_user_to_usergroup-1470"><span class="linenos">1470</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1471"><a href="#GuacamoleDB.add_user_to_usergroup-1471"><span class="linenos">1471</span></a><span class="sd">                SELECT entity_id </span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1472"><a href="#GuacamoleDB.add_user_to_usergroup-1472"><span class="linenos">1472</span></a><span class="sd">                FROM guacamole_entity </span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1473"><a href="#GuacamoleDB.add_user_to_usergroup-1473"><span class="linenos">1473</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1474"><a href="#GuacamoleDB.add_user_to_usergroup-1474"><span class="linenos">1474</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1475"><a href="#GuacamoleDB.add_user_to_usergroup-1475"><span class="linenos">1475</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1476"><a href="#GuacamoleDB.add_user_to_usergroup-1476"><span class="linenos">1476</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1477"><a href="#GuacamoleDB.add_user_to_usergroup-1477"><span class="linenos">1477</span></a>            <span class="n">user_entity_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1478"><a href="#GuacamoleDB.add_user_to_usergroup-1478"><span class="linenos">1478</span></a>
</span><span id="GuacamoleDB.add_user_to_usergroup-1479"><a href="#GuacamoleDB.add_user_to_usergroup-1479"><span class="linenos">1479</span></a>            <span class="c1"># Add user to group</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1480"><a href="#GuacamoleDB.add_user_to_usergroup-1480"><span class="linenos">1480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1481"><a href="#GuacamoleDB.add_user_to_usergroup-1481"><span class="linenos">1481</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1482"><a href="#GuacamoleDB.add_user_to_usergroup-1482"><span class="linenos">1482</span></a><span class="sd">                INSERT INTO guacamole_user_group_member </span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1483"><a href="#GuacamoleDB.add_user_to_usergroup-1483"><span class="linenos">1483</span></a><span class="sd">                (user_group_id, member_entity_id)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1484"><a href="#GuacamoleDB.add_user_to_usergroup-1484"><span class="linenos">1484</span></a><span class="sd">                VALUES (%s, %s)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1485"><a href="#GuacamoleDB.add_user_to_usergroup-1485"><span class="linenos">1485</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1486"><a href="#GuacamoleDB.add_user_to_usergroup-1486"><span class="linenos">1486</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1487"><a href="#GuacamoleDB.add_user_to_usergroup-1487"><span class="linenos">1487</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1488"><a href="#GuacamoleDB.add_user_to_usergroup-1488"><span class="linenos">1488</span></a>
</span><span id="GuacamoleDB.add_user_to_usergroup-1489"><a href="#GuacamoleDB.add_user_to_usergroup-1489"><span class="linenos">1489</span></a>            <span class="c1"># Grant group permissions to user</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1490"><a href="#GuacamoleDB.add_user_to_usergroup-1490"><span class="linenos">1490</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1491"><a href="#GuacamoleDB.add_user_to_usergroup-1491"><span class="linenos">1491</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1492"><a href="#GuacamoleDB.add_user_to_usergroup-1492"><span class="linenos">1492</span></a><span class="sd">                INSERT INTO guacamole_user_group_permission</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1493"><a href="#GuacamoleDB.add_user_to_usergroup-1493"><span class="linenos">1493</span></a><span class="sd">                (entity_id, affected_user_group_id, permission)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1494"><a href="#GuacamoleDB.add_user_to_usergroup-1494"><span class="linenos">1494</span></a><span class="sd">                SELECT %s, %s, &#39;READ&#39;</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1495"><a href="#GuacamoleDB.add_user_to_usergroup-1495"><span class="linenos">1495</span></a><span class="sd">                FROM dual</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1496"><a href="#GuacamoleDB.add_user_to_usergroup-1496"><span class="linenos">1496</span></a><span class="sd">                WHERE NOT EXISTS (</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1497"><a href="#GuacamoleDB.add_user_to_usergroup-1497"><span class="linenos">1497</span></a><span class="sd">                    SELECT 1 FROM guacamole_user_group_permission</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1498"><a href="#GuacamoleDB.add_user_to_usergroup-1498"><span class="linenos">1498</span></a><span class="sd">                    WHERE entity_id = %s </span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1499"><a href="#GuacamoleDB.add_user_to_usergroup-1499"><span class="linenos">1499</span></a><span class="sd">                    AND affected_user_group_id = %s </span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1500"><a href="#GuacamoleDB.add_user_to_usergroup-1500"><span class="linenos">1500</span></a><span class="sd">                    AND permission = &#39;READ&#39;</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1501"><a href="#GuacamoleDB.add_user_to_usergroup-1501"><span class="linenos">1501</span></a><span class="sd">                )</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1502"><a href="#GuacamoleDB.add_user_to_usergroup-1502"><span class="linenos">1502</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1503"><a href="#GuacamoleDB.add_user_to_usergroup-1503"><span class="linenos">1503</span></a>                <span class="p">(</span><span class="n">user_entity_id</span><span class="p">,</span> <span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">,</span> <span class="n">group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1504"><a href="#GuacamoleDB.add_user_to_usergroup-1504"><span class="linenos">1504</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1505"><a href="#GuacamoleDB.add_user_to_usergroup-1505"><span class="linenos">1505</span></a>
</span><span id="GuacamoleDB.add_user_to_usergroup-1506"><a href="#GuacamoleDB.add_user_to_usergroup-1506"><span class="linenos">1506</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1507"><a href="#GuacamoleDB.add_user_to_usergroup-1507"><span class="linenos">1507</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully added user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; to usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1508"><a href="#GuacamoleDB.add_user_to_usergroup-1508"><span class="linenos">1508</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1509"><a href="#GuacamoleDB.add_user_to_usergroup-1509"><span class="linenos">1509</span></a>
</span><span id="GuacamoleDB.add_user_to_usergroup-1510"><a href="#GuacamoleDB.add_user_to_usergroup-1510"><span class="linenos">1510</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1511"><a href="#GuacamoleDB.add_user_to_usergroup-1511"><span class="linenos">1511</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding user to usergroup: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.add_user_to_usergroup-1512"><a href="#GuacamoleDB.add_user_to_usergroup-1512"><span class="linenos">1512</span></a>            <span class="k">raise</span>
</span></pre></div>


    

                            </div>
                            <div id="GuacamoleDB.remove_user_from_usergroup" class="classattr">
                                        <input id="GuacamoleDB.remove_user_from_usergroup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_user_from_usergroup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.remove_user_from_usergroup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.remove_user_from_usergroup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.remove_user_from_usergroup-1514"><a href="#GuacamoleDB.remove_user_from_usergroup-1514"><span class="linenos">1514</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_user_from_usergroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1515"><a href="#GuacamoleDB.remove_user_from_usergroup-1515"><span class="linenos">1515</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1516"><a href="#GuacamoleDB.remove_user_from_usergroup-1516"><span class="linenos">1516</span></a>            <span class="c1"># Get the group ID</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1517"><a href="#GuacamoleDB.remove_user_from_usergroup-1517"><span class="linenos">1517</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_usergroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1518"><a href="#GuacamoleDB.remove_user_from_usergroup-1518"><span class="linenos">1518</span></a>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1519"><a href="#GuacamoleDB.remove_user_from_usergroup-1519"><span class="linenos">1519</span></a>            <span class="c1"># Get the user&#39;s entity ID</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1520"><a href="#GuacamoleDB.remove_user_from_usergroup-1520"><span class="linenos">1520</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1521"><a href="#GuacamoleDB.remove_user_from_usergroup-1521"><span class="linenos">1521</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1522"><a href="#GuacamoleDB.remove_user_from_usergroup-1522"><span class="linenos">1522</span></a><span class="sd">                SELECT entity_id </span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1523"><a href="#GuacamoleDB.remove_user_from_usergroup-1523"><span class="linenos">1523</span></a><span class="sd">                FROM guacamole_entity </span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1524"><a href="#GuacamoleDB.remove_user_from_usergroup-1524"><span class="linenos">1524</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1525"><a href="#GuacamoleDB.remove_user_from_usergroup-1525"><span class="linenos">1525</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1526"><a href="#GuacamoleDB.remove_user_from_usergroup-1526"><span class="linenos">1526</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1527"><a href="#GuacamoleDB.remove_user_from_usergroup-1527"><span class="linenos">1527</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1528"><a href="#GuacamoleDB.remove_user_from_usergroup-1528"><span class="linenos">1528</span></a>            <span class="n">user_entity_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1529"><a href="#GuacamoleDB.remove_user_from_usergroup-1529"><span class="linenos">1529</span></a>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1530"><a href="#GuacamoleDB.remove_user_from_usergroup-1530"><span class="linenos">1530</span></a>            <span class="c1"># Check if user is actually in the group</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1531"><a href="#GuacamoleDB.remove_user_from_usergroup-1531"><span class="linenos">1531</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1532"><a href="#GuacamoleDB.remove_user_from_usergroup-1532"><span class="linenos">1532</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1533"><a href="#GuacamoleDB.remove_user_from_usergroup-1533"><span class="linenos">1533</span></a><span class="sd">                SELECT COUNT(*) </span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1534"><a href="#GuacamoleDB.remove_user_from_usergroup-1534"><span class="linenos">1534</span></a><span class="sd">                FROM guacamole_user_group_member</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1535"><a href="#GuacamoleDB.remove_user_from_usergroup-1535"><span class="linenos">1535</span></a><span class="sd">                WHERE user_group_id = %s AND member_entity_id = %s</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1536"><a href="#GuacamoleDB.remove_user_from_usergroup-1536"><span class="linenos">1536</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1537"><a href="#GuacamoleDB.remove_user_from_usergroup-1537"><span class="linenos">1537</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1538"><a href="#GuacamoleDB.remove_user_from_usergroup-1538"><span class="linenos">1538</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1539"><a href="#GuacamoleDB.remove_user_from_usergroup-1539"><span class="linenos">1539</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1540"><a href="#GuacamoleDB.remove_user_from_usergroup-1540"><span class="linenos">1540</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; is not in group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1541"><a href="#GuacamoleDB.remove_user_from_usergroup-1541"><span class="linenos">1541</span></a>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1542"><a href="#GuacamoleDB.remove_user_from_usergroup-1542"><span class="linenos">1542</span></a>            <span class="c1"># Remove user from group</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1543"><a href="#GuacamoleDB.remove_user_from_usergroup-1543"><span class="linenos">1543</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1544"><a href="#GuacamoleDB.remove_user_from_usergroup-1544"><span class="linenos">1544</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1545"><a href="#GuacamoleDB.remove_user_from_usergroup-1545"><span class="linenos">1545</span></a><span class="sd">                DELETE FROM guacamole_user_group_member</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1546"><a href="#GuacamoleDB.remove_user_from_usergroup-1546"><span class="linenos">1546</span></a><span class="sd">                WHERE user_group_id = %s AND member_entity_id = %s</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1547"><a href="#GuacamoleDB.remove_user_from_usergroup-1547"><span class="linenos">1547</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1548"><a href="#GuacamoleDB.remove_user_from_usergroup-1548"><span class="linenos">1548</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,</span> <span class="n">user_entity_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1549"><a href="#GuacamoleDB.remove_user_from_usergroup-1549"><span class="linenos">1549</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1550"><a href="#GuacamoleDB.remove_user_from_usergroup-1550"><span class="linenos">1550</span></a>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1551"><a href="#GuacamoleDB.remove_user_from_usergroup-1551"><span class="linenos">1551</span></a>            <span class="c1"># Revoke group permissions from user</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1552"><a href="#GuacamoleDB.remove_user_from_usergroup-1552"><span class="linenos">1552</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1553"><a href="#GuacamoleDB.remove_user_from_usergroup-1553"><span class="linenos">1553</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1554"><a href="#GuacamoleDB.remove_user_from_usergroup-1554"><span class="linenos">1554</span></a><span class="sd">                DELETE FROM guacamole_user_group_permission</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1555"><a href="#GuacamoleDB.remove_user_from_usergroup-1555"><span class="linenos">1555</span></a><span class="sd">                WHERE entity_id = %s AND affected_user_group_id = %s</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1556"><a href="#GuacamoleDB.remove_user_from_usergroup-1556"><span class="linenos">1556</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1557"><a href="#GuacamoleDB.remove_user_from_usergroup-1557"><span class="linenos">1557</span></a>                <span class="p">(</span><span class="n">user_entity_id</span><span class="p">,</span> <span class="n">group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1558"><a href="#GuacamoleDB.remove_user_from_usergroup-1558"><span class="linenos">1558</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1559"><a href="#GuacamoleDB.remove_user_from_usergroup-1559"><span class="linenos">1559</span></a>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1560"><a href="#GuacamoleDB.remove_user_from_usergroup-1560"><span class="linenos">1560</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1561"><a href="#GuacamoleDB.remove_user_from_usergroup-1561"><span class="linenos">1561</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully removed user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; from usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1562"><a href="#GuacamoleDB.remove_user_from_usergroup-1562"><span class="linenos">1562</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1563"><a href="#GuacamoleDB.remove_user_from_usergroup-1563"><span class="linenos">1563</span></a>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1564"><a href="#GuacamoleDB.remove_user_from_usergroup-1564"><span class="linenos">1564</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1565"><a href="#GuacamoleDB.remove_user_from_usergroup-1565"><span class="linenos">1565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error removing user from group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.remove_user_from_usergroup-1566"><a href="#GuacamoleDB.remove_user_from_usergroup-1566"><span class="linenos">1566</span></a>            <span class="k">raise</span>
</span></pre></div>


    

                            </div>
                            <div id="GuacamoleDB.get_connection_group_id" class="classattr">
                                        <input id="GuacamoleDB.get_connection_group_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_connection_group_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_connection_group_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_connection_group_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_connection_group_id-1568"><a href="#GuacamoleDB.get_connection_group_id-1568"><span class="linenos">1568</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1569"><a href="#GuacamoleDB.get_connection_group_id-1569"><span class="linenos">1569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve nested connection group path to connection group ID.</span>
</span><span id="GuacamoleDB.get_connection_group_id-1570"><a href="#GuacamoleDB.get_connection_group_id-1570"><span class="linenos">1570</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1571"><a href="#GuacamoleDB.get_connection_group_id-1571"><span class="linenos">1571</span></a><span class="sd">        Resolves a hierarchical path (e.g., &quot;parent/child/grandchild&quot;) to the</span>
</span><span id="GuacamoleDB.get_connection_group_id-1572"><a href="#GuacamoleDB.get_connection_group_id-1572"><span class="linenos">1572</span></a><span class="sd">        database ID of the final group in the path. This method traverses the</span>
</span><span id="GuacamoleDB.get_connection_group_id-1573"><a href="#GuacamoleDB.get_connection_group_id-1573"><span class="linenos">1573</span></a><span class="sd">        hierarchy to find the exact group at the specified path.</span>
</span><span id="GuacamoleDB.get_connection_group_id-1574"><a href="#GuacamoleDB.get_connection_group_id-1574"><span class="linenos">1574</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1575"><a href="#GuacamoleDB.get_connection_group_id-1575"><span class="linenos">1575</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1576"><a href="#GuacamoleDB.get_connection_group_id-1576"><span class="linenos">1576</span></a><span class="sd">            group_path: Slash-separated path to the connection group.</span>
</span><span id="GuacamoleDB.get_connection_group_id-1577"><a href="#GuacamoleDB.get_connection_group_id-1577"><span class="linenos">1577</span></a><span class="sd">                       Examples: &quot;Production&quot;, &quot;Production/Web&quot;, &quot;Servers/Linux&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1578"><a href="#GuacamoleDB.get_connection_group_id-1578"><span class="linenos">1578</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1579"><a href="#GuacamoleDB.get_connection_group_id-1579"><span class="linenos">1579</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1580"><a href="#GuacamoleDB.get_connection_group_id-1580"><span class="linenos">1580</span></a><span class="sd">            The database ID of the connection group at the specified path.</span>
</span><span id="GuacamoleDB.get_connection_group_id-1581"><a href="#GuacamoleDB.get_connection_group_id-1581"><span class="linenos">1581</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1582"><a href="#GuacamoleDB.get_connection_group_id-1582"><span class="linenos">1582</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1583"><a href="#GuacamoleDB.get_connection_group_id-1583"><span class="linenos">1583</span></a><span class="sd">            ValueError: If the group path cannot be resolved or any group in the</span>
</span><span id="GuacamoleDB.get_connection_group_id-1584"><a href="#GuacamoleDB.get_connection_group_id-1584"><span class="linenos">1584</span></a><span class="sd">                       path doesn&#39;t exist.</span>
</span><span id="GuacamoleDB.get_connection_group_id-1585"><a href="#GuacamoleDB.get_connection_group_id-1585"><span class="linenos">1585</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.get_connection_group_id-1586"><a href="#GuacamoleDB.get_connection_group_id-1586"><span class="linenos">1586</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1587"><a href="#GuacamoleDB.get_connection_group_id-1587"><span class="linenos">1587</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1588"><a href="#GuacamoleDB.get_connection_group_id-1588"><span class="linenos">1588</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1589"><a href="#GuacamoleDB.get_connection_group_id-1589"><span class="linenos">1589</span></a><span class="sd">            ...     group_id = db.get_connection_group_id(&quot;Production/Web Servers&quot;)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1590"><a href="#GuacamoleDB.get_connection_group_id-1590"><span class="linenos">1590</span></a><span class="sd">            ...     print(f&quot;Group ID: {group_id}&quot;)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1591"><a href="#GuacamoleDB.get_connection_group_id-1591"><span class="linenos">1591</span></a><span class="sd">            Group ID: 42</span>
</span><span id="GuacamoleDB.get_connection_group_id-1592"><a href="#GuacamoleDB.get_connection_group_id-1592"><span class="linenos">1592</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1593"><a href="#GuacamoleDB.get_connection_group_id-1593"><span class="linenos">1593</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1594"><a href="#GuacamoleDB.get_connection_group_id-1594"><span class="linenos">1594</span></a>            <span class="n">groups</span> <span class="o">=</span> <span class="n">group_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1595"><a href="#GuacamoleDB.get_connection_group_id-1595"><span class="linenos">1595</span></a>            <span class="n">parent_group_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.get_connection_group_id-1596"><a href="#GuacamoleDB.get_connection_group_id-1596"><span class="linenos">1596</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1597"><a href="#GuacamoleDB.get_connection_group_id-1597"><span class="linenos">1597</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resolving group path: </span><span class="si">{</span><span class="n">group_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1598"><a href="#GuacamoleDB.get_connection_group_id-1598"><span class="linenos">1598</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1599"><a href="#GuacamoleDB.get_connection_group_id-1599"><span class="linenos">1599</span></a>            <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1600"><a href="#GuacamoleDB.get_connection_group_id-1600"><span class="linenos">1600</span></a>                <span class="c1"># CORRECTED SQL - use connection_group_name directly</span>
</span><span id="GuacamoleDB.get_connection_group_id-1601"><a href="#GuacamoleDB.get_connection_group_id-1601"><span class="linenos">1601</span></a>                <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1602"><a href="#GuacamoleDB.get_connection_group_id-1602"><span class="linenos">1602</span></a><span class="s2">                    SELECT connection_group_id </span>
</span><span id="GuacamoleDB.get_connection_group_id-1603"><a href="#GuacamoleDB.get_connection_group_id-1603"><span class="linenos">1603</span></a><span class="s2">                    FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.get_connection_group_id-1604"><a href="#GuacamoleDB.get_connection_group_id-1604"><span class="linenos">1604</span></a><span class="s2">                    WHERE connection_group_name = </span><span class="si">%s</span>
</span><span id="GuacamoleDB.get_connection_group_id-1605"><a href="#GuacamoleDB.get_connection_group_id-1605"><span class="linenos">1605</span></a><span class="s2">                &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1606"><a href="#GuacamoleDB.get_connection_group_id-1606"><span class="linenos">1606</span></a>                <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_name</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_connection_group_id-1607"><a href="#GuacamoleDB.get_connection_group_id-1607"><span class="linenos">1607</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1608"><a href="#GuacamoleDB.get_connection_group_id-1608"><span class="linenos">1608</span></a>                <span class="k">if</span> <span class="n">parent_group_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1609"><a href="#GuacamoleDB.get_connection_group_id-1609"><span class="linenos">1609</span></a>                    <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; AND parent_id = </span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1610"><a href="#GuacamoleDB.get_connection_group_id-1610"><span class="linenos">1610</span></a>                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1611"><a href="#GuacamoleDB.get_connection_group_id-1611"><span class="linenos">1611</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1612"><a href="#GuacamoleDB.get_connection_group_id-1612"><span class="linenos">1612</span></a>                    <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; AND parent_id IS NULL&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1613"><a href="#GuacamoleDB.get_connection_group_id-1613"><span class="linenos">1613</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1614"><a href="#GuacamoleDB.get_connection_group_id-1614"><span class="linenos">1614</span></a>                <span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY connection_group_id LIMIT 1&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1615"><a href="#GuacamoleDB.get_connection_group_id-1615"><span class="linenos">1615</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1616"><a href="#GuacamoleDB.get_connection_group_id-1616"><span class="linenos">1616</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing SQL:</span><span class="se">\n</span><span class="si">{</span><span class="n">sql</span><span class="si">}</span><span class="se">\n</span><span class="s2">With params: </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1617"><a href="#GuacamoleDB.get_connection_group_id-1617"><span class="linenos">1617</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1618"><a href="#GuacamoleDB.get_connection_group_id-1618"><span class="linenos">1618</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
</span><span id="GuacamoleDB.get_connection_group_id-1619"><a href="#GuacamoleDB.get_connection_group_id-1619"><span class="linenos">1619</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1620"><a href="#GuacamoleDB.get_connection_group_id-1620"><span class="linenos">1620</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_connection_group_id-1621"><a href="#GuacamoleDB.get_connection_group_id-1621"><span class="linenos">1621</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1622"><a href="#GuacamoleDB.get_connection_group_id-1622"><span class="linenos">1622</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_group_id-1623"><a href="#GuacamoleDB.get_connection_group_id-1623"><span class="linenos">1623</span></a>                        <span class="sa">f</span><span class="s2">&quot;Group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found in path &#39;</span><span class="si">{</span><span class="n">group_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_id-1624"><a href="#GuacamoleDB.get_connection_group_id-1624"><span class="linenos">1624</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1625"><a href="#GuacamoleDB.get_connection_group_id-1625"><span class="linenos">1625</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1626"><a href="#GuacamoleDB.get_connection_group_id-1626"><span class="linenos">1626</span></a>                <span class="n">parent_group_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_connection_group_id-1627"><a href="#GuacamoleDB.get_connection_group_id-1627"><span class="linenos">1627</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found group ID </span><span class="si">{</span><span class="n">parent_group_id</span><span class="si">}</span><span class="s2"> for &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1628"><a href="#GuacamoleDB.get_connection_group_id-1628"><span class="linenos">1628</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1629"><a href="#GuacamoleDB.get_connection_group_id-1629"><span class="linenos">1629</span></a>            <span class="k">return</span> <span class="n">parent_group_id</span>
</span><span id="GuacamoleDB.get_connection_group_id-1630"><a href="#GuacamoleDB.get_connection_group_id-1630"><span class="linenos">1630</span></a>
</span><span id="GuacamoleDB.get_connection_group_id-1631"><a href="#GuacamoleDB.get_connection_group_id-1631"><span class="linenos">1631</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_id-1632"><a href="#GuacamoleDB.get_connection_group_id-1632"><span class="linenos">1632</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error resolving group path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_id-1633"><a href="#GuacamoleDB.get_connection_group_id-1633"><span class="linenos">1633</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Resolve nested connection group path to connection group ID.</p>

<p>Resolves a hierarchical path (e.g., "parent/child/grandchild") to the
database ID of the final group in the path. This method traverses the
hierarchy to find the exact group at the specified path.</p>

<p>Args:
    group_path: Slash-separated path to the connection group.
               Examples: "Production", "Production/Web", "Servers/Linux"</p>

<p>Returns:
    The database ID of the connection group at the specified path.</p>

<p>Raises:
    ValueError: If the group path cannot be resolved or any group in the
               path doesn't exist.
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     group_id = db.get_connection_group_id("Production/Web Servers")
          ...     print(f"Group ID: {group_id}")
          Group ID: 42</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.connection_exists" class="classattr">
                                        <input id="GuacamoleDB.connection_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">connection_exists</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.connection_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.connection_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.connection_exists-1635"><a href="#GuacamoleDB.connection_exists-1635"><span class="linenos">1635</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connection_exists</span><span class="p">(</span>
</span><span id="GuacamoleDB.connection_exists-1636"><a href="#GuacamoleDB.connection_exists-1636"><span class="linenos">1636</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.connection_exists-1637"><a href="#GuacamoleDB.connection_exists-1637"><span class="linenos">1637</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_exists-1638"><a href="#GuacamoleDB.connection_exists-1638"><span class="linenos">1638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a connection exists in the Guacamole database.</span>
</span><span id="GuacamoleDB.connection_exists-1639"><a href="#GuacamoleDB.connection_exists-1639"><span class="linenos">1639</span></a>
</span><span id="GuacamoleDB.connection_exists-1640"><a href="#GuacamoleDB.connection_exists-1640"><span class="linenos">1640</span></a><span class="sd">        Uses the resolve_connection_id method to validate inputs and determine</span>
</span><span id="GuacamoleDB.connection_exists-1641"><a href="#GuacamoleDB.connection_exists-1641"><span class="linenos">1641</span></a><span class="sd">        if a connection with the specified name or ID exists.</span>
</span><span id="GuacamoleDB.connection_exists-1642"><a href="#GuacamoleDB.connection_exists-1642"><span class="linenos">1642</span></a>
</span><span id="GuacamoleDB.connection_exists-1643"><a href="#GuacamoleDB.connection_exists-1643"><span class="linenos">1643</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.connection_exists-1644"><a href="#GuacamoleDB.connection_exists-1644"><span class="linenos">1644</span></a><span class="sd">            connection_name: The connection name to check. Optional.</span>
</span><span id="GuacamoleDB.connection_exists-1645"><a href="#GuacamoleDB.connection_exists-1645"><span class="linenos">1645</span></a><span class="sd">            connection_id: The connection ID to check. Optional.</span>
</span><span id="GuacamoleDB.connection_exists-1646"><a href="#GuacamoleDB.connection_exists-1646"><span class="linenos">1646</span></a>
</span><span id="GuacamoleDB.connection_exists-1647"><a href="#GuacamoleDB.connection_exists-1647"><span class="linenos">1647</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.connection_exists-1648"><a href="#GuacamoleDB.connection_exists-1648"><span class="linenos">1648</span></a><span class="sd">            True if the connection exists, False otherwise.</span>
</span><span id="GuacamoleDB.connection_exists-1649"><a href="#GuacamoleDB.connection_exists-1649"><span class="linenos">1649</span></a>
</span><span id="GuacamoleDB.connection_exists-1650"><a href="#GuacamoleDB.connection_exists-1650"><span class="linenos">1650</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.connection_exists-1651"><a href="#GuacamoleDB.connection_exists-1651"><span class="linenos">1651</span></a><span class="sd">            ValueError: If neither or both parameters are provided.</span>
</span><span id="GuacamoleDB.connection_exists-1652"><a href="#GuacamoleDB.connection_exists-1652"><span class="linenos">1652</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.connection_exists-1653"><a href="#GuacamoleDB.connection_exists-1653"><span class="linenos">1653</span></a>
</span><span id="GuacamoleDB.connection_exists-1654"><a href="#GuacamoleDB.connection_exists-1654"><span class="linenos">1654</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.connection_exists-1655"><a href="#GuacamoleDB.connection_exists-1655"><span class="linenos">1655</span></a><span class="sd">            Exactly one of connection_name or connection_id must be provided.</span>
</span><span id="GuacamoleDB.connection_exists-1656"><a href="#GuacamoleDB.connection_exists-1656"><span class="linenos">1656</span></a>
</span><span id="GuacamoleDB.connection_exists-1657"><a href="#GuacamoleDB.connection_exists-1657"><span class="linenos">1657</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.connection_exists-1658"><a href="#GuacamoleDB.connection_exists-1658"><span class="linenos">1658</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.connection_exists-1659"><a href="#GuacamoleDB.connection_exists-1659"><span class="linenos">1659</span></a><span class="sd">            ...     if db.connection_exists(connection_name=&#39;my-server&#39;):</span>
</span><span id="GuacamoleDB.connection_exists-1660"><a href="#GuacamoleDB.connection_exists-1660"><span class="linenos">1660</span></a><span class="sd">            ...         print(&quot;Connection exists&quot;)</span>
</span><span id="GuacamoleDB.connection_exists-1661"><a href="#GuacamoleDB.connection_exists-1661"><span class="linenos">1661</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.connection_exists-1662"><a href="#GuacamoleDB.connection_exists-1662"><span class="linenos">1662</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_exists-1663"><a href="#GuacamoleDB.connection_exists-1663"><span class="linenos">1663</span></a>            <span class="c1"># Use resolver to validate inputs and get connection_id</span>
</span><span id="GuacamoleDB.connection_exists-1664"><a href="#GuacamoleDB.connection_exists-1664"><span class="linenos">1664</span></a>            <span class="n">resolved_connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.connection_exists-1665"><a href="#GuacamoleDB.connection_exists-1665"><span class="linenos">1665</span></a>                <span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB.connection_exists-1666"><a href="#GuacamoleDB.connection_exists-1666"><span class="linenos">1666</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.connection_exists-1667"><a href="#GuacamoleDB.connection_exists-1667"><span class="linenos">1667</span></a>            <span class="c1"># If resolver succeeds, connection exists</span>
</span><span id="GuacamoleDB.connection_exists-1668"><a href="#GuacamoleDB.connection_exists-1668"><span class="linenos">1668</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.connection_exists-1669"><a href="#GuacamoleDB.connection_exists-1669"><span class="linenos">1669</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_exists-1670"><a href="#GuacamoleDB.connection_exists-1670"><span class="linenos">1670</span></a>            <span class="c1"># If resolver fails with &quot;not found&quot;, connection doesn&#39;t exist</span>
</span><span id="GuacamoleDB.connection_exists-1671"><a href="#GuacamoleDB.connection_exists-1671"><span class="linenos">1671</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GuacamoleDB.connection_exists-1672"><a href="#GuacamoleDB.connection_exists-1672"><span class="linenos">1672</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_exists-1673"><a href="#GuacamoleDB.connection_exists-1673"><span class="linenos">1673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking connection existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.connection_exists-1674"><a href="#GuacamoleDB.connection_exists-1674"><span class="linenos">1674</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Check if a connection exists in the Guacamole database.</p>

<p>Uses the resolve_connection_id method to validate inputs and determine
if a connection with the specified name or ID exists.</p>

<p>Args:
    connection_name: The connection name to check. Optional.
    connection_id: The connection ID to check. Optional.</p>

<p>Returns:
    True if the connection exists, False otherwise.</p>

<p>Raises:
    ValueError: If neither or both parameters are provided.
    mysql.connector.Error: If database query fails.</p>

<p>Note:
    Exactly one of connection_name or connection_id must be provided.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     if db.connection_exists(connection_name='my-server'):
          ...         print("Connection exists")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.connection_group_exists" class="classattr">
                                        <input id="GuacamoleDB.connection_group_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">connection_group_exists</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.connection_group_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.connection_group_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.connection_group_exists-1676"><a href="#GuacamoleDB.connection_group_exists-1676"><span class="linenos">1676</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connection_group_exists</span><span class="p">(</span>
</span><span id="GuacamoleDB.connection_group_exists-1677"><a href="#GuacamoleDB.connection_group_exists-1677"><span class="linenos">1677</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.connection_group_exists-1678"><a href="#GuacamoleDB.connection_group_exists-1678"><span class="linenos">1678</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_group_exists-1679"><a href="#GuacamoleDB.connection_group_exists-1679"><span class="linenos">1679</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a connection group with the given name or ID exists&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.connection_group_exists-1680"><a href="#GuacamoleDB.connection_group_exists-1680"><span class="linenos">1680</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_group_exists-1681"><a href="#GuacamoleDB.connection_group_exists-1681"><span class="linenos">1681</span></a>            <span class="c1"># Use resolver to validate inputs and get group_id</span>
</span><span id="GuacamoleDB.connection_group_exists-1682"><a href="#GuacamoleDB.connection_group_exists-1682"><span class="linenos">1682</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_conngroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.connection_group_exists-1683"><a href="#GuacamoleDB.connection_group_exists-1683"><span class="linenos">1683</span></a>            <span class="c1"># If resolver succeeds, connection group exists</span>
</span><span id="GuacamoleDB.connection_group_exists-1684"><a href="#GuacamoleDB.connection_group_exists-1684"><span class="linenos">1684</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.connection_group_exists-1685"><a href="#GuacamoleDB.connection_group_exists-1685"><span class="linenos">1685</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_group_exists-1686"><a href="#GuacamoleDB.connection_group_exists-1686"><span class="linenos">1686</span></a>            <span class="c1"># If resolver fails with &quot;not found&quot;, connection group doesn&#39;t exist</span>
</span><span id="GuacamoleDB.connection_group_exists-1687"><a href="#GuacamoleDB.connection_group_exists-1687"><span class="linenos">1687</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GuacamoleDB.connection_group_exists-1688"><a href="#GuacamoleDB.connection_group_exists-1688"><span class="linenos">1688</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.connection_group_exists-1689"><a href="#GuacamoleDB.connection_group_exists-1689"><span class="linenos">1689</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking connection group existence: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.connection_group_exists-1690"><a href="#GuacamoleDB.connection_group_exists-1690"><span class="linenos">1690</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Check if a connection group with the given name or ID exists</p>
</div>


                            </div>
                            <div id="GuacamoleDB.create_connection" class="classattr">
                                        <input id="GuacamoleDB.create_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_connection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">connection_type</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">port</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">vnc_password</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">parent_group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.create_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.create_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.create_connection-1692"><a href="#GuacamoleDB.create_connection-1692"><span class="linenos">1692</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_connection</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection-1693"><a href="#GuacamoleDB.create_connection-1693"><span class="linenos">1693</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1694"><a href="#GuacamoleDB.create_connection-1694"><span class="linenos">1694</span></a>        <span class="n">connection_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1695"><a href="#GuacamoleDB.create_connection-1695"><span class="linenos">1695</span></a>        <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1696"><a href="#GuacamoleDB.create_connection-1696"><span class="linenos">1696</span></a>        <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1697"><a href="#GuacamoleDB.create_connection-1697"><span class="linenos">1697</span></a>        <span class="n">port</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="GuacamoleDB.create_connection-1698"><a href="#GuacamoleDB.create_connection-1698"><span class="linenos">1698</span></a>        <span class="n">vnc_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1699"><a href="#GuacamoleDB.create_connection-1699"><span class="linenos">1699</span></a>        <span class="n">parent_group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1700"><a href="#GuacamoleDB.create_connection-1700"><span class="linenos">1700</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection-1701"><a href="#GuacamoleDB.create_connection-1701"><span class="linenos">1701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new connection in the Guacamole database.</span>
</span><span id="GuacamoleDB.create_connection-1702"><a href="#GuacamoleDB.create_connection-1702"><span class="linenos">1702</span></a>
</span><span id="GuacamoleDB.create_connection-1703"><a href="#GuacamoleDB.create_connection-1703"><span class="linenos">1703</span></a><span class="sd">        Creates a new connection with basic parameters. Currently designed</span>
</span><span id="GuacamoleDB.create_connection-1704"><a href="#GuacamoleDB.create_connection-1704"><span class="linenos">1704</span></a><span class="sd">        for VNC connections but can be extended for other protocols.</span>
</span><span id="GuacamoleDB.create_connection-1705"><a href="#GuacamoleDB.create_connection-1705"><span class="linenos">1705</span></a>
</span><span id="GuacamoleDB.create_connection-1706"><a href="#GuacamoleDB.create_connection-1706"><span class="linenos">1706</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.create_connection-1707"><a href="#GuacamoleDB.create_connection-1707"><span class="linenos">1707</span></a><span class="sd">            connection_type: The connection protocol (e.g., &#39;vnc&#39;, &#39;rdp&#39;, &#39;ssh&#39;).</span>
</span><span id="GuacamoleDB.create_connection-1708"><a href="#GuacamoleDB.create_connection-1708"><span class="linenos">1708</span></a><span class="sd">            connection_name: The name for the new connection.</span>
</span><span id="GuacamoleDB.create_connection-1709"><a href="#GuacamoleDB.create_connection-1709"><span class="linenos">1709</span></a><span class="sd">            hostname: The hostname or IP address of the target server.</span>
</span><span id="GuacamoleDB.create_connection-1710"><a href="#GuacamoleDB.create_connection-1710"><span class="linenos">1710</span></a><span class="sd">            port: The port number for the connection.</span>
</span><span id="GuacamoleDB.create_connection-1711"><a href="#GuacamoleDB.create_connection-1711"><span class="linenos">1711</span></a><span class="sd">            vnc_password: The password for VNC authentication.</span>
</span><span id="GuacamoleDB.create_connection-1712"><a href="#GuacamoleDB.create_connection-1712"><span class="linenos">1712</span></a><span class="sd">            parent_group_id: Optional parent connection group ID.</span>
</span><span id="GuacamoleDB.create_connection-1713"><a href="#GuacamoleDB.create_connection-1713"><span class="linenos">1713</span></a>
</span><span id="GuacamoleDB.create_connection-1714"><a href="#GuacamoleDB.create_connection-1714"><span class="linenos">1714</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.create_connection-1715"><a href="#GuacamoleDB.create_connection-1715"><span class="linenos">1715</span></a><span class="sd">            The ID of the newly created connection.</span>
</span><span id="GuacamoleDB.create_connection-1716"><a href="#GuacamoleDB.create_connection-1716"><span class="linenos">1716</span></a>
</span><span id="GuacamoleDB.create_connection-1717"><a href="#GuacamoleDB.create_connection-1717"><span class="linenos">1717</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.create_connection-1718"><a href="#GuacamoleDB.create_connection-1718"><span class="linenos">1718</span></a><span class="sd">            ValueError: If required parameters are missing or connection already exists.</span>
</span><span id="GuacamoleDB.create_connection-1719"><a href="#GuacamoleDB.create_connection-1719"><span class="linenos">1719</span></a><span class="sd">            mysql.connector.Error: If database operations fail.</span>
</span><span id="GuacamoleDB.create_connection-1720"><a href="#GuacamoleDB.create_connection-1720"><span class="linenos">1720</span></a>
</span><span id="GuacamoleDB.create_connection-1721"><a href="#GuacamoleDB.create_connection-1721"><span class="linenos">1721</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.create_connection-1722"><a href="#GuacamoleDB.create_connection-1722"><span class="linenos">1722</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.create_connection-1723"><a href="#GuacamoleDB.create_connection-1723"><span class="linenos">1723</span></a><span class="sd">            ...     conn_id = db.create_connection(</span>
</span><span id="GuacamoleDB.create_connection-1724"><a href="#GuacamoleDB.create_connection-1724"><span class="linenos">1724</span></a><span class="sd">            ...         &#39;vnc&#39;, &#39;server1&#39;, &#39;192.168.1.100&#39;, 5901, &#39;password&#39;</span>
</span><span id="GuacamoleDB.create_connection-1725"><a href="#GuacamoleDB.create_connection-1725"><span class="linenos">1725</span></a><span class="sd">            ...     )</span>
</span><span id="GuacamoleDB.create_connection-1726"><a href="#GuacamoleDB.create_connection-1726"><span class="linenos">1726</span></a><span class="sd">            ...     print(f&quot;Created connection with ID: {conn_id}&quot;)</span>
</span><span id="GuacamoleDB.create_connection-1727"><a href="#GuacamoleDB.create_connection-1727"><span class="linenos">1727</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection-1728"><a href="#GuacamoleDB.create_connection-1728"><span class="linenos">1728</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">connection_name</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">port</span><span class="p">]):</span>
</span><span id="GuacamoleDB.create_connection-1729"><a href="#GuacamoleDB.create_connection-1729"><span class="linenos">1729</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing required connection parameters&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_connection-1730"><a href="#GuacamoleDB.create_connection-1730"><span class="linenos">1730</span></a>
</span><span id="GuacamoleDB.create_connection-1731"><a href="#GuacamoleDB.create_connection-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_exists</span><span class="p">(</span><span class="n">connection_name</span><span class="p">):</span>
</span><span id="GuacamoleDB.create_connection-1732"><a href="#GuacamoleDB.create_connection-1732"><span class="linenos">1732</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; already exists&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_connection-1733"><a href="#GuacamoleDB.create_connection-1733"><span class="linenos">1733</span></a>
</span><span id="GuacamoleDB.create_connection-1734"><a href="#GuacamoleDB.create_connection-1734"><span class="linenos">1734</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection-1735"><a href="#GuacamoleDB.create_connection-1735"><span class="linenos">1735</span></a>            <span class="c1"># Create connection</span>
</span><span id="GuacamoleDB.create_connection-1736"><a href="#GuacamoleDB.create_connection-1736"><span class="linenos">1736</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection-1737"><a href="#GuacamoleDB.create_connection-1737"><span class="linenos">1737</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection-1738"><a href="#GuacamoleDB.create_connection-1738"><span class="linenos">1738</span></a><span class="sd">                INSERT INTO guacamole_connection</span>
</span><span id="GuacamoleDB.create_connection-1739"><a href="#GuacamoleDB.create_connection-1739"><span class="linenos">1739</span></a><span class="sd">                (connection_name, protocol, parent_id)</span>
</span><span id="GuacamoleDB.create_connection-1740"><a href="#GuacamoleDB.create_connection-1740"><span class="linenos">1740</span></a><span class="sd">                VALUES (%s, %s, %s)</span>
</span><span id="GuacamoleDB.create_connection-1741"><a href="#GuacamoleDB.create_connection-1741"><span class="linenos">1741</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1742"><a href="#GuacamoleDB.create_connection-1742"><span class="linenos">1742</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,</span> <span class="n">connection_type</span><span class="p">,</span> <span class="n">parent_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.create_connection-1743"><a href="#GuacamoleDB.create_connection-1743"><span class="linenos">1743</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection-1744"><a href="#GuacamoleDB.create_connection-1744"><span class="linenos">1744</span></a>
</span><span id="GuacamoleDB.create_connection-1745"><a href="#GuacamoleDB.create_connection-1745"><span class="linenos">1745</span></a>            <span class="c1"># Get connection_id</span>
</span><span id="GuacamoleDB.create_connection-1746"><a href="#GuacamoleDB.create_connection-1746"><span class="linenos">1746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection-1747"><a href="#GuacamoleDB.create_connection-1747"><span class="linenos">1747</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection-1748"><a href="#GuacamoleDB.create_connection-1748"><span class="linenos">1748</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB.create_connection-1749"><a href="#GuacamoleDB.create_connection-1749"><span class="linenos">1749</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB.create_connection-1750"><a href="#GuacamoleDB.create_connection-1750"><span class="linenos">1750</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1751"><a href="#GuacamoleDB.create_connection-1751"><span class="linenos">1751</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.create_connection-1752"><a href="#GuacamoleDB.create_connection-1752"><span class="linenos">1752</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection-1753"><a href="#GuacamoleDB.create_connection-1753"><span class="linenos">1753</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.create_connection-1754"><a href="#GuacamoleDB.create_connection-1754"><span class="linenos">1754</span></a>
</span><span id="GuacamoleDB.create_connection-1755"><a href="#GuacamoleDB.create_connection-1755"><span class="linenos">1755</span></a>            <span class="c1"># Create connection parameters</span>
</span><span id="GuacamoleDB.create_connection-1756"><a href="#GuacamoleDB.create_connection-1756"><span class="linenos">1756</span></a>            <span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="GuacamoleDB.create_connection-1757"><a href="#GuacamoleDB.create_connection-1757"><span class="linenos">1757</span></a>                <span class="p">(</span><span class="s2">&quot;hostname&quot;</span><span class="p">,</span> <span class="n">hostname</span><span class="p">),</span>
</span><span id="GuacamoleDB.create_connection-1758"><a href="#GuacamoleDB.create_connection-1758"><span class="linenos">1758</span></a>                <span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span>
</span><span id="GuacamoleDB.create_connection-1759"><a href="#GuacamoleDB.create_connection-1759"><span class="linenos">1759</span></a>                <span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="n">vnc_password</span><span class="p">),</span>
</span><span id="GuacamoleDB.create_connection-1760"><a href="#GuacamoleDB.create_connection-1760"><span class="linenos">1760</span></a>            <span class="p">]</span>
</span><span id="GuacamoleDB.create_connection-1761"><a href="#GuacamoleDB.create_connection-1761"><span class="linenos">1761</span></a>
</span><span id="GuacamoleDB.create_connection-1762"><a href="#GuacamoleDB.create_connection-1762"><span class="linenos">1762</span></a>            <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection-1763"><a href="#GuacamoleDB.create_connection-1763"><span class="linenos">1763</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection-1764"><a href="#GuacamoleDB.create_connection-1764"><span class="linenos">1764</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection-1765"><a href="#GuacamoleDB.create_connection-1765"><span class="linenos">1765</span></a><span class="sd">                    INSERT INTO guacamole_connection_parameter</span>
</span><span id="GuacamoleDB.create_connection-1766"><a href="#GuacamoleDB.create_connection-1766"><span class="linenos">1766</span></a><span class="sd">                    (connection_id, parameter_name, parameter_value)</span>
</span><span id="GuacamoleDB.create_connection-1767"><a href="#GuacamoleDB.create_connection-1767"><span class="linenos">1767</span></a><span class="sd">                    VALUES (%s, %s, %s)</span>
</span><span id="GuacamoleDB.create_connection-1768"><a href="#GuacamoleDB.create_connection-1768"><span class="linenos">1768</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection-1769"><a href="#GuacamoleDB.create_connection-1769"><span class="linenos">1769</span></a>                    <span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span><span class="p">),</span>
</span><span id="GuacamoleDB.create_connection-1770"><a href="#GuacamoleDB.create_connection-1770"><span class="linenos">1770</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection-1771"><a href="#GuacamoleDB.create_connection-1771"><span class="linenos">1771</span></a>
</span><span id="GuacamoleDB.create_connection-1772"><a href="#GuacamoleDB.create_connection-1772"><span class="linenos">1772</span></a>            <span class="k">return</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB.create_connection-1773"><a href="#GuacamoleDB.create_connection-1773"><span class="linenos">1773</span></a>
</span><span id="GuacamoleDB.create_connection-1774"><a href="#GuacamoleDB.create_connection-1774"><span class="linenos">1774</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection-1775"><a href="#GuacamoleDB.create_connection-1775"><span class="linenos">1775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating VNC connection: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_connection-1776"><a href="#GuacamoleDB.create_connection-1776"><span class="linenos">1776</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Create a new connection in the Guacamole database.</p>

<p>Creates a new connection with basic parameters. Currently designed
for VNC connections but can be extended for other protocols.</p>

<p>Args:
    connection_type: The connection protocol (e.g., 'vnc', 'rdp', 'ssh').
    connection_name: The name for the new connection.
    hostname: The hostname or IP address of the target server.
    port: The port number for the connection.
    vnc_password: The password for VNC authentication.
    parent_group_id: Optional parent connection group ID.</p>

<p>Returns:
    The ID of the newly created connection.</p>

<p>Raises:
    ValueError: If required parameters are missing or connection already exists.
    mysql.connector.Error: If database operations fail.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     conn_id = db.create_connection(
          ...         'vnc', 'server1', '192.168.1.100', 5901, 'password'
          ...     )
          ...     print(f"Created connection with ID: {conn_id}")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.grant_connection_permission" class="classattr">
                                        <input id="GuacamoleDB.grant_connection_permission-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grant_connection_permission</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">entity_name</span>, </span><span class="param"><span class="n">entity_type</span>, </span><span class="param"><span class="n">connection_id</span>, </span><span class="param"><span class="n">group_path</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GuacamoleDB.grant_connection_permission-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.grant_connection_permission"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.grant_connection_permission-1778"><a href="#GuacamoleDB.grant_connection_permission-1778"><span class="linenos">1778</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_permission</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission-1779"><a href="#GuacamoleDB.grant_connection_permission-1779"><span class="linenos">1779</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">,</span> <span class="n">group_path</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GuacamoleDB.grant_connection_permission-1780"><a href="#GuacamoleDB.grant_connection_permission-1780"><span class="linenos">1780</span></a>    <span class="p">):</span>
</span><span id="GuacamoleDB.grant_connection_permission-1781"><a href="#GuacamoleDB.grant_connection_permission-1781"><span class="linenos">1781</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission-1782"><a href="#GuacamoleDB.grant_connection_permission-1782"><span class="linenos">1782</span></a>            <span class="k">if</span> <span class="n">group_path</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission-1783"><a href="#GuacamoleDB.grant_connection_permission-1783"><span class="linenos">1783</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing group path: </span><span class="si">{</span><span class="n">group_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1784"><a href="#GuacamoleDB.grant_connection_permission-1784"><span class="linenos">1784</span></a>                <span class="n">parent_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_id</span><span class="p">(</span><span class="n">group_path</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1785"><a href="#GuacamoleDB.grant_connection_permission-1785"><span class="linenos">1785</span></a>
</span><span id="GuacamoleDB.grant_connection_permission-1786"><a href="#GuacamoleDB.grant_connection_permission-1786"><span class="linenos">1786</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission-1787"><a href="#GuacamoleDB.grant_connection_permission-1787"><span class="linenos">1787</span></a>                    <span class="sa">f</span><span class="s2">&quot;Assigning connection </span><span class="si">{</span><span class="n">connection_id</span><span class="si">}</span><span class="s2"> to parent group </span><span class="si">{</span><span class="n">parent_group_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission-1788"><a href="#GuacamoleDB.grant_connection_permission-1788"><span class="linenos">1788</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1789"><a href="#GuacamoleDB.grant_connection_permission-1789"><span class="linenos">1789</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission-1790"><a href="#GuacamoleDB.grant_connection_permission-1790"><span class="linenos">1790</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission-1791"><a href="#GuacamoleDB.grant_connection_permission-1791"><span class="linenos">1791</span></a><span class="sd">                    UPDATE guacamole_connection</span>
</span><span id="GuacamoleDB.grant_connection_permission-1792"><a href="#GuacamoleDB.grant_connection_permission-1792"><span class="linenos">1792</span></a><span class="sd">                    SET parent_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_permission-1793"><a href="#GuacamoleDB.grant_connection_permission-1793"><span class="linenos">1793</span></a><span class="sd">                    WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_permission-1794"><a href="#GuacamoleDB.grant_connection_permission-1794"><span class="linenos">1794</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_permission-1795"><a href="#GuacamoleDB.grant_connection_permission-1795"><span class="linenos">1795</span></a>                    <span class="p">(</span><span class="n">parent_group_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_permission-1796"><a href="#GuacamoleDB.grant_connection_permission-1796"><span class="linenos">1796</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1797"><a href="#GuacamoleDB.grant_connection_permission-1797"><span class="linenos">1797</span></a>
</span><span id="GuacamoleDB.grant_connection_permission-1798"><a href="#GuacamoleDB.grant_connection_permission-1798"><span class="linenos">1798</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Granting permission to </span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1799"><a href="#GuacamoleDB.grant_connection_permission-1799"><span class="linenos">1799</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission-1800"><a href="#GuacamoleDB.grant_connection_permission-1800"><span class="linenos">1800</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission-1801"><a href="#GuacamoleDB.grant_connection_permission-1801"><span class="linenos">1801</span></a><span class="sd">                INSERT INTO guacamole_connection_permission (entity_id, connection_id, permission)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1802"><a href="#GuacamoleDB.grant_connection_permission-1802"><span class="linenos">1802</span></a><span class="sd">                SELECT entity.entity_id, %s, &#39;READ&#39;</span>
</span><span id="GuacamoleDB.grant_connection_permission-1803"><a href="#GuacamoleDB.grant_connection_permission-1803"><span class="linenos">1803</span></a><span class="sd">                FROM guacamole_entity entity</span>
</span><span id="GuacamoleDB.grant_connection_permission-1804"><a href="#GuacamoleDB.grant_connection_permission-1804"><span class="linenos">1804</span></a><span class="sd">                WHERE entity.name = %s AND entity.type = %s</span>
</span><span id="GuacamoleDB.grant_connection_permission-1805"><a href="#GuacamoleDB.grant_connection_permission-1805"><span class="linenos">1805</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_permission-1806"><a href="#GuacamoleDB.grant_connection_permission-1806"><span class="linenos">1806</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_permission-1807"><a href="#GuacamoleDB.grant_connection_permission-1807"><span class="linenos">1807</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1808"><a href="#GuacamoleDB.grant_connection_permission-1808"><span class="linenos">1808</span></a>
</span><span id="GuacamoleDB.grant_connection_permission-1809"><a href="#GuacamoleDB.grant_connection_permission-1809"><span class="linenos">1809</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission-1810"><a href="#GuacamoleDB.grant_connection_permission-1810"><span class="linenos">1810</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error granting connection permission: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission-1811"><a href="#GuacamoleDB.grant_connection_permission-1811"><span class="linenos">1811</span></a>            <span class="k">raise</span>
</span></pre></div>


    

                            </div>
                            <div id="GuacamoleDB.list_users_with_usergroups" class="classattr">
                                        <input id="GuacamoleDB.list_users_with_usergroups-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_users_with_usergroups</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.list_users_with_usergroups-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.list_users_with_usergroups"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.list_users_with_usergroups-1813"><a href="#GuacamoleDB.list_users_with_usergroups-1813"><span class="linenos">1813</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_users_with_usergroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1814"><a href="#GuacamoleDB.list_users_with_usergroups-1814"><span class="linenos">1814</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all users with their associated user group memberships.</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1815"><a href="#GuacamoleDB.list_users_with_usergroups-1815"><span class="linenos">1815</span></a>
</span><span id="GuacamoleDB.list_users_with_usergroups-1816"><a href="#GuacamoleDB.list_users_with_usergroups-1816"><span class="linenos">1816</span></a><span class="sd">        Retrieves a comprehensive mapping of all users in the system and the</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1817"><a href="#GuacamoleDB.list_users_with_usergroups-1817"><span class="linenos">1817</span></a><span class="sd">        user groups they belong to. This provides a complete view of user</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1818"><a href="#GuacamoleDB.list_users_with_usergroups-1818"><span class="linenos">1818</span></a><span class="sd">        group memberships for reporting and analysis.</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1819"><a href="#GuacamoleDB.list_users_with_usergroups-1819"><span class="linenos">1819</span></a>
</span><span id="GuacamoleDB.list_users_with_usergroups-1820"><a href="#GuacamoleDB.list_users_with_usergroups-1820"><span class="linenos">1820</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1821"><a href="#GuacamoleDB.list_users_with_usergroups-1821"><span class="linenos">1821</span></a><span class="sd">            Dict[str, List[str]]: Mapping of usernames to lists of user group names.</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1822"><a href="#GuacamoleDB.list_users_with_usergroups-1822"><span class="linenos">1822</span></a><span class="sd">                Users with no group memberships will have an empty list.</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1823"><a href="#GuacamoleDB.list_users_with_usergroups-1823"><span class="linenos">1823</span></a>
</span><span id="GuacamoleDB.list_users_with_usergroups-1824"><a href="#GuacamoleDB.list_users_with_usergroups-1824"><span class="linenos">1824</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1825"><a href="#GuacamoleDB.list_users_with_usergroups-1825"><span class="linenos">1825</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1826"><a href="#GuacamoleDB.list_users_with_usergroups-1826"><span class="linenos">1826</span></a>
</span><span id="GuacamoleDB.list_users_with_usergroups-1827"><a href="#GuacamoleDB.list_users_with_usergroups-1827"><span class="linenos">1827</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1828"><a href="#GuacamoleDB.list_users_with_usergroups-1828"><span class="linenos">1828</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1829"><a href="#GuacamoleDB.list_users_with_usergroups-1829"><span class="linenos">1829</span></a><span class="sd">            ...     users = db.list_users_with_usergroups()</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1830"><a href="#GuacamoleDB.list_users_with_usergroups-1830"><span class="linenos">1830</span></a><span class="sd">            ...     for username, groups in users.items():</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1831"><a href="#GuacamoleDB.list_users_with_usergroups-1831"><span class="linenos">1831</span></a><span class="sd">            ...         print(f&quot;{username}: {groups}&quot;)</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1832"><a href="#GuacamoleDB.list_users_with_usergroups-1832"><span class="linenos">1832</span></a><span class="sd">            john.doe: [&#39;admin&#39;, &#39;developers&#39;]</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1833"><a href="#GuacamoleDB.list_users_with_usergroups-1833"><span class="linenos">1833</span></a><span class="sd">            jane.smith: [&#39;users&#39;]</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1834"><a href="#GuacamoleDB.list_users_with_usergroups-1834"><span class="linenos">1834</span></a><span class="sd">            guest: []</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1835"><a href="#GuacamoleDB.list_users_with_usergroups-1835"><span class="linenos">1835</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1836"><a href="#GuacamoleDB.list_users_with_usergroups-1836"><span class="linenos">1836</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1837"><a href="#GuacamoleDB.list_users_with_usergroups-1837"><span class="linenos">1837</span></a><span class="s2">            SELECT DISTINCT </span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1838"><a href="#GuacamoleDB.list_users_with_usergroups-1838"><span class="linenos">1838</span></a><span class="s2">                e1.name as username,</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1839"><a href="#GuacamoleDB.list_users_with_usergroups-1839"><span class="linenos">1839</span></a><span class="s2">                GROUP_CONCAT(e2.name) as groupnames</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1840"><a href="#GuacamoleDB.list_users_with_usergroups-1840"><span class="linenos">1840</span></a><span class="s2">            FROM guacamole_entity e1</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1841"><a href="#GuacamoleDB.list_users_with_usergroups-1841"><span class="linenos">1841</span></a><span class="s2">            JOIN guacamole_user u ON e1.entity_id = u.entity_id</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1842"><a href="#GuacamoleDB.list_users_with_usergroups-1842"><span class="linenos">1842</span></a><span class="s2">            LEFT JOIN guacamole_user_group_member ugm </span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1843"><a href="#GuacamoleDB.list_users_with_usergroups-1843"><span class="linenos">1843</span></a><span class="s2">                ON e1.entity_id = ugm.member_entity_id</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1844"><a href="#GuacamoleDB.list_users_with_usergroups-1844"><span class="linenos">1844</span></a><span class="s2">            LEFT JOIN guacamole_user_group ug</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1845"><a href="#GuacamoleDB.list_users_with_usergroups-1845"><span class="linenos">1845</span></a><span class="s2">                ON ugm.user_group_id = ug.user_group_id</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1846"><a href="#GuacamoleDB.list_users_with_usergroups-1846"><span class="linenos">1846</span></a><span class="s2">            LEFT JOIN guacamole_entity e2</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1847"><a href="#GuacamoleDB.list_users_with_usergroups-1847"><span class="linenos">1847</span></a><span class="s2">                ON ug.entity_id = e2.entity_id</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1848"><a href="#GuacamoleDB.list_users_with_usergroups-1848"><span class="linenos">1848</span></a><span class="s2">            WHERE e1.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1849"><a href="#GuacamoleDB.list_users_with_usergroups-1849"><span class="linenos">1849</span></a><span class="s2">            GROUP BY e1.name</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1850"><a href="#GuacamoleDB.list_users_with_usergroups-1850"><span class="linenos">1850</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1851"><a href="#GuacamoleDB.list_users_with_usergroups-1851"><span class="linenos">1851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1852"><a href="#GuacamoleDB.list_users_with_usergroups-1852"><span class="linenos">1852</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1853"><a href="#GuacamoleDB.list_users_with_usergroups-1853"><span class="linenos">1853</span></a>
</span><span id="GuacamoleDB.list_users_with_usergroups-1854"><a href="#GuacamoleDB.list_users_with_usergroups-1854"><span class="linenos">1854</span></a>        <span class="n">users_groups</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1855"><a href="#GuacamoleDB.list_users_with_usergroups-1855"><span class="linenos">1855</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1856"><a href="#GuacamoleDB.list_users_with_usergroups-1856"><span class="linenos">1856</span></a>            <span class="n">username</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1857"><a href="#GuacamoleDB.list_users_with_usergroups-1857"><span class="linenos">1857</span></a>            <span class="n">groupnames</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1858"><a href="#GuacamoleDB.list_users_with_usergroups-1858"><span class="linenos">1858</span></a>            <span class="n">users_groups</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">groupnames</span>
</span><span id="GuacamoleDB.list_users_with_usergroups-1859"><a href="#GuacamoleDB.list_users_with_usergroups-1859"><span class="linenos">1859</span></a>
</span><span id="GuacamoleDB.list_users_with_usergroups-1860"><a href="#GuacamoleDB.list_users_with_usergroups-1860"><span class="linenos">1860</span></a>        <span class="k">return</span> <span class="n">users_groups</span>
</span></pre></div>


            <div class="docstring"><p>List all users with their associated user group memberships.</p>

<p>Retrieves a comprehensive mapping of all users in the system and the
user groups they belong to. This provides a complete view of user
group memberships for reporting and analysis.</p>

<p>Returns:
    Dict[str, List[str]]: Mapping of usernames to lists of user group names.
        Users with no group memberships will have an empty list.</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     users = db.list_users_with_usergroups()
          ...     for username, groups in users.items():
          ...         print(f"{username}: {groups}")
          john.doe: ['admin', 'developers']
          jane.smith: ['users']
          guest: []</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.list_connections_with_conngroups_and_parents" class="classattr">
                                        <input id="GuacamoleDB.list_connections_with_conngroups_and_parents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_connections_with_conngroups_and_parents</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.list_connections_with_conngroups_and_parents-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.list_connections_with_conngroups_and_parents"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1862"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1862"><span class="linenos">1862</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_connections_with_conngroups_and_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConnectionInfo</span><span class="p">]:</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1863"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1863"><span class="linenos">1863</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all connections with their groups, parent group, and user permissions&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1864"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1864"><span class="linenos">1864</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1865"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1865"><span class="linenos">1865</span></a>            <span class="c1"># Get basic connection info with groups</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1866"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1866"><span class="linenos">1866</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1867"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1867"><span class="linenos">1867</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1868"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1868"><span class="linenos">1868</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1869"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1869"><span class="linenos">1869</span></a><span class="sd">                    c.connection_id,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1870"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1870"><span class="linenos">1870</span></a><span class="sd">                    c.connection_name,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1871"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1871"><span class="linenos">1871</span></a><span class="sd">                    c.protocol,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1872"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1872"><span class="linenos">1872</span></a><span class="sd">                    MAX(CASE WHEN p1.parameter_name = &#39;hostname&#39; THEN p1.parameter_value END) AS hostname,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1873"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1873"><span class="linenos">1873</span></a><span class="sd">                    MAX(CASE WHEN p2.parameter_name = &#39;port&#39; THEN p2.parameter_value END) AS port,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1874"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1874"><span class="linenos">1874</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT CASE WHEN e.type = &#39;USER_GROUP&#39; THEN e.name END) AS groups,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1875"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1875"><span class="linenos">1875</span></a><span class="sd">                    cg.connection_group_name AS parent</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1876"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1876"><span class="linenos">1876</span></a><span class="sd">                FROM guacamole_connection c</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1877"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1877"><span class="linenos">1877</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p1 </span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1878"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1878"><span class="linenos">1878</span></a><span class="sd">                    ON c.connection_id = p1.connection_id AND p1.parameter_name = &#39;hostname&#39;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1879"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1879"><span class="linenos">1879</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p2 </span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1880"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1880"><span class="linenos">1880</span></a><span class="sd">                    ON c.connection_id = p2.connection_id AND p2.parameter_name = &#39;port&#39;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1881"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1881"><span class="linenos">1881</span></a><span class="sd">                LEFT JOIN guacamole_connection_permission cp </span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1882"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1882"><span class="linenos">1882</span></a><span class="sd">                    ON c.connection_id = cp.connection_id</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1883"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1883"><span class="linenos">1883</span></a><span class="sd">                LEFT JOIN guacamole_entity e </span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1884"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1884"><span class="linenos">1884</span></a><span class="sd">                    ON cp.entity_id = e.entity_id AND e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1885"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1885"><span class="linenos">1885</span></a><span class="sd">                LEFT JOIN guacamole_connection_group cg</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1886"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1886"><span class="linenos">1886</span></a><span class="sd">                    ON c.parent_id = cg.connection_group_id</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1887"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1887"><span class="linenos">1887</span></a><span class="sd">                GROUP BY c.connection_id</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1888"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1888"><span class="linenos">1888</span></a><span class="sd">                ORDER BY c.connection_name</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1889"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1889"><span class="linenos">1889</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1890"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1890"><span class="linenos">1890</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1891"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1891"><span class="linenos">1891</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1892"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1892"><span class="linenos">1892</span></a>            <span class="n">connections_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1893"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1893"><span class="linenos">1893</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1894"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1894"><span class="linenos">1894</span></a>            <span class="c1"># Create a mapping of connection names to connection IDs</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1895"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1895"><span class="linenos">1895</span></a>            <span class="n">connection_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1896"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1896"><span class="linenos">1896</span></a>                <span class="n">name</span><span class="p">:</span> <span class="n">conn_id</span> <span class="k">for</span> <span class="n">conn_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">connections_info</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1897"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1897"><span class="linenos">1897</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1898"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1898"><span class="linenos">1898</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1899"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1899"><span class="linenos">1899</span></a>            <span class="c1"># Now prepare the result array</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1900"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1900"><span class="linenos">1900</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1901"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1901"><span class="linenos">1901</span></a>            <span class="k">for</span> <span class="n">conn_info</span> <span class="ow">in</span> <span class="n">connections_info</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1902"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1902"><span class="linenos">1902</span></a>                <span class="n">conn_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">conn_info</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1903"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1903"><span class="linenos">1903</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1904"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1904"><span class="linenos">1904</span></a>                <span class="c1"># Get user permissions for this connection - THIS IS THE KEY CHANGE</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1905"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1905"><span class="linenos">1905</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1906"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1906"><span class="linenos">1906</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1907"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1907"><span class="linenos">1907</span></a><span class="sd">                    SELECT e.name</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1908"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1908"><span class="linenos">1908</span></a><span class="sd">                    FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1909"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1909"><span class="linenos">1909</span></a><span class="sd">                    JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1910"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1910"><span class="linenos">1910</span></a><span class="sd">                    WHERE cp.connection_id = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1911"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1911"><span class="linenos">1911</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1912"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1912"><span class="linenos">1912</span></a>                    <span class="p">(</span><span class="n">conn_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1913"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1913"><span class="linenos">1913</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1914"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1914"><span class="linenos">1914</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1915"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1915"><span class="linenos">1915</span></a>                <span class="n">user_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1916"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1916"><span class="linenos">1916</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1917"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1917"><span class="linenos">1917</span></a>                <span class="c1"># Append user permissions to the connection info (include connection_id)</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1918"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1918"><span class="linenos">1918</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1919"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1919"><span class="linenos">1919</span></a>                    <span class="p">(</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1920"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1920"><span class="linenos">1920</span></a>                        <span class="n">conn_id</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1921"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1921"><span class="linenos">1921</span></a>                        <span class="n">name</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1922"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1922"><span class="linenos">1922</span></a>                        <span class="n">protocol</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1923"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1923"><span class="linenos">1923</span></a>                        <span class="n">host</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1924"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1924"><span class="linenos">1924</span></a>                        <span class="n">port</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1925"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1925"><span class="linenos">1925</span></a>                        <span class="n">groups</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1926"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1926"><span class="linenos">1926</span></a>                        <span class="n">parent</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1927"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1927"><span class="linenos">1927</span></a>                        <span class="n">user_permissions</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1928"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1928"><span class="linenos">1928</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1929"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1929"><span class="linenos">1929</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1930"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1930"><span class="linenos">1930</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1931"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1931"><span class="linenos">1931</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1932"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1932"><span class="linenos">1932</span></a>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1933"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1933"><span class="linenos">1933</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1934"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1934"><span class="linenos">1934</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing connections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.list_connections_with_conngroups_and_parents-1935"><a href="#GuacamoleDB.list_connections_with_conngroups_and_parents-1935"><span class="linenos">1935</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>List all connections with their groups, parent group, and user permissions</p>
</div>


                            </div>
                            <div id="GuacamoleDB.get_connection_by_id" class="classattr">
                                        <input id="GuacamoleDB.get_connection_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_connection_by_id</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">connection_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_connection_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_connection_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_connection_by_id-1937"><a href="#GuacamoleDB.get_connection_by_id-1937"><span class="linenos">1937</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConnectionInfo</span><span class="p">]:</span>
</span><span id="GuacamoleDB.get_connection_by_id-1938"><a href="#GuacamoleDB.get_connection_by_id-1938"><span class="linenos">1938</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a specific connection by its ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_by_id-1939"><a href="#GuacamoleDB.get_connection_by_id-1939"><span class="linenos">1939</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_by_id-1940"><a href="#GuacamoleDB.get_connection_by_id-1940"><span class="linenos">1940</span></a>            <span class="c1"># Get basic connection info with groups</span>
</span><span id="GuacamoleDB.get_connection_by_id-1941"><a href="#GuacamoleDB.get_connection_by_id-1941"><span class="linenos">1941</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_by_id-1942"><a href="#GuacamoleDB.get_connection_by_id-1942"><span class="linenos">1942</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_by_id-1943"><a href="#GuacamoleDB.get_connection_by_id-1943"><span class="linenos">1943</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB.get_connection_by_id-1944"><a href="#GuacamoleDB.get_connection_by_id-1944"><span class="linenos">1944</span></a><span class="sd">                    c.connection_id,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1945"><a href="#GuacamoleDB.get_connection_by_id-1945"><span class="linenos">1945</span></a><span class="sd">                    c.connection_name,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1946"><a href="#GuacamoleDB.get_connection_by_id-1946"><span class="linenos">1946</span></a><span class="sd">                    c.protocol,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1947"><a href="#GuacamoleDB.get_connection_by_id-1947"><span class="linenos">1947</span></a><span class="sd">                    MAX(CASE WHEN p1.parameter_name = &#39;hostname&#39; THEN p1.parameter_value END) AS hostname,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1948"><a href="#GuacamoleDB.get_connection_by_id-1948"><span class="linenos">1948</span></a><span class="sd">                    MAX(CASE WHEN p2.parameter_name = &#39;port&#39; THEN p2.parameter_value END) AS port,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1949"><a href="#GuacamoleDB.get_connection_by_id-1949"><span class="linenos">1949</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT CASE WHEN e.type = &#39;USER_GROUP&#39; THEN e.name END) AS groups,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1950"><a href="#GuacamoleDB.get_connection_by_id-1950"><span class="linenos">1950</span></a><span class="sd">                    cg.connection_group_name AS parent</span>
</span><span id="GuacamoleDB.get_connection_by_id-1951"><a href="#GuacamoleDB.get_connection_by_id-1951"><span class="linenos">1951</span></a><span class="sd">                FROM guacamole_connection c</span>
</span><span id="GuacamoleDB.get_connection_by_id-1952"><a href="#GuacamoleDB.get_connection_by_id-1952"><span class="linenos">1952</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p1 </span>
</span><span id="GuacamoleDB.get_connection_by_id-1953"><a href="#GuacamoleDB.get_connection_by_id-1953"><span class="linenos">1953</span></a><span class="sd">                    ON c.connection_id = p1.connection_id AND p1.parameter_name = &#39;hostname&#39;</span>
</span><span id="GuacamoleDB.get_connection_by_id-1954"><a href="#GuacamoleDB.get_connection_by_id-1954"><span class="linenos">1954</span></a><span class="sd">                LEFT JOIN guacamole_connection_parameter p2 </span>
</span><span id="GuacamoleDB.get_connection_by_id-1955"><a href="#GuacamoleDB.get_connection_by_id-1955"><span class="linenos">1955</span></a><span class="sd">                    ON c.connection_id = p2.connection_id AND p2.parameter_name = &#39;port&#39;</span>
</span><span id="GuacamoleDB.get_connection_by_id-1956"><a href="#GuacamoleDB.get_connection_by_id-1956"><span class="linenos">1956</span></a><span class="sd">                LEFT JOIN guacamole_connection_permission cp </span>
</span><span id="GuacamoleDB.get_connection_by_id-1957"><a href="#GuacamoleDB.get_connection_by_id-1957"><span class="linenos">1957</span></a><span class="sd">                    ON c.connection_id = cp.connection_id</span>
</span><span id="GuacamoleDB.get_connection_by_id-1958"><a href="#GuacamoleDB.get_connection_by_id-1958"><span class="linenos">1958</span></a><span class="sd">                LEFT JOIN guacamole_entity e </span>
</span><span id="GuacamoleDB.get_connection_by_id-1959"><a href="#GuacamoleDB.get_connection_by_id-1959"><span class="linenos">1959</span></a><span class="sd">                    ON cp.entity_id = e.entity_id AND e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.get_connection_by_id-1960"><a href="#GuacamoleDB.get_connection_by_id-1960"><span class="linenos">1960</span></a><span class="sd">                LEFT JOIN guacamole_connection_group cg</span>
</span><span id="GuacamoleDB.get_connection_by_id-1961"><a href="#GuacamoleDB.get_connection_by_id-1961"><span class="linenos">1961</span></a><span class="sd">                    ON c.parent_id = cg.connection_group_id</span>
</span><span id="GuacamoleDB.get_connection_by_id-1962"><a href="#GuacamoleDB.get_connection_by_id-1962"><span class="linenos">1962</span></a><span class="sd">                WHERE c.connection_id = %s</span>
</span><span id="GuacamoleDB.get_connection_by_id-1963"><a href="#GuacamoleDB.get_connection_by_id-1963"><span class="linenos">1963</span></a><span class="sd">                GROUP BY c.connection_id</span>
</span><span id="GuacamoleDB.get_connection_by_id-1964"><a href="#GuacamoleDB.get_connection_by_id-1964"><span class="linenos">1964</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1965"><a href="#GuacamoleDB.get_connection_by_id-1965"><span class="linenos">1965</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_connection_by_id-1966"><a href="#GuacamoleDB.get_connection_by_id-1966"><span class="linenos">1966</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_by_id-1967"><a href="#GuacamoleDB.get_connection_by_id-1967"><span class="linenos">1967</span></a>
</span><span id="GuacamoleDB.get_connection_by_id-1968"><a href="#GuacamoleDB.get_connection_by_id-1968"><span class="linenos">1968</span></a>            <span class="n">connection_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_connection_by_id-1969"><a href="#GuacamoleDB.get_connection_by_id-1969"><span class="linenos">1969</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">connection_info</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_by_id-1970"><a href="#GuacamoleDB.get_connection_by_id-1970"><span class="linenos">1970</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.get_connection_by_id-1971"><a href="#GuacamoleDB.get_connection_by_id-1971"><span class="linenos">1971</span></a>
</span><span id="GuacamoleDB.get_connection_by_id-1972"><a href="#GuacamoleDB.get_connection_by_id-1972"><span class="linenos">1972</span></a>            <span class="n">conn_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">connection_info</span>
</span><span id="GuacamoleDB.get_connection_by_id-1973"><a href="#GuacamoleDB.get_connection_by_id-1973"><span class="linenos">1973</span></a>
</span><span id="GuacamoleDB.get_connection_by_id-1974"><a href="#GuacamoleDB.get_connection_by_id-1974"><span class="linenos">1974</span></a>            <span class="c1"># Get user permissions for this connection</span>
</span><span id="GuacamoleDB.get_connection_by_id-1975"><a href="#GuacamoleDB.get_connection_by_id-1975"><span class="linenos">1975</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_by_id-1976"><a href="#GuacamoleDB.get_connection_by_id-1976"><span class="linenos">1976</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_by_id-1977"><a href="#GuacamoleDB.get_connection_by_id-1977"><span class="linenos">1977</span></a><span class="sd">                SELECT e.name</span>
</span><span id="GuacamoleDB.get_connection_by_id-1978"><a href="#GuacamoleDB.get_connection_by_id-1978"><span class="linenos">1978</span></a><span class="sd">                FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB.get_connection_by_id-1979"><a href="#GuacamoleDB.get_connection_by_id-1979"><span class="linenos">1979</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB.get_connection_by_id-1980"><a href="#GuacamoleDB.get_connection_by_id-1980"><span class="linenos">1980</span></a><span class="sd">                WHERE cp.connection_id = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.get_connection_by_id-1981"><a href="#GuacamoleDB.get_connection_by_id-1981"><span class="linenos">1981</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1982"><a href="#GuacamoleDB.get_connection_by_id-1982"><span class="linenos">1982</span></a>                <span class="p">(</span><span class="n">conn_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_connection_by_id-1983"><a href="#GuacamoleDB.get_connection_by_id-1983"><span class="linenos">1983</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_by_id-1984"><a href="#GuacamoleDB.get_connection_by_id-1984"><span class="linenos">1984</span></a>
</span><span id="GuacamoleDB.get_connection_by_id-1985"><a href="#GuacamoleDB.get_connection_by_id-1985"><span class="linenos">1985</span></a>            <span class="n">user_permissions</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</span><span id="GuacamoleDB.get_connection_by_id-1986"><a href="#GuacamoleDB.get_connection_by_id-1986"><span class="linenos">1986</span></a>
</span><span id="GuacamoleDB.get_connection_by_id-1987"><a href="#GuacamoleDB.get_connection_by_id-1987"><span class="linenos">1987</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_by_id-1988"><a href="#GuacamoleDB.get_connection_by_id-1988"><span class="linenos">1988</span></a>                <span class="n">conn_id</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1989"><a href="#GuacamoleDB.get_connection_by_id-1989"><span class="linenos">1989</span></a>                <span class="n">name</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1990"><a href="#GuacamoleDB.get_connection_by_id-1990"><span class="linenos">1990</span></a>                <span class="n">protocol</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1991"><a href="#GuacamoleDB.get_connection_by_id-1991"><span class="linenos">1991</span></a>                <span class="n">host</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1992"><a href="#GuacamoleDB.get_connection_by_id-1992"><span class="linenos">1992</span></a>                <span class="n">port</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1993"><a href="#GuacamoleDB.get_connection_by_id-1993"><span class="linenos">1993</span></a>                <span class="n">groups</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1994"><a href="#GuacamoleDB.get_connection_by_id-1994"><span class="linenos">1994</span></a>                <span class="n">parent</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1995"><a href="#GuacamoleDB.get_connection_by_id-1995"><span class="linenos">1995</span></a>                <span class="n">user_permissions</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_by_id-1996"><a href="#GuacamoleDB.get_connection_by_id-1996"><span class="linenos">1996</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_by_id-1997"><a href="#GuacamoleDB.get_connection_by_id-1997"><span class="linenos">1997</span></a>
</span><span id="GuacamoleDB.get_connection_by_id-1998"><a href="#GuacamoleDB.get_connection_by_id-1998"><span class="linenos">1998</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_by_id-1999"><a href="#GuacamoleDB.get_connection_by_id-1999"><span class="linenos">1999</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_by_id-2000"><a href="#GuacamoleDB.get_connection_by_id-2000"><span class="linenos">2000</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Get a specific connection by its ID</p>
</div>


                            </div>
                            <div id="GuacamoleDB.list_usergroups_with_users_and_connections" class="classattr">
                                        <input id="GuacamoleDB.list_usergroups_with_users_and_connections-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_usergroups_with_users_and_connections</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GuacamoleDB.list_usergroups_with_users_and_connections-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.list_usergroups_with_users_and_connections"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2002"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2002"><span class="linenos">2002</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_usergroups_with_users_and_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2003"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2003"><span class="linenos">2003</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all user groups with their associated users and connections.</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2004"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2004"><span class="linenos">2004</span></a>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2005"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2005"><span class="linenos">2005</span></a><span class="sd">        Retrieves a comprehensive mapping of all user groups in the system,</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2006"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2006"><span class="linenos">2006</span></a><span class="sd">        including the users belonging to each group and the connections</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2007"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2007"><span class="linenos">2007</span></a><span class="sd">        accessible to those users through group permissions.</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2008"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2008"><span class="linenos">2008</span></a>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2009"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2009"><span class="linenos">2009</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2010"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2010"><span class="linenos">2010</span></a><span class="sd">            Dict[str, Dict[str, Any]]: Nested dictionary with group names as keys.</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2011"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2011"><span class="linenos">2011</span></a><span class="sd">                Each group dictionary contains:</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2012"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2012"><span class="linenos">2012</span></a><span class="sd">                - id (int): The database ID of the user group</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2013"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2013"><span class="linenos">2013</span></a><span class="sd">                - users (List[str]): List of usernames belonging to the group</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2014"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2014"><span class="linenos">2014</span></a><span class="sd">                - connections (List[str]): List of connection names accessible to the group</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2015"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2015"><span class="linenos">2015</span></a>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2016"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2016"><span class="linenos">2016</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2017"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2017"><span class="linenos">2017</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2018"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2018"><span class="linenos">2018</span></a>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2019"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2019"><span class="linenos">2019</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2020"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2020"><span class="linenos">2020</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2021"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2021"><span class="linenos">2021</span></a><span class="sd">            ...     result = db.list_usergroups_with_users_and_connections()</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2022"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2022"><span class="linenos">2022</span></a><span class="sd">            ...     admin_group = result.get(&#39;admin&#39;, {})</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2023"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2023"><span class="linenos">2023</span></a><span class="sd">            ...     print(f&quot;Admin users: {admin_group.get(&#39;users&#39;, [])}&quot;)</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2024"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2024"><span class="linenos">2024</span></a><span class="sd">            ...     print(f&quot;Admin connections: {admin_group.get(&#39;connections&#39;, [])}&quot;)</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2025"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2025"><span class="linenos">2025</span></a><span class="sd">            Admin users: [&#39;admin1&#39;, &#39;admin2&#39;]</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2026"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2026"><span class="linenos">2026</span></a><span class="sd">            Admin connections: [&#39;server1&#39;, &#39;server2&#39;]</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2027"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2027"><span class="linenos">2027</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2028"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2028"><span class="linenos">2028</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2029"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2029"><span class="linenos">2029</span></a>            <span class="c1"># Get users per group with IDs</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2030"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2030"><span class="linenos">2030</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2031"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2031"><span class="linenos">2031</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2032"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2032"><span class="linenos">2032</span></a><span class="sd">                SELECT</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2033"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2033"><span class="linenos">2033</span></a><span class="sd">                    e.name as groupname,</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2034"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2034"><span class="linenos">2034</span></a><span class="sd">                    ug.user_group_id,</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2035"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2035"><span class="linenos">2035</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT ue.name) as users</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2036"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2036"><span class="linenos">2036</span></a><span class="sd">                FROM guacamole_entity e</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2037"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2037"><span class="linenos">2037</span></a><span class="sd">                LEFT JOIN guacamole_user_group ug ON e.entity_id = ug.entity_id</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2038"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2038"><span class="linenos">2038</span></a><span class="sd">                LEFT JOIN guacamole_user_group_member ugm ON ug.user_group_id = ugm.user_group_id</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2039"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2039"><span class="linenos">2039</span></a><span class="sd">                LEFT JOIN guacamole_entity ue ON ugm.member_entity_id = ue.entity_id AND ue.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2040"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2040"><span class="linenos">2040</span></a><span class="sd">                WHERE e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2041"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2041"><span class="linenos">2041</span></a><span class="sd">                GROUP BY e.name, ug.user_group_id</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2042"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2042"><span class="linenos">2042</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2043"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2043"><span class="linenos">2043</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2044"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2044"><span class="linenos">2044</span></a>            <span class="n">groups_users</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2045"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2045"><span class="linenos">2045</span></a>                <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2046"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2046"><span class="linenos">2046</span></a>                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2047"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2047"><span class="linenos">2047</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2048"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2048"><span class="linenos">2048</span></a>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2049"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2049"><span class="linenos">2049</span></a>            <span class="c1"># Get connections per group with IDs</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2050"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2050"><span class="linenos">2050</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2051"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2051"><span class="linenos">2051</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2052"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2052"><span class="linenos">2052</span></a><span class="sd">                SELECT</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2053"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2053"><span class="linenos">2053</span></a><span class="sd">                    e.name as groupname,</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2054"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2054"><span class="linenos">2054</span></a><span class="sd">                    ug.user_group_id,</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2055"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2055"><span class="linenos">2055</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT c.connection_name) as connections</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2056"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2056"><span class="linenos">2056</span></a><span class="sd">                FROM guacamole_entity e</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2057"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2057"><span class="linenos">2057</span></a><span class="sd">                LEFT JOIN guacamole_user_group ug ON e.entity_id = ug.entity_id</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2058"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2058"><span class="linenos">2058</span></a><span class="sd">                LEFT JOIN guacamole_connection_permission cp ON e.entity_id = cp.entity_id</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2059"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2059"><span class="linenos">2059</span></a><span class="sd">                LEFT JOIN guacamole_connection c ON cp.connection_id = c.connection_id</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2060"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2060"><span class="linenos">2060</span></a><span class="sd">                WHERE e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2061"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2061"><span class="linenos">2061</span></a><span class="sd">                GROUP BY e.name, ug.user_group_id</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2062"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2062"><span class="linenos">2062</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2063"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2063"><span class="linenos">2063</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2064"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2064"><span class="linenos">2064</span></a>            <span class="n">groups_connections</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2065"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2065"><span class="linenos">2065</span></a>                <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2066"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2066"><span class="linenos">2066</span></a>                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2067"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2067"><span class="linenos">2067</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2068"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2068"><span class="linenos">2068</span></a>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2069"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2069"><span class="linenos">2069</span></a>            <span class="c1"># Combine results</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2070"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2070"><span class="linenos">2070</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2071"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2071"><span class="linenos">2071</span></a>            <span class="k">for</span> <span class="n">group_key</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">groups_users</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">groups_connections</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2072"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2072"><span class="linenos">2072</span></a>                <span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span> <span class="o">=</span> <span class="n">group_key</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2073"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2073"><span class="linenos">2073</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2074"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2074"><span class="linenos">2074</span></a>                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2075"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2075"><span class="linenos">2075</span></a>                    <span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="n">groups_users</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_key</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2076"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2076"><span class="linenos">2076</span></a>                    <span class="s2">&quot;connections&quot;</span><span class="p">:</span> <span class="n">groups_connections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_key</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2077"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2077"><span class="linenos">2077</span></a>                <span class="p">}</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2078"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2078"><span class="linenos">2078</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2079"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2079"><span class="linenos">2079</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2080"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2080"><span class="linenos">2080</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing groups with users and connections: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.list_usergroups_with_users_and_connections-2081"><a href="#GuacamoleDB.list_usergroups_with_users_and_connections-2081"><span class="linenos">2081</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>List all user groups with their associated users and connections.</p>

<p>Retrieves a comprehensive mapping of all user groups in the system,
including the users belonging to each group and the connections
accessible to those users through group permissions.</p>

<p>Returns:
    Dict[str, Dict[str, Any]]: Nested dictionary with group names as keys.
        Each group dictionary contains:
        - id (int): The database ID of the user group
        - users (List[str]): List of usernames belonging to the group
        - connections (List[str]): List of connection names accessible to the group</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     result = db.list_usergroups_with_users_and_connections()
          ...     admin_group = result.get('admin', {})
          ...     print(f"Admin users: {admin_group.get('users', [])}")
          ...     print(f"Admin connections: {admin_group.get('connections', [])}")
          Admin users: ['admin1', 'admin2']
          Admin connections: ['server1', 'server2']</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.create_connection_group" class="classattr">
                                        <input id="GuacamoleDB.create_connection_group-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_connection_group</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">parent_group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.create_connection_group-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.create_connection_group"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.create_connection_group-2129"><a href="#GuacamoleDB.create_connection_group-2129"><span class="linenos">2129</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_connection_group</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection_group-2130"><a href="#GuacamoleDB.create_connection_group-2130"><span class="linenos">2130</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent_group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.create_connection_group-2131"><a href="#GuacamoleDB.create_connection_group-2131"><span class="linenos">2131</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection_group-2132"><a href="#GuacamoleDB.create_connection_group-2132"><span class="linenos">2132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new connection group in the Guacamole database.</span>
</span><span id="GuacamoleDB.create_connection_group-2133"><a href="#GuacamoleDB.create_connection_group-2133"><span class="linenos">2133</span></a>
</span><span id="GuacamoleDB.create_connection_group-2134"><a href="#GuacamoleDB.create_connection_group-2134"><span class="linenos">2134</span></a><span class="sd">        Creates a new connection group with the specified name and optionally</span>
</span><span id="GuacamoleDB.create_connection_group-2135"><a href="#GuacamoleDB.create_connection_group-2135"><span class="linenos">2135</span></a><span class="sd">        assigns it to a parent group to establish a hierarchical structure.</span>
</span><span id="GuacamoleDB.create_connection_group-2136"><a href="#GuacamoleDB.create_connection_group-2136"><span class="linenos">2136</span></a>
</span><span id="GuacamoleDB.create_connection_group-2137"><a href="#GuacamoleDB.create_connection_group-2137"><span class="linenos">2137</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.create_connection_group-2138"><a href="#GuacamoleDB.create_connection_group-2138"><span class="linenos">2138</span></a><span class="sd">            group_name: Name for the new connection group.</span>
</span><span id="GuacamoleDB.create_connection_group-2139"><a href="#GuacamoleDB.create_connection_group-2139"><span class="linenos">2139</span></a><span class="sd">            parent_group_name: Optional name of the parent connection group.</span>
</span><span id="GuacamoleDB.create_connection_group-2140"><a href="#GuacamoleDB.create_connection_group-2140"><span class="linenos">2140</span></a><span class="sd">                              If None, the group will be created at the root level.</span>
</span><span id="GuacamoleDB.create_connection_group-2141"><a href="#GuacamoleDB.create_connection_group-2141"><span class="linenos">2141</span></a>
</span><span id="GuacamoleDB.create_connection_group-2142"><a href="#GuacamoleDB.create_connection_group-2142"><span class="linenos">2142</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.create_connection_group-2143"><a href="#GuacamoleDB.create_connection_group-2143"><span class="linenos">2143</span></a><span class="sd">            True if the connection group was created successfully.</span>
</span><span id="GuacamoleDB.create_connection_group-2144"><a href="#GuacamoleDB.create_connection_group-2144"><span class="linenos">2144</span></a>
</span><span id="GuacamoleDB.create_connection_group-2145"><a href="#GuacamoleDB.create_connection_group-2145"><span class="linenos">2145</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.create_connection_group-2146"><a href="#GuacamoleDB.create_connection_group-2146"><span class="linenos">2146</span></a><span class="sd">            ValueError: If group name is invalid, parent group doesn&#39;t exist,</span>
</span><span id="GuacamoleDB.create_connection_group-2147"><a href="#GuacamoleDB.create_connection_group-2147"><span class="linenos">2147</span></a><span class="sd">                       or would create a cycle in the hierarchy.</span>
</span><span id="GuacamoleDB.create_connection_group-2148"><a href="#GuacamoleDB.create_connection_group-2148"><span class="linenos">2148</span></a><span class="sd">            mysql.connector.Error: If database operation fails.</span>
</span><span id="GuacamoleDB.create_connection_group-2149"><a href="#GuacamoleDB.create_connection_group-2149"><span class="linenos">2149</span></a>
</span><span id="GuacamoleDB.create_connection_group-2150"><a href="#GuacamoleDB.create_connection_group-2150"><span class="linenos">2150</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.create_connection_group-2151"><a href="#GuacamoleDB.create_connection_group-2151"><span class="linenos">2151</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.create_connection_group-2152"><a href="#GuacamoleDB.create_connection_group-2152"><span class="linenos">2152</span></a><span class="sd">            ...     # Create root-level group</span>
</span><span id="GuacamoleDB.create_connection_group-2153"><a href="#GuacamoleDB.create_connection_group-2153"><span class="linenos">2153</span></a><span class="sd">            ...     db.create_connection_group(&quot;Production Servers&quot;)</span>
</span><span id="GuacamoleDB.create_connection_group-2154"><a href="#GuacamoleDB.create_connection_group-2154"><span class="linenos">2154</span></a><span class="sd">            ...     # Create child group</span>
</span><span id="GuacamoleDB.create_connection_group-2155"><a href="#GuacamoleDB.create_connection_group-2155"><span class="linenos">2155</span></a><span class="sd">            ...     db.create_connection_group(&quot;Web Servers&quot;, &quot;Production Servers&quot;)</span>
</span><span id="GuacamoleDB.create_connection_group-2156"><a href="#GuacamoleDB.create_connection_group-2156"><span class="linenos">2156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection_group-2157"><a href="#GuacamoleDB.create_connection_group-2157"><span class="linenos">2157</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection_group-2158"><a href="#GuacamoleDB.create_connection_group-2158"><span class="linenos">2158</span></a>            <span class="n">parent_group_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.create_connection_group-2159"><a href="#GuacamoleDB.create_connection_group-2159"><span class="linenos">2159</span></a>            <span class="k">if</span> <span class="n">parent_group_name</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection_group-2160"><a href="#GuacamoleDB.create_connection_group-2160"><span class="linenos">2160</span></a>                <span class="c1"># Get parent group ID if specified</span>
</span><span id="GuacamoleDB.create_connection_group-2161"><a href="#GuacamoleDB.create_connection_group-2161"><span class="linenos">2161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection_group-2162"><a href="#GuacamoleDB.create_connection_group-2162"><span class="linenos">2162</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection_group-2163"><a href="#GuacamoleDB.create_connection_group-2163"><span class="linenos">2163</span></a><span class="sd">                    SELECT connection_group_id </span>
</span><span id="GuacamoleDB.create_connection_group-2164"><a href="#GuacamoleDB.create_connection_group-2164"><span class="linenos">2164</span></a><span class="sd">                    FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.create_connection_group-2165"><a href="#GuacamoleDB.create_connection_group-2165"><span class="linenos">2165</span></a><span class="sd">                    WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB.create_connection_group-2166"><a href="#GuacamoleDB.create_connection_group-2166"><span class="linenos">2166</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection_group-2167"><a href="#GuacamoleDB.create_connection_group-2167"><span class="linenos">2167</span></a>                    <span class="p">(</span><span class="n">parent_group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.create_connection_group-2168"><a href="#GuacamoleDB.create_connection_group-2168"><span class="linenos">2168</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection_group-2169"><a href="#GuacamoleDB.create_connection_group-2169"><span class="linenos">2169</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.create_connection_group-2170"><a href="#GuacamoleDB.create_connection_group-2170"><span class="linenos">2170</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection_group-2171"><a href="#GuacamoleDB.create_connection_group-2171"><span class="linenos">2171</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection_group-2172"><a href="#GuacamoleDB.create_connection_group-2172"><span class="linenos">2172</span></a>                        <span class="sa">f</span><span class="s2">&quot;Parent connection group &#39;</span><span class="si">{</span><span class="n">parent_group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="GuacamoleDB.create_connection_group-2173"><a href="#GuacamoleDB.create_connection_group-2173"><span class="linenos">2173</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection_group-2174"><a href="#GuacamoleDB.create_connection_group-2174"><span class="linenos">2174</span></a>                <span class="n">parent_group_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.create_connection_group-2175"><a href="#GuacamoleDB.create_connection_group-2175"><span class="linenos">2175</span></a>
</span><span id="GuacamoleDB.create_connection_group-2176"><a href="#GuacamoleDB.create_connection_group-2176"><span class="linenos">2176</span></a>                <span class="c1"># Check for cycles - since this is a new group, we can&#39;t be creating a cycle</span>
</span><span id="GuacamoleDB.create_connection_group-2177"><a href="#GuacamoleDB.create_connection_group-2177"><span class="linenos">2177</span></a>                <span class="c1"># but we should still validate the parent exists and is valid</span>
</span><span id="GuacamoleDB.create_connection_group-2178"><a href="#GuacamoleDB.create_connection_group-2178"><span class="linenos">2178</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection_group_cycle</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent_group_id</span><span class="p">):</span>
</span><span id="GuacamoleDB.create_connection_group-2179"><a href="#GuacamoleDB.create_connection_group-2179"><span class="linenos">2179</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection_group-2180"><a href="#GuacamoleDB.create_connection_group-2180"><span class="linenos">2180</span></a>                        <span class="sa">f</span><span class="s2">&quot;Parent connection group &#39;</span><span class="si">{</span><span class="n">parent_group_name</span><span class="si">}</span><span class="s2">&#39; is invalid&quot;</span>
</span><span id="GuacamoleDB.create_connection_group-2181"><a href="#GuacamoleDB.create_connection_group-2181"><span class="linenos">2181</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection_group-2182"><a href="#GuacamoleDB.create_connection_group-2182"><span class="linenos">2182</span></a>
</span><span id="GuacamoleDB.create_connection_group-2183"><a href="#GuacamoleDB.create_connection_group-2183"><span class="linenos">2183</span></a>            <span class="c1"># Create the new connection group</span>
</span><span id="GuacamoleDB.create_connection_group-2184"><a href="#GuacamoleDB.create_connection_group-2184"><span class="linenos">2184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection_group-2185"><a href="#GuacamoleDB.create_connection_group-2185"><span class="linenos">2185</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection_group-2186"><a href="#GuacamoleDB.create_connection_group-2186"><span class="linenos">2186</span></a><span class="sd">                INSERT INTO guacamole_connection_group </span>
</span><span id="GuacamoleDB.create_connection_group-2187"><a href="#GuacamoleDB.create_connection_group-2187"><span class="linenos">2187</span></a><span class="sd">                (connection_group_name, parent_id)</span>
</span><span id="GuacamoleDB.create_connection_group-2188"><a href="#GuacamoleDB.create_connection_group-2188"><span class="linenos">2188</span></a><span class="sd">                VALUES (%s, %s)</span>
</span><span id="GuacamoleDB.create_connection_group-2189"><a href="#GuacamoleDB.create_connection_group-2189"><span class="linenos">2189</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection_group-2190"><a href="#GuacamoleDB.create_connection_group-2190"><span class="linenos">2190</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">parent_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.create_connection_group-2191"><a href="#GuacamoleDB.create_connection_group-2191"><span class="linenos">2191</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection_group-2192"><a href="#GuacamoleDB.create_connection_group-2192"><span class="linenos">2192</span></a>
</span><span id="GuacamoleDB.create_connection_group-2193"><a href="#GuacamoleDB.create_connection_group-2193"><span class="linenos">2193</span></a>            <span class="c1"># Verify the group was created</span>
</span><span id="GuacamoleDB.create_connection_group-2194"><a href="#GuacamoleDB.create_connection_group-2194"><span class="linenos">2194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.create_connection_group-2195"><a href="#GuacamoleDB.create_connection_group-2195"><span class="linenos">2195</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.create_connection_group-2196"><a href="#GuacamoleDB.create_connection_group-2196"><span class="linenos">2196</span></a><span class="sd">                SELECT connection_group_id </span>
</span><span id="GuacamoleDB.create_connection_group-2197"><a href="#GuacamoleDB.create_connection_group-2197"><span class="linenos">2197</span></a><span class="sd">                FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.create_connection_group-2198"><a href="#GuacamoleDB.create_connection_group-2198"><span class="linenos">2198</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB.create_connection_group-2199"><a href="#GuacamoleDB.create_connection_group-2199"><span class="linenos">2199</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.create_connection_group-2200"><a href="#GuacamoleDB.create_connection_group-2200"><span class="linenos">2200</span></a>                <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.create_connection_group-2201"><a href="#GuacamoleDB.create_connection_group-2201"><span class="linenos">2201</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.create_connection_group-2202"><a href="#GuacamoleDB.create_connection_group-2202"><span class="linenos">2202</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB.create_connection_group-2203"><a href="#GuacamoleDB.create_connection_group-2203"><span class="linenos">2203</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed to create connection group - no ID returned&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_connection_group-2204"><a href="#GuacamoleDB.create_connection_group-2204"><span class="linenos">2204</span></a>
</span><span id="GuacamoleDB.create_connection_group-2205"><a href="#GuacamoleDB.create_connection_group-2205"><span class="linenos">2205</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.create_connection_group-2206"><a href="#GuacamoleDB.create_connection_group-2206"><span class="linenos">2206</span></a>
</span><span id="GuacamoleDB.create_connection_group-2207"><a href="#GuacamoleDB.create_connection_group-2207"><span class="linenos">2207</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.create_connection_group-2208"><a href="#GuacamoleDB.create_connection_group-2208"><span class="linenos">2208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating connection group: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.create_connection_group-2209"><a href="#GuacamoleDB.create_connection_group-2209"><span class="linenos">2209</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Create a new connection group in the Guacamole database.</p>

<p>Creates a new connection group with the specified name and optionally
assigns it to a parent group to establish a hierarchical structure.</p>

<p>Args:
    group_name: Name for the new connection group.
    parent_group_name: Optional name of the parent connection group.
                      If None, the group will be created at the root level.</p>

<p>Returns:
    True if the connection group was created successfully.</p>

<p>Raises:
    ValueError: If group name is invalid, parent group doesn't exist,
               or would create a cycle in the hierarchy.
    mysql.connector.Error: If database operation fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     # Create root-level group
          ...     db.create_connection_group("Production Servers")
          ...     # Create child group
          ...     db.create_connection_group("Web Servers", "Production Servers")</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.grant_connection_permission_to_user" class="classattr">
                                        <input id="GuacamoleDB.grant_connection_permission_to_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grant_connection_permission_to_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.grant_connection_permission_to_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.grant_connection_permission_to_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.grant_connection_permission_to_user-2211"><a href="#GuacamoleDB.grant_connection_permission_to_user-2211"><span class="linenos">2211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_permission_to_user</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2212"><a href="#GuacamoleDB.grant_connection_permission_to_user-2212"><span class="linenos">2212</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2213"><a href="#GuacamoleDB.grant_connection_permission_to_user-2213"><span class="linenos">2213</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2214"><a href="#GuacamoleDB.grant_connection_permission_to_user-2214"><span class="linenos">2214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Grant connection permission to a specific user&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2215"><a href="#GuacamoleDB.grant_connection_permission_to_user-2215"><span class="linenos">2215</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2216"><a href="#GuacamoleDB.grant_connection_permission_to_user-2216"><span class="linenos">2216</span></a>            <span class="c1"># Get connection ID</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2217"><a href="#GuacamoleDB.grant_connection_permission_to_user-2217"><span class="linenos">2217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2218"><a href="#GuacamoleDB.grant_connection_permission_to_user-2218"><span class="linenos">2218</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2219"><a href="#GuacamoleDB.grant_connection_permission_to_user-2219"><span class="linenos">2219</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2220"><a href="#GuacamoleDB.grant_connection_permission_to_user-2220"><span class="linenos">2220</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2221"><a href="#GuacamoleDB.grant_connection_permission_to_user-2221"><span class="linenos">2221</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2222"><a href="#GuacamoleDB.grant_connection_permission_to_user-2222"><span class="linenos">2222</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2223"><a href="#GuacamoleDB.grant_connection_permission_to_user-2223"><span class="linenos">2223</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2224"><a href="#GuacamoleDB.grant_connection_permission_to_user-2224"><span class="linenos">2224</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2225"><a href="#GuacamoleDB.grant_connection_permission_to_user-2225"><span class="linenos">2225</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2226"><a href="#GuacamoleDB.grant_connection_permission_to_user-2226"><span class="linenos">2226</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2227"><a href="#GuacamoleDB.grant_connection_permission_to_user-2227"><span class="linenos">2227</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2228"><a href="#GuacamoleDB.grant_connection_permission_to_user-2228"><span class="linenos">2228</span></a>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2229"><a href="#GuacamoleDB.grant_connection_permission_to_user-2229"><span class="linenos">2229</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2230"><a href="#GuacamoleDB.grant_connection_permission_to_user-2230"><span class="linenos">2230</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2231"><a href="#GuacamoleDB.grant_connection_permission_to_user-2231"><span class="linenos">2231</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2232"><a href="#GuacamoleDB.grant_connection_permission_to_user-2232"><span class="linenos">2232</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2233"><a href="#GuacamoleDB.grant_connection_permission_to_user-2233"><span class="linenos">2233</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2234"><a href="#GuacamoleDB.grant_connection_permission_to_user-2234"><span class="linenos">2234</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2235"><a href="#GuacamoleDB.grant_connection_permission_to_user-2235"><span class="linenos">2235</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2236"><a href="#GuacamoleDB.grant_connection_permission_to_user-2236"><span class="linenos">2236</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2237"><a href="#GuacamoleDB.grant_connection_permission_to_user-2237"><span class="linenos">2237</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2238"><a href="#GuacamoleDB.grant_connection_permission_to_user-2238"><span class="linenos">2238</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2239"><a href="#GuacamoleDB.grant_connection_permission_to_user-2239"><span class="linenos">2239</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2240"><a href="#GuacamoleDB.grant_connection_permission_to_user-2240"><span class="linenos">2240</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2241"><a href="#GuacamoleDB.grant_connection_permission_to_user-2241"><span class="linenos">2241</span></a>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2242"><a href="#GuacamoleDB.grant_connection_permission_to_user-2242"><span class="linenos">2242</span></a>            <span class="c1"># Check if permission already exists</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2243"><a href="#GuacamoleDB.grant_connection_permission_to_user-2243"><span class="linenos">2243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2244"><a href="#GuacamoleDB.grant_connection_permission_to_user-2244"><span class="linenos">2244</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2245"><a href="#GuacamoleDB.grant_connection_permission_to_user-2245"><span class="linenos">2245</span></a><span class="sd">                SELECT 1 FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2246"><a href="#GuacamoleDB.grant_connection_permission_to_user-2246"><span class="linenos">2246</span></a><span class="sd">                WHERE entity_id = %s AND connection_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2247"><a href="#GuacamoleDB.grant_connection_permission_to_user-2247"><span class="linenos">2247</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2248"><a href="#GuacamoleDB.grant_connection_permission_to_user-2248"><span class="linenos">2248</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2249"><a href="#GuacamoleDB.grant_connection_permission_to_user-2249"><span class="linenos">2249</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2250"><a href="#GuacamoleDB.grant_connection_permission_to_user-2250"><span class="linenos">2250</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2251"><a href="#GuacamoleDB.grant_connection_permission_to_user-2251"><span class="linenos">2251</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2252"><a href="#GuacamoleDB.grant_connection_permission_to_user-2252"><span class="linenos">2252</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; already has permission for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2253"><a href="#GuacamoleDB.grant_connection_permission_to_user-2253"><span class="linenos">2253</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2254"><a href="#GuacamoleDB.grant_connection_permission_to_user-2254"><span class="linenos">2254</span></a>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2255"><a href="#GuacamoleDB.grant_connection_permission_to_user-2255"><span class="linenos">2255</span></a>            <span class="c1"># Grant permission</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2256"><a href="#GuacamoleDB.grant_connection_permission_to_user-2256"><span class="linenos">2256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2257"><a href="#GuacamoleDB.grant_connection_permission_to_user-2257"><span class="linenos">2257</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2258"><a href="#GuacamoleDB.grant_connection_permission_to_user-2258"><span class="linenos">2258</span></a><span class="sd">                INSERT INTO guacamole_connection_permission</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2259"><a href="#GuacamoleDB.grant_connection_permission_to_user-2259"><span class="linenos">2259</span></a><span class="sd">                (entity_id, connection_id, permission)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2260"><a href="#GuacamoleDB.grant_connection_permission_to_user-2260"><span class="linenos">2260</span></a><span class="sd">                VALUES (%s, %s, &#39;READ&#39;)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2261"><a href="#GuacamoleDB.grant_connection_permission_to_user-2261"><span class="linenos">2261</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2262"><a href="#GuacamoleDB.grant_connection_permission_to_user-2262"><span class="linenos">2262</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2263"><a href="#GuacamoleDB.grant_connection_permission_to_user-2263"><span class="linenos">2263</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2264"><a href="#GuacamoleDB.grant_connection_permission_to_user-2264"><span class="linenos">2264</span></a>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2265"><a href="#GuacamoleDB.grant_connection_permission_to_user-2265"><span class="linenos">2265</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2266"><a href="#GuacamoleDB.grant_connection_permission_to_user-2266"><span class="linenos">2266</span></a>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2267"><a href="#GuacamoleDB.grant_connection_permission_to_user-2267"><span class="linenos">2267</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2268"><a href="#GuacamoleDB.grant_connection_permission_to_user-2268"><span class="linenos">2268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error granting connection permission: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_permission_to_user-2269"><a href="#GuacamoleDB.grant_connection_permission_to_user-2269"><span class="linenos">2269</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Grant connection permission to a specific user</p>
</div>


                            </div>
                            <div id="GuacamoleDB.revoke_connection_permission_from_user" class="classattr">
                                        <input id="GuacamoleDB.revoke_connection_permission_from_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">revoke_connection_permission_from_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.revoke_connection_permission_from_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.revoke_connection_permission_from_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.revoke_connection_permission_from_user-2271"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2271"><span class="linenos">2271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_connection_permission_from_user</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2272"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2272"><span class="linenos">2272</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2273"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2273"><span class="linenos">2273</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2274"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2274"><span class="linenos">2274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke connection permission from a specific user&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2275"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2275"><span class="linenos">2275</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2276"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2276"><span class="linenos">2276</span></a>            <span class="c1"># Get connection ID</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2277"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2277"><span class="linenos">2277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2278"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2278"><span class="linenos">2278</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2279"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2279"><span class="linenos">2279</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2280"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2280"><span class="linenos">2280</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2281"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2281"><span class="linenos">2281</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2282"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2282"><span class="linenos">2282</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2283"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2283"><span class="linenos">2283</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2284"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2284"><span class="linenos">2284</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2285"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2285"><span class="linenos">2285</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2286"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2286"><span class="linenos">2286</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2287"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2287"><span class="linenos">2287</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2288"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2288"><span class="linenos">2288</span></a>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2289"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2289"><span class="linenos">2289</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2290"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2290"><span class="linenos">2290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2291"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2291"><span class="linenos">2291</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2292"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2292"><span class="linenos">2292</span></a><span class="sd">                SELECT entity_id FROM guacamole_entity</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2293"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2293"><span class="linenos">2293</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2294"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2294"><span class="linenos">2294</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2295"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2295"><span class="linenos">2295</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2296"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2296"><span class="linenos">2296</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2297"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2297"><span class="linenos">2297</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2298"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2298"><span class="linenos">2298</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2299"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2299"><span class="linenos">2299</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2300"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2300"><span class="linenos">2300</span></a>            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2301"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2301"><span class="linenos">2301</span></a>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2302"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2302"><span class="linenos">2302</span></a>            <span class="c1"># Check if permission exists</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2303"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2303"><span class="linenos">2303</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2304"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2304"><span class="linenos">2304</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2305"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2305"><span class="linenos">2305</span></a><span class="sd">                SELECT 1 FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2306"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2306"><span class="linenos">2306</span></a><span class="sd">                WHERE entity_id = %s AND connection_id = %s</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2307"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2307"><span class="linenos">2307</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2308"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2308"><span class="linenos">2308</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2309"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2309"><span class="linenos">2309</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2310"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2310"><span class="linenos">2310</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">():</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2311"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2311"><span class="linenos">2311</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2312"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2312"><span class="linenos">2312</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; has no permission for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2313"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2313"><span class="linenos">2313</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2314"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2314"><span class="linenos">2314</span></a>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2315"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2315"><span class="linenos">2315</span></a>            <span class="c1"># Revoke permission</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2316"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2316"><span class="linenos">2316</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2317"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2317"><span class="linenos">2317</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2318"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2318"><span class="linenos">2318</span></a><span class="sd">                DELETE FROM guacamole_connection_permission</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2319"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2319"><span class="linenos">2319</span></a><span class="sd">                WHERE entity_id = %s AND connection_id = %s</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2320"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2320"><span class="linenos">2320</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2321"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2321"><span class="linenos">2321</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2322"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2322"><span class="linenos">2322</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2323"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2323"><span class="linenos">2323</span></a>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2324"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2324"><span class="linenos">2324</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2325"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2325"><span class="linenos">2325</span></a>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2326"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2326"><span class="linenos">2326</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2327"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2327"><span class="linenos">2327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error revoking connection permission: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_permission_from_user-2328"><a href="#GuacamoleDB.revoke_connection_permission_from_user-2328"><span class="linenos">2328</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Revoke connection permission from a specific user</p>
</div>


                            </div>
                            <div id="GuacamoleDB.modify_connection_group_parent" class="classattr">
                                        <input id="GuacamoleDB.modify_connection_group_parent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modify_connection_group_parent</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">new_parent_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.modify_connection_group_parent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.modify_connection_group_parent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.modify_connection_group_parent-2330"><a href="#GuacamoleDB.modify_connection_group_parent-2330"><span class="linenos">2330</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">modify_connection_group_parent</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2331"><a href="#GuacamoleDB.modify_connection_group_parent-2331"><span class="linenos">2331</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2332"><a href="#GuacamoleDB.modify_connection_group_parent-2332"><span class="linenos">2332</span></a>        <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2333"><a href="#GuacamoleDB.modify_connection_group_parent-2333"><span class="linenos">2333</span></a>        <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2334"><a href="#GuacamoleDB.modify_connection_group_parent-2334"><span class="linenos">2334</span></a>        <span class="n">new_parent_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2335"><a href="#GuacamoleDB.modify_connection_group_parent-2335"><span class="linenos">2335</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2336"><a href="#GuacamoleDB.modify_connection_group_parent-2336"><span class="linenos">2336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set parent connection group for a connection group with cycle detection&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2337"><a href="#GuacamoleDB.modify_connection_group_parent-2337"><span class="linenos">2337</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2338"><a href="#GuacamoleDB.modify_connection_group_parent-2338"><span class="linenos">2338</span></a>            <span class="c1"># Use resolver to get group_id and validate inputs</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2339"><a href="#GuacamoleDB.modify_connection_group_parent-2339"><span class="linenos">2339</span></a>            <span class="n">resolved_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_conngroup_id</span><span class="p">(</span><span class="n">group_name</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2340"><a href="#GuacamoleDB.modify_connection_group_parent-2340"><span class="linenos">2340</span></a>
</span><span id="GuacamoleDB.modify_connection_group_parent-2341"><a href="#GuacamoleDB.modify_connection_group_parent-2341"><span class="linenos">2341</span></a>            <span class="c1"># Get group name for error messages if we only have ID</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2342"><a href="#GuacamoleDB.modify_connection_group_parent-2342"><span class="linenos">2342</span></a>            <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2343"><a href="#GuacamoleDB.modify_connection_group_parent-2343"><span class="linenos">2343</span></a>                <span class="n">group_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection_group_name_by_id</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2344"><a href="#GuacamoleDB.modify_connection_group_parent-2344"><span class="linenos">2344</span></a>
</span><span id="GuacamoleDB.modify_connection_group_parent-2345"><a href="#GuacamoleDB.modify_connection_group_parent-2345"><span class="linenos">2345</span></a>            <span class="c1"># Handle NULL parent (empty string)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2346"><a href="#GuacamoleDB.modify_connection_group_parent-2346"><span class="linenos">2346</span></a>            <span class="n">new_parent_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2347"><a href="#GuacamoleDB.modify_connection_group_parent-2347"><span class="linenos">2347</span></a>            <span class="k">if</span> <span class="n">new_parent_name</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2348"><a href="#GuacamoleDB.modify_connection_group_parent-2348"><span class="linenos">2348</span></a>                <span class="c1"># Get new parent ID</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2349"><a href="#GuacamoleDB.modify_connection_group_parent-2349"><span class="linenos">2349</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2350"><a href="#GuacamoleDB.modify_connection_group_parent-2350"><span class="linenos">2350</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2351"><a href="#GuacamoleDB.modify_connection_group_parent-2351"><span class="linenos">2351</span></a><span class="sd">                    SELECT connection_group_id </span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2352"><a href="#GuacamoleDB.modify_connection_group_parent-2352"><span class="linenos">2352</span></a><span class="sd">                    FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2353"><a href="#GuacamoleDB.modify_connection_group_parent-2353"><span class="linenos">2353</span></a><span class="sd">                    WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2354"><a href="#GuacamoleDB.modify_connection_group_parent-2354"><span class="linenos">2354</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2355"><a href="#GuacamoleDB.modify_connection_group_parent-2355"><span class="linenos">2355</span></a>                    <span class="p">(</span><span class="n">new_parent_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2356"><a href="#GuacamoleDB.modify_connection_group_parent-2356"><span class="linenos">2356</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2357"><a href="#GuacamoleDB.modify_connection_group_parent-2357"><span class="linenos">2357</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2358"><a href="#GuacamoleDB.modify_connection_group_parent-2358"><span class="linenos">2358</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2359"><a href="#GuacamoleDB.modify_connection_group_parent-2359"><span class="linenos">2359</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2360"><a href="#GuacamoleDB.modify_connection_group_parent-2360"><span class="linenos">2360</span></a>                        <span class="sa">f</span><span class="s2">&quot;Parent connection group &#39;</span><span class="si">{</span><span class="n">new_parent_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2361"><a href="#GuacamoleDB.modify_connection_group_parent-2361"><span class="linenos">2361</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2362"><a href="#GuacamoleDB.modify_connection_group_parent-2362"><span class="linenos">2362</span></a>                <span class="n">new_parent_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2363"><a href="#GuacamoleDB.modify_connection_group_parent-2363"><span class="linenos">2363</span></a>
</span><span id="GuacamoleDB.modify_connection_group_parent-2364"><a href="#GuacamoleDB.modify_connection_group_parent-2364"><span class="linenos">2364</span></a>                <span class="c1"># Check for cycles using helper method</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2365"><a href="#GuacamoleDB.modify_connection_group_parent-2365"><span class="linenos">2365</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection_group_cycle</span><span class="p">(</span><span class="n">resolved_group_id</span><span class="p">,</span> <span class="n">new_parent_id</span><span class="p">):</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2366"><a href="#GuacamoleDB.modify_connection_group_parent-2366"><span class="linenos">2366</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2367"><a href="#GuacamoleDB.modify_connection_group_parent-2367"><span class="linenos">2367</span></a>                        <span class="sa">f</span><span class="s2">&quot;Setting parent would create a cycle in connection groups&quot;</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2368"><a href="#GuacamoleDB.modify_connection_group_parent-2368"><span class="linenos">2368</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2369"><a href="#GuacamoleDB.modify_connection_group_parent-2369"><span class="linenos">2369</span></a>
</span><span id="GuacamoleDB.modify_connection_group_parent-2370"><a href="#GuacamoleDB.modify_connection_group_parent-2370"><span class="linenos">2370</span></a>            <span class="c1"># Update the parent</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2371"><a href="#GuacamoleDB.modify_connection_group_parent-2371"><span class="linenos">2371</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2372"><a href="#GuacamoleDB.modify_connection_group_parent-2372"><span class="linenos">2372</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2373"><a href="#GuacamoleDB.modify_connection_group_parent-2373"><span class="linenos">2373</span></a><span class="sd">                UPDATE guacamole_connection_group</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2374"><a href="#GuacamoleDB.modify_connection_group_parent-2374"><span class="linenos">2374</span></a><span class="sd">                SET parent_id = %s</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2375"><a href="#GuacamoleDB.modify_connection_group_parent-2375"><span class="linenos">2375</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2376"><a href="#GuacamoleDB.modify_connection_group_parent-2376"><span class="linenos">2376</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2377"><a href="#GuacamoleDB.modify_connection_group_parent-2377"><span class="linenos">2377</span></a>                <span class="p">(</span><span class="n">new_parent_id</span><span class="p">,</span> <span class="n">resolved_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2378"><a href="#GuacamoleDB.modify_connection_group_parent-2378"><span class="linenos">2378</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2379"><a href="#GuacamoleDB.modify_connection_group_parent-2379"><span class="linenos">2379</span></a>
</span><span id="GuacamoleDB.modify_connection_group_parent-2380"><a href="#GuacamoleDB.modify_connection_group_parent-2380"><span class="linenos">2380</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2381"><a href="#GuacamoleDB.modify_connection_group_parent-2381"><span class="linenos">2381</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update parent group for &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2382"><a href="#GuacamoleDB.modify_connection_group_parent-2382"><span class="linenos">2382</span></a>
</span><span id="GuacamoleDB.modify_connection_group_parent-2383"><a href="#GuacamoleDB.modify_connection_group_parent-2383"><span class="linenos">2383</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2384"><a href="#GuacamoleDB.modify_connection_group_parent-2384"><span class="linenos">2384</span></a>
</span><span id="GuacamoleDB.modify_connection_group_parent-2385"><a href="#GuacamoleDB.modify_connection_group_parent-2385"><span class="linenos">2385</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2386"><a href="#GuacamoleDB.modify_connection_group_parent-2386"><span class="linenos">2386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error modifying connection group parent: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.modify_connection_group_parent-2387"><a href="#GuacamoleDB.modify_connection_group_parent-2387"><span class="linenos">2387</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Set parent connection group for a connection group with cycle detection</p>
</div>


                            </div>
                            <div id="GuacamoleDB.list_connection_groups" class="classattr">
                                        <input id="GuacamoleDB.list_connection_groups-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_connection_groups</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.list_connection_groups-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.list_connection_groups"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.list_connection_groups-2389"><a href="#GuacamoleDB.list_connection_groups-2389"><span class="linenos">2389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_connection_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]:</span>
</span><span id="GuacamoleDB.list_connection_groups-2390"><a href="#GuacamoleDB.list_connection_groups-2390"><span class="linenos">2390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all connection groups with their connections and parent groups&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_connection_groups-2391"><a href="#GuacamoleDB.list_connection_groups-2391"><span class="linenos">2391</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_connection_groups-2392"><a href="#GuacamoleDB.list_connection_groups-2392"><span class="linenos">2392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.list_connection_groups-2393"><a href="#GuacamoleDB.list_connection_groups-2393"><span class="linenos">2393</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_connection_groups-2394"><a href="#GuacamoleDB.list_connection_groups-2394"><span class="linenos">2394</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB.list_connection_groups-2395"><a href="#GuacamoleDB.list_connection_groups-2395"><span class="linenos">2395</span></a><span class="sd">                    cg.connection_group_id,</span>
</span><span id="GuacamoleDB.list_connection_groups-2396"><a href="#GuacamoleDB.list_connection_groups-2396"><span class="linenos">2396</span></a><span class="sd">                    cg.connection_group_name,</span>
</span><span id="GuacamoleDB.list_connection_groups-2397"><a href="#GuacamoleDB.list_connection_groups-2397"><span class="linenos">2397</span></a><span class="sd">                    cg.parent_id,</span>
</span><span id="GuacamoleDB.list_connection_groups-2398"><a href="#GuacamoleDB.list_connection_groups-2398"><span class="linenos">2398</span></a><span class="sd">                    p.connection_group_name as parent_name,</span>
</span><span id="GuacamoleDB.list_connection_groups-2399"><a href="#GuacamoleDB.list_connection_groups-2399"><span class="linenos">2399</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT c.connection_name) as connections</span>
</span><span id="GuacamoleDB.list_connection_groups-2400"><a href="#GuacamoleDB.list_connection_groups-2400"><span class="linenos">2400</span></a><span class="sd">                FROM guacamole_connection_group cg</span>
</span><span id="GuacamoleDB.list_connection_groups-2401"><a href="#GuacamoleDB.list_connection_groups-2401"><span class="linenos">2401</span></a><span class="sd">                LEFT JOIN guacamole_connection_group p ON cg.parent_id = p.connection_group_id</span>
</span><span id="GuacamoleDB.list_connection_groups-2402"><a href="#GuacamoleDB.list_connection_groups-2402"><span class="linenos">2402</span></a><span class="sd">                LEFT JOIN guacamole_connection c ON cg.connection_group_id = c.parent_id</span>
</span><span id="GuacamoleDB.list_connection_groups-2403"><a href="#GuacamoleDB.list_connection_groups-2403"><span class="linenos">2403</span></a><span class="sd">                GROUP BY cg.connection_group_id</span>
</span><span id="GuacamoleDB.list_connection_groups-2404"><a href="#GuacamoleDB.list_connection_groups-2404"><span class="linenos">2404</span></a><span class="sd">                ORDER BY cg.connection_group_name</span>
</span><span id="GuacamoleDB.list_connection_groups-2405"><a href="#GuacamoleDB.list_connection_groups-2405"><span class="linenos">2405</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_connection_groups-2406"><a href="#GuacamoleDB.list_connection_groups-2406"><span class="linenos">2406</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.list_connection_groups-2407"><a href="#GuacamoleDB.list_connection_groups-2407"><span class="linenos">2407</span></a>
</span><span id="GuacamoleDB.list_connection_groups-2408"><a href="#GuacamoleDB.list_connection_groups-2408"><span class="linenos">2408</span></a>            <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB.list_connection_groups-2409"><a href="#GuacamoleDB.list_connection_groups-2409"><span class="linenos">2409</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
</span><span id="GuacamoleDB.list_connection_groups-2410"><a href="#GuacamoleDB.list_connection_groups-2410"><span class="linenos">2410</span></a>                <span class="n">group_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.list_connection_groups-2411"><a href="#GuacamoleDB.list_connection_groups-2411"><span class="linenos">2411</span></a>                <span class="n">group_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GuacamoleDB.list_connection_groups-2412"><a href="#GuacamoleDB.list_connection_groups-2412"><span class="linenos">2412</span></a>                <span class="n">parent_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="GuacamoleDB.list_connection_groups-2413"><a href="#GuacamoleDB.list_connection_groups-2413"><span class="linenos">2413</span></a>                <span class="n">parent_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="GuacamoleDB.list_connection_groups-2414"><a href="#GuacamoleDB.list_connection_groups-2414"><span class="linenos">2414</span></a>                <span class="n">connections</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.list_connection_groups-2415"><a href="#GuacamoleDB.list_connection_groups-2415"><span class="linenos">2415</span></a>
</span><span id="GuacamoleDB.list_connection_groups-2416"><a href="#GuacamoleDB.list_connection_groups-2416"><span class="linenos">2416</span></a>                <span class="n">groups</span><span class="p">[</span><span class="n">group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="GuacamoleDB.list_connection_groups-2417"><a href="#GuacamoleDB.list_connection_groups-2417"><span class="linenos">2417</span></a>                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connection_groups-2418"><a href="#GuacamoleDB.list_connection_groups-2418"><span class="linenos">2418</span></a>                    <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">parent_name</span> <span class="k">if</span> <span class="n">parent_name</span> <span class="k">else</span> <span class="s2">&quot;ROOT&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connection_groups-2419"><a href="#GuacamoleDB.list_connection_groups-2419"><span class="linenos">2419</span></a>                    <span class="s2">&quot;connections&quot;</span><span class="p">:</span> <span class="n">connections</span><span class="p">,</span>
</span><span id="GuacamoleDB.list_connection_groups-2420"><a href="#GuacamoleDB.list_connection_groups-2420"><span class="linenos">2420</span></a>                <span class="p">}</span>
</span><span id="GuacamoleDB.list_connection_groups-2421"><a href="#GuacamoleDB.list_connection_groups-2421"><span class="linenos">2421</span></a>            <span class="k">return</span> <span class="n">groups</span>
</span><span id="GuacamoleDB.list_connection_groups-2422"><a href="#GuacamoleDB.list_connection_groups-2422"><span class="linenos">2422</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_connection_groups-2423"><a href="#GuacamoleDB.list_connection_groups-2423"><span class="linenos">2423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing groups: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.list_connection_groups-2424"><a href="#GuacamoleDB.list_connection_groups-2424"><span class="linenos">2424</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>List all connection groups with their connections and parent groups</p>
</div>


                            </div>
                            <div id="GuacamoleDB.get_connection_group_by_id" class="classattr">
                                        <input id="GuacamoleDB.get_connection_group_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_connection_group_by_id</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_connection_group_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_connection_group_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_connection_group_by_id-2426"><a href="#GuacamoleDB.get_connection_group_by_id-2426"><span class="linenos">2426</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_by_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2427"><a href="#GuacamoleDB.get_connection_group_by_id-2427"><span class="linenos">2427</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2428"><a href="#GuacamoleDB.get_connection_group_by_id-2428"><span class="linenos">2428</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]]:</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2429"><a href="#GuacamoleDB.get_connection_group_by_id-2429"><span class="linenos">2429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a specific connection group by its ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2430"><a href="#GuacamoleDB.get_connection_group_by_id-2430"><span class="linenos">2430</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2431"><a href="#GuacamoleDB.get_connection_group_by_id-2431"><span class="linenos">2431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2432"><a href="#GuacamoleDB.get_connection_group_by_id-2432"><span class="linenos">2432</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2433"><a href="#GuacamoleDB.get_connection_group_by_id-2433"><span class="linenos">2433</span></a><span class="sd">                SELECT </span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2434"><a href="#GuacamoleDB.get_connection_group_by_id-2434"><span class="linenos">2434</span></a><span class="sd">                    cg.connection_group_id,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2435"><a href="#GuacamoleDB.get_connection_group_by_id-2435"><span class="linenos">2435</span></a><span class="sd">                    cg.connection_group_name,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2436"><a href="#GuacamoleDB.get_connection_group_by_id-2436"><span class="linenos">2436</span></a><span class="sd">                    cg.parent_id,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2437"><a href="#GuacamoleDB.get_connection_group_by_id-2437"><span class="linenos">2437</span></a><span class="sd">                    p.connection_group_name as parent_name,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2438"><a href="#GuacamoleDB.get_connection_group_by_id-2438"><span class="linenos">2438</span></a><span class="sd">                    GROUP_CONCAT(DISTINCT c.connection_name) as connections</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2439"><a href="#GuacamoleDB.get_connection_group_by_id-2439"><span class="linenos">2439</span></a><span class="sd">                FROM guacamole_connection_group cg</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2440"><a href="#GuacamoleDB.get_connection_group_by_id-2440"><span class="linenos">2440</span></a><span class="sd">                LEFT JOIN guacamole_connection_group p ON cg.parent_id = p.connection_group_id</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2441"><a href="#GuacamoleDB.get_connection_group_by_id-2441"><span class="linenos">2441</span></a><span class="sd">                LEFT JOIN guacamole_connection c ON cg.connection_group_id = c.parent_id</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2442"><a href="#GuacamoleDB.get_connection_group_by_id-2442"><span class="linenos">2442</span></a><span class="sd">                WHERE cg.connection_group_id = %s</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2443"><a href="#GuacamoleDB.get_connection_group_by_id-2443"><span class="linenos">2443</span></a><span class="sd">                GROUP BY cg.connection_group_id</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2444"><a href="#GuacamoleDB.get_connection_group_by_id-2444"><span class="linenos">2444</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2445"><a href="#GuacamoleDB.get_connection_group_by_id-2445"><span class="linenos">2445</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2446"><a href="#GuacamoleDB.get_connection_group_by_id-2446"><span class="linenos">2446</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2447"><a href="#GuacamoleDB.get_connection_group_by_id-2447"><span class="linenos">2447</span></a>
</span><span id="GuacamoleDB.get_connection_group_by_id-2448"><a href="#GuacamoleDB.get_connection_group_by_id-2448"><span class="linenos">2448</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2449"><a href="#GuacamoleDB.get_connection_group_by_id-2449"><span class="linenos">2449</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2450"><a href="#GuacamoleDB.get_connection_group_by_id-2450"><span class="linenos">2450</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2451"><a href="#GuacamoleDB.get_connection_group_by_id-2451"><span class="linenos">2451</span></a>
</span><span id="GuacamoleDB.get_connection_group_by_id-2452"><a href="#GuacamoleDB.get_connection_group_by_id-2452"><span class="linenos">2452</span></a>            <span class="n">group_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2453"><a href="#GuacamoleDB.get_connection_group_by_id-2453"><span class="linenos">2453</span></a>            <span class="n">group_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2454"><a href="#GuacamoleDB.get_connection_group_by_id-2454"><span class="linenos">2454</span></a>            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2455"><a href="#GuacamoleDB.get_connection_group_by_id-2455"><span class="linenos">2455</span></a>            <span class="n">parent_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2456"><a href="#GuacamoleDB.get_connection_group_by_id-2456"><span class="linenos">2456</span></a>            <span class="n">connections</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2457"><a href="#GuacamoleDB.get_connection_group_by_id-2457"><span class="linenos">2457</span></a>
</span><span id="GuacamoleDB.get_connection_group_by_id-2458"><a href="#GuacamoleDB.get_connection_group_by_id-2458"><span class="linenos">2458</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2459"><a href="#GuacamoleDB.get_connection_group_by_id-2459"><span class="linenos">2459</span></a>                <span class="n">group_name</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2460"><a href="#GuacamoleDB.get_connection_group_by_id-2460"><span class="linenos">2460</span></a>                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">group_id</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2461"><a href="#GuacamoleDB.get_connection_group_by_id-2461"><span class="linenos">2461</span></a>                    <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="n">parent_name</span> <span class="k">if</span> <span class="n">parent_name</span> <span class="k">else</span> <span class="s2">&quot;ROOT&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2462"><a href="#GuacamoleDB.get_connection_group_by_id-2462"><span class="linenos">2462</span></a>                    <span class="s2">&quot;connections&quot;</span><span class="p">:</span> <span class="n">connections</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2463"><a href="#GuacamoleDB.get_connection_group_by_id-2463"><span class="linenos">2463</span></a>                <span class="p">}</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2464"><a href="#GuacamoleDB.get_connection_group_by_id-2464"><span class="linenos">2464</span></a>            <span class="p">}</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2465"><a href="#GuacamoleDB.get_connection_group_by_id-2465"><span class="linenos">2465</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2466"><a href="#GuacamoleDB.get_connection_group_by_id-2466"><span class="linenos">2466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection group by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_by_id-2467"><a href="#GuacamoleDB.get_connection_group_by_id-2467"><span class="linenos">2467</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Get a specific connection group by its ID</p>
</div>


                            </div>
                            <div id="GuacamoleDB.get_connection_name_by_id" class="classattr">
                                        <input id="GuacamoleDB.get_connection_name_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_connection_name_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">connection_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_connection_name_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_connection_name_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_connection_name_by_id-2469"><a href="#GuacamoleDB.get_connection_name_by_id-2469"><span class="linenos">2469</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2470"><a href="#GuacamoleDB.get_connection_name_by_id-2470"><span class="linenos">2470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get connection name by ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2471"><a href="#GuacamoleDB.get_connection_name_by_id-2471"><span class="linenos">2471</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2472"><a href="#GuacamoleDB.get_connection_name_by_id-2472"><span class="linenos">2472</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2473"><a href="#GuacamoleDB.get_connection_name_by_id-2473"><span class="linenos">2473</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2474"><a href="#GuacamoleDB.get_connection_name_by_id-2474"><span class="linenos">2474</span></a><span class="sd">                SELECT connection_name </span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2475"><a href="#GuacamoleDB.get_connection_name_by_id-2475"><span class="linenos">2475</span></a><span class="sd">                FROM guacamole_connection </span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2476"><a href="#GuacamoleDB.get_connection_name_by_id-2476"><span class="linenos">2476</span></a><span class="sd">                WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2477"><a href="#GuacamoleDB.get_connection_name_by_id-2477"><span class="linenos">2477</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2478"><a href="#GuacamoleDB.get_connection_name_by_id-2478"><span class="linenos">2478</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2479"><a href="#GuacamoleDB.get_connection_name_by_id-2479"><span class="linenos">2479</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2480"><a href="#GuacamoleDB.get_connection_name_by_id-2480"><span class="linenos">2480</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2481"><a href="#GuacamoleDB.get_connection_name_by_id-2481"><span class="linenos">2481</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2482"><a href="#GuacamoleDB.get_connection_name_by_id-2482"><span class="linenos">2482</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2483"><a href="#GuacamoleDB.get_connection_name_by_id-2483"><span class="linenos">2483</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection name by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_name_by_id-2484"><a href="#GuacamoleDB.get_connection_name_by_id-2484"><span class="linenos">2484</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Get connection name by ID</p>
</div>


                            </div>
                            <div id="GuacamoleDB.get_connection_group_name_by_id" class="classattr">
                                        <input id="GuacamoleDB.get_connection_group_name_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_connection_group_name_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_connection_group_name_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_connection_group_name_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_connection_group_name_by_id-2486"><a href="#GuacamoleDB.get_connection_group_name_by_id-2486"><span class="linenos">2486</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection_group_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2487"><a href="#GuacamoleDB.get_connection_group_name_by_id-2487"><span class="linenos">2487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get connection group name by ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2488"><a href="#GuacamoleDB.get_connection_group_name_by_id-2488"><span class="linenos">2488</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2489"><a href="#GuacamoleDB.get_connection_group_name_by_id-2489"><span class="linenos">2489</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2490"><a href="#GuacamoleDB.get_connection_group_name_by_id-2490"><span class="linenos">2490</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2491"><a href="#GuacamoleDB.get_connection_group_name_by_id-2491"><span class="linenos">2491</span></a><span class="sd">                SELECT connection_group_name </span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2492"><a href="#GuacamoleDB.get_connection_group_name_by_id-2492"><span class="linenos">2492</span></a><span class="sd">                FROM guacamole_connection_group </span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2493"><a href="#GuacamoleDB.get_connection_group_name_by_id-2493"><span class="linenos">2493</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2494"><a href="#GuacamoleDB.get_connection_group_name_by_id-2494"><span class="linenos">2494</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2495"><a href="#GuacamoleDB.get_connection_group_name_by_id-2495"><span class="linenos">2495</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2496"><a href="#GuacamoleDB.get_connection_group_name_by_id-2496"><span class="linenos">2496</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2497"><a href="#GuacamoleDB.get_connection_group_name_by_id-2497"><span class="linenos">2497</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2498"><a href="#GuacamoleDB.get_connection_group_name_by_id-2498"><span class="linenos">2498</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2499"><a href="#GuacamoleDB.get_connection_group_name_by_id-2499"><span class="linenos">2499</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2500"><a href="#GuacamoleDB.get_connection_group_name_by_id-2500"><span class="linenos">2500</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting connection group name by ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_connection_group_name_by_id-2501"><a href="#GuacamoleDB.get_connection_group_name_by_id-2501"><span class="linenos">2501</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>Get connection group name by ID</p>
</div>


                            </div>
                            <div id="GuacamoleDB.validate_positive_id" class="classattr">
                                        <input id="GuacamoleDB.validate_positive_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_positive_id</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">id_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;entity&#39;</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.validate_positive_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.validate_positive_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.validate_positive_id-2503"><a href="#GuacamoleDB.validate_positive_id-2503"><span class="linenos">2503</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_positive_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.validate_positive_id-2504"><a href="#GuacamoleDB.validate_positive_id-2504"><span class="linenos">2504</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">id_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;entity&quot;</span>
</span><span id="GuacamoleDB.validate_positive_id-2505"><a href="#GuacamoleDB.validate_positive_id-2505"><span class="linenos">2505</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="GuacamoleDB.validate_positive_id-2506"><a href="#GuacamoleDB.validate_positive_id-2506"><span class="linenos">2506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that ID is a positive integer&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.validate_positive_id-2507"><a href="#GuacamoleDB.validate_positive_id-2507"><span class="linenos">2507</span></a>        <span class="k">if</span> <span class="n">id_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">id_value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.validate_positive_id-2508"><a href="#GuacamoleDB.validate_positive_id-2508"><span class="linenos">2508</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.validate_positive_id-2509"><a href="#GuacamoleDB.validate_positive_id-2509"><span class="linenos">2509</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2"> ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB.validate_positive_id-2510"><a href="#GuacamoleDB.validate_positive_id-2510"><span class="linenos">2510</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.validate_positive_id-2511"><a href="#GuacamoleDB.validate_positive_id-2511"><span class="linenos">2511</span></a>        <span class="k">return</span> <span class="n">id_value</span>
</span></pre></div>


            <div class="docstring"><p>Validate that ID is a positive integer</p>
</div>


                            </div>
                            <div id="GuacamoleDB.resolve_connection_id" class="classattr">
                                        <input id="GuacamoleDB.resolve_connection_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resolve_connection_id</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.resolve_connection_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.resolve_connection_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.resolve_connection_id-2513"><a href="#GuacamoleDB.resolve_connection_id-2513"><span class="linenos">2513</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_connection_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_connection_id-2514"><a href="#GuacamoleDB.resolve_connection_id-2514"><span class="linenos">2514</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">connection_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.resolve_connection_id-2515"><a href="#GuacamoleDB.resolve_connection_id-2515"><span class="linenos">2515</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2516"><a href="#GuacamoleDB.resolve_connection_id-2516"><span class="linenos">2516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs and resolve to connection_id with centralized validation.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2517"><a href="#GuacamoleDB.resolve_connection_id-2517"><span class="linenos">2517</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2518"><a href="#GuacamoleDB.resolve_connection_id-2518"><span class="linenos">2518</span></a><span class="sd">        This is a core utility method that handles the common pattern of accepting</span>
</span><span id="GuacamoleDB.resolve_connection_id-2519"><a href="#GuacamoleDB.resolve_connection_id-2519"><span class="linenos">2519</span></a><span class="sd">        either a connection name or ID and resolving it to a validated connection ID.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2520"><a href="#GuacamoleDB.resolve_connection_id-2520"><span class="linenos">2520</span></a><span class="sd">        Provides comprehensive input validation and error handling.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2521"><a href="#GuacamoleDB.resolve_connection_id-2521"><span class="linenos">2521</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2522"><a href="#GuacamoleDB.resolve_connection_id-2522"><span class="linenos">2522</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2523"><a href="#GuacamoleDB.resolve_connection_id-2523"><span class="linenos">2523</span></a><span class="sd">            connection_name: The connection name to resolve. Optional.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2524"><a href="#GuacamoleDB.resolve_connection_id-2524"><span class="linenos">2524</span></a><span class="sd">            connection_id: The connection ID to validate. Optional.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2525"><a href="#GuacamoleDB.resolve_connection_id-2525"><span class="linenos">2525</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2526"><a href="#GuacamoleDB.resolve_connection_id-2526"><span class="linenos">2526</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2527"><a href="#GuacamoleDB.resolve_connection_id-2527"><span class="linenos">2527</span></a><span class="sd">            The validated connection ID.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2528"><a href="#GuacamoleDB.resolve_connection_id-2528"><span class="linenos">2528</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2529"><a href="#GuacamoleDB.resolve_connection_id-2529"><span class="linenos">2529</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2530"><a href="#GuacamoleDB.resolve_connection_id-2530"><span class="linenos">2530</span></a><span class="sd">            ValueError: If neither or both parameters are provided, if ID is invalid,</span>
</span><span id="GuacamoleDB.resolve_connection_id-2531"><a href="#GuacamoleDB.resolve_connection_id-2531"><span class="linenos">2531</span></a><span class="sd">                       if connection doesn&#39;t exist, or if database error occurs.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2532"><a href="#GuacamoleDB.resolve_connection_id-2532"><span class="linenos">2532</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2533"><a href="#GuacamoleDB.resolve_connection_id-2533"><span class="linenos">2533</span></a><span class="sd">        Note:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2534"><a href="#GuacamoleDB.resolve_connection_id-2534"><span class="linenos">2534</span></a><span class="sd">            Exactly one of connection_name or connection_id must be provided.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2535"><a href="#GuacamoleDB.resolve_connection_id-2535"><span class="linenos">2535</span></a><span class="sd">            This method is used by many other methods for consistent ID resolution.</span>
</span><span id="GuacamoleDB.resolve_connection_id-2536"><a href="#GuacamoleDB.resolve_connection_id-2536"><span class="linenos">2536</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2537"><a href="#GuacamoleDB.resolve_connection_id-2537"><span class="linenos">2537</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2538"><a href="#GuacamoleDB.resolve_connection_id-2538"><span class="linenos">2538</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2539"><a href="#GuacamoleDB.resolve_connection_id-2539"><span class="linenos">2539</span></a><span class="sd">            ...     # Resolve by name</span>
</span><span id="GuacamoleDB.resolve_connection_id-2540"><a href="#GuacamoleDB.resolve_connection_id-2540"><span class="linenos">2540</span></a><span class="sd">            ...     conn_id = db.resolve_connection_id(connection_name=&#39;my-server&#39;)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2541"><a href="#GuacamoleDB.resolve_connection_id-2541"><span class="linenos">2541</span></a><span class="sd">            ...     # Resolve by ID (validates existence)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2542"><a href="#GuacamoleDB.resolve_connection_id-2542"><span class="linenos">2542</span></a><span class="sd">            ...     conn_id = db.resolve_connection_id(connection_id=123)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2543"><a href="#GuacamoleDB.resolve_connection_id-2543"><span class="linenos">2543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_connection_id-2544"><a href="#GuacamoleDB.resolve_connection_id-2544"><span class="linenos">2544</span></a>        <span class="c1"># Validate exactly one parameter provided</span>
</span><span id="GuacamoleDB.resolve_connection_id-2545"><a href="#GuacamoleDB.resolve_connection_id-2545"><span class="linenos">2545</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">connection_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">connection_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GuacamoleDB.resolve_connection_id-2546"><a href="#GuacamoleDB.resolve_connection_id-2546"><span class="linenos">2546</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_connection_id-2547"><a href="#GuacamoleDB.resolve_connection_id-2547"><span class="linenos">2547</span></a>                <span class="s2">&quot;Exactly one of connection_name or connection_id must be provided&quot;</span>
</span><span id="GuacamoleDB.resolve_connection_id-2548"><a href="#GuacamoleDB.resolve_connection_id-2548"><span class="linenos">2548</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2549"><a href="#GuacamoleDB.resolve_connection_id-2549"><span class="linenos">2549</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2550"><a href="#GuacamoleDB.resolve_connection_id-2550"><span class="linenos">2550</span></a>        <span class="c1"># If ID provided, validate and return it</span>
</span><span id="GuacamoleDB.resolve_connection_id-2551"><a href="#GuacamoleDB.resolve_connection_id-2551"><span class="linenos">2551</span></a>        <span class="k">if</span> <span class="n">connection_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2552"><a href="#GuacamoleDB.resolve_connection_id-2552"><span class="linenos">2552</span></a>            <span class="k">if</span> <span class="n">connection_id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2553"><a href="#GuacamoleDB.resolve_connection_id-2553"><span class="linenos">2553</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_connection_id-2554"><a href="#GuacamoleDB.resolve_connection_id-2554"><span class="linenos">2554</span></a>                    <span class="s2">&quot;Connection ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB.resolve_connection_id-2555"><a href="#GuacamoleDB.resolve_connection_id-2555"><span class="linenos">2555</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2556"><a href="#GuacamoleDB.resolve_connection_id-2556"><span class="linenos">2556</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2557"><a href="#GuacamoleDB.resolve_connection_id-2557"><span class="linenos">2557</span></a>            <span class="c1"># Verify the connection exists</span>
</span><span id="GuacamoleDB.resolve_connection_id-2558"><a href="#GuacamoleDB.resolve_connection_id-2558"><span class="linenos">2558</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2559"><a href="#GuacamoleDB.resolve_connection_id-2559"><span class="linenos">2559</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_connection_id-2560"><a href="#GuacamoleDB.resolve_connection_id-2560"><span class="linenos">2560</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_connection_id-2561"><a href="#GuacamoleDB.resolve_connection_id-2561"><span class="linenos">2561</span></a><span class="sd">                    SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB.resolve_connection_id-2562"><a href="#GuacamoleDB.resolve_connection_id-2562"><span class="linenos">2562</span></a><span class="sd">                    WHERE connection_id = %s</span>
</span><span id="GuacamoleDB.resolve_connection_id-2563"><a href="#GuacamoleDB.resolve_connection_id-2563"><span class="linenos">2563</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.resolve_connection_id-2564"><a href="#GuacamoleDB.resolve_connection_id-2564"><span class="linenos">2564</span></a>                    <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.resolve_connection_id-2565"><a href="#GuacamoleDB.resolve_connection_id-2565"><span class="linenos">2565</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2566"><a href="#GuacamoleDB.resolve_connection_id-2566"><span class="linenos">2566</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.resolve_connection_id-2567"><a href="#GuacamoleDB.resolve_connection_id-2567"><span class="linenos">2567</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2568"><a href="#GuacamoleDB.resolve_connection_id-2568"><span class="linenos">2568</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection with ID </span><span class="si">{</span><span class="n">connection_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2569"><a href="#GuacamoleDB.resolve_connection_id-2569"><span class="linenos">2569</span></a>                <span class="k">return</span> <span class="n">connection_id</span>
</span><span id="GuacamoleDB.resolve_connection_id-2570"><a href="#GuacamoleDB.resolve_connection_id-2570"><span class="linenos">2570</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2571"><a href="#GuacamoleDB.resolve_connection_id-2571"><span class="linenos">2571</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving connection ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2572"><a href="#GuacamoleDB.resolve_connection_id-2572"><span class="linenos">2572</span></a>
</span><span id="GuacamoleDB.resolve_connection_id-2573"><a href="#GuacamoleDB.resolve_connection_id-2573"><span class="linenos">2573</span></a>        <span class="c1"># If name provided, resolve to ID</span>
</span><span id="GuacamoleDB.resolve_connection_id-2574"><a href="#GuacamoleDB.resolve_connection_id-2574"><span class="linenos">2574</span></a>        <span class="k">if</span> <span class="n">connection_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2575"><a href="#GuacamoleDB.resolve_connection_id-2575"><span class="linenos">2575</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2576"><a href="#GuacamoleDB.resolve_connection_id-2576"><span class="linenos">2576</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_connection_id-2577"><a href="#GuacamoleDB.resolve_connection_id-2577"><span class="linenos">2577</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_connection_id-2578"><a href="#GuacamoleDB.resolve_connection_id-2578"><span class="linenos">2578</span></a><span class="sd">                    SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB.resolve_connection_id-2579"><a href="#GuacamoleDB.resolve_connection_id-2579"><span class="linenos">2579</span></a><span class="sd">                    WHERE connection_name = %s</span>
</span><span id="GuacamoleDB.resolve_connection_id-2580"><a href="#GuacamoleDB.resolve_connection_id-2580"><span class="linenos">2580</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.resolve_connection_id-2581"><a href="#GuacamoleDB.resolve_connection_id-2581"><span class="linenos">2581</span></a>                    <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.resolve_connection_id-2582"><a href="#GuacamoleDB.resolve_connection_id-2582"><span class="linenos">2582</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2583"><a href="#GuacamoleDB.resolve_connection_id-2583"><span class="linenos">2583</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.resolve_connection_id-2584"><a href="#GuacamoleDB.resolve_connection_id-2584"><span class="linenos">2584</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2585"><a href="#GuacamoleDB.resolve_connection_id-2585"><span class="linenos">2585</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_connection_id-2586"><a href="#GuacamoleDB.resolve_connection_id-2586"><span class="linenos">2586</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.resolve_connection_id-2587"><a href="#GuacamoleDB.resolve_connection_id-2587"><span class="linenos">2587</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_connection_id-2588"><a href="#GuacamoleDB.resolve_connection_id-2588"><span class="linenos">2588</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving connection name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate inputs and resolve to connection_id with centralized validation.</p>

<p>This is a core utility method that handles the common pattern of accepting
either a connection name or ID and resolving it to a validated connection ID.
Provides comprehensive input validation and error handling.</p>

<p>Args:
    connection_name: The connection name to resolve. Optional.
    connection_id: The connection ID to validate. Optional.</p>

<p>Returns:
    The validated connection ID.</p>

<p>Raises:
    ValueError: If neither or both parameters are provided, if ID is invalid,
               if connection doesn't exist, or if database error occurs.</p>

<p>Note:
    Exactly one of connection_name or connection_id must be provided.
    This method is used by many other methods for consistent ID resolution.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     # Resolve by name
          ...     conn_id = db.resolve_connection_id(connection_name='my-server')
          ...     # Resolve by ID (validates existence)
          ...     conn_id = db.resolve_connection_id(connection_id=123)</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.resolve_conngroup_id" class="classattr">
                                        <input id="GuacamoleDB.resolve_conngroup_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resolve_conngroup_id</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.resolve_conngroup_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.resolve_conngroup_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.resolve_conngroup_id-2590"><a href="#GuacamoleDB.resolve_conngroup_id-2590"><span class="linenos">2590</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_conngroup_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2591"><a href="#GuacamoleDB.resolve_conngroup_id-2591"><span class="linenos">2591</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2592"><a href="#GuacamoleDB.resolve_conngroup_id-2592"><span class="linenos">2592</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2593"><a href="#GuacamoleDB.resolve_conngroup_id-2593"><span class="linenos">2593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs and resolve to connection_group_id with centralized validation&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2594"><a href="#GuacamoleDB.resolve_conngroup_id-2594"><span class="linenos">2594</span></a>        <span class="c1"># Validate exactly one parameter provided</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2595"><a href="#GuacamoleDB.resolve_conngroup_id-2595"><span class="linenos">2595</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">group_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2596"><a href="#GuacamoleDB.resolve_conngroup_id-2596"><span class="linenos">2596</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Exactly one of group_name or group_id must be provided&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2597"><a href="#GuacamoleDB.resolve_conngroup_id-2597"><span class="linenos">2597</span></a>
</span><span id="GuacamoleDB.resolve_conngroup_id-2598"><a href="#GuacamoleDB.resolve_conngroup_id-2598"><span class="linenos">2598</span></a>        <span class="c1"># If ID provided, validate and return it</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2599"><a href="#GuacamoleDB.resolve_conngroup_id-2599"><span class="linenos">2599</span></a>        <span class="k">if</span> <span class="n">group_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2600"><a href="#GuacamoleDB.resolve_conngroup_id-2600"><span class="linenos">2600</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2601"><a href="#GuacamoleDB.resolve_conngroup_id-2601"><span class="linenos">2601</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2602"><a href="#GuacamoleDB.resolve_conngroup_id-2602"><span class="linenos">2602</span></a>                    <span class="s2">&quot;Connection group ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2603"><a href="#GuacamoleDB.resolve_conngroup_id-2603"><span class="linenos">2603</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2604"><a href="#GuacamoleDB.resolve_conngroup_id-2604"><span class="linenos">2604</span></a>
</span><span id="GuacamoleDB.resolve_conngroup_id-2605"><a href="#GuacamoleDB.resolve_conngroup_id-2605"><span class="linenos">2605</span></a>            <span class="c1"># Verify the connection group exists</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2606"><a href="#GuacamoleDB.resolve_conngroup_id-2606"><span class="linenos">2606</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2607"><a href="#GuacamoleDB.resolve_conngroup_id-2607"><span class="linenos">2607</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2608"><a href="#GuacamoleDB.resolve_conngroup_id-2608"><span class="linenos">2608</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2609"><a href="#GuacamoleDB.resolve_conngroup_id-2609"><span class="linenos">2609</span></a><span class="sd">                    SELECT connection_group_id FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2610"><a href="#GuacamoleDB.resolve_conngroup_id-2610"><span class="linenos">2610</span></a><span class="sd">                    WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2611"><a href="#GuacamoleDB.resolve_conngroup_id-2611"><span class="linenos">2611</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2612"><a href="#GuacamoleDB.resolve_conngroup_id-2612"><span class="linenos">2612</span></a>                    <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2613"><a href="#GuacamoleDB.resolve_conngroup_id-2613"><span class="linenos">2613</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2614"><a href="#GuacamoleDB.resolve_conngroup_id-2614"><span class="linenos">2614</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2615"><a href="#GuacamoleDB.resolve_conngroup_id-2615"><span class="linenos">2615</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2616"><a href="#GuacamoleDB.resolve_conngroup_id-2616"><span class="linenos">2616</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group with ID </span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2617"><a href="#GuacamoleDB.resolve_conngroup_id-2617"><span class="linenos">2617</span></a>                <span class="k">return</span> <span class="n">group_id</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2618"><a href="#GuacamoleDB.resolve_conngroup_id-2618"><span class="linenos">2618</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2619"><a href="#GuacamoleDB.resolve_conngroup_id-2619"><span class="linenos">2619</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2620"><a href="#GuacamoleDB.resolve_conngroup_id-2620"><span class="linenos">2620</span></a>                    <span class="sa">f</span><span class="s2">&quot;Database error while resolving connection group ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2621"><a href="#GuacamoleDB.resolve_conngroup_id-2621"><span class="linenos">2621</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2622"><a href="#GuacamoleDB.resolve_conngroup_id-2622"><span class="linenos">2622</span></a>
</span><span id="GuacamoleDB.resolve_conngroup_id-2623"><a href="#GuacamoleDB.resolve_conngroup_id-2623"><span class="linenos">2623</span></a>        <span class="c1"># If name provided, resolve to ID</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2624"><a href="#GuacamoleDB.resolve_conngroup_id-2624"><span class="linenos">2624</span></a>        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2625"><a href="#GuacamoleDB.resolve_conngroup_id-2625"><span class="linenos">2625</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2626"><a href="#GuacamoleDB.resolve_conngroup_id-2626"><span class="linenos">2626</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2627"><a href="#GuacamoleDB.resolve_conngroup_id-2627"><span class="linenos">2627</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2628"><a href="#GuacamoleDB.resolve_conngroup_id-2628"><span class="linenos">2628</span></a><span class="sd">                    SELECT connection_group_id FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2629"><a href="#GuacamoleDB.resolve_conngroup_id-2629"><span class="linenos">2629</span></a><span class="sd">                    WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2630"><a href="#GuacamoleDB.resolve_conngroup_id-2630"><span class="linenos">2630</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2631"><a href="#GuacamoleDB.resolve_conngroup_id-2631"><span class="linenos">2631</span></a>                    <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2632"><a href="#GuacamoleDB.resolve_conngroup_id-2632"><span class="linenos">2632</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2633"><a href="#GuacamoleDB.resolve_conngroup_id-2633"><span class="linenos">2633</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2634"><a href="#GuacamoleDB.resolve_conngroup_id-2634"><span class="linenos">2634</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2635"><a href="#GuacamoleDB.resolve_conngroup_id-2635"><span class="linenos">2635</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2636"><a href="#GuacamoleDB.resolve_conngroup_id-2636"><span class="linenos">2636</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2637"><a href="#GuacamoleDB.resolve_conngroup_id-2637"><span class="linenos">2637</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2638"><a href="#GuacamoleDB.resolve_conngroup_id-2638"><span class="linenos">2638</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2639"><a href="#GuacamoleDB.resolve_conngroup_id-2639"><span class="linenos">2639</span></a>                    <span class="sa">f</span><span class="s2">&quot;Database error while resolving connection group name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.resolve_conngroup_id-2640"><a href="#GuacamoleDB.resolve_conngroup_id-2640"><span class="linenos">2640</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate inputs and resolve to connection_group_id with centralized validation</p>
</div>


                            </div>
                            <div id="GuacamoleDB.resolve_usergroup_id" class="classattr">
                                        <input id="GuacamoleDB.resolve_usergroup_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resolve_usergroup_id</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.resolve_usergroup_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.resolve_usergroup_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.resolve_usergroup_id-2642"><a href="#GuacamoleDB.resolve_usergroup_id-2642"><span class="linenos">2642</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_usergroup_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2643"><a href="#GuacamoleDB.resolve_usergroup_id-2643"><span class="linenos">2643</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2644"><a href="#GuacamoleDB.resolve_usergroup_id-2644"><span class="linenos">2644</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2645"><a href="#GuacamoleDB.resolve_usergroup_id-2645"><span class="linenos">2645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate inputs and resolve to user_group_id with centralized validation&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2646"><a href="#GuacamoleDB.resolve_usergroup_id-2646"><span class="linenos">2646</span></a>        <span class="c1"># Validate exactly one parameter provided</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2647"><a href="#GuacamoleDB.resolve_usergroup_id-2647"><span class="linenos">2647</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">group_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">group_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2648"><a href="#GuacamoleDB.resolve_usergroup_id-2648"><span class="linenos">2648</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Exactly one of group_name or group_id must be provided&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2649"><a href="#GuacamoleDB.resolve_usergroup_id-2649"><span class="linenos">2649</span></a>
</span><span id="GuacamoleDB.resolve_usergroup_id-2650"><a href="#GuacamoleDB.resolve_usergroup_id-2650"><span class="linenos">2650</span></a>        <span class="c1"># If ID provided, validate and return it</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2651"><a href="#GuacamoleDB.resolve_usergroup_id-2651"><span class="linenos">2651</span></a>        <span class="k">if</span> <span class="n">group_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2652"><a href="#GuacamoleDB.resolve_usergroup_id-2652"><span class="linenos">2652</span></a>            <span class="k">if</span> <span class="n">group_id</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2653"><a href="#GuacamoleDB.resolve_usergroup_id-2653"><span class="linenos">2653</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2654"><a href="#GuacamoleDB.resolve_usergroup_id-2654"><span class="linenos">2654</span></a>                    <span class="s2">&quot;Usergroup ID must be a positive integer greater than 0&quot;</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2655"><a href="#GuacamoleDB.resolve_usergroup_id-2655"><span class="linenos">2655</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2656"><a href="#GuacamoleDB.resolve_usergroup_id-2656"><span class="linenos">2656</span></a>
</span><span id="GuacamoleDB.resolve_usergroup_id-2657"><a href="#GuacamoleDB.resolve_usergroup_id-2657"><span class="linenos">2657</span></a>            <span class="c1"># Verify the usergroup exists</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2658"><a href="#GuacamoleDB.resolve_usergroup_id-2658"><span class="linenos">2658</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2659"><a href="#GuacamoleDB.resolve_usergroup_id-2659"><span class="linenos">2659</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2660"><a href="#GuacamoleDB.resolve_usergroup_id-2660"><span class="linenos">2660</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2661"><a href="#GuacamoleDB.resolve_usergroup_id-2661"><span class="linenos">2661</span></a><span class="sd">                    SELECT user_group_id FROM guacamole_user_group</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2662"><a href="#GuacamoleDB.resolve_usergroup_id-2662"><span class="linenos">2662</span></a><span class="sd">                    WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2663"><a href="#GuacamoleDB.resolve_usergroup_id-2663"><span class="linenos">2663</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2664"><a href="#GuacamoleDB.resolve_usergroup_id-2664"><span class="linenos">2664</span></a>                    <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2665"><a href="#GuacamoleDB.resolve_usergroup_id-2665"><span class="linenos">2665</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2666"><a href="#GuacamoleDB.resolve_usergroup_id-2666"><span class="linenos">2666</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2667"><a href="#GuacamoleDB.resolve_usergroup_id-2667"><span class="linenos">2667</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2668"><a href="#GuacamoleDB.resolve_usergroup_id-2668"><span class="linenos">2668</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup with ID </span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2669"><a href="#GuacamoleDB.resolve_usergroup_id-2669"><span class="linenos">2669</span></a>                <span class="k">return</span> <span class="n">group_id</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2670"><a href="#GuacamoleDB.resolve_usergroup_id-2670"><span class="linenos">2670</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2671"><a href="#GuacamoleDB.resolve_usergroup_id-2671"><span class="linenos">2671</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving usergroup ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2672"><a href="#GuacamoleDB.resolve_usergroup_id-2672"><span class="linenos">2672</span></a>
</span><span id="GuacamoleDB.resolve_usergroup_id-2673"><a href="#GuacamoleDB.resolve_usergroup_id-2673"><span class="linenos">2673</span></a>        <span class="c1"># If name provided, resolve to ID</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2674"><a href="#GuacamoleDB.resolve_usergroup_id-2674"><span class="linenos">2674</span></a>        <span class="k">if</span> <span class="n">group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2675"><a href="#GuacamoleDB.resolve_usergroup_id-2675"><span class="linenos">2675</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2676"><a href="#GuacamoleDB.resolve_usergroup_id-2676"><span class="linenos">2676</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2677"><a href="#GuacamoleDB.resolve_usergroup_id-2677"><span class="linenos">2677</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2678"><a href="#GuacamoleDB.resolve_usergroup_id-2678"><span class="linenos">2678</span></a><span class="sd">                    SELECT user_group_id FROM guacamole_user_group g</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2679"><a href="#GuacamoleDB.resolve_usergroup_id-2679"><span class="linenos">2679</span></a><span class="sd">                    JOIN guacamole_entity e ON g.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2680"><a href="#GuacamoleDB.resolve_usergroup_id-2680"><span class="linenos">2680</span></a><span class="sd">                    WHERE e.name = %s</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2681"><a href="#GuacamoleDB.resolve_usergroup_id-2681"><span class="linenos">2681</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2682"><a href="#GuacamoleDB.resolve_usergroup_id-2682"><span class="linenos">2682</span></a>                    <span class="p">(</span><span class="n">group_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2683"><a href="#GuacamoleDB.resolve_usergroup_id-2683"><span class="linenos">2683</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2684"><a href="#GuacamoleDB.resolve_usergroup_id-2684"><span class="linenos">2684</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2685"><a href="#GuacamoleDB.resolve_usergroup_id-2685"><span class="linenos">2685</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2686"><a href="#GuacamoleDB.resolve_usergroup_id-2686"><span class="linenos">2686</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup &#39;</span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2687"><a href="#GuacamoleDB.resolve_usergroup_id-2687"><span class="linenos">2687</span></a>                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2688"><a href="#GuacamoleDB.resolve_usergroup_id-2688"><span class="linenos">2688</span></a>            <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.resolve_usergroup_id-2689"><a href="#GuacamoleDB.resolve_usergroup_id-2689"><span class="linenos">2689</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while resolving usergroup name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate inputs and resolve to user_group_id with centralized validation</p>
</div>


                            </div>
                            <div id="GuacamoleDB.usergroup_exists_by_id" class="classattr">
                                        <input id="GuacamoleDB.usergroup_exists_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">usergroup_exists_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.usergroup_exists_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.usergroup_exists_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.usergroup_exists_by_id-2691"><a href="#GuacamoleDB.usergroup_exists_by_id-2691"><span class="linenos">2691</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">usergroup_exists_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2692"><a href="#GuacamoleDB.usergroup_exists_by_id-2692"><span class="linenos">2692</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a usergroup exists by ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2693"><a href="#GuacamoleDB.usergroup_exists_by_id-2693"><span class="linenos">2693</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2694"><a href="#GuacamoleDB.usergroup_exists_by_id-2694"><span class="linenos">2694</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2695"><a href="#GuacamoleDB.usergroup_exists_by_id-2695"><span class="linenos">2695</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2696"><a href="#GuacamoleDB.usergroup_exists_by_id-2696"><span class="linenos">2696</span></a><span class="sd">                SELECT user_group_id FROM guacamole_user_group</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2697"><a href="#GuacamoleDB.usergroup_exists_by_id-2697"><span class="linenos">2697</span></a><span class="sd">                WHERE user_group_id = %s</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2698"><a href="#GuacamoleDB.usergroup_exists_by_id-2698"><span class="linenos">2698</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2699"><a href="#GuacamoleDB.usergroup_exists_by_id-2699"><span class="linenos">2699</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2700"><a href="#GuacamoleDB.usergroup_exists_by_id-2700"><span class="linenos">2700</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2701"><a href="#GuacamoleDB.usergroup_exists_by_id-2701"><span class="linenos">2701</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2702"><a href="#GuacamoleDB.usergroup_exists_by_id-2702"><span class="linenos">2702</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.usergroup_exists_by_id-2703"><a href="#GuacamoleDB.usergroup_exists_by_id-2703"><span class="linenos">2703</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while checking usergroup existence: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if a usergroup exists by ID</p>
</div>


                            </div>
                            <div id="GuacamoleDB.get_usergroup_name_by_id" class="classattr">
                                        <input id="GuacamoleDB.get_usergroup_name_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_usergroup_name_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.get_usergroup_name_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.get_usergroup_name_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.get_usergroup_name_by_id-2705"><a href="#GuacamoleDB.get_usergroup_name_by_id-2705"><span class="linenos">2705</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_usergroup_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2706"><a href="#GuacamoleDB.get_usergroup_name_by_id-2706"><span class="linenos">2706</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get user group name by its database ID.</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2707"><a href="#GuacamoleDB.get_usergroup_name_by_id-2707"><span class="linenos">2707</span></a>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2708"><a href="#GuacamoleDB.get_usergroup_name_by_id-2708"><span class="linenos">2708</span></a><span class="sd">        Retrieves the name of a user group given its database ID.</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2709"><a href="#GuacamoleDB.get_usergroup_name_by_id-2709"><span class="linenos">2709</span></a><span class="sd">        This is useful for converting internal IDs back to human-readable names.</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2710"><a href="#GuacamoleDB.get_usergroup_name_by_id-2710"><span class="linenos">2710</span></a>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2711"><a href="#GuacamoleDB.get_usergroup_name_by_id-2711"><span class="linenos">2711</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2712"><a href="#GuacamoleDB.get_usergroup_name_by_id-2712"><span class="linenos">2712</span></a><span class="sd">            group_id: The database ID of the user group.</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2713"><a href="#GuacamoleDB.get_usergroup_name_by_id-2713"><span class="linenos">2713</span></a>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2714"><a href="#GuacamoleDB.get_usergroup_name_by_id-2714"><span class="linenos">2714</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2715"><a href="#GuacamoleDB.get_usergroup_name_by_id-2715"><span class="linenos">2715</span></a><span class="sd">            The name of the user group.</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2716"><a href="#GuacamoleDB.get_usergroup_name_by_id-2716"><span class="linenos">2716</span></a>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2717"><a href="#GuacamoleDB.get_usergroup_name_by_id-2717"><span class="linenos">2717</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2718"><a href="#GuacamoleDB.get_usergroup_name_by_id-2718"><span class="linenos">2718</span></a><span class="sd">            ValueError: If user group with the specified ID is not found.</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2719"><a href="#GuacamoleDB.get_usergroup_name_by_id-2719"><span class="linenos">2719</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2720"><a href="#GuacamoleDB.get_usergroup_name_by_id-2720"><span class="linenos">2720</span></a>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2721"><a href="#GuacamoleDB.get_usergroup_name_by_id-2721"><span class="linenos">2721</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2722"><a href="#GuacamoleDB.get_usergroup_name_by_id-2722"><span class="linenos">2722</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2723"><a href="#GuacamoleDB.get_usergroup_name_by_id-2723"><span class="linenos">2723</span></a><span class="sd">            ...     name = db.get_usergroup_name_by_id(42)</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2724"><a href="#GuacamoleDB.get_usergroup_name_by_id-2724"><span class="linenos">2724</span></a><span class="sd">            ...     print(f&quot;Group name: {name}&quot;)</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2725"><a href="#GuacamoleDB.get_usergroup_name_by_id-2725"><span class="linenos">2725</span></a><span class="sd">            Group name: admin-group</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2726"><a href="#GuacamoleDB.get_usergroup_name_by_id-2726"><span class="linenos">2726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2727"><a href="#GuacamoleDB.get_usergroup_name_by_id-2727"><span class="linenos">2727</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2728"><a href="#GuacamoleDB.get_usergroup_name_by_id-2728"><span class="linenos">2728</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2729"><a href="#GuacamoleDB.get_usergroup_name_by_id-2729"><span class="linenos">2729</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2730"><a href="#GuacamoleDB.get_usergroup_name_by_id-2730"><span class="linenos">2730</span></a><span class="sd">                SELECT e.name FROM guacamole_entity e</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2731"><a href="#GuacamoleDB.get_usergroup_name_by_id-2731"><span class="linenos">2731</span></a><span class="sd">                JOIN guacamole_user_group g ON e.entity_id = g.entity_id</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2732"><a href="#GuacamoleDB.get_usergroup_name_by_id-2732"><span class="linenos">2732</span></a><span class="sd">                WHERE g.user_group_id = %s</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2733"><a href="#GuacamoleDB.get_usergroup_name_by_id-2733"><span class="linenos">2733</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2734"><a href="#GuacamoleDB.get_usergroup_name_by_id-2734"><span class="linenos">2734</span></a>                <span class="p">(</span><span class="n">group_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2735"><a href="#GuacamoleDB.get_usergroup_name_by_id-2735"><span class="linenos">2735</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2736"><a href="#GuacamoleDB.get_usergroup_name_by_id-2736"><span class="linenos">2736</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2737"><a href="#GuacamoleDB.get_usergroup_name_by_id-2737"><span class="linenos">2737</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2738"><a href="#GuacamoleDB.get_usergroup_name_by_id-2738"><span class="linenos">2738</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usergroup with ID </span><span class="si">{</span><span class="n">group_id</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2739"><a href="#GuacamoleDB.get_usergroup_name_by_id-2739"><span class="linenos">2739</span></a>            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2740"><a href="#GuacamoleDB.get_usergroup_name_by_id-2740"><span class="linenos">2740</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.get_usergroup_name_by_id-2741"><a href="#GuacamoleDB.get_usergroup_name_by_id-2741"><span class="linenos">2741</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database error while getting usergroup name: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get user group name by its database ID.</p>

<p>Retrieves the name of a user group given its database ID.
This is useful for converting internal IDs back to human-readable names.</p>

<p>Args:
    group_id: The database ID of the user group.</p>

<p>Returns:
    The name of the user group.</p>

<p>Raises:
    ValueError: If user group with the specified ID is not found.
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     name = db.get_usergroup_name_by_id(42)
          ...     print(f"Group name: {name}")
          Group name: admin-group</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.list_groups_with_users" class="classattr">
                                        <input id="GuacamoleDB.list_groups_with_users-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_groups_with_users</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.list_groups_with_users-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.list_groups_with_users"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.list_groups_with_users-2743"><a href="#GuacamoleDB.list_groups_with_users-2743"><span class="linenos">2743</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">list_groups_with_users</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="GuacamoleDB.list_groups_with_users-2744"><a href="#GuacamoleDB.list_groups_with_users-2744"><span class="linenos">2744</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all user groups with their associated users.</span>
</span><span id="GuacamoleDB.list_groups_with_users-2745"><a href="#GuacamoleDB.list_groups_with_users-2745"><span class="linenos">2745</span></a>
</span><span id="GuacamoleDB.list_groups_with_users-2746"><a href="#GuacamoleDB.list_groups_with_users-2746"><span class="linenos">2746</span></a><span class="sd">        Retrieves a mapping of user group names to the list of usernames</span>
</span><span id="GuacamoleDB.list_groups_with_users-2747"><a href="#GuacamoleDB.list_groups_with_users-2747"><span class="linenos">2747</span></a><span class="sd">        that belong to each group. This provides a simplified view of</span>
</span><span id="GuacamoleDB.list_groups_with_users-2748"><a href="#GuacamoleDB.list_groups_with_users-2748"><span class="linenos">2748</span></a><span class="sd">        user group membership.</span>
</span><span id="GuacamoleDB.list_groups_with_users-2749"><a href="#GuacamoleDB.list_groups_with_users-2749"><span class="linenos">2749</span></a>
</span><span id="GuacamoleDB.list_groups_with_users-2750"><a href="#GuacamoleDB.list_groups_with_users-2750"><span class="linenos">2750</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.list_groups_with_users-2751"><a href="#GuacamoleDB.list_groups_with_users-2751"><span class="linenos">2751</span></a><span class="sd">            Dict[str, List[str]]: Mapping of group names to lists of usernames.</span>
</span><span id="GuacamoleDB.list_groups_with_users-2752"><a href="#GuacamoleDB.list_groups_with_users-2752"><span class="linenos">2752</span></a><span class="sd">                Groups with no members will have an empty list.</span>
</span><span id="GuacamoleDB.list_groups_with_users-2753"><a href="#GuacamoleDB.list_groups_with_users-2753"><span class="linenos">2753</span></a>
</span><span id="GuacamoleDB.list_groups_with_users-2754"><a href="#GuacamoleDB.list_groups_with_users-2754"><span class="linenos">2754</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.list_groups_with_users-2755"><a href="#GuacamoleDB.list_groups_with_users-2755"><span class="linenos">2755</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.list_groups_with_users-2756"><a href="#GuacamoleDB.list_groups_with_users-2756"><span class="linenos">2756</span></a>
</span><span id="GuacamoleDB.list_groups_with_users-2757"><a href="#GuacamoleDB.list_groups_with_users-2757"><span class="linenos">2757</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.list_groups_with_users-2758"><a href="#GuacamoleDB.list_groups_with_users-2758"><span class="linenos">2758</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.list_groups_with_users-2759"><a href="#GuacamoleDB.list_groups_with_users-2759"><span class="linenos">2759</span></a><span class="sd">            ...     groups = db.list_groups_with_users()</span>
</span><span id="GuacamoleDB.list_groups_with_users-2760"><a href="#GuacamoleDB.list_groups_with_users-2760"><span class="linenos">2760</span></a><span class="sd">            ...     for group_name, users in groups.items():</span>
</span><span id="GuacamoleDB.list_groups_with_users-2761"><a href="#GuacamoleDB.list_groups_with_users-2761"><span class="linenos">2761</span></a><span class="sd">            ...         print(f&quot;{group_name}: {users}&quot;)</span>
</span><span id="GuacamoleDB.list_groups_with_users-2762"><a href="#GuacamoleDB.list_groups_with_users-2762"><span class="linenos">2762</span></a><span class="sd">            admin: [&#39;admin1&#39;, &#39;admin2&#39;]</span>
</span><span id="GuacamoleDB.list_groups_with_users-2763"><a href="#GuacamoleDB.list_groups_with_users-2763"><span class="linenos">2763</span></a><span class="sd">            users: [&#39;john.doe&#39;, &#39;jane.smith&#39;]</span>
</span><span id="GuacamoleDB.list_groups_with_users-2764"><a href="#GuacamoleDB.list_groups_with_users-2764"><span class="linenos">2764</span></a><span class="sd">            guests: []</span>
</span><span id="GuacamoleDB.list_groups_with_users-2765"><a href="#GuacamoleDB.list_groups_with_users-2765"><span class="linenos">2765</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_groups_with_users-2766"><a href="#GuacamoleDB.list_groups_with_users-2766"><span class="linenos">2766</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_groups_with_users-2767"><a href="#GuacamoleDB.list_groups_with_users-2767"><span class="linenos">2767</span></a><span class="s2">            SELECT </span>
</span><span id="GuacamoleDB.list_groups_with_users-2768"><a href="#GuacamoleDB.list_groups_with_users-2768"><span class="linenos">2768</span></a><span class="s2">                e.name as groupname,</span>
</span><span id="GuacamoleDB.list_groups_with_users-2769"><a href="#GuacamoleDB.list_groups_with_users-2769"><span class="linenos">2769</span></a><span class="s2">                GROUP_CONCAT(DISTINCT ue.name) as usernames</span>
</span><span id="GuacamoleDB.list_groups_with_users-2770"><a href="#GuacamoleDB.list_groups_with_users-2770"><span class="linenos">2770</span></a><span class="s2">            FROM guacamole_entity e</span>
</span><span id="GuacamoleDB.list_groups_with_users-2771"><a href="#GuacamoleDB.list_groups_with_users-2771"><span class="linenos">2771</span></a><span class="s2">            LEFT JOIN guacamole_user_group ug ON e.entity_id = ug.entity_id</span>
</span><span id="GuacamoleDB.list_groups_with_users-2772"><a href="#GuacamoleDB.list_groups_with_users-2772"><span class="linenos">2772</span></a><span class="s2">            LEFT JOIN guacamole_user_group_member ugm ON ug.user_group_id = ugm.user_group_id</span>
</span><span id="GuacamoleDB.list_groups_with_users-2773"><a href="#GuacamoleDB.list_groups_with_users-2773"><span class="linenos">2773</span></a><span class="s2">            LEFT JOIN guacamole_entity ue ON ugm.member_entity_id = ue.entity_id AND ue.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.list_groups_with_users-2774"><a href="#GuacamoleDB.list_groups_with_users-2774"><span class="linenos">2774</span></a><span class="s2">            WHERE e.type = &#39;USER_GROUP&#39;</span>
</span><span id="GuacamoleDB.list_groups_with_users-2775"><a href="#GuacamoleDB.list_groups_with_users-2775"><span class="linenos">2775</span></a><span class="s2">            GROUP BY e.name</span>
</span><span id="GuacamoleDB.list_groups_with_users-2776"><a href="#GuacamoleDB.list_groups_with_users-2776"><span class="linenos">2776</span></a><span class="s2">            ORDER BY e.name</span>
</span><span id="GuacamoleDB.list_groups_with_users-2777"><a href="#GuacamoleDB.list_groups_with_users-2777"><span class="linenos">2777</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.list_groups_with_users-2778"><a href="#GuacamoleDB.list_groups_with_users-2778"><span class="linenos">2778</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="GuacamoleDB.list_groups_with_users-2779"><a href="#GuacamoleDB.list_groups_with_users-2779"><span class="linenos">2779</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB.list_groups_with_users-2780"><a href="#GuacamoleDB.list_groups_with_users-2780"><span class="linenos">2780</span></a>
</span><span id="GuacamoleDB.list_groups_with_users-2781"><a href="#GuacamoleDB.list_groups_with_users-2781"><span class="linenos">2781</span></a>        <span class="n">groups_users</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GuacamoleDB.list_groups_with_users-2782"><a href="#GuacamoleDB.list_groups_with_users-2782"><span class="linenos">2782</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="GuacamoleDB.list_groups_with_users-2783"><a href="#GuacamoleDB.list_groups_with_users-2783"><span class="linenos">2783</span></a>            <span class="n">groupname</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.list_groups_with_users-2784"><a href="#GuacamoleDB.list_groups_with_users-2784"><span class="linenos">2784</span></a>            <span class="n">usernames</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="GuacamoleDB.list_groups_with_users-2785"><a href="#GuacamoleDB.list_groups_with_users-2785"><span class="linenos">2785</span></a>            <span class="n">groups_users</span><span class="p">[</span><span class="n">groupname</span><span class="p">]</span> <span class="o">=</span> <span class="n">usernames</span>
</span><span id="GuacamoleDB.list_groups_with_users-2786"><a href="#GuacamoleDB.list_groups_with_users-2786"><span class="linenos">2786</span></a>
</span><span id="GuacamoleDB.list_groups_with_users-2787"><a href="#GuacamoleDB.list_groups_with_users-2787"><span class="linenos">2787</span></a>        <span class="k">return</span> <span class="n">groups_users</span>
</span></pre></div>


            <div class="docstring"><p>List all user groups with their associated users.</p>

<p>Retrieves a mapping of user group names to the list of usernames
that belong to each group. This provides a simplified view of
user group membership.</p>

<p>Returns:
    Dict[str, List[str]]: Mapping of group names to lists of usernames.
        Groups with no members will have an empty list.</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     groups = db.list_groups_with_users()
          ...     for group_name, users in groups.items():
          ...         print(f"{group_name}: {users}")
          admin: ['admin1', 'admin2']
          users: ['john.doe', 'jane.smith']
          guests: []</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.debug_connection_permissions" class="classattr">
                                        <input id="GuacamoleDB.debug_connection_permissions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">debug_connection_permissions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.debug_connection_permissions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.debug_connection_permissions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.debug_connection_permissions-2789"><a href="#GuacamoleDB.debug_connection_permissions-2789"><span class="linenos">2789</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">debug_connection_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2790"><a href="#GuacamoleDB.debug_connection_permissions-2790"><span class="linenos">2790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Debug function to check and display permissions for a connection.</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2791"><a href="#GuacamoleDB.debug_connection_permissions-2791"><span class="linenos">2791</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2792"><a href="#GuacamoleDB.debug_connection_permissions-2792"><span class="linenos">2792</span></a><span class="sd">        Outputs detailed debugging information about all permissions associated</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2793"><a href="#GuacamoleDB.debug_connection_permissions-2793"><span class="linenos">2793</span></a><span class="sd">        with a specific connection, including both user and user group permissions.</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2794"><a href="#GuacamoleDB.debug_connection_permissions-2794"><span class="linenos">2794</span></a><span class="sd">        This function is intended for troubleshooting connection access issues.</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2795"><a href="#GuacamoleDB.debug_connection_permissions-2795"><span class="linenos">2795</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2796"><a href="#GuacamoleDB.debug_connection_permissions-2796"><span class="linenos">2796</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2797"><a href="#GuacamoleDB.debug_connection_permissions-2797"><span class="linenos">2797</span></a><span class="sd">            connection_name: The name of the connection to debug.</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2798"><a href="#GuacamoleDB.debug_connection_permissions-2798"><span class="linenos">2798</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2799"><a href="#GuacamoleDB.debug_connection_permissions-2799"><span class="linenos">2799</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2800"><a href="#GuacamoleDB.debug_connection_permissions-2800"><span class="linenos">2800</span></a><span class="sd">            None (outputs debug information to stdout).</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2801"><a href="#GuacamoleDB.debug_connection_permissions-2801"><span class="linenos">2801</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2802"><a href="#GuacamoleDB.debug_connection_permissions-2802"><span class="linenos">2802</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2803"><a href="#GuacamoleDB.debug_connection_permissions-2803"><span class="linenos">2803</span></a><span class="sd">            mysql.connector.Error: If database query fails.</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2804"><a href="#GuacamoleDB.debug_connection_permissions-2804"><span class="linenos">2804</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2805"><a href="#GuacamoleDB.debug_connection_permissions-2805"><span class="linenos">2805</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2806"><a href="#GuacamoleDB.debug_connection_permissions-2806"><span class="linenos">2806</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2807"><a href="#GuacamoleDB.debug_connection_permissions-2807"><span class="linenos">2807</span></a><span class="sd">            ...     db.debug_connection_permissions(&quot;my-server&quot;)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2808"><a href="#GuacamoleDB.debug_connection_permissions-2808"><span class="linenos">2808</span></a><span class="sd">            [DEBUG] Checking permissions for connection &#39;my-server&#39;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2809"><a href="#GuacamoleDB.debug_connection_permissions-2809"><span class="linenos">2809</span></a><span class="sd">            [DEBUG] Connection ID: 42</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2810"><a href="#GuacamoleDB.debug_connection_permissions-2810"><span class="linenos">2810</span></a><span class="sd">            [DEBUG] Found 2 permissions:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2811"><a href="#GuacamoleDB.debug_connection_permissions-2811"><span class="linenos">2811</span></a><span class="sd">            [DEBUG]   Entity ID: 15, Name: john.doe, Type: USER, Permission: READ</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2812"><a href="#GuacamoleDB.debug_connection_permissions-2812"><span class="linenos">2812</span></a><span class="sd">            [DEBUG]   Entity ID: 20, Name: admin-group, Type: USER_GROUP, Permission: READ</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2813"><a href="#GuacamoleDB.debug_connection_permissions-2813"><span class="linenos">2813</span></a><span class="sd">            [DEBUG] Found 1 user permissions:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2814"><a href="#GuacamoleDB.debug_connection_permissions-2814"><span class="linenos">2814</span></a><span class="sd">            [DEBUG]   User: john.doe</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2815"><a href="#GuacamoleDB.debug_connection_permissions-2815"><span class="linenos">2815</span></a><span class="sd">            [DEBUG] End of debug info</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2816"><a href="#GuacamoleDB.debug_connection_permissions-2816"><span class="linenos">2816</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2817"><a href="#GuacamoleDB.debug_connection_permissions-2817"><span class="linenos">2817</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2818"><a href="#GuacamoleDB.debug_connection_permissions-2818"><span class="linenos">2818</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking permissions for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2819"><a href="#GuacamoleDB.debug_connection_permissions-2819"><span class="linenos">2819</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2820"><a href="#GuacamoleDB.debug_connection_permissions-2820"><span class="linenos">2820</span></a>            <span class="c1"># Get connection ID</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2821"><a href="#GuacamoleDB.debug_connection_permissions-2821"><span class="linenos">2821</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2822"><a href="#GuacamoleDB.debug_connection_permissions-2822"><span class="linenos">2822</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2823"><a href="#GuacamoleDB.debug_connection_permissions-2823"><span class="linenos">2823</span></a><span class="sd">                SELECT connection_id FROM guacamole_connection</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2824"><a href="#GuacamoleDB.debug_connection_permissions-2824"><span class="linenos">2824</span></a><span class="sd">                WHERE connection_name = %s</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2825"><a href="#GuacamoleDB.debug_connection_permissions-2825"><span class="linenos">2825</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2826"><a href="#GuacamoleDB.debug_connection_permissions-2826"><span class="linenos">2826</span></a>                <span class="p">(</span><span class="n">connection_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2827"><a href="#GuacamoleDB.debug_connection_permissions-2827"><span class="linenos">2827</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2828"><a href="#GuacamoleDB.debug_connection_permissions-2828"><span class="linenos">2828</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2829"><a href="#GuacamoleDB.debug_connection_permissions-2829"><span class="linenos">2829</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2830"><a href="#GuacamoleDB.debug_connection_permissions-2830"><span class="linenos">2830</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2831"><a href="#GuacamoleDB.debug_connection_permissions-2831"><span class="linenos">2831</span></a>                <span class="k">return</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2832"><a href="#GuacamoleDB.debug_connection_permissions-2832"><span class="linenos">2832</span></a>            <span class="n">connection_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2833"><a href="#GuacamoleDB.debug_connection_permissions-2833"><span class="linenos">2833</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection ID: </span><span class="si">{</span><span class="n">connection_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2834"><a href="#GuacamoleDB.debug_connection_permissions-2834"><span class="linenos">2834</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2835"><a href="#GuacamoleDB.debug_connection_permissions-2835"><span class="linenos">2835</span></a>            <span class="c1"># Check all permissions</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2836"><a href="#GuacamoleDB.debug_connection_permissions-2836"><span class="linenos">2836</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2837"><a href="#GuacamoleDB.debug_connection_permissions-2837"><span class="linenos">2837</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2838"><a href="#GuacamoleDB.debug_connection_permissions-2838"><span class="linenos">2838</span></a><span class="sd">                SELECT cp.entity_id, e.name, e.type, cp.permission</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2839"><a href="#GuacamoleDB.debug_connection_permissions-2839"><span class="linenos">2839</span></a><span class="sd">                FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2840"><a href="#GuacamoleDB.debug_connection_permissions-2840"><span class="linenos">2840</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2841"><a href="#GuacamoleDB.debug_connection_permissions-2841"><span class="linenos">2841</span></a><span class="sd">                WHERE cp.connection_id = %s</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2842"><a href="#GuacamoleDB.debug_connection_permissions-2842"><span class="linenos">2842</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2843"><a href="#GuacamoleDB.debug_connection_permissions-2843"><span class="linenos">2843</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2844"><a href="#GuacamoleDB.debug_connection_permissions-2844"><span class="linenos">2844</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2845"><a href="#GuacamoleDB.debug_connection_permissions-2845"><span class="linenos">2845</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2846"><a href="#GuacamoleDB.debug_connection_permissions-2846"><span class="linenos">2846</span></a>            <span class="n">permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2847"><a href="#GuacamoleDB.debug_connection_permissions-2847"><span class="linenos">2847</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2848"><a href="#GuacamoleDB.debug_connection_permissions-2848"><span class="linenos">2848</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2849"><a href="#GuacamoleDB.debug_connection_permissions-2849"><span class="linenos">2849</span></a>                    <span class="sa">f</span><span class="s2">&quot;No permissions found for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2850"><a href="#GuacamoleDB.debug_connection_permissions-2850"><span class="linenos">2850</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2851"><a href="#GuacamoleDB.debug_connection_permissions-2851"><span class="linenos">2851</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2852"><a href="#GuacamoleDB.debug_connection_permissions-2852"><span class="linenos">2852</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">permissions</span><span class="p">)</span><span class="si">}</span><span class="s2"> permissions:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2853"><a href="#GuacamoleDB.debug_connection_permissions-2853"><span class="linenos">2853</span></a>                <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2854"><a href="#GuacamoleDB.debug_connection_permissions-2854"><span class="linenos">2854</span></a>                    <span class="n">entity_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">perm</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2855"><a href="#GuacamoleDB.debug_connection_permissions-2855"><span class="linenos">2855</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2856"><a href="#GuacamoleDB.debug_connection_permissions-2856"><span class="linenos">2856</span></a>                        <span class="sa">f</span><span class="s2">&quot;  Entity ID: </span><span class="si">{</span><span class="n">entity_id</span><span class="si">}</span><span class="s2">, Name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, Type: </span><span class="si">{</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">, Permission: </span><span class="si">{</span><span class="n">permission</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2857"><a href="#GuacamoleDB.debug_connection_permissions-2857"><span class="linenos">2857</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2858"><a href="#GuacamoleDB.debug_connection_permissions-2858"><span class="linenos">2858</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2859"><a href="#GuacamoleDB.debug_connection_permissions-2859"><span class="linenos">2859</span></a>            <span class="c1"># Specifically check user permissions</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2860"><a href="#GuacamoleDB.debug_connection_permissions-2860"><span class="linenos">2860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2861"><a href="#GuacamoleDB.debug_connection_permissions-2861"><span class="linenos">2861</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2862"><a href="#GuacamoleDB.debug_connection_permissions-2862"><span class="linenos">2862</span></a><span class="sd">                SELECT e.name</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2863"><a href="#GuacamoleDB.debug_connection_permissions-2863"><span class="linenos">2863</span></a><span class="sd">                FROM guacamole_connection_permission cp</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2864"><a href="#GuacamoleDB.debug_connection_permissions-2864"><span class="linenos">2864</span></a><span class="sd">                JOIN guacamole_entity e ON cp.entity_id = e.entity_id</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2865"><a href="#GuacamoleDB.debug_connection_permissions-2865"><span class="linenos">2865</span></a><span class="sd">                WHERE cp.connection_id = %s AND e.type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2866"><a href="#GuacamoleDB.debug_connection_permissions-2866"><span class="linenos">2866</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2867"><a href="#GuacamoleDB.debug_connection_permissions-2867"><span class="linenos">2867</span></a>                <span class="p">(</span><span class="n">connection_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2868"><a href="#GuacamoleDB.debug_connection_permissions-2868"><span class="linenos">2868</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2869"><a href="#GuacamoleDB.debug_connection_permissions-2869"><span class="linenos">2869</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2870"><a href="#GuacamoleDB.debug_connection_permissions-2870"><span class="linenos">2870</span></a>            <span class="n">user_permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2871"><a href="#GuacamoleDB.debug_connection_permissions-2871"><span class="linenos">2871</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2872"><a href="#GuacamoleDB.debug_connection_permissions-2872"><span class="linenos">2872</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2873"><a href="#GuacamoleDB.debug_connection_permissions-2873"><span class="linenos">2873</span></a>                    <span class="sa">f</span><span class="s2">&quot;No user permissions found for connection &#39;</span><span class="si">{</span><span class="n">connection_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2874"><a href="#GuacamoleDB.debug_connection_permissions-2874"><span class="linenos">2874</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2875"><a href="#GuacamoleDB.debug_connection_permissions-2875"><span class="linenos">2875</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2876"><a href="#GuacamoleDB.debug_connection_permissions-2876"><span class="linenos">2876</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">user_permissions</span><span class="p">)</span><span class="si">}</span><span class="s2"> user permissions:&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2877"><a href="#GuacamoleDB.debug_connection_permissions-2877"><span class="linenos">2877</span></a>                <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">user_permissions</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2878"><a href="#GuacamoleDB.debug_connection_permissions-2878"><span class="linenos">2878</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  User: </span><span class="si">{</span><span class="n">perm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2879"><a href="#GuacamoleDB.debug_connection_permissions-2879"><span class="linenos">2879</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2880"><a href="#GuacamoleDB.debug_connection_permissions-2880"><span class="linenos">2880</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;End of debug info&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2881"><a href="#GuacamoleDB.debug_connection_permissions-2881"><span class="linenos">2881</span></a>
</span><span id="GuacamoleDB.debug_connection_permissions-2882"><a href="#GuacamoleDB.debug_connection_permissions-2882"><span class="linenos">2882</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.debug_connection_permissions-2883"><a href="#GuacamoleDB.debug_connection_permissions-2883"><span class="linenos">2883</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error debugging permissions: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Debug function to check and display permissions for a connection.</p>

<p>Outputs detailed debugging information about all permissions associated
with a specific connection, including both user and user group permissions.
This function is intended for troubleshooting connection access issues.</p>

<p>Args:
    connection_name: The name of the connection to debug.</p>

<p>Returns:
    None (outputs debug information to stdout).</p>

<p>Raises:
    mysql.connector.Error: If database query fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     db.debug_connection_permissions("my-server")
          [DEBUG] Checking permissions for connection 'my-server'
          [DEBUG] Connection ID: 42
          [DEBUG] Found 2 permissions:
          [DEBUG]   Entity ID: 15, Name: john.doe, Type: USER, Permission: READ
          [DEBUG]   Entity ID: 20, Name: admin-group, Type: USER_GROUP, Permission: READ
          [DEBUG] Found 1 user permissions:
          [DEBUG]   User: john.doe
          [DEBUG] End of debug info</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.grant_connection_group_permission_to_user" class="classattr">
                                        <input id="GuacamoleDB.grant_connection_group_permission_to_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grant_connection_group_permission_to_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">conngroup_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.grant_connection_group_permission_to_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.grant_connection_group_permission_to_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2885"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2885"><span class="linenos">2885</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_group_permission_to_user</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2886"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2886"><span class="linenos">2886</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2887"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2887"><span class="linenos">2887</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2888"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2888"><span class="linenos">2888</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Grant connection group permission to a specific user.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2889"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2889"><span class="linenos">2889</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2890"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2890"><span class="linenos">2890</span></a><span class="sd">        Grants READ permission to a user for accessing a connection group.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2891"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2891"><span class="linenos">2891</span></a><span class="sd">        This allows the user to see and use all connections within that group.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2892"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2892"><span class="linenos">2892</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2893"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2893"><span class="linenos">2893</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2894"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2894"><span class="linenos">2894</span></a><span class="sd">            username: Name of the user to grant permission to.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2895"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2895"><span class="linenos">2895</span></a><span class="sd">            conngroup_name: Name of the connection group to grant access to.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2896"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2896"><span class="linenos">2896</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2897"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2897"><span class="linenos">2897</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2898"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2898"><span class="linenos">2898</span></a><span class="sd">            True if the permission was granted successfully.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2899"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2899"><span class="linenos">2899</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2900"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2900"><span class="linenos">2900</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2901"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2901"><span class="linenos">2901</span></a><span class="sd">            ValueError: If username or connection group name is invalid, or if</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2902"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2902"><span class="linenos">2902</span></a><span class="sd">                       the user or connection group doesn&#39;t exist.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2903"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2903"><span class="linenos">2903</span></a><span class="sd">            mysql.connector.Error: If database operation fails.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2904"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2904"><span class="linenos">2904</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2905"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2905"><span class="linenos">2905</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2906"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2906"><span class="linenos">2906</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2907"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2907"><span class="linenos">2907</span></a><span class="sd">            ...     success = db.grant_connection_group_permission_to_user(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2908"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2908"><span class="linenos">2908</span></a><span class="sd">            ...         &quot;john.doe&quot;, &quot;Production Servers&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2909"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2909"><span class="linenos">2909</span></a><span class="sd">            ...     )</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2910"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2910"><span class="linenos">2910</span></a><span class="sd">            ...     print(f&quot;Permission granted: {success}&quot;)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2911"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2911"><span class="linenos">2911</span></a><span class="sd">            Permission granted: True</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2912"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2912"><span class="linenos">2912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2913"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2913"><span class="linenos">2913</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2914"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2914"><span class="linenos">2914</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2915"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2915"><span class="linenos">2915</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">conngroup_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2916"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2916"><span class="linenos">2916</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group name must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2917"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2917"><span class="linenos">2917</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2918"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2918"><span class="linenos">2918</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2919"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2919"><span class="linenos">2919</span></a>            <span class="c1"># Get connection group ID</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2920"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2920"><span class="linenos">2920</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2921"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2921"><span class="linenos">2921</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2922"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2922"><span class="linenos">2922</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2923"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2923"><span class="linenos">2923</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2924"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2924"><span class="linenos">2924</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2925"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2925"><span class="linenos">2925</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2926"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2926"><span class="linenos">2926</span></a>                <span class="p">(</span><span class="n">conngroup_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2927"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2927"><span class="linenos">2927</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2928"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2928"><span class="linenos">2928</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2929"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2929"><span class="linenos">2929</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2930"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2930"><span class="linenos">2930</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2931"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2931"><span class="linenos">2931</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group lookup failed for: </span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2932"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2932"><span class="linenos">2932</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2933"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2933"><span class="linenos">2933</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2934"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2934"><span class="linenos">2934</span></a>            <span class="n">connection_group_id</span><span class="p">,</span> <span class="n">actual_conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2935"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2935"><span class="linenos">2935</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2936"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2936"><span class="linenos">2936</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2937"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2937"><span class="linenos">2937</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2938"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2938"><span class="linenos">2938</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2939"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2939"><span class="linenos">2939</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2940"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2940"><span class="linenos">2940</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2941"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2941"><span class="linenos">2941</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2942"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2942"><span class="linenos">2942</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2943"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2943"><span class="linenos">2943</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2944"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2944"><span class="linenos">2944</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2945"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2945"><span class="linenos">2945</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2946"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2946"><span class="linenos">2946</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2947"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2947"><span class="linenos">2947</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2948"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2948"><span class="linenos">2948</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2949"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2949"><span class="linenos">2949</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2950"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2950"><span class="linenos">2950</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2951"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2951"><span class="linenos">2951</span></a>            <span class="c1"># Check if permission already exists</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2952"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2952"><span class="linenos">2952</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2953"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2953"><span class="linenos">2953</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2954"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2954"><span class="linenos">2954</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2955"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2955"><span class="linenos">2955</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2956"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2956"><span class="linenos">2956</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2957"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2957"><span class="linenos">2957</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2958"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2958"><span class="linenos">2958</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2959"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2959"><span class="linenos">2959</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2960"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2960"><span class="linenos">2960</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2961"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2961"><span class="linenos">2961</span></a>            <span class="k">if</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2962"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2962"><span class="linenos">2962</span></a>                <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2963"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2963"><span class="linenos">2963</span></a>                <span class="k">if</span> <span class="n">permission_type</span> <span class="o">==</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2964"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2964"><span class="linenos">2964</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2965"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2965"><span class="linenos">2965</span></a>                        <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; already has permission for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2966"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2966"><span class="linenos">2966</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2967"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2967"><span class="linenos">2967</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2968"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2968"><span class="linenos">2968</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2969"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2969"><span class="linenos">2969</span></a>                        <span class="sa">f</span><span class="s2">&quot;Updating existing permission &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2970"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2970"><span class="linenos">2970</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2971"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2971"><span class="linenos">2971</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2972"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2972"><span class="linenos">2972</span></a>            <span class="c1"># Grant permission (INSERT or UPDATE if unexpected permission exists)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2973"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2973"><span class="linenos">2973</span></a>            <span class="k">if</span> <span class="n">existing_permission</span> <span class="ow">and</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2974"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2974"><span class="linenos">2974</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2975"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2975"><span class="linenos">2975</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2976"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2976"><span class="linenos">2976</span></a><span class="sd">                    UPDATE guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2977"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2977"><span class="linenos">2977</span></a><span class="sd">                    SET permission = &#39;READ&#39;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2978"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2978"><span class="linenos">2978</span></a><span class="sd">                    WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2979"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2979"><span class="linenos">2979</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2980"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2980"><span class="linenos">2980</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2981"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2981"><span class="linenos">2981</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2982"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2982"><span class="linenos">2982</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2983"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2983"><span class="linenos">2983</span></a>                    <span class="sa">f</span><span class="s2">&quot;Updated permission to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; on connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2984"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2984"><span class="linenos">2984</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2985"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2985"><span class="linenos">2985</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2986"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2986"><span class="linenos">2986</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2987"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2987"><span class="linenos">2987</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2988"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2988"><span class="linenos">2988</span></a><span class="sd">                    INSERT INTO guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2989"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2989"><span class="linenos">2989</span></a><span class="sd">                    (entity_id, connection_group_id, permission)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2990"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2990"><span class="linenos">2990</span></a><span class="sd">                    VALUES (%s, %s, &#39;READ&#39;)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2991"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2991"><span class="linenos">2991</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2992"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2992"><span class="linenos">2992</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2993"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2993"><span class="linenos">2993</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2994"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2994"><span class="linenos">2994</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2995"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2995"><span class="linenos">2995</span></a>                    <span class="sa">f</span><span class="s2">&quot;Granted &#39;READ&#39; permission to user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2996"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2996"><span class="linenos">2996</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2997"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2997"><span class="linenos">2997</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2998"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2998"><span class="linenos">2998</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-2999"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-2999"><span class="linenos">2999</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-3000"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-3000"><span class="linenos">3000</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error granting connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-3001"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-3001"><span class="linenos">3001</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user-3002"><a href="#GuacamoleDB.grant_connection_group_permission_to_user-3002"><span class="linenos">3002</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span></pre></div>


            <div class="docstring"><p>Grant connection group permission to a specific user.</p>

<p>Grants READ permission to a user for accessing a connection group.
This allows the user to see and use all connections within that group.</p>

<p>Args:
    username: Name of the user to grant permission to.
    conngroup_name: Name of the connection group to grant access to.</p>

<p>Returns:
    True if the permission was granted successfully.</p>

<p>Raises:
    ValueError: If username or connection group name is invalid, or if
               the user or connection group doesn't exist.
    mysql.connector.Error: If database operation fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     success = db.grant_connection_group_permission_to_user(
          ...         "john.doe", "Production Servers"
          ...     )
          ...     print(f"Permission granted: {success}")
          Permission granted: True</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.revoke_connection_group_permission_from_user" class="classattr">
                                        <input id="GuacamoleDB.revoke_connection_group_permission_from_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">revoke_connection_group_permission_from_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">conngroup_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.revoke_connection_group_permission_from_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.revoke_connection_group_permission_from_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3004"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3004"><span class="linenos">3004</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_connection_group_permission_from_user</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3005"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3005"><span class="linenos">3005</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3006"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3006"><span class="linenos">3006</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3007"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3007"><span class="linenos">3007</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke connection group permission from a specific user&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3008"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3008"><span class="linenos">3008</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3009"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3009"><span class="linenos">3009</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3010"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3010"><span class="linenos">3010</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">conngroup_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3011"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3011"><span class="linenos">3011</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group name must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3012"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3012"><span class="linenos">3012</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3013"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3013"><span class="linenos">3013</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3014"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3014"><span class="linenos">3014</span></a>            <span class="c1"># Get connection group ID</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3015"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3015"><span class="linenos">3015</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3016"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3016"><span class="linenos">3016</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3017"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3017"><span class="linenos">3017</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3018"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3018"><span class="linenos">3018</span></a><span class="sd">                WHERE connection_group_name = %s</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3019"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3019"><span class="linenos">3019</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3020"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3020"><span class="linenos">3020</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3021"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3021"><span class="linenos">3021</span></a>                <span class="p">(</span><span class="n">conngroup_name</span><span class="p">,),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3022"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3022"><span class="linenos">3022</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3023"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3023"><span class="linenos">3023</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3024"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3024"><span class="linenos">3024</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3025"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3025"><span class="linenos">3025</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3026"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3026"><span class="linenos">3026</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group lookup failed for: </span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3027"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3027"><span class="linenos">3027</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3028"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3028"><span class="linenos">3028</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3029"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3029"><span class="linenos">3029</span></a>            <span class="n">connection_group_id</span><span class="p">,</span> <span class="n">actual_conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3030"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3030"><span class="linenos">3030</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3031"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3031"><span class="linenos">3031</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3032"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3032"><span class="linenos">3032</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3033"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3033"><span class="linenos">3033</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3034"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3034"><span class="linenos">3034</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3035"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3035"><span class="linenos">3035</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3036"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3036"><span class="linenos">3036</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3037"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3037"><span class="linenos">3037</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3038"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3038"><span class="linenos">3038</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3039"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3039"><span class="linenos">3039</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3040"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3040"><span class="linenos">3040</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3041"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3041"><span class="linenos">3041</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3042"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3042"><span class="linenos">3042</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3043"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3043"><span class="linenos">3043</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3044"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3044"><span class="linenos">3044</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3045"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3045"><span class="linenos">3045</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3046"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3046"><span class="linenos">3046</span></a>            <span class="c1"># Check if permission exists and get its type</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3047"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3047"><span class="linenos">3047</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3048"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3048"><span class="linenos">3048</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3049"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3049"><span class="linenos">3049</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3050"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3050"><span class="linenos">3050</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3051"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3051"><span class="linenos">3051</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3052"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3052"><span class="linenos">3052</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3053"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3053"><span class="linenos">3053</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3054"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3054"><span class="linenos">3054</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3055"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3055"><span class="linenos">3055</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3056"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3056"><span class="linenos">3056</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3057"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3057"><span class="linenos">3057</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3058"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3058"><span class="linenos">3058</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; has no permission for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3059"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3059"><span class="linenos">3059</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3060"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3060"><span class="linenos">3060</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3061"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3061"><span class="linenos">3061</span></a>            <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3062"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3062"><span class="linenos">3062</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3063"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3063"><span class="linenos">3063</span></a>                <span class="sa">f</span><span class="s2">&quot;Revoking &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3064"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3064"><span class="linenos">3064</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3065"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3065"><span class="linenos">3065</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3066"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3066"><span class="linenos">3066</span></a>            <span class="c1"># Revoke permission</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3067"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3067"><span class="linenos">3067</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3068"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3068"><span class="linenos">3068</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3069"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3069"><span class="linenos">3069</span></a><span class="sd">                DELETE FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3070"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3070"><span class="linenos">3070</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3071"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3071"><span class="linenos">3071</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3072"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3072"><span class="linenos">3072</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3073"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3073"><span class="linenos">3073</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">connection_group_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3074"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3074"><span class="linenos">3074</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3075"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3075"><span class="linenos">3075</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3076"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3076"><span class="linenos">3076</span></a>            <span class="c1"># Verify deletion was successful</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3077"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3077"><span class="linenos">3077</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3078"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3078"><span class="linenos">3078</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3079"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3079"><span class="linenos">3079</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to revoke permission - no rows affected. Permission may have been removed by another operation.&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3080"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3080"><span class="linenos">3080</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3081"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3081"><span class="linenos">3081</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3082"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3082"><span class="linenos">3082</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3083"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3083"><span class="linenos">3083</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully revoked &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group &#39;</span><span class="si">{</span><span class="n">actual_conngroup_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3084"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3084"><span class="linenos">3084</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3085"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3085"><span class="linenos">3085</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3086"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3086"><span class="linenos">3086</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3087"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3087"><span class="linenos">3087</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error revoking connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group &#39;</span><span class="si">{</span><span class="n">conngroup_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3088"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3088"><span class="linenos">3088</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user-3089"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user-3089"><span class="linenos">3089</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span></pre></div>


            <div class="docstring"><p>Revoke connection group permission from a specific user</p>
</div>


                            </div>
                            <div id="GuacamoleDB.grant_connection_group_permission_to_user_by_id" class="classattr">
                                        <input id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grant_connection_group_permission_to_user_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">conngroup_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.grant_connection_group_permission_to_user_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3102"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3102"><span class="linenos">3102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grant_connection_group_permission_to_user_by_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3103"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3103"><span class="linenos">3103</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3104"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3104"><span class="linenos">3104</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3105"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3105"><span class="linenos">3105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Grant connection group permission to a user using connection group ID.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3106"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3106"><span class="linenos">3106</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3107"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3107"><span class="linenos">3107</span></a><span class="sd">        Grants READ permission to a user for accessing a connection group</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3108"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3108"><span class="linenos">3108</span></a><span class="sd">        when you have the database ID rather than the name.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3109"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3109"><span class="linenos">3109</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3110"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3110"><span class="linenos">3110</span></a><span class="sd">        Args:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3111"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3111"><span class="linenos">3111</span></a><span class="sd">            username: Name of the user to grant permission to.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3112"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3112"><span class="linenos">3112</span></a><span class="sd">            conngroup_id: Database ID of the connection group to grant access to.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3113"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3113"><span class="linenos">3113</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3114"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3114"><span class="linenos">3114</span></a><span class="sd">        Returns:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3115"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3115"><span class="linenos">3115</span></a><span class="sd">            True if the permission was granted successfully.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3116"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3116"><span class="linenos">3116</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3117"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3117"><span class="linenos">3117</span></a><span class="sd">        Raises:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3118"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3118"><span class="linenos">3118</span></a><span class="sd">            ValueError: If username is invalid, conngroup_id is not a positive</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3119"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3119"><span class="linenos">3119</span></a><span class="sd">                       integer, or if the user or connection group doesn&#39;t exist.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3120"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3120"><span class="linenos">3120</span></a><span class="sd">            mysql.connector.Error: If database operation fails.</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3121"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3121"><span class="linenos">3121</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3122"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3122"><span class="linenos">3122</span></a><span class="sd">        Example:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3123"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3123"><span class="linenos">3123</span></a><span class="sd">            &gt;&gt;&gt; with GuacamoleDB() as db:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3124"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3124"><span class="linenos">3124</span></a><span class="sd">            ...     success = db.grant_connection_group_permission_to_user_by_id(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3125"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3125"><span class="linenos">3125</span></a><span class="sd">            ...         &quot;john.doe&quot;, 42</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3126"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3126"><span class="linenos">3126</span></a><span class="sd">            ...     )</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3127"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3127"><span class="linenos">3127</span></a><span class="sd">            ...     print(f&quot;Permission granted: {success}&quot;)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3128"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3128"><span class="linenos">3128</span></a><span class="sd">            Permission granted: True</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3129"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3129"><span class="linenos">3129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3130"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3130"><span class="linenos">3130</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3131"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3131"><span class="linenos">3131</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3132"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3132"><span class="linenos">3132</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3133"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3133"><span class="linenos">3133</span></a>            <span class="n">conngroup_id</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3134"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3134"><span class="linenos">3134</span></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3135"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3135"><span class="linenos">3135</span></a>            <span class="ow">or</span> <span class="n">conngroup_id</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3136"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3136"><span class="linenos">3136</span></a>        <span class="p">):</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3137"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3137"><span class="linenos">3137</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group ID must be a positive integer&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3138"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3138"><span class="linenos">3138</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3139"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3139"><span class="linenos">3139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3140"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3140"><span class="linenos">3140</span></a>            <span class="c1"># Get connection group name for error messages</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3141"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3141"><span class="linenos">3141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3142"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3142"><span class="linenos">3142</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3143"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3143"><span class="linenos">3143</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3144"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3144"><span class="linenos">3144</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3145"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3145"><span class="linenos">3145</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3146"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3146"><span class="linenos">3146</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3147"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3147"><span class="linenos">3147</span></a>                <span class="p">(</span><span class="n">conngroup_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3148"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3148"><span class="linenos">3148</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3149"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3149"><span class="linenos">3149</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3150"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3150"><span class="linenos">3150</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3151"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3151"><span class="linenos">3151</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3152"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3152"><span class="linenos">3152</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group ID lookup failed for: </span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3153"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3153"><span class="linenos">3153</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3154"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3154"><span class="linenos">3154</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3155"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3155"><span class="linenos">3155</span></a>            <span class="n">actual_conngroup_id</span><span class="p">,</span> <span class="n">conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3156"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3156"><span class="linenos">3156</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3157"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3157"><span class="linenos">3157</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3158"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3158"><span class="linenos">3158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3159"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3159"><span class="linenos">3159</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3160"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3160"><span class="linenos">3160</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3161"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3161"><span class="linenos">3161</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3162"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3162"><span class="linenos">3162</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3163"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3163"><span class="linenos">3163</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3164"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3164"><span class="linenos">3164</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3165"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3165"><span class="linenos">3165</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3166"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3166"><span class="linenos">3166</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3167"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3167"><span class="linenos">3167</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3168"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3168"><span class="linenos">3168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3169"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3169"><span class="linenos">3169</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3170"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3170"><span class="linenos">3170</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3171"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3171"><span class="linenos">3171</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3172"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3172"><span class="linenos">3172</span></a>            <span class="c1"># Check if permission already exists</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3173"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3173"><span class="linenos">3173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3174"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3174"><span class="linenos">3174</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3175"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3175"><span class="linenos">3175</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3176"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3176"><span class="linenos">3176</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3177"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3177"><span class="linenos">3177</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3178"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3178"><span class="linenos">3178</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3179"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3179"><span class="linenos">3179</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3180"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3180"><span class="linenos">3180</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3181"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3181"><span class="linenos">3181</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3182"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3182"><span class="linenos">3182</span></a>            <span class="k">if</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3183"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3183"><span class="linenos">3183</span></a>                <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3184"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3184"><span class="linenos">3184</span></a>                <span class="k">if</span> <span class="n">permission_type</span> <span class="o">==</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3185"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3185"><span class="linenos">3185</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3186"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3186"><span class="linenos">3186</span></a>                        <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; already has permission for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3187"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3187"><span class="linenos">3187</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3188"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3188"><span class="linenos">3188</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3189"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3189"><span class="linenos">3189</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3190"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3190"><span class="linenos">3190</span></a>                        <span class="sa">f</span><span class="s2">&quot;Updating existing permission &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3191"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3191"><span class="linenos">3191</span></a>                    <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3192"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3192"><span class="linenos">3192</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3193"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3193"><span class="linenos">3193</span></a>            <span class="c1"># Grant permission (INSERT or UPDATE if unexpected permission exists)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3194"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3194"><span class="linenos">3194</span></a>            <span class="k">if</span> <span class="n">existing_permission</span> <span class="ow">and</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3195"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3195"><span class="linenos">3195</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3196"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3196"><span class="linenos">3196</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3197"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3197"><span class="linenos">3197</span></a><span class="sd">                    UPDATE guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3198"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3198"><span class="linenos">3198</span></a><span class="sd">                    SET permission = &#39;READ&#39;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3199"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3199"><span class="linenos">3199</span></a><span class="sd">                    WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3200"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3200"><span class="linenos">3200</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3201"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3201"><span class="linenos">3201</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3202"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3202"><span class="linenos">3202</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3203"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3203"><span class="linenos">3203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3204"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3204"><span class="linenos">3204</span></a>                    <span class="sa">f</span><span class="s2">&quot;Updated permission to &#39;READ&#39; for user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; on connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3205"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3205"><span class="linenos">3205</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3206"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3206"><span class="linenos">3206</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3207"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3207"><span class="linenos">3207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3208"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3208"><span class="linenos">3208</span></a><span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3209"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3209"><span class="linenos">3209</span></a><span class="sd">                    INSERT INTO guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3210"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3210"><span class="linenos">3210</span></a><span class="sd">                    (entity_id, connection_group_id, permission)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3211"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3211"><span class="linenos">3211</span></a><span class="sd">                    VALUES (%s, %s, &#39;READ&#39;)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3212"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3212"><span class="linenos">3212</span></a><span class="sd">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3213"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3213"><span class="linenos">3213</span></a>                    <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3214"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3214"><span class="linenos">3214</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3215"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3215"><span class="linenos">3215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3216"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3216"><span class="linenos">3216</span></a>                    <span class="sa">f</span><span class="s2">&quot;Granted &#39;READ&#39; permission to user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3217"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3217"><span class="linenos">3217</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3218"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3218"><span class="linenos">3218</span></a>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3219"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3219"><span class="linenos">3219</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3220"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3220"><span class="linenos">3220</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3221"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3221"><span class="linenos">3221</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error granting connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3222"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3222"><span class="linenos">3222</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB.grant_connection_group_permission_to_user_by_id-3223"><a href="#GuacamoleDB.grant_connection_group_permission_to_user_by_id-3223"><span class="linenos">3223</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span></pre></div>


            <div class="docstring"><p>Grant connection group permission to a user using connection group ID.</p>

<p>Grants READ permission to a user for accessing a connection group
when you have the database ID rather than the name.</p>

<p>Args:
    username: Name of the user to grant permission to.
    conngroup_id: Database ID of the connection group to grant access to.</p>

<p>Returns:
    True if the permission was granted successfully.</p>

<p>Raises:
    ValueError: If username is invalid, conngroup_id is not a positive
               integer, or if the user or connection group doesn't exist.
    mysql.connector.Error: If database operation fails.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>with GuacamoleDB() as db:
          ...     success = db.grant_connection_group_permission_to_user_by_id(
          ...         "john.doe", 42
          ...     )
          ...     print(f"Permission granted: {success}")
          Permission granted: True</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                            <div id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id" class="classattr">
                                        <input id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">revoke_connection_group_permission_from_user_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">conngroup_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3225"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3225"><span class="linenos">3225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_connection_group_permission_from_user_by_id</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3226"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3226"><span class="linenos">3226</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conngroup_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3227"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3227"><span class="linenos">3227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3228"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3228"><span class="linenos">3228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Revoke connection group permission from a specific user by connection group ID&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3229"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3229"><span class="linenos">3229</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3230"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3230"><span class="linenos">3230</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be a non-empty string&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3231"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3231"><span class="linenos">3231</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3232"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3232"><span class="linenos">3232</span></a>            <span class="n">conngroup_id</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3233"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3233"><span class="linenos">3233</span></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conngroup_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3234"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3234"><span class="linenos">3234</span></a>            <span class="ow">or</span> <span class="n">conngroup_id</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3235"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3235"><span class="linenos">3235</span></a>        <span class="p">):</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3236"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3236"><span class="linenos">3236</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection group ID must be a positive integer&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3237"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3237"><span class="linenos">3237</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3238"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3238"><span class="linenos">3238</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3239"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3239"><span class="linenos">3239</span></a>            <span class="c1"># Get connection group name for error messages</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3240"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3240"><span class="linenos">3240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3241"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3241"><span class="linenos">3241</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3242"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3242"><span class="linenos">3242</span></a><span class="sd">                SELECT connection_group_id, connection_group_name FROM guacamole_connection_group</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3243"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3243"><span class="linenos">3243</span></a><span class="sd">                WHERE connection_group_id = %s</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3244"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3244"><span class="linenos">3244</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3245"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3245"><span class="linenos">3245</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3246"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3246"><span class="linenos">3246</span></a>                <span class="p">(</span><span class="n">conngroup_id</span><span class="p">,),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3247"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3247"><span class="linenos">3247</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3248"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3248"><span class="linenos">3248</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3249"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3249"><span class="linenos">3249</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3250"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3250"><span class="linenos">3250</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3251"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3251"><span class="linenos">3251</span></a>                    <span class="sa">f</span><span class="s2">&quot;Connection group ID lookup failed for: </span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3252"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3252"><span class="linenos">3252</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3253"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3253"><span class="linenos">3253</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3254"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3254"><span class="linenos">3254</span></a>            <span class="n">actual_conngroup_id</span><span class="p">,</span> <span class="n">conngroup_name</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3255"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3255"><span class="linenos">3255</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3256"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3256"><span class="linenos">3256</span></a>            <span class="c1"># Get user entity ID</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3257"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3257"><span class="linenos">3257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3258"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3258"><span class="linenos">3258</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3259"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3259"><span class="linenos">3259</span></a><span class="sd">                SELECT entity_id, name FROM guacamole_entity</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3260"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3260"><span class="linenos">3260</span></a><span class="sd">                WHERE name = %s AND type = &#39;USER&#39;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3261"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3261"><span class="linenos">3261</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3262"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3262"><span class="linenos">3262</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3263"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3263"><span class="linenos">3263</span></a>                <span class="p">(</span><span class="n">username</span><span class="p">,),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3264"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3264"><span class="linenos">3264</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3265"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3265"><span class="linenos">3265</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3266"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3266"><span class="linenos">3266</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3267"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3267"><span class="linenos">3267</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User lookup failed for: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3268"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3268"><span class="linenos">3268</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3269"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3269"><span class="linenos">3269</span></a>            <span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_username</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3270"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3270"><span class="linenos">3270</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3271"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3271"><span class="linenos">3271</span></a>            <span class="c1"># Check if permission exists and get its type</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3272"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3272"><span class="linenos">3272</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3273"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3273"><span class="linenos">3273</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3274"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3274"><span class="linenos">3274</span></a><span class="sd">                SELECT permission FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3275"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3275"><span class="linenos">3275</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3276"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3276"><span class="linenos">3276</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3277"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3277"><span class="linenos">3277</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3278"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3278"><span class="linenos">3278</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3279"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3279"><span class="linenos">3279</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3280"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3280"><span class="linenos">3280</span></a>            <span class="n">existing_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3281"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3281"><span class="linenos">3281</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_permission</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3282"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3282"><span class="linenos">3282</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3283"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3283"><span class="linenos">3283</span></a>                    <span class="sa">f</span><span class="s2">&quot;User &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; has no permission for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3284"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3284"><span class="linenos">3284</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3285"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3285"><span class="linenos">3285</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3286"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3286"><span class="linenos">3286</span></a>            <span class="n">permission_type</span> <span class="o">=</span> <span class="n">existing_permission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3287"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3287"><span class="linenos">3287</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3288"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3288"><span class="linenos">3288</span></a>                <span class="sa">f</span><span class="s2">&quot;Revoking &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3289"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3289"><span class="linenos">3289</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3290"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3290"><span class="linenos">3290</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3291"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3291"><span class="linenos">3291</span></a>            <span class="c1"># Revoke permission</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3292"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3292"><span class="linenos">3292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3293"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3293"><span class="linenos">3293</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3294"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3294"><span class="linenos">3294</span></a><span class="sd">                DELETE FROM guacamole_connection_group_permission</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3295"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3295"><span class="linenos">3295</span></a><span class="sd">                WHERE entity_id = %s AND connection_group_id = %s</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3296"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3296"><span class="linenos">3296</span></a><span class="sd">                LIMIT 1</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3297"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3297"><span class="linenos">3297</span></a><span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3298"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3298"><span class="linenos">3298</span></a>                <span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="n">actual_conngroup_id</span><span class="p">),</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3299"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3299"><span class="linenos">3299</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3300"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3300"><span class="linenos">3300</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3301"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3301"><span class="linenos">3301</span></a>            <span class="c1"># Verify deletion was successful</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3302"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3302"><span class="linenos">3302</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3303"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3303"><span class="linenos">3303</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3304"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3304"><span class="linenos">3304</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to revoke permission - no rows affected. Permission may have been removed by another operation.&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3305"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3305"><span class="linenos">3305</span></a>                <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3306"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3306"><span class="linenos">3306</span></a>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3307"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3307"><span class="linenos">3307</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3308"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3308"><span class="linenos">3308</span></a>                <span class="sa">f</span><span class="s2">&quot;Successfully revoked &#39;</span><span class="si">{</span><span class="n">permission_type</span><span class="si">}</span><span class="s2">&#39; permission from user &#39;</span><span class="si">{</span><span class="n">actual_username</span><span class="si">}</span><span class="s2">&#39; for connection group ID &#39;</span><span class="si">{</span><span class="n">actual_conngroup_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3309"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3309"><span class="linenos">3309</span></a>            <span class="p">)</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3310"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3310"><span class="linenos">3310</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3311"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3311"><span class="linenos">3311</span></a>        <span class="k">except</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3312"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3312"><span class="linenos">3312</span></a>            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Database error revoking connection group permission for user &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39; on group ID &#39;</span><span class="si">{</span><span class="n">conngroup_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3313"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3313"><span class="linenos">3313</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scrub_credentials</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
</span><span id="GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3314"><a href="#GuacamoleDB.revoke_connection_group_permission_from_user_by_id-3314"><span class="linenos">3314</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span></pre></div>


            <div class="docstring"><p>Revoke connection group permission from a specific user by connection group ID</p>
</div>


                            </div>
                </section>
                <section id="setup_logging">
                            <input id="setup_logging-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setup_logging</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>, </span><span class="param"><span class="n">force_reconfigure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="setup_logging-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#setup_logging"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="setup_logging-14"><a href="#setup_logging-14"><span class="linenos"> 14</span></a><span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">(</span><span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">force_reconfigure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="setup_logging-15"><a href="#setup_logging-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure logging for guacalib package with duplicate handler prevention.</span>
</span><span id="setup_logging-16"><a href="#setup_logging-16"><span class="linenos"> 16</span></a>
</span><span id="setup_logging-17"><a href="#setup_logging-17"><span class="linenos"> 17</span></a><span class="sd">    This function sets up logging configuration for the guacalib package.</span>
</span><span id="setup_logging-18"><a href="#setup_logging-18"><span class="linenos"> 18</span></a><span class="sd">    It includes guards against duplicate handlers to support repeated</span>
</span><span id="setup_logging-19"><a href="#setup_logging-19"><span class="linenos"> 19</span></a><span class="sd">    invocations and library usage scenarios. This function is idempotent</span>
</span><span id="setup_logging-20"><a href="#setup_logging-20"><span class="linenos"> 20</span></a><span class="sd">    and can be called multiple times safely.</span>
</span><span id="setup_logging-21"><a href="#setup_logging-21"><span class="linenos"> 21</span></a>
</span><span id="setup_logging-22"><a href="#setup_logging-22"><span class="linenos"> 22</span></a><span class="sd">    Args:</span>
</span><span id="setup_logging-23"><a href="#setup_logging-23"><span class="linenos"> 23</span></a><span class="sd">        debug: If True, set logging level to DEBUG; otherwise use WARNING.</span>
</span><span id="setup_logging-24"><a href="#setup_logging-24"><span class="linenos"> 24</span></a><span class="sd">               Ignored if GUACALIB_LOG_LEVEL environment variable is set.</span>
</span><span id="setup_logging-25"><a href="#setup_logging-25"><span class="linenos"> 25</span></a><span class="sd">        force_reconfigure: If True, remove existing handlers before configuration.</span>
</span><span id="setup_logging-26"><a href="#setup_logging-26"><span class="linenos"> 26</span></a><span class="sd">                         Used for testing and special scenarios.</span>
</span><span id="setup_logging-27"><a href="#setup_logging-27"><span class="linenos"> 27</span></a>
</span><span id="setup_logging-28"><a href="#setup_logging-28"><span class="linenos"> 28</span></a><span class="sd">    Note:</span>
</span><span id="setup_logging-29"><a href="#setup_logging-29"><span class="linenos"> 29</span></a><span class="sd">        - Function is idempotent - safe to call multiple times</span>
</span><span id="setup_logging-30"><a href="#setup_logging-30"><span class="linenos"> 30</span></a><span class="sd">        - Prevents duplicate handlers by checking existing handlers</span>
</span><span id="setup_logging-31"><a href="#setup_logging-31"><span class="linenos"> 31</span></a><span class="sd">        - **Important**: Does NOT modify root logger handlers - respects host application configuration</span>
</span><span id="setup_logging-32"><a href="#setup_logging-32"><span class="linenos"> 32</span></a><span class="sd">        - Only manages guacalib-specific handlers to avoid interference with embedding applications</span>
</span><span id="setup_logging-33"><a href="#setup_logging-33"><span class="linenos"> 33</span></a><span class="sd">        - Configures both guacalib root logger and module-specific loggers</span>
</span><span id="setup_logging-34"><a href="#setup_logging-34"><span class="linenos"> 34</span></a><span class="sd">        - Uses stderr for log output to preserve stdout for user-facing data</span>
</span><span id="setup_logging-35"><a href="#setup_logging-35"><span class="linenos"> 35</span></a><span class="sd">        - Must be called explicitly - never configured on import</span>
</span><span id="setup_logging-36"><a href="#setup_logging-36"><span class="linenos"> 36</span></a><span class="sd">        - **Phase 4**: Supports GUACALIB_LOG_LEVEL and GUACALIB_LOG_FORMAT environment variables</span>
</span><span id="setup_logging-37"><a href="#setup_logging-37"><span class="linenos"> 37</span></a>
</span><span id="setup_logging-38"><a href="#setup_logging-38"><span class="linenos"> 38</span></a><span class="sd">    Environment Variables:</span>
</span><span id="setup_logging-39"><a href="#setup_logging-39"><span class="linenos"> 39</span></a><span class="sd">        GUACALIB_LOG_LEVEL: Override logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)</span>
</span><span id="setup_logging-40"><a href="#setup_logging-40"><span class="linenos"> 40</span></a><span class="sd">        GUACALIB_LOG_FORMAT: Override log format string</span>
</span><span id="setup_logging-41"><a href="#setup_logging-41"><span class="linenos"> 41</span></a><span class="sd">                            Example: &#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;</span>
</span><span id="setup_logging-42"><a href="#setup_logging-42"><span class="linenos"> 42</span></a>
</span><span id="setup_logging-43"><a href="#setup_logging-43"><span class="linenos"> 43</span></a><span class="sd">    Example:</span>
</span><span id="setup_logging-44"><a href="#setup_logging-44"><span class="linenos"> 44</span></a><span class="sd">        &gt;&gt;&gt; # CLI usage (called from cli.main after parsing --debug)</span>
</span><span id="setup_logging-45"><a href="#setup_logging-45"><span class="linenos"> 45</span></a><span class="sd">        &gt;&gt;&gt; setup_logging(debug=True)</span>
</span><span id="setup_logging-46"><a href="#setup_logging-46"><span class="linenos"> 46</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="setup_logging-47"><a href="#setup_logging-47"><span class="linenos"> 47</span></a><span class="sd">        &gt;&gt;&gt; # Library usage with custom configuration</span>
</span><span id="setup_logging-48"><a href="#setup_logging-48"><span class="linenos"> 48</span></a><span class="sd">        &gt;&gt;&gt; setup_logging(debug=False)</span>
</span><span id="setup_logging-49"><a href="#setup_logging-49"><span class="linenos"> 49</span></a><span class="sd">        &gt;&gt;&gt; logger = logging.getLogger(&#39;guacalib.db&#39;)</span>
</span><span id="setup_logging-50"><a href="#setup_logging-50"><span class="linenos"> 50</span></a><span class="sd">        &gt;&gt;&gt; logger.info(&quot;Database operation completed&quot;)</span>
</span><span id="setup_logging-51"><a href="#setup_logging-51"><span class="linenos"> 51</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="setup_logging-52"><a href="#setup_logging-52"><span class="linenos"> 52</span></a><span class="sd">        &gt;&gt;&gt; # Environment variable usage</span>
</span><span id="setup_logging-53"><a href="#setup_logging-53"><span class="linenos"> 53</span></a><span class="sd">        &gt;&gt;&gt; # export GUACALIB_LOG_LEVEL=DEBUG</span>
</span><span id="setup_logging-54"><a href="#setup_logging-54"><span class="linenos"> 54</span></a><span class="sd">        &gt;&gt;&gt; # export GUACALIB_LOG_FORMAT=&#39;%(asctime)s [%(levelname)s] %(name)s: %(message)s&#39;</span>
</span><span id="setup_logging-55"><a href="#setup_logging-55"><span class="linenos"> 55</span></a><span class="sd">        &gt;&gt;&gt; setup_logging()</span>
</span><span id="setup_logging-56"><a href="#setup_logging-56"><span class="linenos"> 56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="setup_logging-57"><a href="#setup_logging-57"><span class="linenos"> 57</span></a>    <span class="c1"># Phase 4: Check for environment variable overrides</span>
</span><span id="setup_logging-58"><a href="#setup_logging-58"><span class="linenos"> 58</span></a>    <span class="n">env_log_level</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GUACALIB_LOG_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="setup_logging-59"><a href="#setup_logging-59"><span class="linenos"> 59</span></a>    <span class="n">env_log_format</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GUACALIB_LOG_FORMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="setup_logging-60"><a href="#setup_logging-60"><span class="linenos"> 60</span></a>
</span><span id="setup_logging-61"><a href="#setup_logging-61"><span class="linenos"> 61</span></a>    <span class="c1"># Determine logging level with environment variable support</span>
</span><span id="setup_logging-62"><a href="#setup_logging-62"><span class="linenos"> 62</span></a>    <span class="k">if</span> <span class="n">env_log_level</span><span class="p">:</span>
</span><span id="setup_logging-63"><a href="#setup_logging-63"><span class="linenos"> 63</span></a>        <span class="c1"># Map environment variable to logging level</span>
</span><span id="setup_logging-64"><a href="#setup_logging-64"><span class="linenos"> 64</span></a>        <span class="n">level_mapping</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="setup_logging-65"><a href="#setup_logging-65"><span class="linenos"> 65</span></a>            <span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
</span><span id="setup_logging-66"><a href="#setup_logging-66"><span class="linenos"> 66</span></a>            <span class="s1">&#39;INFO&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span id="setup_logging-67"><a href="#setup_logging-67"><span class="linenos"> 67</span></a>            <span class="s1">&#39;WARNING&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
</span><span id="setup_logging-68"><a href="#setup_logging-68"><span class="linenos"> 68</span></a>            <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
</span><span id="setup_logging-69"><a href="#setup_logging-69"><span class="linenos"> 69</span></a>            <span class="s1">&#39;CRITICAL&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
</span><span id="setup_logging-70"><a href="#setup_logging-70"><span class="linenos"> 70</span></a>        <span class="p">}</span>
</span><span id="setup_logging-71"><a href="#setup_logging-71"><span class="linenos"> 71</span></a>
</span><span id="setup_logging-72"><a href="#setup_logging-72"><span class="linenos"> 72</span></a>        <span class="k">if</span> <span class="n">env_log_level</span> <span class="ow">in</span> <span class="n">level_mapping</span><span class="p">:</span>
</span><span id="setup_logging-73"><a href="#setup_logging-73"><span class="linenos"> 73</span></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">level_mapping</span><span class="p">[</span><span class="n">env_log_level</span><span class="p">]</span>
</span><span id="setup_logging-74"><a href="#setup_logging-74"><span class="linenos"> 74</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="setup_logging-75"><a href="#setup_logging-75"><span class="linenos"> 75</span></a>            <span class="c1"># Invalid environment variable - fallback to debug parameter</span>
</span><span id="setup_logging-76"><a href="#setup_logging-76"><span class="linenos"> 76</span></a>            <span class="c1"># and print warning to stderr (since logging isn&#39;t configured yet)</span>
</span><span id="setup_logging-77"><a href="#setup_logging-77"><span class="linenos"> 77</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Invalid GUACALIB_LOG_LEVEL &#39;</span><span class="si">{</span><span class="n">env_log_level</span><span class="si">}</span><span class="s2">&#39;. Using debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s2"> instead.&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="setup_logging-78"><a href="#setup_logging-78"><span class="linenos"> 78</span></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
</span><span id="setup_logging-79"><a href="#setup_logging-79"><span class="linenos"> 79</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="setup_logging-80"><a href="#setup_logging-80"><span class="linenos"> 80</span></a>        <span class="c1"># No environment variable override - use debug parameter</span>
</span><span id="setup_logging-81"><a href="#setup_logging-81"><span class="linenos"> 81</span></a>        <span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
</span><span id="setup_logging-82"><a href="#setup_logging-82"><span class="linenos"> 82</span></a>
</span><span id="setup_logging-83"><a href="#setup_logging-83"><span class="linenos"> 83</span></a>    <span class="c1"># Get the guacalib root logger</span>
</span><span id="setup_logging-84"><a href="#setup_logging-84"><span class="linenos"> 84</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;guacalib&#39;</span><span class="p">)</span>
</span><span id="setup_logging-85"><a href="#setup_logging-85"><span class="linenos"> 85</span></a>
</span><span id="setup_logging-86"><a href="#setup_logging-86"><span class="linenos"> 86</span></a>    <span class="c1"># Check if already configured to avoid duplicate handlers</span>
</span><span id="setup_logging-87"><a href="#setup_logging-87"><span class="linenos"> 87</span></a>    <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_reconfigure</span><span class="p">:</span>
</span><span id="setup_logging-88"><a href="#setup_logging-88"><span class="linenos"> 88</span></a>        <span class="k">return</span>
</span><span id="setup_logging-89"><a href="#setup_logging-89"><span class="linenos"> 89</span></a>
</span><span id="setup_logging-90"><a href="#setup_logging-90"><span class="linenos"> 90</span></a>    <span class="c1"># Remove any existing handlers if forcing reconfiguration</span>
</span><span id="setup_logging-91"><a href="#setup_logging-91"><span class="linenos"> 91</span></a>    <span class="k">if</span> <span class="n">force_reconfigure</span><span class="p">:</span>
</span><span id="setup_logging-92"><a href="#setup_logging-92"><span class="linenos"> 92</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="setup_logging-93"><a href="#setup_logging-93"><span class="linenos"> 93</span></a>
</span><span id="setup_logging-94"><a href="#setup_logging-94"><span class="linenos"> 94</span></a>    <span class="c1"># **Important**: Do NOT remove root logger handlers - respect host application&#39;s logging configuration</span>
</span><span id="setup_logging-95"><a href="#setup_logging-95"><span class="linenos"> 95</span></a>    <span class="c1"># Only manage guacalib-specific handlers to avoid interfering with embedding applications</span>
</span><span id="setup_logging-96"><a href="#setup_logging-96"><span class="linenos"> 96</span></a>
</span><span id="setup_logging-97"><a href="#setup_logging-97"><span class="linenos"> 97</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_logging-98"><a href="#setup_logging-98"><span class="linenos"> 98</span></a>
</span><span id="setup_logging-99"><a href="#setup_logging-99"><span class="linenos"> 99</span></a>    <span class="c1"># Create handler for stderr</span>
</span><span id="setup_logging-100"><a href="#setup_logging-100"><span class="linenos">100</span></a>    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="setup_logging-101"><a href="#setup_logging-101"><span class="linenos">101</span></a>    <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="setup_logging-102"><a href="#setup_logging-102"><span class="linenos">102</span></a>
</span><span id="setup_logging-103"><a href="#setup_logging-103"><span class="linenos">103</span></a>    <span class="c1"># Phase 4: Create formatter based on environment variables or debug mode</span>
</span><span id="setup_logging-104"><a href="#setup_logging-104"><span class="linenos">104</span></a>    <span class="k">if</span> <span class="n">env_log_format</span><span class="p">:</span>
</span><span id="setup_logging-105"><a href="#setup_logging-105"><span class="linenos">105</span></a>        <span class="c1"># Use custom format from environment variable</span>
</span><span id="setup_logging-106"><a href="#setup_logging-106"><span class="linenos">106</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="setup_logging-107"><a href="#setup_logging-107"><span class="linenos">107</span></a>            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">env_log_format</span><span class="p">)</span>
</span><span id="setup_logging-108"><a href="#setup_logging-108"><span class="linenos">108</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="setup_logging-109"><a href="#setup_logging-109"><span class="linenos">109</span></a>            <span class="c1"># Invalid format string - fallback to debug mode</span>
</span><span id="setup_logging-110"><a href="#setup_logging-110"><span class="linenos">110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Invalid GUACALIB_LOG_FORMAT &#39;</span><span class="si">{</span><span class="n">env_log_format</span><span class="si">}</span><span class="s2">&#39;. Using debug=</span><span class="si">{</span><span class="n">debug</span><span class="si">}</span><span class="s2"> format instead. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="setup_logging-111"><a href="#setup_logging-111"><span class="linenos">111</span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="setup_logging-112"><a href="#setup_logging-112"><span class="linenos">112</span></a>                <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span><span id="setup_logging-113"><a href="#setup_logging-113"><span class="linenos">113</span></a>                    <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="setup_logging-114"><a href="#setup_logging-114"><span class="linenos">114</span></a>                    <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
</span><span id="setup_logging-115"><a href="#setup_logging-115"><span class="linenos">115</span></a>                <span class="p">)</span>
</span><span id="setup_logging-116"><a href="#setup_logging-116"><span class="linenos">116</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="setup_logging-117"><a href="#setup_logging-117"><span class="linenos">117</span></a>                <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="setup_logging-118"><a href="#setup_logging-118"><span class="linenos">118</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="setup_logging-119"><a href="#setup_logging-119"><span class="linenos">119</span></a>        <span class="c1"># Use default format based on debug mode</span>
</span><span id="setup_logging-120"><a href="#setup_logging-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="setup_logging-121"><a href="#setup_logging-121"><span class="linenos">121</span></a>            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
</span><span id="setup_logging-122"><a href="#setup_logging-122"><span class="linenos">122</span></a>                <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="setup_logging-123"><a href="#setup_logging-123"><span class="linenos">123</span></a>                <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
</span><span id="setup_logging-124"><a href="#setup_logging-124"><span class="linenos">124</span></a>            <span class="p">)</span>
</span><span id="setup_logging-125"><a href="#setup_logging-125"><span class="linenos">125</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="setup_logging-126"><a href="#setup_logging-126"><span class="linenos">126</span></a>            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="setup_logging-127"><a href="#setup_logging-127"><span class="linenos">127</span></a>
</span><span id="setup_logging-128"><a href="#setup_logging-128"><span class="linenos">128</span></a>    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span><span id="setup_logging-129"><a href="#setup_logging-129"><span class="linenos">129</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span><span id="setup_logging-130"><a href="#setup_logging-130"><span class="linenos">130</span></a>
</span><span id="setup_logging-131"><a href="#setup_logging-131"><span class="linenos">131</span></a>    <span class="c1"># Prevent propagation to root logger to avoid duplication</span>
</span><span id="setup_logging-132"><a href="#setup_logging-132"><span class="linenos">132</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Configure logging for guacalib package with duplicate handler prevention.</p>

<p>This function sets up logging configuration for the guacalib package.
It includes guards against duplicate handlers to support repeated
invocations and library usage scenarios. This function is idempotent
and can be called multiple times safely.</p>

<p>Args:
    debug: If True, set logging level to DEBUG; otherwise use WARNING.
           Ignored if GUACALIB_LOG_LEVEL environment variable is set.
    force_reconfigure: If True, remove existing handlers before configuration.
                     Used for testing and special scenarios.</p>

<p>Note:
    - Function is idempotent - safe to call multiple times
    - Prevents duplicate handlers by checking existing handlers
    - <strong>Important</strong>: Does NOT modify root logger handlers - respects host application configuration
    - Only manages guacalib-specific handlers to avoid interference with embedding applications
    - Configures both guacalib root logger and module-specific loggers
    - Uses stderr for log output to preserve stdout for user-facing data
    - Must be called explicitly - never configured on import
    - <strong>Phase 4</strong>: Supports GUACALIB_LOG_LEVEL and GUACALIB_LOG_FORMAT environment variables</p>

<p>Environment Variables:
    GUACALIB_LOG_LEVEL: Override logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
    GUACALIB_LOG_FORMAT: Override log format string
                        Example: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <h1 id="cli-usage-called-from-climain-after-parsing-debug">CLI usage (called from cli.main after parsing --debug)</h1>
      
      <p>setup_logging(debug=True)</p>
      
      <h1 id="library-usage-with-custom-configuration">Library usage with custom configuration</h1>
      
      <p>setup_logging(debug=False)
      logger = logging.getLogger('guacalib.db')
      logger.info("Database operation completed")</p>
      
      <h1 id="environment-variable-usage">Environment variable usage</h1>
      
      <h1 id="export-guacalib_log_leveldebug">export GUACALIB_LOG_LEVEL=DEBUG</h1>
      
      <h1 id="export-guacalib_log_formatasctimes-levelnames-names-messages">export GUACALIB_LOG_FORMAT='%(asctime)s [%(levelname)s] %(name)s: %(message)s'</h1>
      
      <p>setup_logging()</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                </section>
                <section id="get_logger">
                            <input id="get_logger-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_logger</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span>:</span></span>

                <label class="view-source-button" for="get_logger-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_logger"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_logger-135"><a href="#get_logger-135"><span class="linenos">135</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
</span><span id="get_logger-136"><a href="#get_logger-136"><span class="linenos">136</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a logger instance for a specific guacalib module.</span>
</span><span id="get_logger-137"><a href="#get_logger-137"><span class="linenos">137</span></a>
</span><span id="get_logger-138"><a href="#get_logger-138"><span class="linenos">138</span></a><span class="sd">    Args:</span>
</span><span id="get_logger-139"><a href="#get_logger-139"><span class="linenos">139</span></a><span class="sd">        name: The module name (e.g., &#39;db&#39;, &#39;cli&#39;, &#39;cli_handle_user&#39;)</span>
</span><span id="get_logger-140"><a href="#get_logger-140"><span class="linenos">140</span></a>
</span><span id="get_logger-141"><a href="#get_logger-141"><span class="linenos">141</span></a><span class="sd">    Returns:</span>
</span><span id="get_logger-142"><a href="#get_logger-142"><span class="linenos">142</span></a><span class="sd">        A configured logger instance for the specified module.</span>
</span><span id="get_logger-143"><a href="#get_logger-143"><span class="linenos">143</span></a>
</span><span id="get_logger-144"><a href="#get_logger-144"><span class="linenos">144</span></a><span class="sd">    Example:</span>
</span><span id="get_logger-145"><a href="#get_logger-145"><span class="linenos">145</span></a><span class="sd">        &gt;&gt;&gt; logger = get_logger(&#39;db&#39;)</span>
</span><span id="get_logger-146"><a href="#get_logger-146"><span class="linenos">146</span></a><span class="sd">        &gt;&gt;&gt; logger.debug(&quot;Executing SQL query&quot;)</span>
</span><span id="get_logger-147"><a href="#get_logger-147"><span class="linenos">147</span></a>
</span><span id="get_logger-148"><a href="#get_logger-148"><span class="linenos">148</span></a><span class="sd">    Note:</span>
</span><span id="get_logger-149"><a href="#get_logger-149"><span class="linenos">149</span></a><span class="sd">        This helper function must follow AGENTS.md requirements:</span>
</span><span id="get_logger-150"><a href="#get_logger-150"><span class="linenos">150</span></a><span class="sd">        - Includes proper type hints and Google-style docstrings</span>
</span><span id="get_logger-151"><a href="#get_logger-151"><span class="linenos">151</span></a><span class="sd">        - Uses clear, meaningful function names</span>
</span><span id="get_logger-152"><a href="#get_logger-152"><span class="linenos">152</span></a><span class="sd">        - Handles parameters appropriately</span>
</span><span id="get_logger-153"><a href="#get_logger-153"><span class="linenos">153</span></a><span class="sd">        - Follows single-responsibility principle</span>
</span><span id="get_logger-154"><a href="#get_logger-154"><span class="linenos">154</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_logger-155"><a href="#get_logger-155"><span class="linenos">155</span></a>    <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;guacalib.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get a logger instance for a specific guacalib module.</p>

<p>Args:
    name: The module name (e.g., 'db', 'cli', 'cli_handle_user')</p>

<p>Returns:
    A configured logger instance for the specified module.</p>

<p>Example:</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>logger = get_logger('db')
      logger.debug("Executing SQL query")</p>
    </blockquote>
  </blockquote>
</blockquote>

<p>Note:
    This helper function must follow AGENTS.md requirements:
    - Includes proper type hints and Google-style docstrings
    - Uses clear, meaningful function names
    - Handles parameters appropriately
    - Follows single-responsibility principle</p>
</div>


                </section>
    </main>
</body>
</html>